{"config":{"lang":["ru"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"\u0413\u043b\u0430\u0432\u043d\u0430\u044f","text":""},{"location":"index.html#_1","title":"\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u0435\u043a\u0442\u0430","text":"<p>\u0422\u0443\u0442 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438\u043b\u0438 \u0443\u0434\u0430\u043b\u0438\u0442\u044c, \u0435\u0441\u043b\u0438 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430</p>"},{"location":"domain.html","title":"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043d\u044b\u0445 \u043e\u0431\u043b\u0430\u0441\u0442\u0435\u0439","text":""},{"location":"domain.html#_1","title":"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043d\u044b\u0445 \u043e\u0431\u043b\u0430\u0441\u0442\u0435\u0439","text":"<ol> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0441\u0438\u043c\u0443\u043b\u044f\u0442\u043e\u0440\u0430 \u0434\u043b\u044f \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b-\u0433\u043e\u043b\u043e\u0432\u043e\u043b\u043e\u043c\u043a\u0438 \u0434\u043b\u044f \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043d\u0430\u0440\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0439 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0439  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abAction\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abAdventure\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abRole-Playing Game\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abSimulator\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abStrategy\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abShooter\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abPlatform game\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abTower Defense\u00bb \u043d\u0430 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 Unity  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u0438\u0433\u0440\u044b \u043d\u0430 \u0431\u0430\u0437\u0435 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u044b Unity \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c 2D-\u043c\u043e\u0434\u0435\u043b\u0435\u0439  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u0438\u0433\u0440\u044b \u043d\u0430 \u0431\u0430\u0437\u0435 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u044b Unity \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c 3D-\u043c\u043e\u0434\u0435\u043b\u0435\u0439  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043d\u043e\u0439 \u0438\u0433\u0440\u044b  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abSurvival\u00bb  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0446\u0438\u0438 \u043e\u043d\u043b\u0430\u0439\u043d-\u0438\u0433\u0440\u044b \u0438 \u0435\u0451 \u043e\u043f\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f  </li> <li>\u041f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445 \u0443\u0447\u0435\u0431\u043d\u044b\u0445 \u0438\u0433\u0440 \u0441 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c \u0441\u0440\u0435\u0434\u044b Unity 3D  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u043a\u0430\u0437\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u0438\u0433\u0440\u044b (casual) \u0434\u043b\u044f \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0433\u0438\u043f\u0435\u0440-\u043a\u0430\u0437\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u0438\u0433\u0440\u044b (hyper-casual) \u0434\u043b\u044f \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b-\u0432\u0438\u043a\u0442\u043e\u0440\u0438\u043d\u044b (quiz/trivia)  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0441 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430\u043c\u0438 \u0441\u043b\u043e\u0432\u0435\u0441\u043d\u044b\u0445 \u0433\u043e\u043b\u043e\u0432\u043e\u043b\u043e\u043c\u043e\u043a (word puzzle)  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00abIdle/Clicker\u00bb  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043d\u043e\u0439 \u0438\u0433\u0440\u044b (card game)  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0432\u0438\u0437\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u043d\u043e\u0432\u0435\u043b\u043b\u044b (visual novel)  </li> <li>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430 \u0438\u0433\u0440\u044b \u0432 \u0436\u0430\u043d\u0440\u0435 \u00ab2D Roguelike / \u043b\u0430\u0431\u0438\u0440\u0438\u043d\u0442\u00bb  </li> </ol>"},{"location":"practice/api_design.html","title":"API \u0434\u0438\u0437\u0430\u0439\u043d","text":""},{"location":"practice/api_design.html#2-5-api","title":"2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. 5. API \u0434\u0438\u0437\u0430\u0439\u043d \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":""},{"location":"practice/api_design.html#50","title":"5.0. \u0421\u043c\u044b\u0441\u043b \u0440\u0430\u0437\u0434\u0435\u043b\u0430","text":"<p>API \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b Unity/Web/Mobile \u043c\u043e\u0433\u043b\u0438 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441 \u043d\u0438\u043c \u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u043e \u0438 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u043e:</p> <ul> <li>stateless REST (\u0431\u0435\u0437 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0445 \u0441\u0435\u0441\u0441\u0438\u0439);</li> <li>\u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c: JWT + RBAC + \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f;</li> <li>\u0435\u0434\u0438\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u0438 \u043e\u0448\u0438\u0431\u043e\u043a;</li> <li>\u0443\u0434\u043e\u0431\u0441\u0442\u0432\u043e \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (Postman / <code>test_client.html</code> / Swagger).</li> </ul> <p>\u041a\u043b\u044e\u0447\u0435\u0432\u0430\u044f \u0438\u0434\u0435\u044f: API \u2014 \u044d\u0442\u043e \u043a\u043e\u043d\u0432\u0435\u0439\u0435\u0440 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430, \u0433\u0434\u0435 \u0432\u0441\u0451 \u0440\u0430\u0437\u043b\u043e\u0436\u0435\u043d\u043e \u043f\u043e \u0441\u043b\u043e\u044f\u043c \u0438 \u043a\u0430\u0436\u0434\u044b\u0439 \u0441\u043b\u043e\u0439 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u0441\u0432\u043e\u0451.</p>"},{"location":"practice/api_design.html#51-5-api","title":"5.1. \u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0443 5 \u00abAPI \u0434\u0438\u0437\u0430\u0439\u043d\u00bb","text":""},{"location":"practice/api_design.html#_1","title":"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c","text":"<ol> <li> <p>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c MVP endpoints (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 5) \u0438 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0442\u044c, \u0447\u0442\u043e \u043e\u043d\u0438 \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u043e\u0442\u0432\u0435\u0447\u0430\u044e\u0442:</p> </li> <li> <p><code>POST /api/v1/auth/register</code></p> </li> <li><code>POST /api/v1/auth/login</code></li> <li><code>GET /api/v1/profile</code></li> <li><code>POST /api/v1/events</code></li> <li><code>GET /api/v1/leaderboard</code></li> </ol> <p>\u041e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e (\u0435\u0441\u043b\u0438 \u0443\u0441\u043f\u0435\u0432\u0430\u0435\u0442\u0435):</p> <ul> <li><code>POST /api/v1/match/finish</code></li> <li> <p><code>GET /health</code></p> </li> <li> <p>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0434\u0438\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432:</p> </li> <li> <p>\u0443\u0441\u043f\u0435\u0445: <code>{ \"ok\": true, \"data\": ... }</code></p> </li> <li> <p>\u043e\u0448\u0438\u0431\u043a\u0430: <code>{ \"ok\": false, \"error\": { \"code\", \"message\", \"requestId\" } }</code></p> </li> <li> <p>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 REST (\u0440\u0435\u0441\u0443\u0440\u0441\u043d\u043e\u0441\u0442\u044c, stateless, \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0432 \u0411\u0414).</p> </li> <li> <p>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 HTTP-\u043a\u043e\u0434\u044b (200/201/400/401/403/404/409/429/500) \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043a\u0430\u0436\u0434\u044b\u0439 \u043c\u043e\u0436\u043d\u043e \u0431\u044b\u043b\u043e \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0441\u0442\u0438 \u0442\u0435\u0441\u0442\u043e\u043c.</p> </li> </ul>"},{"location":"practice/api_design.html#_2","title":"\u0410\u0440\u0442\u0435\u0444\u0430\u043a\u0442","text":"<ul> <li>\u0420\u0430\u0431\u043e\u0442\u0430\u044e\u0449\u0438\u0439 API (\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f <code>python wsgi.py</code> \u0438 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043d\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u044b).</li> <li>\u0414\u043b\u044f \u0441\u0434\u0430\u0447\u0438 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e Postman-\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438, <code>test_client.html</code> \u0438\u043b\u0438 Swagger UI (\u0435\u0441\u043b\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0451\u043d).</li> </ul>"},{"location":"practice/api_design.html#52-api","title":"5.2. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 API (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0430)","text":"<p>API-\u0441\u043b\u043e\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 (auth, profile, events, leaderboard) \u0435\u0434\u0438\u043d\u043e\u043e\u0431\u0440\u0430\u0437\u043d\u043e.</p> <p>\u041a\u043e\u043d\u0432\u0435\u0439\u0435\u0440 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432:</p> <pre><code>Request\n  \u2192 requestId + logging\n  \u2192 authJwt (\u0442\u0430\u043c \u0433\u0434\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)\n  \u2192 validate (body/query)\n  \u2192 controller\n  \u2192 service (business / orchestration / \u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 transaction)\n  \u2192 repository (SQL)\n  \u2192 response (JSON)\nError \u2192 errorHandler \u2192 JSON + logging\n</code></pre>"},{"location":"practice/api_design.html#521","title":"5.2.1. \u0427\u0442\u043e \u0433\u0434\u0435 \u043f\u0438\u0441\u0430\u0442\u044c (\u0441\u0442\u0440\u043e\u0433\u043e\u0435 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u0438)","text":"<ul> <li> <p>routes/ \u2014 \u0442\u043e\u043b\u044c\u043a\u043e URL-\u0442\u0430\u0431\u043b\u0438\u0446\u0430 (\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b), \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0438 \u0432\u044b\u0437\u043e\u0432 controller.   \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0441\u0432\u044f\u0437\u0430\u0442\u044c HTTP-\u043c\u0435\u0442\u043e\u0434 + \u043f\u0443\u0442\u044c \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u043c \u0438 middleware.   \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f: \u043d\u0438\u043a\u0430\u043a\u0438\u0445 SQL, \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043b\u043e\u0433\u0438\u043a\u0438.</p> </li> <li> <p>controllers/ \u2014 \u0441\u043b\u043e\u0439 HTTP-\u0430\u0434\u0430\u043f\u0442\u0435\u0440\u0430: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 (body/query/g.user), \u0432\u044b\u0437\u0432\u0430\u0442\u044c service, \u0432\u0435\u0440\u043d\u0443\u0442\u044c <code>{ok:true,data:...}</code>.   \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0443\u043d\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0442\u0432\u0435\u0442\u0430 \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442 (HTTP) \u0438 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0443.   \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f: \u043d\u0438\u043a\u0430\u043a\u0438\u0445 SQL, \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439.</p> </li> <li> <p>services/ \u2014 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430, \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438, orchestration \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432, \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439.   \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0442\u043e\u0447\u043a\u0430, \u0433\u0434\u0435 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u044e\u0442\u0441\u044f \u0431\u0438\u0437\u043d\u0435\u0441-\u0440\u0435\u0448\u0435\u043d\u0438\u044f (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \"\u0435\u0441\u043b\u0438 eventType=match_finish \u2014 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0438\u0442\u043e\u0433\u043e\u0432\u0443\u044e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443\").   \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f: \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u0434\u043e\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0434\u0435\u0441\u044c (\u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u044b); \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b \u0438 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043d\u0435 \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u044e\u0442.</p> </li> <li> <p>repositories/ \u2014 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0434\u0430\u043d\u043d\u044b\u043c: \u0442\u043e\u043b\u044c\u043a\u043e SQL (<code>SELECT/INSERT/UPDATE/UPSERT</code>).   \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0411\u0414 \u0438 \u0441\u0434\u0435\u043b\u0430\u0442\u044c SQL \u043f\u0435\u0440\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u043c.   \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f: \u043d\u0438\u043a\u0430\u043a\u043e\u0439 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0438, \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \"\u043f\u0440\u0430\u0432\u0438\u043b \u0438\u0433\u0440\u044b\", \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0440\u0430\u0441\u0447\u0451\u0442\u043e\u0432 \u043d\u0430\u0433\u0440\u0430\u0434.</p> </li> <li> <p>middleware/ \u2014 \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430: requestId/auth/validate/errorHandler.   \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0435\u0434\u0438\u043d\u044b\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432 (\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c, \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f, \u043e\u0448\u0438\u0431\u043a\u0438).   \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f: \u043d\u0438\u043a\u0430\u043a\u043e\u0433\u043e SQL.</p> </li> </ul>"},{"location":"practice/api_design.html#53-rest","title":"5.3. \u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f REST","text":""},{"location":"practice/api_design.html#531","title":"5.3.1. \u0420\u0435\u0441\u0443\u0440\u0441\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434","text":"<ul> <li>\u043f\u043b\u043e\u0445\u043e: <code>/doLogin</code>, <code>/sendEventCommand</code></li> <li>\u0445\u043e\u0440\u043e\u0448\u043e: <code>/api/v1/auth/login</code>, <code>/api/v1/events</code>, <code>/api/v1/profile</code></li> </ul> <p>\u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0435 \"\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435\" \u0432 \u0438\u0433\u0440\u043e\u0432\u044b\u0445 API \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u043a \u043f\u043e\u0434\u0440\u0435\u0441\u0443\u0440\u0441:</p> <ul> <li><code>POST /api/v1/match/finish</code></li> <li><code>POST /api/v1/events</code></li> </ul>"},{"location":"practice/api_design.html#532-stateless","title":"5.3.2. Stateless","text":"<p>\u041a\u0430\u0436\u0434\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435\u0441\u0451\u0442 \u0432\u0441\u0451 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0435:</p> <ul> <li><code>Authorization: Bearer &lt;JWT&gt;</code></li> <li>JSON body / query params</li> </ul> <p>\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0432 \u0411\u0414 (<code>player_progress</code>, <code>matches</code>, <code>leaderboard_scores</code>, <code>statistics_daily</code>), \u0430 \u043d\u0435 \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.</p>"},{"location":"practice/api_design.html#533-json-endpoint","title":"5.3.3. \u0415\u0434\u0438\u043d\u044b\u0439 JSON-\u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d \u0434\u043b\u044f \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432)","text":"<p>\u0423\u0441\u043f\u0435\u0445:</p> <pre><code>{ \"ok\": true, \"data\": {} }\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Field level must be &gt;= 1\",\n    \"requestId\": \"req_abc123\"\n  }\n}\n</code></pre>"},{"location":"practice/api_design.html#54-http","title":"5.4. HTTP \u043a\u043e\u0434\u044b (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440)","text":"<p>\u0414\u043e\u043b\u0436\u043d\u044b \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f:</p> <ul> <li><code>200 OK</code> \u2014 \u0443\u0441\u043f\u0435\u0448\u043d\u043e</li> <li><code>201 Created</code> \u2014 \u0441\u043e\u0437\u0434\u0430\u043d \u0440\u0435\u0441\u0443\u0440\u0441</li> <li><code>400 Bad Request</code> \u2014 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438/\u0444\u043e\u0440\u043c\u0430\u0442\u0430</li> <li><code>401 Unauthorized</code> \u2014 \u043d\u0435\u0442/\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u0435\u043d JWT</li> <li><code>403 Forbidden</code> \u2014 \u043d\u0435\u0442 \u043f\u0440\u0430\u0432 / \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u0430\u043d\u0435\u043d</li> <li><code>404 Not Found</code> \u2014 \u0440\u0435\u0441\u0443\u0440\u0441 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d</li> <li><code>409 Conflict</code> \u2014 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f/\u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 / \u0434\u0443\u0431\u043b\u0438\u0440\u0443\u044e\u0449\u0435\u0435\u0441\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u0435</li> <li><code>429 Too Many Requests</code> \u2014 rate limit</li> <li><code>500 Internal Server Error</code> \u2014 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430</li> </ul>"},{"location":"practice/api_design.html#55-api-v1","title":"5.5. \u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u043f\u043e\u0434 API v1","text":"<p>\u0415\u0441\u043b\u0438 \u0440\u0430\u043d\u0435\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u043b \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u0438\u043d endpoint, \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0440\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044c \u043f\u0440\u043e\u0435\u043a\u0442 \u043f\u043e \u0435\u0434\u0438\u043d\u043e\u0439 \u0441\u0445\u0435\u043c\u0435 \u0441\u043b\u043e\u0451\u0432: routes \u2192 controllers \u2192 services \u2192 repositories.</p> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u043f\u043e\u0441\u043b\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f:</p> <pre><code>app/\n  config.py          \u2190 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0437\u0434\u0435\u0441\u044c, \u043d\u0435 \u0432 \u043a\u043e\u0440\u043d\u0435\n  __init__.py        \u2190 create_app() \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u0432\u0441\u0435 blueprint'\u044b\n  extensions.py      \u2190 db, jwt, cors\n  routes/\n    auth.py\n    match.py\n    profile.py\n    events.py\n    leaderboard.py\n    health.py\n  controllers/\n    auth_controller.py\n    match_controller.py\n    profile_controller.py\n    events_controller.py\n    leaderboard_controller.py\n  services/\n    auth_service.py\n    match_service.py\n    profile_service.py\n    events_service.py\n    leaderboard_service.py\n  repositories/\n    events_repo.py\n    progress_repo.py\n    leaderboard_repo.py\n    stats_repo.py\n    users_repo.py\n    roles_repo.py\n    matches_repo.py\n    dedupe_repo.py\n  middleware/\n    request_id.py\n    auth_jwt.py\n    validate_api.py\n    error_handler.py\nwsgi.py              \u2190 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430\n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e: middleware \u043e\u0441\u0442\u0430\u0451\u0442\u0441\u044f \u043e\u0431\u0449\u0438\u043c \u0434\u043b\u044f \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432 (requestId/errorHandler), \u0430 <code>auth_required</code> \u0438 \u0432\u0430\u043b\u0438\u0434\u0430\u0442\u043e\u0440\u044b \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u044e\u0442\u0441\u044f \u0442\u0430\u043c, \u0433\u0434\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f.</p>"},{"location":"practice/api_design.html#56-api-v1","title":"5.6. \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 API v1 \u0438 \u043f\u0440\u0438\u043c\u0435\u0440 \u0438\u0445 \u043d\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0438\u043d\u0438\u043c\u0443\u043c)","text":"<p>\u0426\u0435\u043b\u044c: \u0447\u0442\u043e\u0431\u044b \u0432\u0441\u0435 5 MVP endpoint'\u043e\u0432 \u0431\u044b\u043b\u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u043e \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e (routes/controllers/services/repositories) \u0438 \u0432\u044b\u0434\u0430\u0432\u0430\u043b\u0438 \u0435\u0434\u0438\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442.</p>"},{"location":"practice/api_design.html#561-blueprint-app__init__py","title":"5.6.1. \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f blueprint'\u043e\u0432 \u0432 <code>app/__init__.py</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0432\u0441\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u043a \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044e, \u0447\u0442\u043e\u0431\u044b endpoints \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u043f\u043e\u044f\u0432\u0438\u043b\u0438\u0441\u044c.</p> <pre><code>from .routes.match import match_bp\nfrom .routes.auth import auth_bp\nfrom .routes.profile import profile_bp\nfrom .routes.events import events_bp\nfrom .routes.leaderboard import leaderboard_bp\nfrom .routes.health import health_bp\n\n# \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u043c blueprint'\u044b, \u0447\u0442\u043e\u0431\u044b Flask \u043d\u0430\u0447\u0430\u043b \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b\napp.register_blueprint(auth_bp)\napp.register_blueprint(events_bp)\napp.register_blueprint(health_bp)\napp.register_blueprint(leaderboard_bp)\napp.register_blueprint(profile_bp)\napp.register_blueprint(match_bp)\n</code></pre> <p>\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439: \u0435\u0441\u043b\u0438 blueprint \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d \u2014 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 endpoint \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0440\u043e\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d.</p>"},{"location":"practice/api_design.html#562-routes-5-endpoints","title":"5.6.2. Routes (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 5 endpoints)","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 routes: \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c URL, HTTP-\u043c\u0435\u0442\u043e\u0434 \u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043d\u0443\u0436\u043d\u044b\u0435 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b (\u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f, JWT).</p>"},{"location":"practice/api_design.html#approutesauthpy","title":"<code>app/routes/auth.py</code>","text":"<pre><code>from flask import Blueprint\nfrom app.controllers.auth_controller import register_controller, login_controller\nfrom app.middleware.validate_api import validate_register, validate_login\n\n# Blueprint \u0434\u043b\u044f /api/v1/auth/*\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0438 \u043b\u043e\u0433\u0438\u043d\u0430\nauth_bp = Blueprint(\"auth\", __name__, url_prefix=\"/api/v1/auth\")\n\n\n@auth_bp.post(\"/register\")\n@validate_register  # \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0442\u0435\u043b\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0434\u043e \u043f\u043e\u043f\u0430\u0434\u0430\u043d\u0438\u044f \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\ndef register():\n    # \u041c\u0430\u0440\u0448\u0440\u0443\u0442 \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043b\u043e\u0433\u0438\u043a\u0438: \u0434\u0435\u043b\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0432 controller\n    return register_controller()\n\n\n@auth_bp.post(\"/login\")\n@validate_login  # \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0442\u0435\u043b\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0434\u043e \u043f\u043e\u043f\u0430\u0434\u0430\u043d\u0438\u044f \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\ndef login():\n    return login_controller()\n</code></pre>"},{"location":"practice/api_design.html#approutesprofilepy","title":"<code>app/routes/profile.py</code>","text":"<pre><code>from flask import Blueprint\nfrom app.controllers.profile_controller import profile_controller\nfrom app.middleware.auth_jwt import auth_required\n\n# Blueprint \u0434\u043b\u044f /api/v1/*\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0432\u044b\u043d\u0435\u0441\u0442\u0438 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432\nprofile_bp = Blueprint(\"profile\", __name__, url_prefix=\"/api/v1\")\n\n\n@profile_bp.get(\"/profile\")\n@auth_required(roles=[\"player\"])  # \u0434\u043e\u0441\u0442\u0443\u043f \u0442\u043e\u043b\u044c\u043a\u043e \u0441 JWT \u0438 \u0440\u043e\u043b\u044c\u044e player\ndef profile():\n    return profile_controller()\n</code></pre>"},{"location":"practice/api_design.html#approuteseventspy","title":"<code>app/routes/events.py</code>","text":"<pre><code>from flask import Blueprint\nfrom app.controllers.events_controller import post_event_controller\nfrom app.middleware.auth_jwt import auth_required\nfrom app.middleware.validate_api import validate_event\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u0440\u0438\u0451\u043c \u0438\u0433\u0440\u043e\u0432\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0435\u0434\u0438\u043d\u044b\u043c endpoint'\u043e\u043c\nevents_bp = Blueprint(\"events\", __name__, url_prefix=\"/api/v1\")\n\n\n@events_bp.post(\"/events\")\n@auth_required(roles=[\"player\"])  # \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043f\u0438\u0448\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430\n@validate_event                   # \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b eventId/eventType/sessionId/clientTime/payload\ndef post_event():\n    return post_event_controller()\n</code></pre>"},{"location":"practice/api_design.html#approutesleaderboardpy","title":"<code>app/routes/leaderboard.py</code>","text":"<pre><code>from flask import Blueprint\nfrom app.controllers.leaderboard_controller import leaderboard_controller\nfrom app.middleware.auth_jwt import auth_required\nfrom app.middleware.validate_api import validate_leaderboard_query\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0432\u044b\u0434\u0430\u0447\u0430 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043b\u0438\u0434\u0435\u0440\u043e\u0432 \u0441 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 query-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\nleaderboard_bp = Blueprint(\"leaderboard\", __name__, url_prefix=\"/api/v1\")\n\n\n@leaderboard_bp.get(\"/leaderboard\")\n@auth_required(roles=[\"player\"])        # \u0434\u043e\u0441\u0442\u0443\u043f \u043f\u043e JWT\n@validate_leaderboard_query             # \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 query: boardCode/season/limit\ndef leaderboard():\n    return leaderboard_controller()\n</code></pre>"},{"location":"practice/api_design.html#563-controllers-http-sql","title":"5.6.3. Controllers (HTTP \u0441\u043b\u043e\u0439, \u0431\u0435\u0437 SQL)","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u0432: \u0443\u043d\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b (<code>ok/data</code>) \u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c.</p>"},{"location":"practice/api_design.html#appcontrollersauth_controllerpy","title":"<code>app/controllers/auth_controller.py</code>","text":"<pre><code>from flask import request, jsonify\nfrom app.services.auth_service import register_service, login_service\n\n# \u041a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 SQL \u0438 \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u0440\u0430\u0432\u0438\u043b.\n# \u041e\u043d\u0438 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0442 HTTP-\u0432\u0445\u043e\u0434, \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442 \u0441\u0435\u0440\u0432\u0438\u0441 \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442 \u0435\u0434\u0438\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442.\n\n\ndef register_controller():\n    # JSON \u0442\u0435\u043b\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0443\u0436\u0435 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u043d validate_register\n    payload = request.get_json()\n\n    # \u0412\u0441\u044f \u043b\u043e\u0433\u0438\u043a\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (bcrypt + \u0440\u043e\u043b\u0438 + progress) \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435\n    result = register_service(payload)\n\n    # 201 Created \u2014 \u0440\u0435\u0441\u0443\u0440\u0441 \u0441\u043e\u0437\u0434\u0430\u043d\n    return jsonify({\"ok\": True, \"data\": result}), 201\n\n\ndef login_controller():\n    payload = request.get_json()\n\n    # \u0412\u0441\u044f \u043b\u043e\u0433\u0438\u043a\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 bcrypt-\u043f\u0430\u0440\u043e\u043b\u044f/\u0432\u044b\u0434\u0430\u0447\u0438 \u0442\u043e\u043a\u0435\u043d\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0441\u0435\u0440\u0432\u0438\u0441\u0435\n    result = login_service(payload)\n\n    return jsonify({\"ok\": True, \"data\": result}), 200\n</code></pre>"},{"location":"practice/api_design.html#appcontrollersprofile_controllerpy","title":"<code>app/controllers/profile_controller.py</code>","text":"<pre><code>from flask import g, jsonify\nfrom app.services.profile_service import profile_service\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043e\u0442\u0434\u0430\u0442\u044c \u0432\u0438\u0442\u0440\u0438\u043d\u0443 \u043f\u0440\u043e\u0444\u0438\u043b\u044f.\n# userId \u0431\u0435\u0440\u0451\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 JWT, \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442 auth_required.\n\n\ndef profile_controller():\n    user_id = g.user[\"userId\"]\n\n    result = profile_service(user_id)\n\n    return jsonify({\"ok\": True, \"data\": result}), 200\n</code></pre>"},{"location":"practice/api_design.html#appcontrollersevents_controllerpy","title":"<code>app/controllers/events_controller.py</code>","text":"<pre><code>from flask import g, request, jsonify\nfrom app.services.events_service import accept_event_service\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0438 \u0434\u0435\u043b\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0441\u0435\u0440\u0432\u0438\u0441\u0443.\n# SQL \u0438 \u0431\u0438\u0437\u043d\u0435\u0441-\u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0432 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u044b.\n\n\ndef post_event_controller():\n    user_id = g.user[\"userId\"]\n    payload = request.get_json()\n\n    result = accept_event_service(user_id, payload)\n\n    return jsonify({\"ok\": True, \"data\": result}), 200\n</code></pre>"},{"location":"practice/api_design.html#appcontrollersleaderboard_controllerpy","title":"<code>app/controllers/leaderboard_controller.py</code>","text":"<pre><code>from flask import request, jsonify\nfrom app.services.leaderboard_service import leaderboard_service\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c query-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0438 \u0432\u044b\u0437\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0438\u0441.\n# validate_leaderboard_query \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0441\u0442\u044c \u0442\u0438\u043f\u043e\u0432 \u0438 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u043e\u0432.\n\n\ndef leaderboard_controller():\n    board_code = request.args.get(\"boardCode\")\n    season = int(request.args.get(\"season\"))\n    limit  = int(request.args.get(\"limit\"))\n\n    result = leaderboard_service(board_code, season, limit)\n\n    return jsonify({\"ok\": True, \"data\": result}), 200\n</code></pre>"},{"location":"practice/api_design.html#564-services-orchestration","title":"5.6.4. Services (\u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430 + orchestration)","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u0432: \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u044f\u043c\u0438.</p>"},{"location":"practice/api_design.html#appservicesauth_servicepy","title":"<code>app/services/auth_service.py</code>","text":"<pre><code>import bcrypt\nfrom flask_jwt_extended import create_access_token\nfrom app.extensions import db\nfrom app.middleware.error_handler import AppError\nfrom app.repositories.users_repo import find_user_by_email, create_user, get_user_roles\nfrom app.repositories.roles_repo import assign_role_to_user\nfrom app.repositories.progress_repo import ensure_progress_row\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435:\n# - register_service: \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (bcrypt-\u0445\u044d\u0448), \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0440\u043e\u043b\u044c player, \u0441\u043e\u0437\u0434\u0430\u0442\u044c progress\n# - login_service: \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c bcrypt-\u043f\u0430\u0440\u043e\u043b\u044c \u0438 \u0432\u044b\u0434\u0430\u0442\u044c JWT \u0441 claims.roles\n\n\ndef register_service(payload: dict) -&gt; dict:\n    email    = payload[\"email\"]\n    password = payload[\"password\"]\n    nickname = payload[\"nickname\"]\n\n    # \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 email\n    if find_user_by_email(email) is not None:\n        raise AppError(code=\"CONFLICT\", message=\"Email already registered\", http_status=409)\n\n    # \u0425\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f bcrypt\n    hashed = bcrypt.hashpw(password.encode(), bcrypt.gensalt()).decode()\n\n    try:\n        user_id = create_user(db.session, email=email, password=hashed, nickname=nickname)\n        assign_role_to_user(db.session, user_id=user_id, role_name=\"player\")\n        ensure_progress_row(db.session, user_id=user_id)\n        db.session.commit()\n    except Exception:\n        db.session.rollback()\n        raise\n\n    return {\"userId\": user_id, \"email\": email, \"nickname\": nickname}\n\n\ndef login_service(payload: dict) -&gt; dict:\n    email    = payload[\"email\"]\n    password = payload[\"password\"]\n\n    user = find_user_by_email(email)\n    if user is None:\n        raise AppError(code=\"UNAUTHORIZED\", message=\"Invalid credentials\", http_status=401)\n\n    # \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 bcrypt-\u0445\u044d\u0448\u0430\n    if not bcrypt.checkpw(password.encode(), user[\"password\"].encode()):\n        raise AppError(code=\"UNAUTHORIZED\", message=\"Invalid credentials\", http_status=401)\n\n    if user[\"is_banned\"]:\n        raise AppError(code=\"FORBIDDEN\", message=\"Account is banned\", http_status=403)\n\n    # JWT claims: roles (\u0434\u043b\u044f RBAC)\n    roles = get_user_roles(user[\"id\"])\n    access_token = create_access_token(\n        identity=user[\"id\"],\n        additional_claims={\"roles\": roles}\n    )\n\n    return {\n        \"accessToken\": access_token,\n        \"userId\": user[\"id\"],\n        \"nickname\": user[\"nickname\"]\n    }\n</code></pre>"},{"location":"practice/api_design.html#appservicesprofile_servicepy","title":"<code>app/services/profile_service.py</code>","text":"<pre><code>from app.middleware.error_handler import AppError\nfrom app.repositories.users_repo import get_user_by_id\nfrom app.repositories.progress_repo import get_progress_by_user\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0432\u0438\u0442\u0440\u0438\u043d\u0443 \u043f\u0440\u043e\u0444\u0438\u043b\u044f (user + progress) \u0438\u0437 \u0411\u0414.\n\n\ndef profile_service(user_id: int) -&gt; dict:\n    user = get_user_by_id(user_id)\n    if user is None:\n        raise AppError(code=\"NOT_FOUND\", message=\"User not found\", http_status=404)\n\n    if user.get(\"is_banned\") is True:\n        raise AppError(code=\"FORBIDDEN\", message=\"Account is banned\", http_status=403)\n\n    progress = get_progress_by_user(user_id)\n\n    return {\n        \"user\": {\n            \"id\":       user[\"id\"],\n            \"email\":    user[\"email\"],\n            \"nickname\": user[\"nickname\"]\n        },\n        \"progress\": progress\n    }\n</code></pre>"},{"location":"practice/api_design.html#appservicesevents_servicepy","title":"<code>app/services/events_service.py</code>","text":"<pre><code>from app.extensions import db\nfrom app.repositories.dedupe_repo import register_event_or_conflict\nfrom app.repositories.events_repo import insert_game_event\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435, \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 processed_events (\u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f) \u0438 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0432 game_events.\n# \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0435: \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 eventId \u2192 409 EVENT_REJECTED \u0447\u0435\u0440\u0435\u0437 UNIQUE(user_id, event_id) \u0432 processed_events.\n\n\ndef accept_event_service(user_id: int, payload: dict) -&gt; dict:\n    event_id    = payload[\"eventId\"]\n    event_type  = payload[\"eventType\"]\n    session_id  = payload.get(\"sessionId\")\n    event_payload = payload.get(\"payload\") or {}\n\n    try:\n        # \u0414\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f: UNIQUE(user_id, event_id) \u2014 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 event_id \u2192 IntegrityError \u2192 409\n        register_event_or_conflict(db.session, user_id=user_id, event_id=event_id, event_type=event_type)\n        # \u0417\u0430\u043f\u0438\u0441\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0432 game_events\n        insert_game_event(db.session, user_id=user_id, session_id=session_id, event_type=event_type, payload=event_payload)\n        db.session.commit()\n    except Exception:\n        db.session.rollback()\n        raise\n\n    return {\"eventId\": event_id, \"status\": \"accepted\"}\n</code></pre>"},{"location":"practice/api_design.html#appservicesleaderboard_servicepy","title":"<code>app/services/leaderboard_service.py</code>","text":"<pre><code>from app.repositories.leaderboard_repo import get_leaderboard\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043b\u0438\u0434\u0435\u0440\u043e\u0432 \u0438 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043a \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442\u0443 API.\n\n\ndef leaderboard_service(board_code: str, season: int, limit: int) -&gt; dict:\n    items = get_leaderboard(board_code, season, limit)\n    return {\n        \"boardCode\": board_code,\n        \"season\":    season,\n        \"items\":     items\n    }\n</code></pre>"},{"location":"practice/api_design.html#565-repositories-sql-","title":"5.6.5. Repositories (SQL \u0441\u043b\u043e\u0439, \u0431\u0435\u0437 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0438)","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432: \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c SQL \u0438 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u0411\u0414 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u043c\u0438.</p>"},{"location":"practice/api_design.html#apprepositoriesusers_repopy","title":"<code>app/repositories/users_repo.py</code>","text":"<pre><code>from sqlalchemy import text\nfrom app.extensions import db\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435:\n# - find_user_by_email: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043f\u043e email (\u0432\u043a\u043b\u044e\u0447\u0430\u044f password \u0434\u043b\u044f bcrypt-\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438)\n# - create_user: \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n# - get_user_by_id: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043f\u043e id\n# - get_user_roles: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u043e\u043b\u0435\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n# \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435: \u0442\u043e\u043b\u044c\u043a\u043e SQL, \u043d\u0438\u043a\u0430\u043a\u043e\u0439 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0438.\n\n\ndef find_user_by_email(email: str):\n    sql = text(\"SELECT id, email, password, nickname, is_banned FROM users WHERE email = :email\")\n    row = db.session.execute(sql, {\"email\": email}).mappings().first()\n    if row is None:\n        return None\n    return {\n        \"id\":        row[\"id\"],\n        \"email\":     row[\"email\"],\n        \"password\":  row[\"password\"],\n        \"nickname\":  row[\"nickname\"],\n        \"is_banned\": bool(row[\"is_banned\"]),\n    }\n\n\ndef create_user(session, email: str, password: str, nickname: str) -&gt; int:\n    sql = text(\"\"\"\n        INSERT INTO users (email, password, nickname, created_at, is_banned)\n        VALUES (:email, :password, :nickname, NOW(3), 0)\n    \"\"\")\n    res = session.execute(sql, {\"email\": email, \"password\": password, \"nickname\": nickname})\n    return res.lastrowid\n\n\ndef get_user_by_id(user_id: int):\n    sql = text(\"SELECT id, email, nickname, is_banned FROM users WHERE id = :id\")\n    row = db.session.execute(sql, {\"id\": user_id}).mappings().first()\n    if row is None:\n        return None\n    return {\"id\": row[\"id\"], \"email\": row[\"email\"], \"nickname\": row[\"nickname\"], \"is_banned\": bool(row[\"is_banned\"])}\n\n\ndef get_user_roles(user_id: int):\n    sql = text(\"\"\"\n        SELECT r.name AS role_name\n        FROM user_roles ur\n        JOIN roles r ON r.id = ur.role_id\n        WHERE ur.user_id = :user_id\n    \"\"\")\n    rows = db.session.execute(sql, {\"user_id\": user_id}).mappings().all()\n    return [r[\"role_name\"] for r in rows] or [\"player\"]\n</code></pre>"},{"location":"practice/api_design.html#apprepositoriesroles_repopy","title":"<code>app/repositories/roles_repo.py</code>","text":"<pre><code>from sqlalchemy import text\nfrom app.extensions import db\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0440\u043e\u043b\u044c (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, player).\n# \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435: \u0442\u043e\u043b\u044c\u043a\u043e SQL.\n\n\ndef assign_role_to_user(session, user_id: int, role_name: str):\n    # \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 role_id \u043f\u043e \u0438\u043c\u0435\u043d\u0438\n    role_sql = text(\"SELECT id FROM roles WHERE name = :name\")\n    role = session.execute(role_sql, {\"name\": role_name}).mappings().first()\n\n    if role is None:\n        # \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0440\u043e\u043b\u0438, \u0435\u0441\u043b\u0438 \u0435\u0451 \u043d\u0435\u0442\n        ins_role = text(\"INSERT INTO roles (name) VALUES (:name)\")\n        res = session.execute(ins_role, {\"name\": role_name})\n        role_id = res.lastrowid\n    else:\n        role_id = role[\"id\"]\n\n    # \u041f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u0440\u043e\u043b\u0438 \u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e (\u043f\u043e\u0432\u0442\u043e\u0440\u043d\u0430\u044f \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u0430 \u043b\u043e\u043c\u0430\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u0443)\n    link_sql = text(\"\"\"\n        INSERT INTO user_roles (user_id, role_id, assigned_at)\n        VALUES (:user_id, :role_id, NOW())\n        ON DUPLICATE KEY UPDATE assigned_at = assigned_at\n    \"\"\")\n    session.execute(link_sql, {\"user_id\": user_id, \"role_id\": role_id})\n</code></pre>"},{"location":"practice/api_design.html#apprepositoriesprogress_repopy","title":"<code>app/repositories/progress_repo.py</code> (\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u0440\u043e\u0444\u0438\u043b\u044f)","text":"<pre><code>from sqlalchemy import text\nfrom app.extensions import db\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0438\u0433\u0440\u043e\u043a\u0430 \u0434\u043b\u044f \u0432\u044b\u0432\u043e\u0434\u0430 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u0435.\n# \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435: \u0442\u043e\u043b\u044c\u043a\u043e SQL.\n\n\ndef get_progress_by_user(user_id: int) -&gt; dict:\n    sql = text(\"\"\"\n        SELECT level, xp, soft_currency, hard_currency\n        FROM player_progress\n        WHERE user_id = :user_id\n    \"\"\")\n    row = db.session.execute(sql, {\"user_id\": user_id}).mappings().first()\n    if row is None:\n        return {\"level\": 1, \"xp\": 0, \"softCurrency\": 0, \"hardCurrency\": 0}\n\n    return {\n        \"level\":        row[\"level\"],\n        \"xp\":           row[\"xp\"],\n        \"softCurrency\": row[\"soft_currency\"],\n        \"hardCurrency\": row[\"hard_currency\"]\n    }\n</code></pre>"},{"location":"practice/api_design.html#apprepositoriesevents_repopy","title":"<code>app/repositories/events_repo.py</code>","text":"<pre><code>import json\nfrom sqlalchemy import text\nfrom app.extensions import db\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0432 game_events.\n# \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435: \u0442\u043e\u043b\u044c\u043a\u043e SQL.\n\n\ndef insert_game_event(session, user_id: int, session_id, event_type: str, payload: dict):\n    sql = text(\"\"\"\n        INSERT INTO game_events (user_id, session_id, event_type, payload_json)\n        VALUES (:user_id, :session_id, :event_type, CAST(:payload AS JSON))\n    \"\"\")\n    session.execute(sql, {\n        \"user_id\":    user_id,\n        \"session_id\": session_id,\n        \"event_type\": event_type,\n        \"payload\":    json.dumps(payload, ensure_ascii=False)\n    })\n</code></pre>"},{"location":"practice/api_design.html#apprepositoriesdedupe_repopy","title":"<code>app/repositories/dedupe_repo.py</code>","text":"<pre><code>from sqlalchemy import text\nfrom app.middleware.error_handler import AppError\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c eventId \u0432 processed_events \u0434\u043b\u044f \u0437\u0430\u0449\u0438\u0442\u044b \u043e\u0442 \u0434\u0443\u0431\u043b\u0435\u0439.\n# UNIQUE(user_id, event_id) \u2192 IntegrityError \u043f\u0440\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u2192 409 EVENT_REJECTED\n\n\ndef register_event_or_conflict(session, user_id: int, event_id: str, event_type: str):\n    sql = text(\"\"\"\n        INSERT INTO processed_events (user_id, event_id, event_type, processed_at)\n        VALUES (:user_id, :event_id, :event_type, NOW(3))\n    \"\"\")\n    try:\n        session.execute(sql, {\"user_id\": user_id, \"event_id\": event_id, \"event_type\": event_type})\n    except Exception:\n        raise AppError(code=\"EVENT_REJECTED\", message=\"Duplicate eventId\", http_status=409)\n</code></pre>"},{"location":"practice/api_design.html#apprepositoriesleaderboard_repopy-get","title":"<code>app/repositories/leaderboard_repo.py</code> (\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043b\u044f GET)","text":"<pre><code>from sqlalchemy import text\nfrom app.extensions import db\n\n# \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0442\u043e\u043f \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u043f\u043e board_code/season \u0441 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435\u043c limit.\n# \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435: \u0442\u043e\u043b\u044c\u043a\u043e SQL.\n\n\ndef get_leaderboard(board_code: str, season: int, limit: int):\n    sql = text(\"\"\"\n        SELECT ls.user_id AS userId, u.nickname AS nickname, ls.score AS score\n        FROM leaderboard_scores ls\n        JOIN users u ON u.id = ls.user_id\n        WHERE ls.board_code = :board_code AND ls.season = :season\n        ORDER BY ls.score DESC\n        LIMIT :limit\n    \"\"\")\n    rows = db.session.execute(sql, {\"board_code\": board_code, \"season\": season, \"limit\": limit}).mappings().all()\n\n    items = []\n    rank = 1\n    for r in rows:\n        items.append({\"rank\": rank, \"userId\": r[\"userId\"], \"nickname\": r[\"nickname\"], \"score\": r[\"score\"]})\n        rank += 1\n\n    return items\n</code></pre>"},{"location":"practice/api_design.html#566-api-endpoints","title":"5.6.6. \u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0434\u043b\u044f API endpoints (\u0435\u0434\u0438\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434)","text":"<p>\u0424\u0430\u0439\u043b \u0432\u0430\u043b\u0438\u0434\u0430\u0442\u043e\u0440\u043e\u0432 API: <code>app/middleware/validate_api.py</code></p> <p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043e \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f \u043a \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c \u0438 \u0411\u0414.</p> <p>\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b:</p> <ul> <li><code>validate_register</code></li> <li><code>validate_login</code></li> <li><code>validate_event</code> \u2014 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 <code>eventId</code> (UUID-\u0441\u0442\u0440\u043e\u043a\u0430, \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0434\u043b\u044f \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438)</li> <li><code>validate_leaderboard_query</code></li> <li><code>validate_match_finish</code></li> </ul> <pre><code>from functools import wraps\nfrom flask import request\nfrom app.middleware.error_handler import AppError\n\n\ndef _bad_body(details):\n    raise AppError(code=\"VALIDATION_ERROR\", message=\"Invalid request body\", http_status=400, details=details)\n\ndef _bad_query(details):\n    raise AppError(code=\"VALIDATION_ERROR\", message=\"Invalid query params\", http_status=400, details=details)\n\n\ndef validate_register(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        data = request.get_json(silent=True)\n        if not isinstance(data, dict):\n            _bad_body({\"body\": \"JSON object expected\"})\n\n        email    = data.get(\"email\")\n        password = data.get(\"password\")\n        nickname = data.get(\"nickname\")\n\n        if not isinstance(email, str) or \"@\" not in email:\n            _bad_body({\"email\": \"valid email required\"})\n        if not isinstance(password, str) or len(password) &lt; 6:\n            _bad_body({\"password\": \"string length &gt;= 6 required\"})\n        if not isinstance(nickname, str) or len(nickname) &lt; 2:\n            _bad_body({\"nickname\": \"string length &gt;= 2 required\"})\n\n        return fn(*args, **kwargs)\n    return wrapper\n\n\ndef validate_login(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        data = request.get_json(silent=True)\n        if not isinstance(data, dict):\n            _bad_body({\"body\": \"JSON object expected\"})\n\n        email    = data.get(\"email\")\n        password = data.get(\"password\")\n\n        if not isinstance(email, str) or \"@\" not in email:\n            _bad_body({\"email\": \"valid email required\"})\n        if not isinstance(password, str) or len(password) &lt; 1:\n            _bad_body({\"password\": \"string required\"})\n\n        return fn(*args, **kwargs)\n    return wrapper\n\n\ndef validate_event(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        data = request.get_json(silent=True)\n        if not isinstance(data, dict):\n            _bad_body({\"body\": \"JSON object expected\"})\n\n        event_id   = data.get(\"eventId\")\n        event_type = data.get(\"eventType\")\n        session_id = data.get(\"sessionId\")\n        client_time = data.get(\"clientTime\")\n        payload    = data.get(\"payload\")\n\n        # eventId \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 processed_events\n        if not isinstance(event_id, str) or len(event_id) &lt; 8:\n            _bad_body({\"eventId\": \"uuid string required\"})\n        if not isinstance(event_type, str) or len(event_type) &lt; 1:\n            _bad_body({\"eventType\": \"string required\"})\n        if session_id is not None and not isinstance(session_id, int):\n            _bad_body({\"sessionId\": \"int or null required\"})\n        if client_time is not None and not isinstance(client_time, str):\n            _bad_body({\"clientTime\": \"string or null required\"})\n        if payload is not None and not isinstance(payload, dict):\n            _bad_body({\"payload\": \"object or null required\"})\n\n        return fn(*args, **kwargs)\n    return wrapper\n\n\ndef validate_leaderboard_query(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        board_code = request.args.get(\"boardCode\")\n        season     = request.args.get(\"season\")\n        limit      = request.args.get(\"limit\")\n\n        if not isinstance(board_code, str) or len(board_code) &lt; 1:\n            _bad_query({\"boardCode\": \"string required\"})\n        if season is None or not season.isdigit():\n            _bad_query({\"season\": \"int required\"})\n        if limit is None or not limit.isdigit():\n            _bad_query({\"limit\": \"int required\"})\n\n        lim = int(limit)\n        if lim &lt; 1 or lim &gt; 1000:\n            _bad_query({\"limit\": \"1..1000 required\"})\n\n        return fn(*args, **kwargs)\n    return wrapper\n\n\ndef validate_match_finish(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        data = request.get_json(silent=True)\n        if not isinstance(data, dict):\n            _bad_body({\"body\": \"JSON object expected\"})\n\n        match_id = data.get(\"matchId\")\n        result   = data.get(\"result\")\n\n        if not isinstance(match_id, int):\n            _bad_body({\"matchId\": \"int required\"})\n        if not isinstance(result, dict):\n            _bad_body({\"result\": \"object required\"})\n\n        is_win      = result.get(\"isWin\")\n        score       = result.get(\"score\")\n        duration    = result.get(\"durationSeconds\")\n        power_delta = result.get(\"powerDelta\")\n\n        if not isinstance(is_win, bool):\n            _bad_body({\"result.isWin\": \"bool required\"})\n        if not isinstance(score, int) or score &lt; 0:\n            _bad_body({\"result.score\": \"int &gt;= 0 required\"})\n        if not isinstance(duration, int) or duration &lt; 0:\n            _bad_body({\"result.durationSeconds\": \"int &gt;= 0 required\"})\n        if power_delta is not None and not isinstance(power_delta, int):\n            _bad_body({\"result.powerDelta\": \"int or null required\"})\n\n        return fn(*args, **kwargs)\n    return wrapper\n</code></pre>"},{"location":"practice/api_design.html#57-mvp-endpoints","title":"5.7. MVP endpoints \u2014 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f + \u043f\u0440\u0438\u043c\u0435\u0440\u044b","text":""},{"location":"practice/api_design.html#571-post-apiv1authregister","title":"5.7.1. <code>POST /api/v1/auth/register</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442, \u0445\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c bcrypt, \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0440\u043e\u043b\u044c <code>player</code>, \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443 <code>player_progress</code>.</p> <p>Request</p> <pre><code>POST /api/v1/auth/register\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"email\": \"player1@example.com\",\n  \"password\": \"P@ssw0rd!\",\n  \"nickname\": \"PlayerOne\"\n}\n</code></pre> <p>Response (201)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": { \"userId\": 101, \"email\": \"player1@example.com\", \"nickname\": \"PlayerOne\" }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400 VALIDATION_ERROR</code></li> <li><code>409 CONFLICT</code> \u2014 email \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d</li> </ul>"},{"location":"practice/api_design.html#572-post-apiv1authlogin","title":"5.7.2. <code>POST /api/v1/auth/login</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c bcrypt-\u043f\u0430\u0440\u043e\u043b\u044c \u0438 \u0432\u044b\u0434\u0430\u0442\u044c JWT \u0441 claims.roles.</p> <p>Request</p> <pre><code>POST /api/v1/auth/login\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"email\": \"alice@example.com\",\n  \"password\": \"password123\"\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"accessToken\": \"&lt;JWT&gt;\",\n    \"userId\": 1,\n    \"nickname\": \"Commander_Alice\"\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>401 UNAUTHORIZED</code> \u2014 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0438\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d</li> <li><code>403 FORBIDDEN</code> \u2014 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d (<code>is_banned = 1</code>)</li> </ul>"},{"location":"practice/api_design.html#573-get-apiv1profile","title":"5.7.3. <code>GET /api/v1/profile</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043e\u0442\u0434\u0430\u0442\u044c \"\u0432\u0438\u0442\u0440\u0438\u043d\u0443\" \u043f\u0440\u043e\u0444\u0438\u043b\u044f: user + progress.</p> <p>Request</p> <pre><code>GET /api/v1/profile\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"user\": { \"id\": 1, \"email\": \"alice@example.com\", \"nickname\": \"Commander_Alice\" },\n    \"progress\": { \"level\": 42, \"xp\": 85400, \"softCurrency\": 12500, \"hardCurrency\": 250 }\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>401 UNAUTHORIZED</code></li> <li><code>403 FORBIDDEN</code> \u2014 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d</li> </ul>"},{"location":"practice/api_design.html#574-post-apiv1events","title":"5.7.4. <code>POST /api/v1/events</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0432 <code>game_events</code> \u0441 \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 <code>processed_events</code> \u043f\u043e <code>eventId</code>.</p> <p>Request</p> <pre><code>POST /api/v1/events\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"eventId\": \"evt-a1b2c3d4-e5f6-7890\",\n  \"eventType\": \"unit_deploy\",\n  \"sessionId\": 1,\n  \"clientTime\": \"2026-02-27T12:20:10.000Z\",\n  \"payload\": {\n    \"matchId\": 9,\n    \"unitCode\": \"cavalry\",\n    \"amount\": 40,\n    \"atSecond\": 15\n  }\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": { \"eventId\": \"evt-a1b2c3d4-e5f6-7890\", \"status\": \"accepted\" }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400 VALIDATION_ERROR</code></li> <li><code>409 EVENT_REJECTED</code> \u2014 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 <code>eventId</code></li> </ul>"},{"location":"practice/api_design.html#575-get-apiv1leaderboard","title":"5.7.5. <code>GET /api/v1/leaderboard</code>","text":"<p>Request</p> <pre><code>GET /api/v1/leaderboard?boardCode=default&amp;season=1&amp;limit=10\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"boardCode\": \"default\",\n    \"season\": 1,\n    \"items\": [\n      { \"rank\": 1, \"userId\": 5, \"nickname\": \"Siege_Eve\",    \"score\": 9850 },\n      { \"rank\": 2, \"userId\": 3, \"nickname\": \"WarLord_Carol\", \"score\": 8720 }\n    ]\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400 VALIDATION_ERROR</code> (\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0435 query-\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b)</li> <li><code>401 UNAUTHORIZED</code></li> </ul>"},{"location":"practice/api_design.html#58-postman-test_clienthtml","title":"5.8. \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0435 \u043a \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a (Postman / test_client.html)","text":"<p>\u0414\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c:</p> <ul> <li><code>201</code> \u043f\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438</li> <li><code>409</code> \u043f\u0440\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0442\u043e\u0433\u043e \u0436\u0435 email</li> <li><code>200</code> \u043f\u0440\u0438 \u043b\u043e\u0433\u0438\u043d\u0435 \u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 <code>accessToken</code></li> <li><code>401</code> \u043f\u0440\u0438 \u043b\u043e\u0433\u0438\u043d\u0435 \u0441 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u043c \u043f\u0430\u0440\u043e\u043b\u0435\u043c</li> <li><code>403</code> \u043f\u0440\u0438 \u043b\u043e\u0433\u0438\u043d\u0435 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (<code>banned@example.com</code> \u0438\u0437 <code>seed.sql</code>)</li> <li><code>401</code> \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0435 \u043a /profile \u0431\u0435\u0437 JWT</li> <li><code>400</code> \u043f\u0440\u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u0445 /leaderboard \u0438\u043b\u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u043e\u043c JSON /events</li> <li><code>409</code> \u043f\u0440\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0441 \u0442\u0435\u043c \u0436\u0435 <code>eventId</code></li> <li><code>500</code> \u043f\u0440\u0438 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u043e\u0448\u0438\u0431\u043a\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430</li> </ul> <p>\u0414\u043b\u044f \u0440\u0443\u0447\u043d\u043e\u0433\u043e \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 <code>test_client.html</code> \u0438\u0437 \u043a\u043e\u0440\u043d\u044f \u043f\u0440\u043e\u0435\u043a\u0442\u0430.</p>"},{"location":"practice/api_design.html#59-match_finish","title":"5.9. \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f \u043a \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438 match_finish (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0443\u0441\u0438\u043b\u0435\u043d\u0438\u044f)","text":"<p>\u0421\u043e\u0431\u044b\u0442\u0438\u0435 <code>match_finish</code> \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>POST /api/v1/match/finish</code>:</p> <ol> <li>\u0418\u0434\u0435\u043c\u043f\u043e\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c:</li> <li>\u0441\u0442\u0430\u0442\u0443\u0441 \u043c\u0430\u0442\u0447\u0430 <code>started</code> \u2014 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0432\u044b\u0437\u043e\u0432 \u0432\u0435\u0440\u043d\u0451\u0442 <code>409 CONFLICT</code></li> <li> <p>\u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e: <code>processed_events</code> \u0441 <code>UNIQUE(user_id, event_id)</code> \u0437\u0430\u0449\u0438\u0449\u0430\u0435\u0442 <code>/events</code> \u043e\u0442 \u0434\u0443\u0431\u043b\u0435\u0439</p> </li> <li> <p>Ownership/anti-cheat:</p> </li> <li><code>matchId</code> \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0430\u0442\u044c <code>userId</code> \u0438\u0437 JWT \u2014 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u0432 <code>ensure_match_ownership_started()</code></li> <li> <p>\u0441\u0442\u0430\u0442\u0443\u0441 \u043c\u0430\u0442\u0447\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c <code>started</code></p> </li> <li> <p>\u0411\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438:</p> </li> <li> <p><code>SELECT ... FOR UPDATE</code> \u043d\u0430 <code>player_progress</code> \u0432 <code>lock_progress_row()</code> (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e)</p> </li> <li> <p>\u0410\u0442\u043e\u043c\u0430\u0440\u043d\u043e\u0441\u0442\u044c:</p> </li> <li>\u0441\u0431\u043e\u0439 \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0448\u0430\u0433\u0435 \u2192 <code>db.session.rollback()</code></li> </ol>"},{"location":"practice/api_design.html#510-swagger-openapi","title":"5.10. Swagger / OpenAPI (\u0435\u0441\u043b\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0435)","text":""},{"location":"practice/api_design.html#5101","title":"5.10.1. \u0427\u0442\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u043e","text":"<ul> <li>\u0432\u0441\u0435 MVP endpoints</li> <li>\u0441\u0445\u0435\u043c\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432/\u043e\u0442\u0432\u0435\u0442\u043e\u0432 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f <code>ErrorResponse</code>)</li> <li>security scheme JWT bearer</li> <li>\u043e\u0442\u0432\u0435\u0442\u044b <code>401/403/409</code> \u0442\u0430\u043c, \u0433\u0434\u0435 \u043e\u043d\u0438 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b</li> </ul> <p>\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442:</p> <pre><code>components:\n  securitySchemes:\n    bearerAuth:\n      type: http\n      scheme: bearer\n      bearerFormat: JWT\n</code></pre>"},{"location":"practice/architecture.html","title":"\u0410\u0440\u0445\u0438\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c","text":""},{"location":"practice/architecture.html#2-1","title":"2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. 1. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430","text":""},{"location":"practice/architecture.html#11","title":"1.1. \u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0443 \u00ab\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430\u00bb","text":""},{"location":"practice/architecture.html#111","title":"1.1.1. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c","text":"<ol> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0443\u044e \u0441\u0445\u0435\u043c\u0443 \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430.</li> <li>\u041e\u043f\u0438\u0441\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0439 \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0447\u0435\u0440\u0435\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u0443.</li> <li>\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0432\u0441\u0451 \u0432 \u0444\u0430\u0439\u043b\u0435:</li> </ol> <pre><code>docs/01-architecture.md\n</code></pre>"},{"location":"practice/architecture.html#12","title":"1.2. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u0441\u0445\u0435\u043c\u0430","text":""},{"location":"practice/architecture.html#121","title":"1.2.1. \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f \u043a \u0441\u0445\u0435\u043c\u0435","text":"<p>\u0421\u0445\u0435\u043c\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 Mermaid flowchart \u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u0433\u043e 5 \u0431\u043b\u043e\u043a\u043e\u0432:</p> <ul> <li>Client</li> <li>API</li> <li>Auth (JWT + RBAC)</li> <li>Business Logic</li> <li>Data Layer (MySQL + optional Redis/MQ)</li> </ul> <p>\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e:</p> <ul> <li>\u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 (Client \u2192 API \u2192 Auth \u2192 Business Logic \u2192 DB);</li> <li>\u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 (HTTPS + JSON);</li> <li>\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430;</li> <li>\u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u043b\u0438\u0448\u043d\u0438\u0435 \u0431\u043b\u043e\u043a\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, CDN, Nginx, Docker \u2014 \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u044f\u0442 \u0432 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0443\u0440).</li> </ul>"},{"location":"practice/architecture.html#122","title":"1.2.2. \u041c\u0435\u0442\u043e\u0434\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 (\u043a\u0430\u043a \u0430\u0434\u0430\u043f\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0434 \u0441\u0432\u043e\u044e \u0438\u0433\u0440\u0443)","text":"<p>\u041f\u0440\u0438 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u0441\u0445\u0435\u043c\u044b \u043f\u043e\u0434 \u0441\u0432\u043e\u044e \u0438\u0433\u0440\u0443 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e:</p> <ul> <li> <p>\u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u0430\u0431\u0441\u0442\u0440\u0430\u043a\u0442\u043d\u044b\u0439 Client \u043d\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439:</p> </li> <li> <p>Unity (2D/3D),</p> </li> <li>Web (React/Vue),</li> <li> <p>Mobile (Android/iOS);</p> </li> <li> <p>\u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 Business Logic (\u0447\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0434\u0435\u043b\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432 \u0432\u0430\u0448\u0435\u0439 \u0438\u0433\u0440\u0435), \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:</p> </li> <li> <p>Match Service (\u043c\u0430\u0442\u0447\u0438 / \u0441\u0435\u0441\u0441\u0438\u0438),</p> </li> <li>Economy Engine (\u0432\u0430\u043b\u044e\u0442\u0430 / \u0440\u0435\u0441\u0443\u0440\u0441\u044b / \u043f\u043e\u043a\u0443\u043f\u043a\u0438),</li> <li>Achievement Engine (\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f),</li> <li>City Service (\u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e / \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f),</li> <li> <p>Quest Service (\u043a\u0432\u0435\u0441\u0442\u044b / \u0437\u0430\u0434\u0430\u043d\u0438\u044f);</p> </li> <li> <p>\u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c optional-\u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b:</p> </li> <li> <p>Redis \u2014 \u043a\u044d\u0448 (\u043f\u0440\u043e\u0444\u0438\u043b\u044c, \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434, \u0441\u0435\u0441\u0441\u0438\u0438),</p> </li> <li>MQ \u2014 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (\u043b\u043e\u0433 \u0441\u043e\u0431\u044b\u0442\u0438\u0439, \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430, \u0430\u043d\u0442\u0438\u0447\u0438\u0442, \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f).</li> </ul> <p>\u26a0 \u0412\u0430\u0436\u043d\u043e: \u0421\u0445\u0435\u043c\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u043e\u0442\u0440\u0430\u0436\u0430\u0442\u044c \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0443 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430, \u0430 \u043d\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \"\u0441\u0430\u0439\u0442 + \u0411\u0414\". \u0422\u043e \u0435\u0441\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0439: \u043c\u0430\u0442\u0447/\u0431\u043e\u0439, \u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e, \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0430, \u0441\u043e\u0431\u044b\u0442\u0438\u044f, \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438.</p>"},{"location":"practice/architecture.html#13","title":"1.3. \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u044f","text":""},{"location":"practice/architecture.html#131-endpoint","title":"1.3.1. \u0412\u044b\u0431\u043e\u0440 endpoint","text":"<p>\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0434\u0438\u043d endpoint:</p> <ul> <li><code>POST /api/v1/auth/login</code></li> <li><code>POST /api/v1/match/finish</code></li> <li><code>GET /api/v1/profile</code></li> </ul>"},{"location":"practice/architecture.html#132","title":"1.3.2. \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0432\u043a\u043b\u044e\u0447\u0430\u0442\u044c","text":"<p>\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0432\u043a\u043b\u044e\u0447\u0430\u0442\u044c:</p> <ul> <li>\u043f\u0440\u0438\u043c\u0435\u0440 HTTP-\u0437\u0430\u043f\u0440\u043e\u0441\u0430;</li> <li>\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 Auth;</li> <li>\u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044e;</li> <li>\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f Business Logic;</li> <li>SQL-\u0437\u0430\u043f\u0440\u043e\u0441\u044b;</li> <li>JSON-\u043e\u0442\u0432\u0435\u0442;</li> <li>\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438.</li> </ul>"},{"location":"practice/architecture.html#133","title":"1.3.3. \u041c\u0435\u0442\u043e\u0434\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 (\u043a\u0430\u043a \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0439 \u043f\u043e\u0434 \u0436\u0430\u043d\u0440)","text":"<p>\u041f\u0440\u0438 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u043f\u043e\u0434 \u0441\u0432\u043e\u044e \u0438\u0433\u0440\u0443:</p> <ul> <li>\u0415\u0441\u043b\u0438 \u044d\u0442\u043e RPG \u2192 \u043c\u043e\u0436\u043d\u043e \u043e\u043f\u0438\u0441\u0430\u0442\u044c <code>POST /api/v1/battle/complete</code></li> <li>\u0415\u0441\u043b\u0438 \u044d\u0442\u043e Tower Defense \u2192 <code>POST /api/v1/match/finish</code></li> <li>\u0415\u0441\u043b\u0438 \u044d\u0442\u043e Shooter \u2192 <code>POST /api/v1/session/end</code></li> <li>\u0415\u0441\u043b\u0438 \u044d\u0442\u043e Idle / Simulator \u2192 <code>POST /api/v1/economy/collect</code></li> <li>\u0415\u0441\u043b\u0438 \u044d\u0442\u043e Strategy \u2192 <code>POST /api/v1/match/finish</code></li> </ul> <p>\u0413\u043b\u0430\u0432\u043d\u043e\u0435 \u2014 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c:</p> <ol> <li>\u0427\u0442\u043e \u0440\u0430\u0441\u0447\u0451\u0442\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435, \u0430 \u043d\u0435 \u0434\u043e\u0432\u0435\u0440\u044f\u044e\u0442\u0441\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0443.</li> <li>\u0427\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f.</li> <li>\u0427\u0442\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (progress/resources/leaderboard/rewards).</li> <li>\u0427\u0442\u043e \u043f\u0440\u0435\u0434\u0443\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u044b \u043e\u0448\u0438\u0431\u043a\u0438 \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043d\u043e\u0433\u043e \u0434\u043e\u0441\u0442\u0443\u043f\u0430 (race condition, \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u0430\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430).</li> <li>\u0427\u0442\u043e \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432\u0430\u043b\u0438\u0434\u0438\u0440\u0443\u044e\u0442\u0441\u044f (\u0442\u0438\u043f\u044b, \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u044b, \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e).</li> </ol>"},{"location":"practice/architecture.html#14-flask","title":"1.4. \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f \u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0443 (Flask)","text":""},{"location":"practice/architecture.html#141","title":"1.4.1. \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u0441\u0442\u0435\u043a","text":"<ul> <li>\u042f\u0437\u044b\u043a: Python 3.10+</li> <li>Web-\u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a: Flask</li> <li>\u0411\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445: MySQL 8.0</li> <li>ORM (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f): SQLAlchemy</li> <li>\u041c\u0438\u0433\u0440\u0430\u0446\u0438\u0438 (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f): Flask-Migrate</li> <li>\u0410\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f: JWT (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>flask-jwt-extended</code>)</li> <li>\u0425\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u0435\u0439: bcrypt</li> <li>\u0424\u043e\u0440\u043c\u0430\u0442 \u043e\u0431\u043c\u0435\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u043c\u0438: JSON</li> <li>\u041f\u0440\u043e\u0442\u043e\u043a\u043e\u043b: HTTPS</li> </ul>"},{"location":"practice/architecture.html#15-flask","title":"1.5. \u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (Flask)","text":"<p>\u0420\u0435\u0430\u043b\u044c\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 <code>strategy-support-is</code>:</p> <pre><code>project-root/\n\u2502\n\u251c\u2500\u2500 docs/\n\u2502   \u2514\u2500\u2500 01-architecture.md\n\u2502\n\u251c\u2500\u2500 db/\n\u2502   \u2514\u2500\u2500 schema.sql\n\u2502\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 __init__.py          \u2190 create_app(), \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f blueprint'\u043e\u0432\n\u2502   \u251c\u2500\u2500 config.py            \u2190 Config (\u0447\u0438\u0442\u0430\u0435\u0442 .env)\n\u2502   \u251c\u2500\u2500 extensions.py        \u2190 db, jwt, cors\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 routes/\n\u2502   \u2502   \u251c\u2500\u2500 auth.py\n\u2502   \u2502   \u251c\u2500\u2500 match.py\n\u2502   \u2502   \u251c\u2500\u2500 profile.py\n\u2502   \u2502   \u251c\u2500\u2500 events.py\n\u2502   \u2502   \u251c\u2500\u2500 leaderboard.py\n\u2502   \u2502   \u2514\u2500\u2500 health.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 controllers/\n\u2502   \u2502   \u251c\u2500\u2500 auth_controller.py\n\u2502   \u2502   \u251c\u2500\u2500 match_controller.py\n\u2502   \u2502   \u251c\u2500\u2500 profile_controller.py\n\u2502   \u2502   \u251c\u2500\u2500 events_controller.py\n\u2502   \u2502   \u2514\u2500\u2500 leaderboard_controller.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 auth_service.py\n\u2502   \u2502   \u251c\u2500\u2500 match_service.py\n\u2502   \u2502   \u251c\u2500\u2500 profile_service.py\n\u2502   \u2502   \u251c\u2500\u2500 events_service.py\n\u2502   \u2502   \u2514\u2500\u2500 leaderboard_service.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u251c\u2500\u2500 users_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 roles_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 matches_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 progress_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 stats_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 leaderboard_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 events_repo.py\n\u2502   \u2502   \u2514\u2500\u2500 dedupe_repo.py\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 middleware/\n\u2502       \u251c\u2500\u2500 request_id.py\n\u2502       \u251c\u2500\u2500 auth_jwt.py\n\u2502       \u251c\u2500\u2500 validate_api.py\n\u2502       \u2514\u2500\u2500 error_handler.py\n\u2502\n\u251c\u2500\u2500 seed.sql\n\u251c\u2500\u2500 test_client.html\n\u2514\u2500\u2500 wsgi.py                  \u2190 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 (python wsgi.py)\n</code></pre> <p>\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0432 <code>app/config.py</code> \u0438 \u0447\u0438\u0442\u0430\u0435\u0442 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0438\u0437 <code>.env</code>. \u0422\u043e\u0447\u043a\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u2014 <code>wsgi.py</code>.</p>"},{"location":"practice/architecture.html#16-docs01-architecturemd","title":"1.6. \u041a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b <code>docs/01-architecture.md</code>","text":"<ol> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u043f\u043a\u0443 <code>docs</code></li> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b <code>01-architecture.md</code></li> <li> <p>\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432 \u0444\u0430\u0439\u043b:</p> </li> <li> <p>Mermaid-\u0441\u0445\u0435\u043c\u0443</p> </li> <li>\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u044f</li> <li>SQL</li> <li>JSON</li> </ol>"},{"location":"practice/architecture.html#17-tower-defense","title":"1.7. \u041f\u0440\u0438\u043c\u0435\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (Tower Defense)","text":""},{"location":"practice/architecture.html#171","title":"1.7.1. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u0441\u0445\u0435\u043c\u0430","text":"<pre><code>flowchart LR\n  C[Client\\nUnity TD Game] --&gt;|HTTPS + JSON| A[API\\nREST]\n  A --&gt; AU[Auth\\nJWT + RBAC]\n  AU --&gt; BL[Business Logic\\nMatch / Rewards]\n  BL --&gt; D[Data Layer\\nMySQL 8.0]\n\n  BL -.cache.-&gt; R[(Redis optional)]\n  BL -.events.-&gt; Q[(MQ optional)]</code></pre>"},{"location":"practice/architecture.html#172-post-apiv1matchfinish","title":"1.7.2. \u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439: <code>POST /api/v1/match/finish</code>","text":""},{"location":"practice/architecture.html#1721","title":"1.7.2.1. \u041a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0439 \u0437\u0430\u043f\u0440\u043e\u0441","text":"<pre><code>POST /api/v1/match/finish\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"matchId\": 987654321,\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 12450,\n    \"durationSeconds\": 410,\n    \"waveReached\": 12\n  }\n}\n</code></pre>"},{"location":"practice/architecture.html#1722-auth-jwt-rbac","title":"1.7.2.2. Auth (JWT + RBAC)","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f:</p> <ul> <li>JWT \u0432\u0430\u043b\u0438\u0434\u0435\u043d</li> <li><code>userId</code> \u0438\u0437\u0432\u043b\u0435\u0447\u0451\u043d (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 <code>15</code>)</li> <li>\u0440\u043e\u043b\u044c = <code>player</code></li> </ul> <p>\u041e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>401 Unauthorized\n</code></pre>"},{"location":"practice/architecture.html#1723-validation","title":"1.7.2.3. Validation","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f:</p> <ul> <li>\u043c\u0430\u0442\u0447 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442</li> <li>\u043c\u0430\u0442\u0447 \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 <code>userId</code></li> <li>\u0441\u0442\u0430\u0442\u0443\u0441 \u043c\u0430\u0442\u0447\u0430 = <code>started</code></li> <li>\u043c\u0430\u0442\u0447 \u0435\u0449\u0451 \u043d\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d</li> </ul> <p>\u041e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>409 Conflict\n</code></pre>"},{"location":"practice/architecture.html#1724-business-logic","title":"1.7.2.4. Business Logic","text":"<p>\u0420\u0430\u0441\u0447\u0451\u0442 \u043d\u0430\u0433\u0440\u0430\u0434 (\u0441\u0435\u0440\u0432\u0435\u0440 \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0441\u0430\u043c):</p> <pre><code>xp = 50 + (waveReached * 10)\nsoftCurrency = 100 + (waveReached * 20)\n</code></pre> <p>\u0414\u043b\u044f <code>waveReached = 12</code>:</p> <pre><code>xp = 170\nsoftCurrency = 340\n</code></pre>"},{"location":"practice/architecture.html#1725-data-layer-mysql","title":"1.7.2.5. Data Layer (MySQL, \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f)","text":"<pre><code>START TRANSACTION;\n</code></pre> <p>\u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043c\u0430\u0442\u0447\u0430:</p> <pre><code>UPDATE matches\nSET status = 'finished',\n    ended_at = CURRENT_TIMESTAMP(3)\nWHERE id = 987654321;\n</code></pre> <p>\u0417\u0430\u043f\u0438\u0441\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430:</p> <pre><code>INSERT INTO battle_results\n(match_id, is_win, score, duration_seconds)\nVALUES\n(987654321, 1, 12450, 410);\n</code></pre> <p>\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430:</p> <pre><code>UPDATE player_progress\nSET xp = xp + 170,\n    soft_currency = soft_currency + 340\nWHERE user_id = 15;\n</code></pre> <p>\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0430:</p> <pre><code>INSERT INTO leaderboard_scores (user_id, board_code, season, score)\nVALUES (15, 'default', 1, 12450)\nON DUPLICATE KEY UPDATE\n  score = GREATEST(score, VALUES(score));\n</code></pre> <pre><code>COMMIT;\n</code></pre>"},{"location":"practice/architecture.html#1726","title":"1.7.2.6. \u041e\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"matchId\": 987654321,\n    \"isWin\": true,\n    \"xpGained\": 170,\n    \"softCurrencyGained\": 340\n  }\n}\n</code></pre>"},{"location":"practice/architecture.html#1727-2","title":"1.7.2.7. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2)","text":"<ul> <li><code>401 Unauthorized</code> \u2014 JWT \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442/\u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d/\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u0435\u043d.</li> <li><code>409 Conflict</code> \u2014 \u043c\u0430\u0442\u0447 \u0443\u0436\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d \u0438\u043b\u0438 \u043d\u0435 \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e.</li> <li><code>404 Not Found</code> \u2014 matchId \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 (\u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e, \u0435\u0441\u043b\u0438 \u0445\u043e\u0442\u0438\u0442\u0435).</li> </ul>"},{"location":"practice/architecture.html#18","title":"1.8. \u041d\u0430 \u0447\u0442\u043e \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u044c \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043f\u0440\u0438 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u043f\u043e\u0434 \u0441\u0432\u043e\u044e \u0438\u0433\u0440\u0443","text":""},{"location":"practice/architecture.html#181","title":"1.8.1. \u0421\u0435\u0440\u0432\u0435\u0440 \u2014 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b","text":"<ul> <li>\u041d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u043c \u0440\u0430\u0441\u0447\u0451\u0442\u0430\u043c \u043d\u0430\u0433\u0440\u0430\u0434.</li> <li>\u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c XP \u0438 \u0432\u0430\u043b\u044e\u0442\u0443 \"\u043a\u0430\u043a \u0435\u0441\u0442\u044c\".</li> <li>\u0412\u0441\u0435 \u0440\u0430\u0441\u0447\u0451\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u043c\u044b \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c.</li> </ul>"},{"location":"practice/architecture.html#182","title":"1.8.2. \u0426\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0445","text":"<ul> <li>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438.</li> <li>\u041f\u0440\u0435\u0434\u0443\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 (idempotency).</li> <li>\u0417\u0430\u0449\u0438\u0442\u0438\u0442\u044c\u0441\u044f \u043e\u0442 \u0434\u0432\u043e\u0439\u043d\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438.</li> </ul>"},{"location":"practice/architecture.html#183","title":"1.8.3. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u0447\u0438\u0441\u0442\u043e\u0442\u0430","text":"<p>\u0420\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0441\u043b\u043e\u0451\u0432 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e:</p> <ul> <li>routes \u2192 \u0442\u043e\u043b\u044c\u043a\u043e HTTP</li> <li>services \u2192 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430</li> <li>repositories \u2192 SQL</li> <li>DB \u2192 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435</li> </ul>"},{"location":"practice/architecture.html#184","title":"1.8.4. \u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430","text":"\u0416\u0430\u043d\u0440 \u0427\u0442\u043e \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0442\u0440\u0430\u0437\u0438\u0442\u044c RPG \u0438\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044c, \u043a\u0432\u0435\u0441\u0442\u044b, XP Shooter \u043c\u0430\u0442\u0447\u0438, K/D, \u0440\u0435\u0439\u0442\u0438\u043d\u0433 Strategy \u0440\u0435\u0441\u0443\u0440\u0441\u044b, \u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e Simulator \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0430, \u0442\u0430\u0439\u043c\u0435\u0440\u044b Idle \u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u0434\u043e\u0445\u043e\u0434\u0430 \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438"},{"location":"practice/architecture.html#19-strategy-unity-strategy-game","title":"1.9. \u041f\u0440\u0438\u043c\u0435\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (Strategy \u2014 Unity Strategy Game)","text":""},{"location":"practice/architecture.html#191","title":"1.9.1. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u0441\u0445\u0435\u043c\u0430","text":"<pre><code>flowchart LR\n  C[Client\\nUnity Strategy Game] --&gt;|HTTPS + JSON| A[REST API\\nFlask Blueprints]\n  A --&gt; AU[Auth\\nJWT + RBAC]\n  AU --&gt; BL[Business Logic\\nMatch / Economy / City]\n  BL --&gt; D[Data Layer\\nMySQL 8.0\\nstrategy_db]\n\n  BL -.cache optional.-&gt; R[(Redis)]\n  BL -.events optional.-&gt; Q[(Message Queue)]</code></pre>"},{"location":"practice/architecture.html#192-post-apiv1matchfinish","title":"1.9.2. \u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439: <code>POST /api/v1/match/finish</code>","text":""},{"location":"practice/architecture.html#1921","title":"1.9.2.1. \u041a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0438\u0439 \u0437\u0430\u043f\u0440\u043e\u0441","text":"<pre><code>POST /api/v1/match/finish\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"matchId\": 9,\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 1850,\n    \"durationSeconds\": 1200,\n    \"powerDelta\": 50\n  }\n}\n</code></pre> <p>\u041c\u0430\u0442\u0447 <code>id=9</code> \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e <code>alice</code> (user_id=1) \u0438 \u0438\u043c\u0435\u0435\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 <code>started</code> \u0441\u043e\u0433\u043b\u0430\u0441\u043d\u043e <code>seed.sql</code>.</p>"},{"location":"practice/architecture.html#1922-auth-jwt-rbac","title":"1.9.2.2. Auth (JWT + RBAC)","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u043e\u043c <code>@auth_required(roles=[\"player\"])</code> \u0432 <code>app/routes/match.py</code>:</p> <ul> <li><code>verify_jwt_in_request()</code> \u0438\u0437 <code>flask-jwt-extended</code></li> <li>\u0438\u0437\u0432\u043b\u0435\u0447\u0451\u043d <code>userId</code> \u0447\u0435\u0440\u0435\u0437 <code>get_jwt_identity()</code></li> <li>\u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u044b <code>roles</code> \u0447\u0435\u0440\u0435\u0437 <code>get_jwt()</code></li> <li>\u043f\u0440\u043e\u0432\u0435\u0440\u0435\u043d\u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0440\u043e\u043b\u0438 <code>player</code></li> <li>\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u043e <code>g.user = {\"userId\": ..., \"roles\": [...]}</code></li> </ul> <p>\u041e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>401 Unauthorized\n</code></pre>"},{"location":"practice/architecture.html#1923-validation","title":"1.9.2.3. Validation","text":"<p>\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 <code>@validate_match_finish</code> \u0432 <code>app/middleware/validate_api.py</code> \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442:</p> <ul> <li><code>matchId</code> \u2014 int</li> <li><code>result.isWin</code> \u2014 bool</li> <li><code>result.score</code> \u2014 int &gt;= 0</li> <li><code>result.durationSeconds</code> \u2014 int &gt;= 0</li> <li><code>result.powerDelta</code> \u2014 int \u0438\u043b\u0438 null (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)</li> </ul> <p>\u041e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>400 Bad Request\n</code></pre>"},{"location":"practice/architecture.html#1924-business-logic","title":"1.9.2.4. Business Logic","text":"<p><code>app/services/match_service.py</code>:</p> <ol> <li><code>ensure_match_ownership_started()</code> \u2014 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0432\u043b\u0430\u0434\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0447\u0435\u043c \u0438 \u0441\u0442\u0430\u0442\u0443\u0441 <code>started</code></li> <li>\u0420\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u043f\u043e \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430\u043c (\u043a\u043b\u0438\u0435\u043d\u0442 \u0438\u0445 \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442):</li> </ol> <pre><code>xp_gained   = 100  (isWin = true)  / 30  (isWin = false)\nsoft_gained = 50   (isWin = true)  / 10  (isWin = false)\n</code></pre>"},{"location":"practice/architecture.html#1925-data-layer-mysql","title":"1.9.2.5. Data Layer (MySQL, \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f)","text":"<pre><code>START TRANSACTION;\n</code></pre> <pre><code>-- 1) \u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043c\u0430\u0442\u0447\u0430\nUPDATE matches SET status = 'finished', ended_at = NOW(3) WHERE id = 9;\n</code></pre> <pre><code>-- 2) \u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\nINSERT INTO battle_results (match_id, is_win, score, duration_seconds)\nVALUES (9, 1, 1850, 1200)\nON DUPLICATE KEY UPDATE is_win=VALUES(is_win), score=VALUES(score), duration_seconds=VALUES(duration_seconds);\n</code></pre> <pre><code>-- 3) \u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0433\u043e\u043d\u043e\u043a\nSELECT user_id FROM player_progress WHERE user_id = 1 FOR UPDATE;\n</code></pre> <pre><code>-- 4) \u041d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435\nUPDATE player_progress SET xp = xp + 100, soft_currency = soft_currency + 50 WHERE user_id = 1;\n</code></pre> <pre><code>-- 5) \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430\nINSERT INTO statistics_daily (user_id, day, sessions_count, events_count, playtime_seconds, wins, losses, score_sum)\nVALUES (1, CURDATE(), 0, 1, 1200, 1, 0, 1850)\nON DUPLICATE KEY UPDATE events_count=events_count+1, playtime_seconds=playtime_seconds+VALUES(playtime_seconds),\n  wins=wins+VALUES(wins), losses=losses+VALUES(losses), score_sum=score_sum+VALUES(score_sum);\n</code></pre> <pre><code>-- 6) \u041b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\nINSERT INTO leaderboard_scores (user_id, board_code, season, score)\nVALUES (1, 'default', 1, 1850)\nON DUPLICATE KEY UPDATE score=GREATEST(score, VALUES(score)), updated_at=CURRENT_TIMESTAMP(3);\n</code></pre> <pre><code>COMMIT;\n</code></pre>"},{"location":"practice/architecture.html#1926","title":"1.9.2.6. \u041e\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"matchId\": 9,\n    \"isWin\": true,\n    \"xpGained\": 100,\n    \"softCurrencyGained\": 50\n  }\n}\n</code></pre>"},{"location":"practice/architecture.html#1927-2","title":"1.9.2.7. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2)","text":"<ul> <li><code>401 Unauthorized</code> \u2014 \u0442\u043e\u043a\u0435\u043d \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442/\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u0435\u043d/\u043f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d.</li> <li><code>409 Conflict</code> \u2014 \u043c\u0430\u0442\u0447 \u0443\u0436\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d \u0438\u043b\u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \u2260 <code>started</code>.</li> <li><code>404 Not Found</code> \u2014 matchId \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.</li> <li><code>403 Forbidden</code> \u2014 \u043c\u0430\u0442\u0447 \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u0434\u0440\u0443\u0433\u043e\u043c\u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e.</li> </ul>"},{"location":"practice/architecture.html#110-docs01-architecturemd","title":"1.10. \u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u0430\u0439\u043b\u0430 <code>docs/01-architecture.md</code>","text":"<pre><code># 2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. 1. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430\n\n**\u0424\u0418\u041e:** \u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d \u0418\u0432\u0430\u043d\u043e\u0432\u0438\u0447\n**\u0413\u0440\u0443\u043f\u043f\u0430:** \u0414\u041a\u0418\u041f-401\u0433\u0434\u0440\u043c\u0438\n**\u041f\u0440\u043e\u0435\u043a\u0442:** &lt;\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430&gt;  \n**\u0416\u0430\u043d\u0440:** &lt;\u0436\u0430\u043d\u0440 \u0438\u0433\u0440\u044b&gt;  \n**\u041a\u043b\u0438\u0435\u043d\u0442:** &lt;Unity / Web / Mobile&gt;  \n**Backend:** Flask + MySQL  \n**\u0414\u0430\u0442\u0430:** &lt;\u0434\u0430\u0442\u0430&gt;\n\n---\n\n## 1.1. \u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0443 \u00ab\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430\u00bb\n\n### 1.1.1. \u0426\u0435\u043b\u044c\n\n\u041a\u0440\u0430\u0442\u043a\u043e \u043e\u043f\u0438\u0441\u0430\u0442\u044c \u0446\u0435\u043b\u044c \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430.\n\n---\n\n## 1.2. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u0441\u0445\u0435\u043c\u0430\n\n### 1.2.1. \u0421\u0445\u0435\u043c\u0430 (Mermaid)\n\n```mermaid\nflowchart LR\n  C[Client] --&gt;|HTTPS + JSON| A[API]\n  A --&gt; AU[Auth\\nJWT + RBAC]\n  AU --&gt; BL[Business Logic]\n  BL --&gt; D[Data Layer\\nMySQL 8.0]\n\n  BL -.cache(optional).-&gt; R[(Redis)]\n  BL -.events(optional).-&gt; Q[(Message Queue)]\n</code></pre>"},{"location":"practice/architecture.html#122_1","title":"1.2.2. \u041f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043a \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435","text":"<p>\u041e\u043f\u0438\u0448\u0438\u0442\u0435:</p> <ul> <li>\u043a\u0430\u043a\u0443\u044e \u0440\u043e\u043b\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 Client;</li> <li>\u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 API;</li> <li>\u0447\u0442\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 Auth;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0437\u0430\u0434\u0430\u0447\u0438 \u0440\u0435\u0448\u0430\u0435\u0442 Business Logic;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u0438\u0442 Data Layer;</li> <li>\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043b\u0438 Redis / MQ \u0438 \u0437\u0430\u0447\u0435\u043c.</li> </ul>"},{"location":"practice/architecture.html#13_1","title":"1.3. \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u044f","text":""},{"location":"practice/architecture.html#131-endpoint_1","title":"1.3.1. \u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 endpoint","text":"<p><code>&lt;\u0443\u043a\u0430\u0437\u0430\u0442\u044c endpoint&gt;</code></p> <p>\u041f\u0440\u0438\u043c\u0435\u0440\u044b:</p> <ul> <li><code>POST /api/v1/auth/login</code></li> <li><code>POST /api/v1/match/finish</code></li> <li><code>GET /api/v1/profile</code></li> </ul>"},{"location":"practice/architecture.html#14-http-","title":"1.4. HTTP-\u0437\u0430\u043f\u0440\u043e\u0441","text":"<pre><code>&lt;\u043f\u0440\u0438\u043c\u0435\u0440 HTTP-\u0437\u0430\u043f\u0440\u043e\u0441\u0430&gt;\n</code></pre> <pre><code>&lt;\u043f\u0440\u0438\u043c\u0435\u0440 JSON-\u0442\u0435\u043b\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430&gt;\n</code></pre>"},{"location":"practice/architecture.html#15-auth-jwt-rbac","title":"1.5. Auth (JWT + RBAC)","text":"<p>\u0423\u043a\u0430\u0437\u0430\u0442\u044c:</p> <ul> <li>\u043a\u0430\u043a \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f JWT;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u044e\u0442\u0441\u044f \u0438\u0437 \u0442\u043e\u043a\u0435\u043d\u0430;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0440\u043e\u043b\u0438 \u0434\u043e\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b.</li> </ul> <p>\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>401 Unauthorized\n</code></pre> <pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"UNAUTHORIZED\",\n    \"message\": \"JWT is missing/invalid/expired\",\n    \"requestId\": \"req_abc123\"\n  }\n}\n</code></pre>"},{"location":"practice/architecture.html#16-validation","title":"1.6. Validation","text":"<p>\u041e\u043f\u0438\u0448\u0438\u0442\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438:</p> <ul> <li>\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430;</li> <li>\u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u043d\u043e\u0441\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e;</li> <li>\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0441\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432;</li> <li>\u0431\u0438\u0437\u043d\u0435\u0441-\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f (\u0443\u0440\u043e\u0432\u043d\u0438, \u0440\u0435\u0441\u0443\u0440\u0441\u044b, \u0441\u0442\u0430\u0442\u0443\u0441 \u0438 \u0442.\u0434.).</li> </ul> <p>\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>409 Conflict\n</code></pre> <pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"CONFLICT\",\n    \"message\": \"...\",\n    \"requestId\": \"req_abc123\"\n  }\n}\n</code></pre>"},{"location":"practice/architecture.html#17-business-logic","title":"1.7. Business Logic","text":"<p>\u041e\u043f\u0438\u0448\u0438\u0442\u0435:</p> <ul> <li>\u043a\u0430\u043a\u0438\u0435 \u0440\u0430\u0441\u0447\u0451\u0442\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u044e\u0442\u0441\u044f;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u044e\u0442;</li> <li>\u043f\u043e\u0447\u0435\u043c\u0443 \u043a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u043e\u043c \u0438\u0441\u0442\u0438\u043d\u044b.</li> </ul> <p>\u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u2014 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438:</p> <pre><code>&lt;\u043f\u0440\u0438\u043c\u0435\u0440 \u0440\u0430\u0441\u0447\u0451\u0442\u0430&gt;\n</code></pre>"},{"location":"practice/architecture.html#18-data-layer-mysql","title":"1.8. Data Layer (MySQL, \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f)","text":""},{"location":"practice/architecture.html#181_1","title":"1.8.1. \u041d\u0430\u0447\u0430\u043b\u043e \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438","text":"<pre><code>START TRANSACTION;\n</code></pre>"},{"location":"practice/architecture.html#182-sql-","title":"1.8.2. SQL-\u0437\u0430\u043f\u0440\u043e\u0441\u044b","text":"<pre><code>-- \u043f\u0440\u0438\u043c\u0435\u0440 SELECT\n&lt;SQL-\u0437\u0430\u043f\u0440\u043e\u0441&gt;\n</code></pre> <pre><code>-- \u043f\u0440\u0438\u043c\u0435\u0440 UPDATE\n&lt;SQL-\u0437\u0430\u043f\u0440\u043e\u0441&gt;\n</code></pre> <pre><code>-- \u043f\u0440\u0438\u043c\u0435\u0440 INSERT\n&lt;SQL-\u0437\u0430\u043f\u0440\u043e\u0441&gt;\n</code></pre>"},{"location":"practice/architecture.html#183_1","title":"1.8.3. \u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438","text":"<pre><code>COMMIT;\n</code></pre>"},{"location":"practice/architecture.html#19-json-","title":"1.9. JSON-\u043e\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"&lt;\u043a\u043b\u044e\u0447&gt;\": \"&lt;\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435&gt;\"\n  }\n}\n</code></pre>"},{"location":"practice/architecture.html#110-2","title":"1.10. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2)","text":""},{"location":"practice/architecture.html#1101-401-unauthorized","title":"1.10.1. 401 Unauthorized","text":"<p>\u041f\u0440\u0438\u0447\u0438\u043d\u0430: &lt;\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435&gt;</p>"},{"location":"practice/architecture.html#1102-409-conflict","title":"1.10.2. 409 Conflict","text":"<p>\u041f\u0440\u0438\u0447\u0438\u043d\u0430: &lt;\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435&gt;</p>"},{"location":"practice/architecture.html#1103-404-not-found","title":"1.10.3. (\u041e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e) 404 Not Found","text":"<p>\u041f\u0440\u0438\u0447\u0438\u043d\u0430: &lt;\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435&gt;</p>"},{"location":"practice/architecture.html#111_1","title":"1.11. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u044b\u0435 \u043f\u0440\u0438\u043d\u0446\u0438\u043f\u044b \u043f\u0440\u043e\u0435\u043a\u0442\u0430","text":"<p>\u041f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0438\u0442\u044c:</p> <ol> <li>\u0421\u0435\u0440\u0432\u0435\u0440 \u2014 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b.</li> <li>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439.</li> <li>Stateless REST.</li> <li>\u0420\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0441\u043b\u043e\u0451\u0432 (routes / services / repositories / DB).</li> <li>\u0417\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 race condition (SELECT FOR UPDATE).</li> <li>\u0414\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (processed_events).</li> </ol>"},{"location":"practice/architecture.html#112","title":"1.12. \u0410\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f \u043f\u043e\u0434 \u0436\u0430\u043d\u0440","text":"\u0416\u0430\u043d\u0440 \u041a\u0430\u043a\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u0447\u0435\u0441\u0442\u044c RPG Shooter Strategy Simulator Idle"},{"location":"practice/architecture.html#113","title":"1.13. \u0418\u0442\u043e\u0433","text":"<p>\u041a\u0440\u0430\u0442\u043a\u0438\u0439 \u0432\u044b\u0432\u043e\u0434:</p> <ul> <li>\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043c\u043e\u0434\u0435\u043b\u0438   Client \u2192 API \u2192 Auth \u2192 Business Logic \u2192 DB;</li> <li>\u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f;</li> <li>\u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043b\u0438 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0445;</li> <li>\u043f\u0440\u0435\u0434\u0443\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u0430 \u043b\u0438 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0435\u043c\u043e\u0441\u0442\u044c. ```</li> </ul>"},{"location":"practice/backend_implementation.html","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f backend\u0430","text":""},{"location":"practice/backend_implementation.html#2-4-backend-flask","title":"2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. 4. \u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f backend'\u0430 \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430 (Flask)","text":""},{"location":"practice/backend_implementation.html#41-4-backend-","title":"4.1. \u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0443 4 \u00abBackend-\u043b\u043e\u0433\u0438\u043a\u0430\u00bb","text":""},{"location":"practice/backend_implementation.html#_1","title":"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c","text":"<ol> <li> <p>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c middleware (\u0434\u043b\u044f Flask \u2014 \u0447\u0435\u0440\u0435\u0437 <code>before_request/after_request</code>, \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0438 error handlers):</p> </li> <li> <p><code>requestId</code></p> </li> <li><code>authJwt</code></li> <li><code>validate</code></li> <li> <p><code>errorHandler</code></p> </li> <li> <p>\u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e \u0434\u043b\u044f \"\u0438\u0442\u043e\u0433\u043e\u0432\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f\" (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>match_finish</code>) \u0432 \u043e\u0434\u043d\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438:</p> </li> <li> <p>\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u043b\u0430\u0434\u0435\u043d\u0438\u044f \u043c\u0430\u0442\u0447\u0435\u043c \u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430</p> </li> <li>\u0437\u0430\u043f\u0438\u0441\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u0432 <code>battle_results</code></li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 <code>player_progress</code></li> <li>upsert \u0432 <code>leaderboard_scores</code></li> <li>upsert \u0432 <code>statistics_daily</code></li> <li>commit / rollback</li> </ol>"},{"location":"practice/backend_implementation.html#_2","title":"\u0410\u0440\u0442\u0435\u0444\u0430\u043a\u0442","text":"<p>\u041a\u043e\u0434 backend (\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0430\u043f\u043e\u043a \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430):</p> <pre><code>app/\n  routes/\n  controllers/\n  services/\n  repositories/\n  middleware/\n  config.py      \u2190 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0432\u043d\u0443\u0442\u0440\u0438 app/, \u043d\u0435 \u0432 \u043a\u043e\u0440\u043d\u0435\nwsgi.py          \u2190 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430\n</code></pre>"},{"location":"practice/backend_implementation.html#42-backend","title":"4.2. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 backend (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0430)","text":"<p>\u041f\u043e\u0442\u043e\u043a \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043a\u043e\u043d\u0432\u0435\u0439\u0435\u0440\u0443:</p> <pre><code>Request\n  \u2192 requestId + logging\n  \u2192 authJwt\n  \u2192 validate\n  \u2192 controller\n  \u2192 service (business + transaction)\n  \u2192 repository (SQL)\n  \u2192 response (JSON)\nError \u2192 errorHandler \u2192 JSON + logging\n</code></pre> <p>\u041f\u0440\u0438\u043d\u0446\u0438\u043f \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u0438 (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d \u0434\u043b\u044f \u0441\u0434\u0430\u0447\u0438):</p> <ul> <li>middleware: \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u043b\u043e\u0439 (requestId, auth, validate, error), \u0431\u0435\u0437 SQL \u0438 \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u0440\u0430\u0432\u0438\u043b.</li> <li>controller: \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0432\u0445\u043e\u0434, \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0438\u0441, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 JSON. SQL \u0437\u0430\u043f\u0440\u0435\u0449\u0451\u043d.</li> <li>service: \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430 + \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f + orchestration \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432. \u0418\u043c\u0435\u043d\u043d\u043e \u0442\u0443\u0442 \u043e\u0434\u043d\u0430 TX.</li> <li>repository: \u0442\u043e\u043b\u044c\u043a\u043e SQL/\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u0411\u0414. \u0411\u0435\u0437 \u0440\u0430\u0441\u0447\u0451\u0442\u043e\u0432 \u043d\u0430\u0433\u0440\u0430\u0434 \u0438 \u043f\u0440\u0430\u0432\u0438\u043b.</li> </ul>"},{"location":"practice/backend_implementation.html#43-endpoints-4","title":"4.3. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0435 endpoints \u0434\u043b\u044f \u0440\u0430\u0437\u0434\u0435\u043b\u0430 4 (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u043d\u0430\u0431\u043e\u0440)","text":"<p>\u0414\u043b\u044f \u0441\u0434\u0430\u0447\u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u0438\u043d \"\u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439\" endpoint:</p> <ul> <li><code>POST /api/v1/match/finish</code></li> </ul> <p>\u0412 \u0434\u0430\u043d\u043d\u043e\u043c \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f: <code>POST /api/v1/match/finish</code>.</p>"},{"location":"practice/backend_implementation.html#44-flask","title":"4.4. \u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (Flask) \u2014 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0438 \u0444\u0430\u0439\u043b\u044b","text":""},{"location":"practice/backend_implementation.html#441-flask","title":"4.4.1. \u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (Flask)","text":"<pre><code>project-root/\n\u2502\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 __init__.py       \u2190 create_app(), \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f blueprint'\u043e\u0432 \u0438 middleware\n\u2502   \u251c\u2500\u2500 config.py         \u2190 class Config (\u0447\u0438\u0442\u0430\u0435\u0442 .env \u0447\u0435\u0440\u0435\u0437 python-dotenv)\n\u2502   \u251c\u2500\u2500 extensions.py     \u2190 db, jwt, cors\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 routes/\n\u2502   \u2502   \u2514\u2500\u2500 match.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 controllers/\n\u2502   \u2502   \u2514\u2500\u2500 match_controller.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 match_service.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u251c\u2500\u2500 matches_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 progress_repo.py\n\u2502   \u2502   \u251c\u2500\u2500 leaderboard_repo.py\n\u2502   \u2502   \u2514\u2500\u2500 stats_repo.py\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 middleware/\n\u2502       \u251c\u2500\u2500 request_id.py\n\u2502       \u251c\u2500\u2500 auth_jwt.py\n\u2502       \u251c\u2500\u2500 validate_api.py\n\u2502       \u2514\u2500\u2500 error_handler.py\n\u2502\n\u251c\u2500\u2500 seed.sql\n\u251c\u2500\u2500 db/\n\u2502   \u2514\u2500\u2500 schema.sql\n\u2514\u2500\u2500 wsgi.py               \u2190 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 (python wsgi.py)\n</code></pre> <p>\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 <code>app/config.py</code>. \u0424\u0430\u0439\u043b\u043e\u0432 <code>config.py</code> \u0432 \u043a\u043e\u0440\u043d\u0435 \u0438 <code>run.py</code> \u043d\u0435\u0442 \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f <code>wsgi.py</code>.</p>"},{"location":"practice/backend_implementation.html#442","title":"4.4.2. \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u043e\u0432 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u0438 \u043f\u0440\u0438\u043c\u0435\u0440 \u0438\u0445 \u043d\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043c\u0438\u043d\u0438\u043c\u0443\u043c)","text":"<p>\u0426\u0435\u043b\u044c: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u044b\u0439 backend, \u0433\u0434\u0435 \u043e\u0434\u0438\u043d endpoint (<code>POST /api/v1/match/finish</code>) \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u0432\u0435\u0441\u044c \u043a\u043e\u043d\u0432\u0435\u0439\u0435\u0440: <code>requestId \u2192 authJwt \u2192 validate \u2192 controller \u2192 service (TX) \u2192 repositories (SQL) \u2192 JSON response</code>, \u0430 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f \u0435\u0434\u0438\u043d\u043e\u043e\u0431\u0440\u0430\u0437\u043d\u043e.</p>"},{"location":"practice/backend_implementation.html#a","title":"A) \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f","text":""},{"location":"practice/backend_implementation.html#a1-appconfigpy","title":"A.1. <code>app/config.py</code>","text":"<pre><code>import os\nfrom dotenv import load_dotenv\n\n# \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f \u0438\u0437 .env (\u0435\u0441\u043b\u0438 \u0444\u0430\u0439\u043b \u0435\u0441\u0442\u044c)\nload_dotenv()\n\n\nclass Config:\n    # Flask\n    SECRET_KEY = os.environ.get(\"SECRET_KEY\", \"change-me-in-production\")\n\n    # MySQL + SQLAlchemy\n    # \u041f\u0440\u0438\u043c\u0435\u0440: mysql+pymysql://root@localhost:3306/strategy_db?charset=utf8mb4\n    SQLALCHEMY_DATABASE_URI = os.environ.get(\n        \"DATABASE_URL\",\n        os.environ.get(\"SQLALCHEMY_DATABASE_URI\", \"sqlite:///dev.db\")\n    )\n    SQLALCHEMY_TRACK_MODIFICATIONS = False\n\n    # JWT\n    # \u0412 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u043f\u0440\u043e\u0435\u043a\u0442\u0435 \u043a\u043b\u044e\u0447 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 .env / \u0441\u0435\u043a\u0440\u0435\u0442\u0430\u0445\n    JWT_SECRET_KEY = os.environ.get(\"JWT_SECRET_KEY\", \"change-jwt-secret-in-production\")\n    JWT_ACCESS_TOKEN_EXPIRES = int(os.environ.get(\"JWT_ACCESS_TOKEN_EXPIRES\", 3600))\n</code></pre> <p>\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f \u0441\u043e\u0437\u0434\u0430\u0442\u044c <code>.env</code> \u0432 \u043a\u043e\u0440\u043d\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430:</p> <pre><code>SQLALCHEMY_DATABASE_URI=mysql+pymysql://root@localhost:3306/strategy_db?charset=utf8mb4\nDATABASE_URL=mysql+pymysql://root@localhost:3306/strategy_db?charset=utf8mb4\nJWT_SECRET_KEY=my-super-secret-jwt-key-change-in-prod\nSECRET_KEY=my-flask-secret-key\nDEBUG=1\n</code></pre>"},{"location":"practice/backend_implementation.html#a2-wsgipy","title":"A.2. <code>wsgi.py</code>","text":"<pre><code>from app import create_app\n\n# \u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 Flask-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f (\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f middleware \u0438 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432)\napp = create_app()\n\nif __name__ == \"__main__\":\n    # \u0417\u0434\u0435\u0441\u044c \u041d\u0415 \u043f\u0438\u0448\u0435\u043c \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0443 \u0438 \u041d\u0415 \u043f\u0438\u0448\u0435\u043c SQL.\n    # \u0424\u0430\u0439\u043b \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430 \u0437\u0430\u043f\u0443\u0441\u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0430.\n    app.run(host=\"0.0.0.0\", port=5000, debug=True)\n</code></pre>"},{"location":"practice/backend_implementation.html#b-app","title":"B) app/","text":""},{"location":"practice/backend_implementation.html#b1-appextensionspy","title":"B.1. <code>app/extensions.py</code>","text":"<pre><code>from flask_sqlalchemy import SQLAlchemy\nfrom flask_jwt_extended import JWTManager\nfrom flask_cors import CORS\n\n# db \u2014 \u0435\u0434\u0438\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0411\u0414 (SQLAlchemy)\ndb = SQLAlchemy()\n\n# jwt \u2014 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 JWT (\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0442\u043e\u043a\u0435\u043d\u0430, \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u0435 identity \u0438 claims)\njwt = JWTManager()\n\n# cors \u2014 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 CORS \u0434\u043b\u044f Unity/Web-\u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432\ncors = CORS()\n</code></pre>"},{"location":"practice/backend_implementation.html#b2-app__init__py","title":"B.2. <code>app/__init__.py</code>","text":"<pre><code>from flask import Flask\n\nfrom .extensions import db, jwt, cors\nfrom .middleware.request_id import register_request_id\nfrom .middleware.error_handler import register_error_handlers\nfrom .routes.match import match_bp\n\n\ndef create_app(config=None) -&gt; Flask:\n    # 1) \u0421\u043e\u0437\u0434\u0430\u0451\u043c Flask-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435\n    app = Flask(__name__)\n\n    # 2) \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044e \u0438\u0437 app/config.py\n    app.config.from_object(config or \"app.config.Config\")\n\n    # 3) \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f (db, jwt, cors)\n    db.init_app(app)\n    jwt.init_app(app)\n    cors.init_app(app, resources={r\"/*\": {\"origins\": \"*\"}})\n\n    # 4) \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u043c middleware \u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0438 \u043e\u0448\u0438\u0431\u043e\u043a\n    register_request_id(app)\n    register_error_handlers(app)\n\n    # 5) \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u043c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u044b (Blueprint)\n    app.register_blueprint(match_bp)\n\n    return app\n</code></pre>"},{"location":"practice/backend_implementation.html#c-appmiddleware","title":"C) app/middleware/","text":"<p>\u0412 Flask \"middleware\" \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u0442\u0430\u043a:</p> <ul> <li><code>@app.before_request</code> / <code>@app.after_request</code> \u2014 requestId + \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435</li> <li>\u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u043d\u0430\u0434 view-\u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c\u0438 \u2014 authJwt, validate</li> <li><code>@app.errorhandler(...)</code> \u2014 errorHandler (\u0435\u0434\u0438\u043d\u044b\u0439 JSON-\u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0448\u0438\u0431\u043e\u043a)</li> </ul>"},{"location":"practice/backend_implementation.html#c1-appmiddlewarerequest_idpy","title":"C.1. <code>app/middleware/request_id.py</code>","text":""},{"location":"practice/backend_implementation.html#requestid-middleware-flask","title":"<code>requestId</code> middleware (Flask)","text":"<p>\u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f:</p> <ul> <li>\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442 <code>requestId</code> \u043d\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441</li> <li>\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a <code>X-Request-Id</code></li> <li>\u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442 <code>requestId</code>, \u043c\u0435\u0442\u043e\u0434, \u043f\u0443\u0442\u044c, \u0441\u0442\u0430\u0442\u0443\u0441, duration</li> </ul> <p>\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043b\u043e\u0433\u0430:</p> <pre><code>req_abc123 user=15 POST /api/v1/match/finish 200 18ms\n</code></pre>"},{"location":"practice/backend_implementation.html#_3","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f (\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c)","text":"<ul> <li> <p>\u0412 <code>before_request</code>:</p> </li> <li> <p>\u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0438\u0441\u043b\u0430\u043b <code>X-Request-Id</code>, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0433\u043e</p> </li> <li>\u0438\u043d\u0430\u0447\u0435 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c <code>req_&lt;shortid&gt;</code></li> <li>\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 <code>g.request_id</code></li> <li>\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0441\u0442\u0430\u0440\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 <code>g._start_ms</code></li> <li> <p>\u0412 <code>after_request</code>:</p> </li> <li> <p>\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c <code>X-Request-Id: &lt;g.request_id&gt;</code></p> </li> <li>\u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c duration</li> <li>\u0437\u0430\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443</li> </ul> <pre><code>import time\nimport uuid\nfrom flask import g, request\n\n\ndef _gen_request_id() -&gt; str:\n    # \u0413\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u043c \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 requestId \u0434\u043b\u044f \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438 \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0438\n    return \"req_\" + uuid.uuid4().hex[:8]\n\n\ndef register_request_id(app):\n    @app.before_request\n    def _before():\n        # \u0415\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0438\u0441\u043b\u0430\u043b X-Request-Id \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0435\u0433\u043e (\u0443\u0434\u043e\u0431\u043d\u043e \u0434\u043b\u044f \u0442\u0440\u0430\u0441\u0441\u0438\u0440\u043e\u0432\u043a\u0438 \u0446\u0435\u043f\u043e\u0447\u043a\u0438)\n        # \u0418\u043d\u0430\u0447\u0435 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u043c \u043d\u043e\u0432\u044b\u0439 id\n        g.request_id = request.headers.get(\"X-Request-Id\") or _gen_request_id()\n\n        # \u0421\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u0434\u043b\u044f \u043f\u043e\u0434\u0441\u0447\u0451\u0442\u0430 \u0434\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\n        g._start_ms = int(time.time() * 1000)\n\n    @app.after_request\n    def _after(response):\n        # \u0414\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441\u0430\n        duration_ms = int(time.time() * 1000) - getattr(g, \"_start_ms\", int(time.time() * 1000))\n\n        # \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c requestId \u043a\u043b\u0438\u0435\u043d\u0442\u0443\n        response.headers[\"X-Request-Id\"] = getattr(g, \"request_id\", \"-\")\n\n        # userId \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d authJwt middleware (\u0447\u0435\u0440\u0435\u0437 g.user)\n        user_id = \"-\"\n        if getattr(g, \"user\", None) and isinstance(g.user, dict):\n            user_id = g.user.get(\"userId\", \"-\")\n\n        # \u041b\u043e\u0433 \u043f\u043e \u0442\u0440\u0435\u0431\u0443\u0435\u043c\u043e\u043c\u0443 \u0444\u043e\u0440\u043c\u0430\u0442\u0443:\n        # req_abc123 user=15 POST /api/v1/match/finish 200 18ms\n        app.logger.info(\n            \"%s user=%s %s %s %s %sms\",\n            getattr(g, \"request_id\", \"-\"),\n            user_id,\n            request.method,\n            request.path,\n            response.status_code,\n            duration_ms,\n        )\n        return response\n</code></pre>"},{"location":"practice/backend_implementation.html#c2-appmiddlewareerror_handlerpy","title":"C.2. <code>app/middleware/error_handler.py</code>","text":""},{"location":"practice/backend_implementation.html#errorhandler-middleware-flask","title":"<code>errorHandler</code> middleware (Flask)","text":"<p>\u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f:</p> <ul> <li>\u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u043b\u044e\u0431\u044b\u0435 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f</li> <li>\u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0435\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0448\u0438\u0431\u043a\u0438</li> <li>\u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443 \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 <code>requestId</code> \u0438 <code>userId</code> (\u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c)</li> </ul> <p>\u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0448\u0438\u0431\u043e\u043a:</p> <pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"INTERNAL_ERROR\",\n    \"message\": \"Unexpected error\",\n    \"requestId\": \"req_abc123\"\n  }\n}\n</code></pre>"},{"location":"practice/backend_implementation.html#_4","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f (\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c)","text":"<ul> <li> <p>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043b\u0430\u0441\u0441 <code>AppError(Exception)</code>:</p> </li> <li> <p><code>code</code>, <code>http_status</code>, <code>message</code>, <code>details(optional)</code></p> </li> <li> <p><code>@app.errorhandler(AppError)</code>:</p> </li> <li> <p>\u0432\u0435\u0440\u043d\u0443\u0442\u044c JSON-\u043e\u0448\u0438\u0431\u043a\u0443 \u0432 \u0435\u0434\u0438\u043d\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435</p> </li> <li> <p><code>@app.errorhandler(Exception)</code>:</p> </li> <li> <p>\u0432\u0435\u0440\u043d\u0443\u0442\u044c <code>500 INTERNAL_ERROR</code></p> </li> <li>\u0432 \u043b\u043e\u0433 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c stack trace + requestId + userId</li> </ul> <pre><code>from dataclasses import dataclass\nfrom typing import Any, Optional\nfrom flask import jsonify, g\n\n\n@dataclass\nclass AppError(Exception):\n    # \u041a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f:\n    # code \u2014 \u043c\u0430\u0448\u0438\u043d\u043d\u044b\u0439 \u043a\u043e\u0434 \u0434\u043b\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430\n    # message \u2014 \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u043e\u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\n    # http_status \u2014 HTTP \u0441\u0442\u0430\u0442\u0443\u0441 \u043e\u0442\u0432\u0435\u0442\u0430\n    # details \u2014 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0435 \u0434\u0435\u0442\u0430\u043b\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u043f\u043e\u043b\u044f \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438)\n    code: str\n    message: str\n    http_status: int = 400\n    details: Optional[Any] = None\n\n\ndef _error_response(code: str, message: str, request_id: str, details=None):\n    # \u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 error-\u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u043f\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044e\n    body = {\n        \"ok\": False,\n        \"error\": {\n            \"code\": code,\n            \"message\": message,\n            \"requestId\": request_id\n        }\n    }\n    if details is not None:\n        body[\"error\"][\"details\"] = details\n    return body\n\n\ndef register_error_handlers(app):\n    @app.errorhandler(AppError)\n    def handle_app_error(err: AppError):\n        rid = getattr(g, \"request_id\", \"-\")\n\n        # \u041b\u043e\u0433\u0438\u0440\u0443\u0435\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443 (\u0431\u0435\u0437 stacktrace, \u043e\u0431\u044b\u0447\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043a\u043e\u0434\u0430/\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f)\n        app.logger.warning(\"AppError %s rid=%s msg=%s\", err.code, rid, err.message)\n\n        return jsonify(_error_response(err.code, err.message, rid, err.details)), err.http_status\n\n    @app.errorhandler(Exception)\n    def handle_exception(err: Exception):\n        rid = getattr(g, \"request_id\", \"-\")\n\n        # \u041b\u043e\u0433\u0438\u0440\u0443\u0435\u043c \u043d\u0435\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443 \u0441\u043e stacktrace\n        app.logger.exception(\"Unhandled error rid=%s\", rid)\n\n        return jsonify(_error_response(\"INTERNAL_ERROR\", \"Unexpected error\", rid)), 500\n</code></pre>"},{"location":"practice/backend_implementation.html#c3-appmiddlewareauth_jwtpy","title":"C.3. <code>app/middleware/auth_jwt.py</code>","text":""},{"location":"practice/backend_implementation.html#authjwt-middleware-flask","title":"<code>authJwt</code> middleware (Flask)","text":"<p>\u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f:</p> <ul> <li>\u0447\u0438\u0442\u0430\u0435\u0442 <code>Authorization: Bearer &lt;JWT&gt;</code></li> <li>\u0432\u0430\u043b\u0438\u0434\u0438\u0440\u0443\u0435\u0442 \u0442\u043e\u043a\u0435\u043d</li> <li> <p>\u043a\u043b\u0430\u0434\u0451\u0442 \u0432 <code>g.user</code>:</p> </li> <li> <p><code>userId</code></p> </li> <li><code>roles</code></li> </ul> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>401 Unauthorized</code> \u2014 \u0442\u043e\u043a\u0435\u043d \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442/\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u0435\u043d/\u0438\u0441\u0442\u0451\u043a</li> <li><code>403 Forbidden</code> \u2014 \u0440\u043e\u043b\u044c \u043d\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 (\u0435\u0441\u043b\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0435 RBAC)</li> </ul>"},{"location":"practice/backend_implementation.html#_5","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f (\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c)","text":"<ul> <li>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 <code>@auth_required(roles=[...])</code></li> <li> <p>\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440:</p> </li> <li> <p>\u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 Bearer token (\u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 <code>verify_jwt_in_request()</code> \u0432\u043d\u0443\u0442\u0440\u0438 <code>flask-jwt-extended</code>)</p> </li> <li>\u0434\u0435\u043a\u043e\u0434\u0438\u0440\u0443\u0435\u0442 \u0442\u043e\u043a\u0435\u043d</li> <li>\u0437\u0430\u0431\u0438\u0440\u0430\u0435\u0442 identity (user_id) \u0438 roles (\u0438\u0437 claims)</li> <li>\u043a\u043b\u0430\u0434\u0451\u0442 \u0432 <code>g.user = {\"userId\": ..., \"roles\": [...]}</code></li> </ul> <pre><code>from functools import wraps\nfrom flask import g\nfrom flask_jwt_extended import verify_jwt_in_request, get_jwt, get_jwt_identity\n\nfrom .error_handler import AppError\n\n\ndef auth_required(roles=None):\n    # roles \u2014 \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u043e\u043b\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f \u043a endpoint\n    roles = roles or []\n\n    def decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **kwargs):\n            try:\n                # \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0442\u043e\u043a\u0435\u043d (\u0432\u0430\u043b\u0438\u0434\u043d\u043e\u0441\u0442\u044c, \u0441\u0440\u043e\u043a \u0436\u0438\u0437\u043d\u0438)\n                verify_jwt_in_request()\n            except Exception:\n                # \u041b\u044e\u0431\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 JWT \u2192 401\n                raise AppError(code=\"UNAUTHORIZED\", message=\"JWT is missing/invalid/expired\", http_status=401)\n\n            # user_id \u0431\u0435\u0440\u0451\u043c \u0438\u0437 identity \u0442\u043e\u043a\u0435\u043d\u0430\n            user_id = get_jwt_identity()\n\n            # \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0442\u043e\u043a\u0435\u043d\u0430 (claims)\n            claims = get_jwt() or {}\n            user_roles = claims.get(\"roles\", [])\n\n            # \u0415\u0441\u043b\u0438 endpoint \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0440\u043e\u043b\u0438 \u2014 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c RBAC\n            if roles:\n                ok = any(r in user_roles for r in roles)\n                if not ok:\n                    raise AppError(code=\"FORBIDDEN\", message=\"Insufficient role\", http_status=403)\n\n            # \u041a\u043b\u0430\u0434\u0451\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 g (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u043c\u0438/\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c)\n            g.user = {\"userId\": user_id, \"roles\": user_roles}\n\n            return fn(*args, **kwargs)\n\n        return wrapper\n\n    return decorator\n</code></pre> <p>\u0414\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u044d\u0442\u043e\u0433\u043e \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 \u0432 JWT \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c:</p> <ul> <li>identity = user_id</li> <li>claim <code>roles</code> = \u0441\u043f\u0438\u0441\u043e\u043a \u0440\u043e\u043b\u0435\u0439</li> </ul> <p>\u042d\u0442\u043e \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 <code>auth_service.py</code> \u043f\u0440\u0438 \u043b\u043e\u0433\u0438\u043d\u0435 \u0447\u0435\u0440\u0435\u0437 <code>create_access_token(identity=user[\"id\"], additional_claims={\"roles\": roles})</code>.</p>"},{"location":"practice/backend_implementation.html#c4-appmiddlewarevalidate_apipy","title":"C.4. <code>app/middleware/validate_api.py</code>","text":""},{"location":"practice/backend_implementation.html#validate-middleware-flask","title":"<code>validate</code> middleware (Flask)","text":"<p>\u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f:</p> <ul> <li>\u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0442\u0435\u043b\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0434\u043e \u0411\u0414</li> <li>\u043f\u0440\u0438 \u043e\u0448\u0438\u0431\u043a\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 <code>400</code> \u0432 \u0435\u0434\u0438\u043d\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435</li> </ul> <p>\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0434\u043b\u044f <code>match_finish</code>:</p> <ul> <li><code>matchId</code> \u2014 \u0447\u0438\u0441\u043b\u043e</li> <li><code>result.isWin</code> \u2014 boolean</li> <li><code>result.score</code> \u2014 \u0447\u0438\u0441\u043b\u043e &gt;= 0</li> <li><code>result.durationSeconds</code> \u2014 \u0447\u0438\u0441\u043b\u043e &gt;= 0</li> <li><code>result.powerDelta</code> \u2014 \u0447\u0438\u0441\u043b\u043e \u0438\u043b\u0438 null (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)</li> </ul>"},{"location":"practice/backend_implementation.html#_6","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f (\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c)","text":"<ul> <li>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 <code>@validate_match_finish</code></li> <li> <p>\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440:</p> </li> <li> <p>\u0447\u0438\u0442\u0430\u0435\u0442 <code>request.get_json(silent=True)</code></p> </li> <li>\u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0439/\u0442\u0438\u043f\u043e\u0432</li> <li>\u043f\u0440\u0438 \u043e\u0448\u0438\u0431\u043a\u0435 \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 <code>AppError(code='VALIDATION_ERROR', http_status=400, ...)</code></li> </ul> <pre><code>from functools import wraps\nfrom flask import request\nfrom .error_handler import AppError\n\n\ndef _bad_body(details):\n    raise AppError(code=\"VALIDATION_ERROR\", message=\"Invalid request body\", http_status=400, details=details)\n\n\ndef validate_match_finish(fn):\n    # \u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0414\u041e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0430/\u0441\u0435\u0440\u0432\u0438\u0441\u0430, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0442\u0440\u043e\u0433\u0430\u0442\u044c \u0411\u0414 \u043f\u0440\u0438 \u043c\u0443\u0441\u043e\u0440\u043d\u043e\u043c \u0432\u0432\u043e\u0434\u0435\n\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        data = request.get_json(silent=True)\n\n        if not isinstance(data, dict):\n            _bad_body({\"body\": \"JSON object expected\"})\n\n        match_id = data.get(\"matchId\")\n        result = data.get(\"result\")\n\n        if not isinstance(match_id, int):\n            _bad_body({\"matchId\": \"int required\"})\n\n        if not isinstance(result, dict):\n            _bad_body({\"result\": \"object required\"})\n\n        is_win = result.get(\"isWin\")\n        score = result.get(\"score\")\n        duration = result.get(\"durationSeconds\")\n        power_delta = result.get(\"powerDelta\")\n\n        if not isinstance(is_win, bool):\n            _bad_body({\"result.isWin\": \"bool required\"})\n        if not isinstance(score, int) or score &lt; 0:\n            _bad_body({\"result.score\": \"int &gt;= 0 required\"})\n        if not isinstance(duration, int) or duration &lt; 0:\n            _bad_body({\"result.durationSeconds\": \"int &gt;= 0 required\"})\n        if power_delta is not None and not isinstance(power_delta, int):\n            _bad_body({\"result.powerDelta\": \"int or null required\"})\n\n        return fn(*args, **kwargs)\n\n    return wrapper\n</code></pre>"},{"location":"practice/backend_implementation.html#d-approutes","title":"D) app/routes/","text":""},{"location":"practice/backend_implementation.html#d1-approutesmatchpy","title":"D.1. <code>app/routes/match.py</code>","text":"<p>\u0424\u0430\u0439\u043b \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 \u0441\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u0442 URL \u0441 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u043e\u043c \u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u0442 middleware-\u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b.</p> <pre><code>from flask import Blueprint\nfrom app.middleware.auth_jwt import auth_required\nfrom app.middleware.validate_api import validate_match_finish\nfrom app.controllers.match_controller import finish_match_controller\n\n# \u0413\u0440\u0443\u043f\u043f\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432 /api/v1/match\nmatch_bp = Blueprint(\"match\", __name__, url_prefix=\"/api/v1/match\")\n\n\n@match_bp.post(\"/finish\")\n# 1) authJwt: \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0442\u043e\u043a\u0435\u043d \u0438 \u0440\u043e\u043b\u044c \u0438\u0433\u0440\u043e\u043a\u0430\n@auth_required(roles=[\"player\"])\n# 2) validate: \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0442\u0435\u043b\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430\n@validate_match_finish\ndef finish_match():\n    # 3) controller: \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0438\u0441\n    return finish_match_controller()\n</code></pre>"},{"location":"practice/backend_implementation.html#e-appcontrollers","title":"E) app/controllers/","text":""},{"location":"practice/backend_implementation.html#e1-appcontrollersmatch_controllerpy","title":"E.1. <code>app/controllers/match_controller.py</code>","text":"<p>\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440: \u0442\u043e\u043b\u044c\u043a\u043e HTTP-\u043e\u0431\u0432\u044f\u0437\u043a\u0430. SQL \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0439 \u0442\u0443\u0442 \u0431\u044b\u0442\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e.</p> <pre><code>from flask import g, request, jsonify\nfrom app.services.match_service import finish_match_service\n\n\ndef finish_match_controller():\n    # userId \u0431\u0435\u0440\u0451\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 JWT (g.user \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f middleware authJwt)\n    user_id = g.user[\"userId\"]\n\n    # JSON \u0442\u0435\u043b\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 (\u0443\u0436\u0435 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u043d middleware validate)\n    payload = request.get_json()\n\n    # \u0421\u0435\u0440\u0432\u0438\u0441 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0443 \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044e\n    result = finish_match_service(user_id=user_id, payload=payload)\n\n    # \u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430\n    return jsonify({\n        \"ok\": True,\n        \"data\": result\n    }), 200\n</code></pre>"},{"location":"practice/backend_implementation.html#f-appservices","title":"F) app/services/","text":""},{"location":"practice/backend_implementation.html#f1-appservicesmatch_servicepy","title":"F.1. <code>app/services/match_service.py</code>","text":"<p>\u0421\u0435\u0440\u0432\u0438\u0441: \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430 + \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f + orchestration \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432.</p> <p>\u0412\u0430\u0436\u043d\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e: \u043e\u0434\u043d\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u043d\u0430 \u0432\u0435\u0441\u044c \u0438\u0442\u043e\u0433.</p> <pre><code>from app.extensions import db\nfrom app.repositories.matches_repo import ensure_match_ownership_started, finish_match_row\nfrom app.repositories.progress_repo import ensure_progress_row, lock_progress_row, add_progress_rewards\nfrom app.repositories.stats_repo import upsert_daily_stats\nfrom app.repositories.leaderboard_repo import upsert_leaderboard_score\n\n_XP_WIN   = 100\n_XP_LOSS  = 30\n_SOFT_WIN = 50\n_SOFT_LOSS = 10\n_BOARD_CODE = \"default\"\n_SEASON = 1\n\n\ndef finish_match_service(user_id: int, payload: dict) -&gt; dict:\n    match_id = payload[\"matchId\"]\n    result   = payload[\"result\"]\n    is_win   = result[\"isWin\"]\n    score    = result[\"score\"]\n    duration = result[\"durationSeconds\"]\n\n    # \u0421\u0435\u0440\u0432\u0435\u0440 \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u0441\u0430\u043c \u2014 \u043a\u043b\u0438\u0435\u043d\u0442 \u0438\u0445 \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442\n    xp_gained   = _XP_WIN   if is_win else _XP_LOSS\n    soft_gained = _SOFT_WIN if is_win else _SOFT_LOSS\n\n    try:\n        # \u0412\u0430\u0436\u043d\u043e: \u043e\u0434\u043d\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u043d\u0430 \u0432\u0435\u0441\u044c \u0438\u0442\u043e\u0433 (\u0430\u0442\u043e\u043c\u0430\u0440\u043d\u043e\u0441\u0442\u044c)\n        # 0) \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0432\u043b\u0430\u0434\u0435\u043d\u0438\u044f \u043c\u0430\u0442\u0447\u0435\u043c \u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 (\u0431\u0435\u0437 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438)\n        ensure_match_ownership_started(db.session, match_id=match_id, user_id=user_id)\n\n        # 1) \u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043c\u0430\u0442\u0447\u0430 + \u0437\u0430\u043f\u0438\u0441\u044c battle_results\n        finish_match_row(db.session, match_id=match_id, is_win=is_win, score=score, duration_seconds=duration)\n\n        # 2) \u0413\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430\n        ensure_progress_row(db.session, user_id=user_id)\n\n        # 3) \u0411\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u043c \u0441\u0442\u0440\u043e\u043a\u0443 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 (\u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0433\u043e\u043d\u043e\u043a)\n        lock_progress_row(db.session, user_id=user_id)\n\n        # 4) \u041d\u0430\u0447\u0438\u0441\u043b\u044f\u0435\u043c \u043d\u0430\u0433\u0440\u0430\u0434\u044b\n        add_progress_rewards(db.session, user_id=user_id, xp=xp_gained, soft_currency=soft_gained)\n\n        # 5) Upsert \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438\n        upsert_daily_stats(db.session, user_id=user_id, playtime_seconds=duration, is_win=is_win, score=score)\n\n        # 6) Upsert \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0430\n        upsert_leaderboard_score(db.session, user_id=user_id, board_code=_BOARD_CODE, season=_SEASON, score=score)\n\n        # Commit \u2014 \u0432\u0441\u0451 \u0438\u043b\u0438 \u043d\u0438\u0447\u0435\u0433\u043e\n        db.session.commit()\n\n    except Exception:\n        db.session.rollback()\n        raise\n\n    return {\n        \"matchId\": match_id,\n        \"isWin\": is_win,\n        \"xpGained\": xp_gained,\n        \"softCurrencyGained\": soft_gained,\n    }\n</code></pre>"},{"location":"practice/backend_implementation.html#g-apprepositories","title":"G) app/repositories/","text":"<p>\u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438: \u0442\u043e\u043b\u044c\u043a\u043e SQL, \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0440\u0430\u0441\u0447\u0451\u0442\u043e\u0432 \u043d\u0430\u0433\u0440\u0430\u0434, \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u043f\u0440\u0430\u0432\u0438\u043b \"\u043a\u0430\u043a \u0441\u0447\u0438\u0442\u0430\u0442\u044c\".</p>"},{"location":"practice/backend_implementation.html#g1-apprepositoriesmatches_repopy","title":"G.1. <code>app/repositories/matches_repo.py</code>","text":"<pre><code>from sqlalchemy import text\nfrom app.middleware.error_handler import AppError\n\n\ndef ensure_match_ownership_started(session, match_id: int, user_id: int):\n    # \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u0447\u0442\u043e \u043c\u0430\u0442\u0447 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0438 \u0438\u043c\u0435\u0435\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 started\n    sql = text(\"SELECT id, user_id, status FROM matches WHERE id = :match_id\")\n    row = session.execute(sql, {\"match_id\": match_id}).mappings().first()\n    if row is None:\n        raise AppError(code=\"NOT_FOUND\", message=\"Match not found\", http_status=404)\n    if row[\"user_id\"] != user_id:\n        raise AppError(code=\"FORBIDDEN\", message=\"Match belongs to another user\", http_status=403)\n    if row[\"status\"] != \"started\":\n        raise AppError(code=\"CONFLICT\", message=\"Match is not in started state\", http_status=409)\n\n\ndef finish_match_row(session, match_id: int, is_win: bool, score: int, duration_seconds: int):\n    # \u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043c\u0430\u0442\u0447\u0430\n    upd = text(\"UPDATE matches SET status='finished', ended_at=NOW(3) WHERE id=:match_id\")\n    session.execute(upd, {\"match_id\": match_id})\n\n    # \u0417\u0430\u043f\u0438\u0441\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 (upsert \u043d\u0430 \u0441\u043b\u0443\u0447\u0430\u0439 retry)\n    ins = text(\"\"\"\n        INSERT INTO battle_results (match_id, is_win, score, duration_seconds)\n        VALUES (:match_id, :is_win, :score, :duration)\n        ON DUPLICATE KEY UPDATE\n          is_win=VALUES(is_win), score=VALUES(score), duration_seconds=VALUES(duration_seconds)\n    \"\"\")\n    session.execute(ins, {\"match_id\": match_id, \"is_win\": int(is_win), \"score\": score, \"duration\": duration_seconds})\n</code></pre>"},{"location":"practice/backend_implementation.html#g2-apprepositoriesprogress_repopy","title":"G.2. <code>app/repositories/progress_repo.py</code>","text":"<pre><code>from sqlalchemy import text\nfrom app.middleware.error_handler import AppError\n\n\ndef ensure_progress_row(session, user_id: int):\n    # INSERT IGNORE \u2014 \u0441\u043e\u0437\u0434\u0430\u0451\u0442 \u0441\u0442\u0440\u043e\u043a\u0443 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430, \u0435\u0441\u043b\u0438 \u0435\u0451 \u043d\u0435\u0442\n    sql = text(\"INSERT IGNORE INTO player_progress (user_id) VALUES (:user_id)\")\n    session.execute(sql, {\"user_id\": user_id})\n\n\ndef lock_progress_row(session, user_id: int):\n    # SELECT ... FOR UPDATE \u2014 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0430 \u0441\u0442\u0440\u043e\u043a\u0438 (\u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0433\u043e\u043d\u043e\u043a)\n    sql = text(\"\"\"\n        SELECT user_id, xp, soft_currency\n        FROM player_progress\n        WHERE user_id = :user_id\n        FOR UPDATE\n    \"\"\")\n    row = session.execute(sql, {\"user_id\": user_id}).fetchone()\n    if row is None:\n        raise AppError(code=\"PROGRESS_NOT_FOUND\", message=\"player_progress row not found\", http_status=404)\n\n\ndef add_progress_rewards(session, user_id: int, xp: int, soft_currency: int):\n    # \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u0438\u0433\u0440\u043e\u043a\u0430\n    sql = text(\"\"\"\n        UPDATE player_progress\n        SET xp = xp + :xp,\n            soft_currency = soft_currency + :soft\n        WHERE user_id = :user_id\n    \"\"\")\n    session.execute(sql, {\"xp\": xp, \"soft\": soft_currency, \"user_id\": user_id})\n</code></pre>"},{"location":"practice/backend_implementation.html#g3-apprepositoriesstats_repopy","title":"G.3. <code>app/repositories/stats_repo.py</code>","text":"<pre><code>from sqlalchemy import text\n\n\ndef upsert_daily_stats(session, user_id: int, playtime_seconds: int, is_win: bool, score: int):\n    wins   = 1 if is_win else 0\n    losses = 0 if is_win else 1\n\n    # UPSERT \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0434\u043d\u044e\n    sql = text(\"\"\"\n        INSERT INTO statistics_daily\n          (user_id, day, sessions_count, events_count, playtime_seconds, wins, losses, score_sum)\n        VALUES (:user_id, CURDATE(), 0, 1, :playtime, :wins, :losses, :score)\n        ON DUPLICATE KEY UPDATE\n          events_count     = events_count + 1,\n          playtime_seconds = playtime_seconds + VALUES(playtime_seconds),\n          wins             = wins + VALUES(wins),\n          losses           = losses + VALUES(losses),\n          score_sum        = score_sum + VALUES(score_sum)\n    \"\"\")\n    session.execute(sql, {\n        \"user_id\": user_id,\n        \"playtime\": playtime_seconds,\n        \"wins\": wins,\n        \"losses\": losses,\n        \"score\": score\n    })\n</code></pre>"},{"location":"practice/backend_implementation.html#g4-apprepositoriesleaderboard_repopy","title":"G.4. <code>app/repositories/leaderboard_repo.py</code>","text":"<pre><code>from sqlalchemy import text\n\n\ndef upsert_leaderboard_score(session, user_id: int, board_code: str, season: int, score: int):\n    # UPSERT \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0430 (\u0431\u0435\u0440\u0451\u043c \u043b\u0443\u0447\u0448\u0438\u0439 score)\n    sql = text(\"\"\"\n        INSERT INTO leaderboard_scores (user_id, board_code, season, score)\n        VALUES (:user_id, :board_code, :season, :score)\n        ON DUPLICATE KEY UPDATE\n          score      = GREATEST(score, VALUES(score)),\n          updated_at = CURRENT_TIMESTAMP(3)\n    \"\"\")\n    session.execute(sql, {\n        \"user_id\": user_id,\n        \"board_code\": board_code,\n        \"season\": season,\n        \"score\": score\n    })\n</code></pre>"},{"location":"practice/backend_implementation.html#45-middleware","title":"4.5. Middleware (\u0438\u0442\u043e\u0433)","text":"<p>\u0412 \u044d\u0442\u043e\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b middleware:</p> <ul> <li><code>requestId</code> \u2014 <code>before_request/after_request</code></li> <li><code>authJwt</code> \u2014 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 <code>@auth_required(...)</code></li> <li><code>validate</code> \u2014 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 <code>@validate_match_finish</code></li> <li><code>errorHandler</code> \u2014 <code>@app.errorhandler(AppError)</code> \u0438 <code>@app.errorhandler(Exception)</code></li> </ul>"},{"location":"practice/backend_implementation.html#46-match_finish","title":"4.6. \u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u0430\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f: <code>match_finish</code> (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f)","text":""},{"location":"practice/backend_implementation.html#461","title":"4.6.1. \u0427\u0442\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432\u043d\u0443\u0442\u0440\u0438 \u043e\u0434\u043d\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438","text":"<p>\u0412\u043d\u0443\u0442\u0440\u0438 \u043e\u0434\u043d\u043e\u0439 TX \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f:</p> <ol> <li>\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043c\u0430\u0442\u0447\u0430 (<code>ensure_match_ownership_started</code>)</li> <li>\u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043c\u0430\u0442\u0447\u0430 + \u0437\u0430\u043f\u0438\u0441\u044c <code>battle_results</code> (<code>finish_match_row</code>)</li> <li>\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 (<code>lock_progress_row</code>)</li> <li>\u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u043d\u0430\u0433\u0440\u0430\u0434 (<code>add_progress_rewards</code>)</li> <li>upsert <code>statistics_daily</code></li> <li>upsert <code>leaderboard_scores</code></li> <li>commit</li> </ol>"},{"location":"practice/backend_implementation.html#462","title":"4.6.2. \u0427\u0442\u043e \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c (\u0447\u0435\u0433\u043e \u043e\u0431\u044b\u0447\u043d\u043e \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442)","text":"<ol> <li> <p>Idempotency \u2014 \u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0433\u043e <code>match_finish</code>:    \u0420\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u0430 \u0447\u0435\u0440\u0435\u0437 \u0441\u0442\u0430\u0442\u0443\u0441 \u043c\u0430\u0442\u0447\u0430: <code>ensure_match_ownership_started()</code> \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 <code>409 CONFLICT</code> \u0435\u0441\u043b\u0438 <code>status != 'started'</code>. \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0432 <code>events_service.py</code> \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f <code>processed_events</code> \u0441 <code>UNIQUE(user_id, event_id)</code>.</p> </li> <li> <p>Anti-cheat / ownership checks:</p> </li> <li><code>matchId</code> \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0430\u0442\u044c <code>userId</code> \u0438\u0437 JWT \u2014 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u0432 <code>ensure_match_ownership_started()</code></li> <li> <p>\u0441\u0442\u0430\u0442\u0443\u0441 \u043c\u0430\u0442\u0447\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c <code>started</code> \u2014 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u0442\u0430\u043c \u0436\u0435</p> </li> <li> <p>\u0411\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0438 \u0434\u043b\u044f \u0437\u0430\u0449\u0438\u0442\u044b \u043e\u0442 \u0433\u043e\u043d\u043e\u043a:</p> </li> <li> <p><code>SELECT ... FOR UPDATE</code> \u043d\u0430 <code>player_progress</code> \u0432 <code>lock_progress_row()</code></p> </li> <li> <p>\u0410\u0442\u043e\u043c\u0430\u0440\u043d\u043e\u0441\u0442\u044c:</p> </li> <li>\u043b\u044e\u0431\u043e\u0439 \u0441\u0431\u043e\u0439 \u2192 <code>db.session.rollback()</code> \u0432 \u0431\u043b\u043e\u043a\u0435 <code>except Exception</code></li> </ol>"},{"location":"practice/backend_implementation.html#463-strategy","title":"4.6.3. \u041f\u0440\u0438\u043c\u0435\u0440 \u0432\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 (Strategy)","text":"<pre><code>POST /api/v1/match/finish\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"matchId\": 9,\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 1850,\n    \"durationSeconds\": 1200,\n    \"powerDelta\": 50\n  }\n}\n</code></pre> <p>\u041c\u0430\u0442\u0447 <code>id=9</code> \u0438\u0437 <code>seed.sql</code> \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 <code>alice</code> (user_id=1), \u0441\u0442\u0430\u0442\u0443\u0441 <code>started</code>.</p>"},{"location":"practice/backend_implementation.html#464-","title":"4.6.4. \u0411\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430 \u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0439","text":"<p>\u041d\u0430\u0433\u0440\u0430\u0434\u044b \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u0432 <code>match_service.py</code>:</p> <pre><code>xp_gained   = 100  (isWin = true)  / 30  (isWin = false)\nsoft_gained = 50   (isWin = true)  / 10  (isWin = false)\n</code></pre>"},{"location":"practice/backend_implementation.html#465-sql-mysql-80","title":"4.6.5. SQL \u0432\u043d\u0443\u0442\u0440\u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 (MySQL 8.0)","text":"<p>\u041d\u0430\u0447\u0430\u043b\u043e \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438:</p> <pre><code>START TRANSACTION;\n</code></pre>"},{"location":"practice/backend_implementation.html#0","title":"0) \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043c\u0430\u0442\u0447\u0430","text":"<pre><code>SELECT id, user_id, status FROM matches WHERE id = 9;\n</code></pre>"},{"location":"practice/backend_implementation.html#1","title":"1) \u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043c\u0430\u0442\u0447\u0430","text":"<pre><code>UPDATE matches SET status='finished', ended_at=NOW(3) WHERE id = 9;\n</code></pre>"},{"location":"practice/backend_implementation.html#2","title":"2) \u0417\u0430\u043f\u0438\u0441\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430","text":"<pre><code>INSERT INTO battle_results (match_id, is_win, score, duration_seconds)\nVALUES (9, 1, 1850, 1200)\nON DUPLICATE KEY UPDATE\n  is_win=VALUES(is_win), score=VALUES(score), duration_seconds=VALUES(duration_seconds);\n</code></pre>"},{"location":"practice/backend_implementation.html#3","title":"3) \u0411\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 (\u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0433\u043e\u043d\u043e\u043a)","text":"<pre><code>SELECT user_id, xp, soft_currency\nFROM player_progress\nWHERE user_id = 1\nFOR UPDATE;\n</code></pre>"},{"location":"practice/backend_implementation.html#4","title":"4) \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430","text":"<pre><code>UPDATE player_progress\nSET xp = xp + 100,\n    soft_currency = soft_currency + 50\nWHERE user_id = 1;\n</code></pre>"},{"location":"practice/backend_implementation.html#5-upsert","title":"5) \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u043d\u0435\u0432\u043d\u043e\u0439 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 (upsert)","text":"<pre><code>INSERT INTO statistics_daily\n  (user_id, day, sessions_count, events_count, playtime_seconds, wins, losses, score_sum)\nVALUES (1, CURDATE(), 0, 1, 1200, 1, 0, 1850)\nON DUPLICATE KEY UPDATE\n  events_count     = events_count + 1,\n  playtime_seconds = playtime_seconds + VALUES(playtime_seconds),\n  wins             = wins + VALUES(wins),\n  losses           = losses + VALUES(losses),\n  score_sum        = score_sum + VALUES(score_sum);\n</code></pre>"},{"location":"practice/backend_implementation.html#6-upsert","title":"6) Upsert \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0430","text":"<pre><code>INSERT INTO leaderboard_scores (user_id, board_code, season, score)\nVALUES (1, 'default', 1, 1850)\nON DUPLICATE KEY UPDATE\n  score      = GREATEST(score, VALUES(score)),\n  updated_at = CURRENT_TIMESTAMP(3);\n</code></pre> <p>\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438:</p> <pre><code>COMMIT;\n</code></pre>"},{"location":"practice/backend_implementation.html#47","title":"4.7. \u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430","text":"<pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"matchId\": 9,\n    \"isWin\": true,\n    \"xpGained\": 100,\n    \"softCurrencyGained\": 50\n  }\n}\n</code></pre>"},{"location":"practice/backend_implementation.html#443","title":"4.4.3. \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0440\u0430\u0431\u043e\u0442\u043e\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u0438 (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f)","text":""},{"location":"practice/backend_implementation.html#1_1","title":"1) \u0417\u0430\u043f\u0443\u0441\u043a","text":"<pre><code>python wsgi.py\n</code></pre>"},{"location":"practice/backend_implementation.html#2_1","title":"2) \u0417\u0430\u043f\u0440\u043e\u0441 (\u043f\u0440\u0438\u043c\u0435\u0440)","text":"<pre><code>POST /api/v1/match/finish\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"matchId\": 9,\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 1850,\n    \"durationSeconds\": 1200\n  }\n}\n</code></pre> <p>\u041e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f:</p> <ul> <li>\u0441\u0442\u0430\u0442\u0443\u0441 <code>200</code></li> <li>\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a <code>X-Request-Id</code></li> <li>JSON <code>ok: true</code></li> <li> <p>\u0437\u0430\u043f\u0438\u0441\u0438 \u0432:</p> </li> <li> <p><code>matches</code> (status = finished)</p> </li> <li><code>battle_results</code></li> <li><code>player_progress</code></li> <li><code>statistics_daily</code></li> <li><code>leaderboard_scores</code></li> </ul>"},{"location":"practice/backend_implementation.html#3-test_clienthtml","title":"3) \u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 test_client.html","text":"<p>\u0412 \u043a\u043e\u0440\u043d\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f <code>test_client.html</code> \u2014 HTML-\u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0434\u043b\u044f \u0440\u0443\u0447\u043d\u043e\u0433\u043e \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432 \u0447\u0435\u0440\u0435\u0437 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0431\u0435\u0437 Postman.</p>"},{"location":"practice/game_integration.html","title":"\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 \u0438\u0433\u0440\u043e\u0439","text":""},{"location":"practice/game_integration.html#2-6-unity-strategy-support-is","title":"2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430 6. \u0420\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u043f\u043e \u0441\u0431\u043e\u0440\u043a\u0435 Unity-\u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0434\u043b\u044f strategy-support-is","text":""},{"location":"practice/game_integration.html#_1","title":"\u0427\u0442\u043e \u044d\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u0438 \u0437\u0430\u0447\u0435\u043c","text":"<p>\u0414\u0430\u043d\u043d\u044b\u0439 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u2014 \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u0430\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u043f\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e Unity-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u043a Flask-\u0431\u044d\u043a\u0435\u043d\u0434\u0443 <code>strategy-support-is</code> \u0438 \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0441 \u043d\u0438\u043c \u0434\u0430\u043d\u043d\u044b\u043c\u0438. \u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u2014 \u0443\u0447\u0435\u0431\u043d\u044b\u0439 MVP: \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f, \u043f\u0440\u043e\u0444\u0438\u043b\u044c, \u0441\u043e\u0431\u044b\u0442\u0438\u044f, \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0447\u0430, \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434.</p> <p>\u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0448\u0430\u0433\u043e\u0432 \u0443 \u0432\u0430\u0441 \u0431\u0443\u0434\u0435\u0442 Unity-\u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0441 \u0442\u0440\u0435\u043c\u044f \u0441\u0446\u0435\u043d\u0430\u043c\u0438, \u043a\u043e\u0442\u043e\u0440\u043e\u0435: - \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0443\u0435\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 Flask JWT - \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0438\u0433\u0440\u043e\u043a\u0430 - \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0438\u0433\u0440\u043e\u0432\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0441 UUID-\u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0435\u0439 - \u0417\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442 \u043c\u0430\u0442\u0447 \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u043d\u0430\u0433\u0440\u0430\u0434\u044b - \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043b\u0438\u0434\u0435\u0440\u043e\u0432</p>"},{"location":"practice/game_integration.html#1-unity","title":"\u0427\u0430\u0441\u0442\u044c 1. \u0422\u0435\u043e\u0440\u0438\u044f: \u043a\u0430\u043a Unity \u043e\u0431\u0449\u0430\u0435\u0442\u0441\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c","text":""},{"location":"practice/game_integration.html#61-rest-api-unity","title":"6.1. \u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 REST API \u0438 \u043f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0432\u0430\u0436\u043d\u043e \u0434\u043b\u044f Unity","text":"<p>REST API \u2014 \u044d\u0442\u043e \u043d\u0430\u0431\u043e\u0440 URL-\u0430\u0434\u0440\u0435\u0441\u043e\u0432 (endpoint'\u043e\u0432) \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435, \u043a \u043a\u043e\u0442\u043e\u0440\u044b\u043c \u043a\u043b\u0438\u0435\u043d\u0442 \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043f\u043e \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u0443 HTTP. Unity \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c: \u043e\u043d\u0430 \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442 \u0437\u0430\u043f\u0440\u043e\u0441, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0435\u0433\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043e\u0442\u0432\u0435\u0442 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 JSON.</p> <p>\u0413\u043b\u0430\u0432\u043d\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e: \u0441\u0435\u0440\u0432\u0435\u0440 \u2014 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b. Unity \u043d\u0435 \u0445\u0440\u0430\u043d\u0438\u0442 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0435, \u043e\u0447\u043a\u0430\u0445 \u0438 \u043d\u0430\u0433\u0440\u0430\u0434\u0430\u0445 \u0432 \u0441\u0435\u0431\u0435. \u0412\u0441\u0451 \u044d\u0442\u043e \u0436\u0438\u0432\u0451\u0442 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u0438 \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u043e API.</p>"},{"location":"practice/game_integration.html#62-http-","title":"6.2. HTTP-\u043c\u0435\u0442\u043e\u0434\u044b","text":"\u041c\u0435\u0442\u043e\u0434 \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u041f\u0440\u0438\u043c\u0435\u0440 GET \u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 <code>GET /api/v1/profile</code> POST \u0421\u043e\u0437\u0434\u0430\u0442\u044c / \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 <code>POST /api/v1/match/finish</code>"},{"location":"practice/game_integration.html#63-json","title":"6.3. JSON \u2014 \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0431\u043c\u0435\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u043c\u0438","text":"<p>\u0412\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0438 \u043e\u0442\u0432\u0435\u0442\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 JSON. Unity \u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0443\u0435\u0442 \u043a\u043b\u0430\u0441\u0441\u044b C# \u0432 JSON \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e <code>JsonUtility.ToJson()</code> \u0438 \u0434\u0435\u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0443\u0435\u0442 \u043e\u0442\u0432\u0435\u0442\u044b \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0447\u0435\u0440\u0435\u0437 <code>JsonUtility.FromJson&lt;T&gt;()</code>.</p> <pre><code>// \u041f\u0440\u0438\u043c\u0435\u0440 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043a /api/v1/auth/login\n{ \"email\": \"alice@example.com\", \"password\": \"password123\" }\n\n// \u041f\u0440\u0438\u043c\u0435\u0440 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430\n{ \"ok\": true, \"data\": { \"accessToken\": \"eyJ...\", \"userId\": 1, \"nickname\": \"Commander_Alice\" } }\n\n// \u041f\u0440\u0438\u043c\u0435\u0440 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439\n{ \"ok\": false, \"error\": { \"code\": \"UNAUTHORIZED\", \"message\": \"Invalid credentials\", \"requestId\": \"req_abc123\" } }\n</code></pre>"},{"location":"practice/game_integration.html#64-jwt","title":"6.4. JWT \u2014 \u043a\u0430\u043a \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f","text":"<p>JWT (JSON Web Token) \u2014 \u044d\u0442\u043e \u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0442\u043e\u043a\u0435\u043d, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u044b\u0434\u0430\u0451\u0442 \u043f\u043e\u0441\u043b\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u0432\u0445\u043e\u0434\u0430. \u0412\u0441\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043a \u0437\u0430\u0449\u0438\u0449\u0451\u043d\u043d\u044b\u043c endpoint'\u0430\u043c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0441 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u043c:</p> <pre><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n</code></pre> <p>\u0422\u043e\u043a\u0435\u043d \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f (\u0432 \u043a\u043b\u0430\u0441\u0441\u0435 <code>AuthSession</code>) \u0438 \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u043d\u0430 \u0434\u0438\u0441\u043a (\u0432 \u0443\u0447\u0435\u0431\u043d\u043e\u043c \u043f\u0440\u043e\u0435\u043a\u0442\u0435). \u041f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043d\u0443\u0436\u043d\u043e \u0432\u043e\u0439\u0442\u0438 \u0437\u0430\u043d\u043e\u0432\u043e.</p>"},{"location":"practice/game_integration.html#65-unitywebrequest-http-unity","title":"6.5. UnityWebRequest \u2014 HTTP \u0432 Unity","text":"<p>Unity \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c <code>HttpClient</code> \u0438\u0437 .NET \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0432 \u043a\u043e\u0440\u0443\u0442\u0438\u043d\u0430\u0445. \u0414\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 HTTP \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f <code>UnityWebRequest</code> \u2014 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0441 Unity.</p> <p>\u0412\u0441\u0435 \u0432\u044b\u0437\u043e\u0432\u044b API \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0442\u0441\u044f \u043a\u0430\u043a \u043a\u043e\u0440\u0443\u0442\u0438\u043d\u044b (IEnumerator + StartCoroutine). \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442: HTTP-\u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435 \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043f\u043e\u0442\u043e\u043a, \u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u043e \u0432 \u0444\u043e\u043d\u0435.</p> <pre><code>// \u041f\u0430\u0442\u0442\u0435\u0440\u043d \u043a\u043e\u0440\u0443\u0442\u0438\u043d\u044b\nStartCoroutine(api.Login(\"email\", \"pass\",\n    onSuccess: resp =&gt; Debug.Log(\"OK: \" + resp.nickname),\n    onError:   err  =&gt; Debug.LogError(\"Fail: \" + err)));\n</code></pre>"},{"location":"practice/game_integration.html#66","title":"6.6. \u041a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 \u0432\u0441\u0435\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<p>\u0412\u0441\u0435 \u043e\u0442\u0432\u0435\u0442\u044b \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438\u043c\u0435\u044e\u0442 \u0435\u0434\u0438\u043d\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443:</p> <pre><code>{ \"ok\": true/false, \"data\": {...} }   \u2190 \u0443\u0441\u043f\u0435\u0445\n{ \"ok\": false, \"error\": {...} }       \u2190 \u043e\u0448\u0438\u0431\u043a\u0430\n</code></pre> <p>\u0412 Unity \u044d\u0442\u043e \u043e\u0442\u0440\u0430\u0436\u0435\u043d\u043e \u043a\u043b\u0430\u0441\u0441\u043e\u043c <code>ApiResponse&lt;T&gt;</code>:</p> <pre><code>[Serializable]\npublic class ApiResponse&lt;T&gt;\n{\n    public bool     ok;\n    public T        data;\n    public ApiError error;\n}\n</code></pre>"},{"location":"practice/game_integration.html#2","title":"\u0427\u0430\u0441\u0442\u044c 2. \u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0432","text":"<pre><code>Assets/\n  Scripts/\n    API/\n      ApiConfig.cs        \u2190 \u0430\u0434\u0440\u0435\u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u0438 \u0432\u0441\u0435 URL\n      ApiModels.cs        \u2190 \u0432\u0441\u0435 DTO (\u043a\u043b\u0430\u0441\u0441\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432/\u043e\u0442\u0432\u0435\u0442\u043e\u0432)\n      AuthSession.cs      \u2190 \u0445\u0440\u0430\u043d\u0438\u0442 JWT-\u0442\u043e\u043a\u0435\u043d \u0438 UserId\n      ApiClient.cs        \u2190 \u043d\u0438\u0437\u043a\u043e\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u044b\u0439 HTTP (Get/Post)\n      GameApiService.cs   \u2190 \u0432\u044b\u0441\u043e\u043a\u043e\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u044b\u0439 \u0441\u0435\u0440\u0432\u0438\u0441 (Login/Profile/...)\n    UI/\n      AuthController.cs   \u2190 \u044d\u043a\u0440\u0430\u043d \u0432\u0445\u043e\u0434\u0430/\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438\n      ProfileController.cs\u2190 \u044d\u043a\u0440\u0430\u043d \u043f\u0440\u043e\u0444\u0438\u043b\u044f\n      LeaderboardController.cs \u2190 \u0442\u0430\u0431\u043b\u0438\u0446\u0430 \u043b\u0438\u0434\u0435\u0440\u043e\u0432\n    Game/\n      MatchController.cs  \u2190 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0447\u0435\u043c\n      EventSender.cs      \u2190 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439\n</code></pre>"},{"location":"practice/game_integration.html#_2","title":"\u0417\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043c\u0435\u0436\u0434\u0443 \u0441\u043b\u043e\u044f\u043c\u0438","text":"<pre><code>UI / Game\n    \u2193  \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442\nGameApiService\n    \u2193  \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\nApiClient  +  AuthSession\n    \u2193  \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\nUnityWebRequest  (\u0432\u0441\u0442\u0440\u043e\u0435\u043d \u0432 Unity)\n</code></pre>"},{"location":"practice/game_integration.html#3-endpoint","title":"\u0427\u0430\u0441\u0442\u044c 3. Endpoint'\u044b \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":""},{"location":"practice/game_integration.html#31-endpoint","title":"3.1. \u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u0432\u0441\u0435\u0445 endpoint'\u043e\u0432","text":"\u041c\u0435\u0442\u043e\u0434 URL \u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 POST <code>/api/v1/auth/register</code> \u041d\u0435\u0442 \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f POST <code>/api/v1/auth/login</code> \u041d\u0435\u0442 \u0412\u0445\u043e\u0434, \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c JWT GET <code>/api/v1/profile</code> Bearer JWT \u041f\u0440\u043e\u0444\u0438\u043b\u044c + \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 POST <code>/api/v1/events</code> Bearer JWT \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u0433\u0440\u043e\u0432\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 POST <code>/api/v1/match/finish</code> Bearer JWT \u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043c\u0430\u0442\u0447 GET <code>/api/v1/leaderboard</code> \u041d\u0435\u0442 \u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043b\u0438\u0434\u0435\u0440\u043e\u0432"},{"location":"practice/game_integration.html#32-endpoint","title":"3.2. \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e endpoint'\u0430","text":""},{"location":"practice/game_integration.html#post-apiv1authregister","title":"POST /api/v1/auth/register","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441: </p><pre><code>{\n  \"email\":    \"player@example.com\",\n  \"password\": \"mypassword\",\n  \"nickname\": \"Commander\"\n}\n</code></pre><p></p> <p>\u041e\u0442\u0432\u0435\u0442 201: </p><pre><code>{ \"ok\": true, \"data\": { \"userId\": 42, \"email\": \"...\", \"nickname\": \"Commander\" } }\n</code></pre><p></p> <p>\u041e\u0448\u0438\u0431\u043a\u0438: - <code>400</code> \u2014 \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u044b \u043f\u043e\u043b\u044f / \u043f\u0430\u0440\u043e\u043b\u044c &lt; 6 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432 - <code>409</code> \u2014 email \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d</p>"},{"location":"practice/game_integration.html#post-apiv1authlogin","title":"POST /api/v1/auth/login","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441: </p><pre><code>{ \"email\": \"alice@example.com\", \"password\": \"password123\" }\n</code></pre><p></p> <p>\u041e\u0442\u0432\u0435\u0442 200: </p><pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"accessToken\": \"eyJ...\",\n    \"userId\":      1,\n    \"nickname\":    \"Commander_Alice\"\n  }\n}\n</code></pre><p></p> <p>\u041e\u0448\u0438\u0431\u043a\u0438: - <code>401</code> \u2014 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0438\u043b\u0438 email - <code>403</code> \u2014 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d</p> <p>\u0414\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 <code>seed.sql</code>: <code>alice@example.com</code> / <code>password123</code></p>"},{"location":"practice/game_integration.html#get-apiv1profile","title":"GET /api/v1/profile","text":"<p>\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a: <code>Authorization: Bearer &lt;token&gt;</code></p> <p>\u041e\u0442\u0432\u0435\u0442 200: </p><pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"userId\":   1,\n    \"email\":    \"alice@example.com\",\n    \"nickname\": \"Commander_Alice\",\n    \"roles\":    [\"player\"],\n    \"progress\": {\n      \"level\":        42,\n      \"xp\":           85400,\n      \"softCurrency\": 12500,\n      \"hardCurrency\": 250\n    }\n  }\n}\n</code></pre><p></p> <p>\u041e\u0448\u0438\u0431\u043a\u0438: - <code>401</code> \u2014 \u0442\u043e\u043a\u0435\u043d \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0438\u043b\u0438 \u0443\u0441\u0442\u0430\u0440\u0435\u043b - <code>403</code> \u2014 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d</p>"},{"location":"practice/game_integration.html#post-apiv1events","title":"POST /api/v1/events","text":"<p>\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a: <code>Authorization: Bearer &lt;token&gt;</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441: </p><pre><code>{\n  \"eventId\":   \"550e8400-e29b-41d4-a716-446655440000\",\n  \"eventType\": \"unit_deploy\",\n  \"sessionId\": null,\n  \"clientTime\": \"2026-02-27T12:00:00.000Z\",\n  \"payload\": {\n    \"matchId\":  9,\n    \"unitCode\": \"cavalry\",\n    \"amount\":   40,\n    \"atSecond\": 15\n  }\n}\n</code></pre><p></p> <p>\u041e\u0442\u0432\u0435\u0442 200: </p><pre><code>{ \"ok\": true, \"data\": { \"eventId\": \"550e...\", \"status\": \"accepted\" } }\n</code></pre><p></p> <p>\u0412\u0430\u0436\u043d\u043e: <code>eventId</code> \u2014 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 UUID \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435. \u0421\u0435\u0440\u0432\u0435\u0440 \u043e\u0442\u043a\u043b\u043e\u043d\u0438\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u0441 \u0442\u0435\u043c \u0436\u0435 <code>eventId</code> \u0441 \u043a\u043e\u0434\u043e\u043c <code>409</code>.</p> <p>\u041e\u0448\u0438\u0431\u043a\u0438: - <code>400</code> \u2014 \u043d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 - <code>409</code> \u2014 \u0434\u0443\u0431\u043b\u0438\u0440\u0443\u044e\u0449\u0438\u0439\u0441\u044f <code>eventId</code></p>"},{"location":"practice/game_integration.html#post-apiv1matchfinish","title":"POST /api/v1/match/finish","text":"<p>\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a: <code>Authorization: Bearer &lt;token&gt;</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441: </p><pre><code>{\n  \"matchId\": 9,\n  \"result\": {\n    \"isWin\":           true,\n    \"score\":           1850,\n    \"durationSeconds\": 1200\n  }\n}\n</code></pre><p></p> <p>\u041e\u0442\u0432\u0435\u0442 200: </p><pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"matchId\":             9,\n    \"isWin\":               true,\n    \"xpGained\":            100,\n    \"softCurrencyGained\":  50\n  }\n}\n</code></pre><p></p> <p>\u0412\u0430\u0436\u043d\u043e: XP \u0438 \u043c\u043e\u043d\u0435\u0442\u044b \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440, \u043a\u043b\u0438\u0435\u043d\u0442 \u0438\u0445 \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442.</p> <p>\u041e\u0448\u0438\u0431\u043a\u0438: - <code>404</code> \u2014 \u043c\u0430\u0442\u0447 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d - <code>403</code> \u2014 \u043c\u0430\u0442\u0447 \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u0434\u0440\u0443\u0433\u043e\u043c\u0443 \u0438\u0433\u0440\u043e\u043a\u0443 - <code>409</code> \u2014 \u043c\u0430\u0442\u0447 \u0443\u0436\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d (status \u2260 started)</p>"},{"location":"practice/game_integration.html#get-apiv1leaderboard","title":"GET /api/v1/leaderboard","text":"<p>\u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u0430: <code>?boardCode=default&amp;season=1&amp;limit=10</code></p> <p>\u041e\u0442\u0432\u0435\u0442 200: </p><pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"boardCode\": \"default\",\n    \"season\":    1,\n    \"items\": [\n      { \"rank\": 1, \"userId\": 5, \"nickname\": \"Siege_Eve\",     \"score\": 9850 },\n      { \"rank\": 2, \"userId\": 3, \"nickname\": \"WarLord_Carol\", \"score\": 8720 }\n    ]\n  }\n}\n</code></pre><p></p>"},{"location":"practice/game_integration.html#4-unity","title":"\u0427\u0430\u0441\u0442\u044c 4. \u041f\u043e\u0448\u0430\u0433\u043e\u0432\u0430\u044f \u0441\u0431\u043e\u0440\u043a\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 Unity","text":""},{"location":"practice/game_integration.html#1","title":"\u0428\u0430\u0433 1. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0435\u043a\u0442","text":"<ol> <li>\u041e\u0442\u043a\u0440\u044b\u0442\u044c Unity Hub.</li> <li>\u041d\u0430\u0436\u0430\u0442\u044c New Project \u2192 \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0448\u0430\u0431\u043b\u043e\u043d 2D (\u0438\u043b\u0438 3D) \u2192 \u043d\u0430\u0437\u0432\u0430\u0442\u044c <code>StrategyClient</code>.</li> <li>\u041d\u0430\u0436\u0430\u0442\u044c Create project.</li> </ol>"},{"location":"practice/game_integration.html#2_1","title":"\u0428\u0430\u0433 2. \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043a\u0440\u0438\u043f\u0442\u044b","text":"<ol> <li>\u0412 \u043f\u0430\u043f\u043a\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 \u043e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 <code>Assets</code>.</li> <li>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u043f\u0430\u043f\u043e\u043a:    <pre><code>Assets/Scripts/API/\nAssets/Scripts/UI/\nAssets/Scripts/Game/\n</code></pre></li> <li>\u0421\u043a\u043e\u043f\u0438\u0440\u0443\u0439\u0442\u0435 \u0432\u0441\u0435 <code>.cs</code>-\u0444\u0430\u0439\u043b\u044b \u0438\u0437 \u043f\u0430\u043a\u0435\u0442\u0430 \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u0430\u043f\u043a\u0438:</li> <li><code>API/</code> \u2192 <code>ApiConfig.cs</code>, <code>ApiModels.cs</code>, <code>AuthSession.cs</code>, <code>ApiClient.cs</code>, <code>GameApiService.cs</code></li> <li><code>UI/</code>  \u2192 <code>AuthController.cs</code>, <code>ProfileController.cs</code>, <code>LeaderboardController.cs</code></li> <li><code>Game/</code> \u2192 <code>MatchController.cs</code>, <code>EventSender.cs</code></li> </ol>"},{"location":"practice/game_integration.html#3","title":"\u0428\u0430\u0433 3. \u041d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0434\u0440\u0435\u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<p>\u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 <code>Assets/Scripts/API/ApiConfig.cs</code>. \u041f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e:</p> <pre><code>public const string BaseUrl = \"http://127.0.0.1:5000\";\n</code></pre> <p>\u0415\u0441\u043b\u0438 Flask \u0437\u0430\u043f\u0443\u0449\u0435\u043d \u043d\u0430 \u0434\u0440\u0443\u0433\u043e\u043c \u043f\u043e\u0440\u0442\u0443 \u0438\u043b\u0438 \u043c\u0430\u0448\u0438\u043d\u0435 \u2014 \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441 \u0437\u0434\u0435\u0441\u044c. \u041c\u0435\u043d\u044f\u0442\u044c \u043d\u0443\u0436\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u044d\u0442\u0443 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u0447\u043a\u0443.</p>"},{"location":"practice/game_integration.html#4","title":"\u0428\u0430\u0433 4. \u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440","text":"<p>\u041f\u0435\u0440\u0435\u0434 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0432 Unity \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e Flask-\u0441\u0435\u0440\u0432\u0435\u0440 \u0437\u0430\u043f\u0443\u0449\u0435\u043d:</p> <pre><code>cd strategy-support-is\npython wsgi.py\n</code></pre> <p>\u0421\u0435\u0440\u0432\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c: </p><pre><code>* Running on http://127.0.0.1:5000\n</code></pre><p></p>"},{"location":"practice/game_integration.html#5-authscene","title":"\u0428\u0430\u0433 5. \u0421\u0446\u0435\u043d\u0430 AuthScene \u2014 \u044d\u043a\u0440\u0430\u043d \u0432\u0445\u043e\u0434\u0430","text":""},{"location":"practice/game_integration.html#51","title":"5.1. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0446\u0435\u043d\u0443","text":"<p><code>File \u2192 New Scene \u2192 Save As \u2192 Scenes/AuthScene</code>.</p>"},{"location":"practice/game_integration.html#52-canvas","title":"5.2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c Canvas","text":"<ol> <li><code>GameObject \u2192 UI \u2192 Canvas</code>.</li> <li>\u0412 Canvas \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0434\u0432\u0430 \u043f\u0430\u043d\u0435\u043b\u0438: <code>LoginPanel</code> \u0438 <code>RegisterPanel</code>.</li> </ol>"},{"location":"practice/game_integration.html#53-loginpanel","title":"5.3. \u041d\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c LoginPanel","text":"<p>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0432 LoginPanel:</p> \u041e\u0431\u044a\u0435\u043a\u0442 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>EmailInput</code> TMP_InputField \u041f\u043e\u043b\u0435 email <code>PasswordInput</code> TMP_InputField \u041f\u043e\u043b\u0435 \u043f\u0430\u0440\u043e\u043b\u044f (Password) <code>LoginButton</code> Button + TMP_Text \u041a\u043d\u043e\u043f\u043a\u0430 \"\u0412\u043e\u0439\u0442\u0438\" <code>StatusText</code> TMP_Text \u0421\u0442\u0430\u0442\u0443\u0441 / \u043e\u0448\u0438\u0431\u043a\u0430 <code>GoToRegisterButton</code> Button \u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0430\u043d\u0435\u043b\u044c"},{"location":"practice/game_integration.html#54-registerpanel","title":"5.4. \u041d\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c RegisterPanel (\u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e)","text":"<p>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043f\u043e\u043b\u044f email, password, nickname, \u043a\u043d\u043e\u043f\u043a\u0443 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0438 \u0441\u0442\u0430\u0442\u0443\u0441.</p>"},{"location":"practice/game_integration.html#55","title":"5.5. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440","text":"<ol> <li><code>GameObject \u2192 Create Empty</code> \u2192 \u043d\u0430\u0437\u0432\u0430\u0442\u044c <code>AuthManager</code>.</li> <li>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b: <code>AuthController</code> \u0438 <code>GameApiService</code>.</li> <li>\u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435 \u043f\u043e\u043b\u044f \u0432 Inspector:</li> <li><code>loginPanel</code> \u2192 \u043e\u0431\u044a\u0435\u043a\u0442 <code>LoginPanel</code></li> <li><code>registerPanel</code> \u2192 \u043e\u0431\u044a\u0435\u043a\u0442 <code>RegisterPanel</code></li> <li><code>loginEmail</code> \u2192 <code>EmailInput</code></li> <li><code>loginPassword</code> \u2192 <code>PasswordInput</code></li> <li><code>loginButton</code> \u2192 <code>LoginButton</code></li> <li><code>regEmail</code>, <code>regPassword</code>, <code>regNickname</code> \u2192 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043f\u043e\u043b\u044f</li> <li><code>registerButton</code> \u2192 \u043a\u043d\u043e\u043f\u043a\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438</li> <li><code>statusText</code> \u2192 <code>StatusText</code></li> <li> <p><code>sceneAfterLogin</code> \u2192 <code>\"MainMenu\"</code> (\u0438\u043c\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u0441\u0446\u0435\u043d\u044b)</p> </li> <li> <p>\u041d\u0430 <code>GoToRegisterButton</code> \u0432 Inspector \u2192 <code>Button.OnClick</code>:</p> </li> <li>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u2192 \u0432\u044b\u0431\u0440\u0430\u0442\u044c <code>AuthManager</code> \u2192 \u043c\u0435\u0442\u043e\u0434 <code>AuthController.ShowRegister</code>.</li> </ol>"},{"location":"practice/game_integration.html#6-mainmenu","title":"\u0428\u0430\u0433 6. \u0421\u0446\u0435\u043d\u0430 MainMenu \u2014 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0438 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434","text":""},{"location":"practice/game_integration.html#61","title":"6.1. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0446\u0435\u043d\u0443","text":"<p><code>File \u2192 New Scene \u2192 Save As \u2192 Scenes/MainMenu</code>.</p>"},{"location":"practice/game_integration.html#62","title":"6.2. \u041f\u0430\u043d\u0435\u043b\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044f","text":"<ol> <li>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 <code>GameObject \u2192 Create Empty</code> \u2192 <code>ProfileManager</code>.</li> <li>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 <code>ProfileController</code> \u0438 <code>GameApiService</code>.</li> <li>\u0412 Canvas \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u043f\u0430\u043d\u0435\u043b\u044c <code>ProfilePanel</code> \u0441 TMP_Text-\u043f\u043e\u043b\u044f\u043c\u0438:</li> <li><code>NicknameText</code>, <code>EmailText</code>, <code>LevelText</code>, <code>XpText</code>, <code>SoftText</code>, <code>HardText</code>, <code>StatusText</code></li> <li>\u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f \u0432 Inspector \u0443 <code>ProfileController</code>.</li> <li>\u041a\u043d\u043e\u043f\u043a\u0430 \"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c\" \u2192 <code>ProfileController.Refresh()</code>.</li> </ol>"},{"location":"practice/game_integration.html#63","title":"6.3. \u041f\u0430\u043d\u0435\u043b\u044c \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0430","text":"<ol> <li>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 <code>GameObject \u2192 Create Empty</code> \u2192 <code>LeaderboardManager</code>.</li> <li>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 <code>LeaderboardController</code> \u0438 <code>GameApiService</code>.</li> <li>\u0412 Canvas \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 <code>ScrollView</code> \u0434\u043b\u044f \u0441\u043f\u0438\u0441\u043a\u0430.</li> <li>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 Prefab \u0441\u0442\u0440\u043e\u043a\u0438:</li> <li><code>GameObject \u2192 Create Empty</code> \u2192 <code>LeaderboardRow</code>.</li> <li>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0440\u0438 <code>TMP_Text</code>: <code>RankText</code>, <code>NicknameText</code>, <code>ScoreText</code>.</li> <li>\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435 \u0432 <code>Assets/Prefabs/LeaderboardRow.prefab</code>.</li> <li>\u0412 Inspector <code>LeaderboardController</code>:</li> <li><code>rowContainer</code> \u2192 <code>ScrollView/Viewport/Content</code></li> <li><code>rowPrefab</code> \u2192 <code>LeaderboardRow.prefab</code></li> </ol>"},{"location":"practice/game_integration.html#7-gamescene","title":"\u0428\u0430\u0433 7. \u0421\u0446\u0435\u043d\u0430 GameScene \u2014 \u043c\u0430\u0442\u0447","text":""},{"location":"practice/game_integration.html#71","title":"7.1. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0446\u0435\u043d\u0443","text":"<p><code>File \u2192 New Scene \u2192 Save As \u2192 Scenes/GameScene</code>.</p>"},{"location":"practice/game_integration.html#72","title":"7.2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043c\u0430\u0442\u0447\u0430","text":"<ol> <li><code>GameObject \u2192 Create Empty</code> \u2192 <code>MatchManager</code>.</li> <li>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 <code>MatchController</code> \u0438 <code>GameApiService</code>.</li> <li>\u0412 Inspector:</li> <li><code>matchId</code> \u2192 <code>9</code> (\u043c\u0430\u0442\u0447 \u0438\u0437 seed.sql, \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0430\u0449\u0438\u0439 alice)</li> <li>\u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435: <code>timerText</code>, <code>statusText</code>, <code>rewardText</code>, <code>resultPanel</code></li> </ol>"},{"location":"practice/game_integration.html#73","title":"7.3. \u041a\u043d\u043e\u043f\u043a\u0438 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f","text":"<p>\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0434\u0432\u0430 Button:</p> <ul> <li><code>WinButton</code> \u2192 \u0432 OnClick: <code>MatchController.EndMatchWin()</code> \u0438\u043b\u0438 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043e\u0431\u0451\u0440\u0442\u043a\u0443:</li> </ul> <pre><code>// \u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0432 MatchController \u0434\u043b\u044f \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a\u043d\u043e\u043f\u043e\u043a \u0432 Inspector:\npublic void EndMatchWin()  =&gt; EndMatch(isWin: true,  score: 1850);\npublic void EndMatchLose() =&gt; EndMatch(isWin: false, score:  300);\n</code></pre>"},{"location":"practice/game_integration.html#8-build-settings","title":"\u0428\u0430\u0433 8. \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0446\u0435\u043d\u044b \u0432 Build Settings","text":"<ol> <li><code>File \u2192 Build Settings</code>.</li> <li>\u041d\u0430\u0436\u0430\u0442\u044c Add Open Scenes \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0441\u0446\u0435\u043d\u044b: <code>AuthScene</code>, <code>MainMenu</code>, <code>GameScene</code>.</li> <li>\u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f, \u0447\u0442\u043e <code>AuthScene</code> \u0441\u0442\u043e\u0438\u0442 \u043f\u0435\u0440\u0432\u043e\u0439 (index 0).</li> </ol>"},{"location":"practice/game_integration.html#9","title":"\u0428\u0430\u0433 9. \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443","text":"<p>\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f:</p> <ol> <li>\u0417\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c Flask: <code>python wsgi.py</code>.</li> <li>\u041d\u0430\u0436\u0430\u0442\u044c Play \u0432 Unity.</li> <li>\u0412\u043e\u0439\u0442\u0438 \u0441 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0438\u0437 <code>seed.sql</code>: <code>alice@example.com</code> / <code>password123</code>.</li> <li>\u041f\u043e\u0441\u043b\u0435 \u0432\u0445\u043e\u0434\u0430 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0442\u043a\u0440\u043e\u0435\u0442\u0441\u044f <code>MainMenu</code>.</li> <li>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u2014 \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u043e\u044f\u0432\u0438\u0442\u044c\u0441\u044f \u0434\u0430\u043d\u043d\u044b\u0435 \u0443\u0440\u043e\u0432\u043d\u044f/XP.</li> <li>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u2014 \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u043e\u044f\u0432\u0438\u0442\u044c\u0441\u044f \u0441\u0442\u0440\u043e\u043a\u0438.</li> <li>\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 <code>GameScene</code>, \u043d\u0430\u0436\u0430\u0442\u044c \"\u041f\u043e\u0431\u0435\u0434\u0430\" \u2014 \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u043e\u044f\u0432\u0438\u0442\u044c\u0441\u044f \u043d\u0430\u0433\u0440\u0430\u0434\u044b.</li> </ol>"},{"location":"practice/game_integration.html#10","title":"\u0428\u0430\u0433 10. \u041e\u0442\u043b\u0430\u0434\u043a\u0430","text":""},{"location":"practice/game_integration.html#unity","title":"\u041a\u043e\u043d\u0441\u043e\u043b\u044c Unity","text":"<p>\u0412\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0438 \u043e\u0442\u0432\u0435\u0442\u044b \u043b\u043e\u0433\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>Debug.Log</code>. \u041f\u0440\u0438 \u043e\u0448\u0438\u0431\u043a\u0435 \u0431\u0443\u0434\u0435\u0442: </p><pre><code>[Match] FinishMatch error: [409] Match is not in started state\n</code></pre><p></p>"},{"location":"practice/game_integration.html#_3","title":"\u0427\u0430\u0441\u0442\u044b\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b","text":"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u0420\u0435\u0448\u0435\u043d\u0438\u0435 <code>Connection refused</code> Flask \u043d\u0435 \u0437\u0430\u043f\u0443\u0449\u0435\u043d <code>python wsgi.py</code> <code>401 UNAUTHORIZED</code> \u041d\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d \u0432\u0445\u043e\u0434 \u0412\u044b\u0437\u0432\u0430\u0442\u044c Login() \u043f\u0435\u0440\u0435\u0434 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438 <code>409 CONFLICT</code> \u043f\u0440\u0438 finish \u041c\u0430\u0442\u0447 \u0443\u0436\u0435 \u0437\u0430\u043a\u0440\u044b\u0442 \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u043c\u0430\u0442\u0447 \u0432 \u0411\u0414 \u0438\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0440\u0443\u0433\u043e\u0439 <code>matchId</code> <code>400 VALIDATION_ERROR</code> \u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0442\u0438\u043f \u043f\u043e\u043b\u044f \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c DTO \u0432 <code>ApiModels.cs</code> JSON parse error \u041e\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 \u043c\u043e\u0434\u0435\u043b\u044c\u044e \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043f\u043e\u043b\u044f \u043a\u043b\u0430\u0441\u0441\u0430 \u0432 <code>ApiModels.cs</code>"},{"location":"practice/game_integration.html#5-seedsql","title":"\u0427\u0430\u0441\u0442\u044c 5. \u0422\u0435\u0441\u0442\u043e\u0432\u044b\u0435 \u0443\u0447\u0451\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 (\u0438\u0437 seed.sql)","text":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c Email \u041f\u0430\u0440\u043e\u043b\u044c \u041c\u0430\u0442\u0447 id=9 alice <code>alice@example.com</code> <code>password123</code> \u2705 owner bob <code>bob@example.com</code> <code>password123</code> \u2014 banned <code>banned@example.com</code> <code>password123</code> \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d"},{"location":"practice/game_integration.html#6","title":"\u0427\u0430\u0441\u0442\u044c 6. \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043a\u0440\u0438\u043f\u0442\u0430","text":""},{"location":"practice/game_integration.html#apiconfigcs","title":"ApiConfig.cs","text":"<p>\u0415\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u043c\u0435\u0441\u0442\u043e \u0433\u0434\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f <code>BaseUrl</code> \u0438 \u0432\u0441\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 URL. \u041f\u0440\u0438 \u0441\u043c\u0435\u043d\u0435 \u0430\u0434\u0440\u0435\u0441\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0434\u0435\u0441\u044c.</p> <pre><code>namespace StrategyGame.API\n{\n    /// &lt;summary&gt;\n    /// \u0415\u0434\u0438\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0430\u0434\u0440\u0435\u0441\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.\n    /// \u041c\u0435\u043d\u044f\u0439\u0442\u0435 BaseUrl \u043f\u043e\u0434 \u0441\u0432\u043e\u0451 \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0435:\n    ///   \u041b\u043e\u043a\u0430\u043b\u044c\u043d\u043e:   http://127.0.0.1:5000\n    ///   Production: https://your-server.com\n    /// &lt;/summary&gt;\n    public static class ApiConfig\n    {\n        public const string BaseUrl = \"http://127.0.0.1:5000\";\n\n        // Endpoints\n        public const string Register       = BaseUrl + \"/api/v1/auth/register\";\n        public const string Login          = BaseUrl + \"/api/v1/auth/login\";\n        public const string Profile        = BaseUrl + \"/api/v1/profile\";\n        public const string Events         = BaseUrl + \"/api/v1/events\";\n        public const string MatchFinish    = BaseUrl + \"/api/v1/match/finish\";\n        public const string Leaderboard    = BaseUrl + \"/api/v1/leaderboard\";\n\n        // Leaderboard defaults\n        public const string DefaultBoard   = \"default\";\n        public const int    DefaultSeason  = 1;\n        public const int    DefaultLimit   = 10;\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#apimodelscs","title":"ApiModels.cs","text":"<p>\u0412\u0441\u0435 \u043a\u043b\u0430\u0441\u0441\u044b-\u043c\u043e\u0434\u0435\u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 (<code>[Serializable]</code>). \u041a\u0430\u0436\u0434\u044b\u0439 \u043a\u043b\u0430\u0441\u0441 \u0442\u043e\u0447\u043d\u043e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u043e\u043b\u044e <code>data</code> \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u043f\u043e\u043b\u044f \u2014 JsonUtility \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0438\u0445 \u043f\u043e \u0438\u043c\u0435\u043d\u0438.</p> <pre><code>using System;\nusing System.Collections.Generic;\n\nnamespace StrategyGame.API\n{\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // \u041e\u0431\u0449\u0430\u044f \u043e\u0431\u0451\u0440\u0442\u043a\u0430 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u0441\u0435\u0440\u0432\u0435\u0440\u0430\n    // { \"ok\": true/false, \"data\": {...}, \"error\": {...} }\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class ApiResponse&lt;T&gt;\n    {\n        public bool ok;\n        public T    data;\n        public ApiError error;\n    }\n\n    [Serializable]\n    public class ApiError\n    {\n        public string code;\n        public string message;\n        public string requestId;\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // POST /api/v1/auth/register\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class RegisterRequest\n    {\n        public string email;\n        public string password;\n        public string nickname;\n    }\n\n    [Serializable]\n    public class RegisterResponse\n    {\n        public int    userId;\n        public string email;\n        public string nickname;\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // POST /api/v1/auth/login\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class LoginRequest\n    {\n        public string email;\n        public string password;\n    }\n\n    [Serializable]\n    public class LoginResponse\n    {\n        public string accessToken;\n        public int    userId;\n        public string nickname;\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // GET /api/v1/profile\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class ProfileUser\n    {\n        public int    id;\n        public string email;\n        public string nickname;\n        public List&lt;string&gt; roles;\n    }\n\n    [Serializable]\n    public class ProfileProgress\n    {\n        public int level;\n        public int xp;\n        public int softCurrency;\n        public int hardCurrency;\n    }\n\n    [Serializable]\n    public class ProfileResponse\n    {\n        public int              userId;\n        public string           email;\n        public string           nickname;\n        public List&lt;string&gt;     roles;\n        public ProfileProgress  progress;\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // POST /api/v1/events\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class EventRequest\n    {\n        public string eventId;      // UUID \u2014 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d \u0434\u043b\u044f \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438\n        public string eventType;\n        public int?   sessionId;    // nullable\n        public string clientTime;   // ISO 8601\n        public object payload;      // \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0439 JSON-\u043e\u0431\u044a\u0435\u043a\u0442\n    }\n\n    [Serializable]\n    public class EventResponse\n    {\n        public string eventId;\n        public string status;       // \"accepted\"\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // POST /api/v1/match/finish\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class MatchResult\n    {\n        public bool   isWin;\n        public int    score;\n        public int    durationSeconds;\n        public int?   powerDelta;    // \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\n    }\n\n    [Serializable]\n    public class MatchFinishRequest\n    {\n        public int         matchId;\n        public MatchResult result;\n    }\n\n    [Serializable]\n    public class MatchFinishResponse\n    {\n        public int  matchId;\n        public bool isWin;\n        public int  xpGained;\n        public int  softCurrencyGained;\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // GET /api/v1/leaderboard\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class LeaderboardItem\n    {\n        public int    rank;\n        public int    userId;\n        public string nickname;\n        public int    score;\n    }\n\n    [Serializable]\n    public class LeaderboardResponse\n    {\n        public string                boardCode;\n        public int                   season;\n        public List&lt;LeaderboardItem&gt; items;\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#authsessioncs","title":"AuthSession.cs","text":"<p>\u0421\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043a\u043b\u0430\u0441\u0441-\u0441\u0438\u043d\u0433\u043b\u0442\u043e\u043d. \u0425\u0440\u0430\u043d\u0438\u0442 <code>AccessToken</code>, <code>UserId</code>, <code>Nickname</code> \u0432 \u043f\u0430\u043c\u044f\u0442\u0438. \u0412\u0441\u0435 API-\u043a\u043b\u0438\u0435\u043d\u0442\u044b \u0447\u0438\u0442\u0430\u044e\u0442 \u0442\u043e\u043a\u0435\u043d \u0438\u0437 \u043d\u0435\u0433\u043e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438.</p> <pre><code>namespace StrategyGame.API\n{\n    /// &lt;summary&gt;\n    /// \u0425\u0440\u0430\u043d\u0438\u0442 JWT-\u0442\u043e\u043a\u0435\u043d \u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f.\n    /// \u0416\u0438\u0432\u0451\u0442 \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 \u043d\u0430 \u043f\u0440\u043e\u0442\u044f\u0436\u0435\u043d\u0438\u0438 \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u0441\u0435\u0441\u0441\u0438\u0438.\n    /// \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432\u0441\u0435\u043c\u0438 API-\u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c\u0438 \u0434\u043b\u044f \u043f\u043e\u0434\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 Bearer-\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430.\n    /// &lt;/summary&gt;\n    public static class AuthSession\n    {\n        public static string AccessToken { get; private set; }\n        public static int    UserId      { get; private set; }\n        public static string Nickname    { get; private set; }\n        public static bool   IsLoggedIn  =&gt; !string.IsNullOrEmpty(AccessToken);\n\n        public static void Save(LoginResponse resp)\n        {\n            AccessToken = resp.accessToken;\n            UserId      = resp.userId;\n            Nickname    = resp.nickname;\n        }\n\n        public static void Clear()\n        {\n            AccessToken = null;\n            UserId      = 0;\n            Nickname    = null;\n        }\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#apiclientcs","title":"ApiClient.cs","text":"<p>\u041d\u0438\u0437\u043a\u043e\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u044b\u0439 \u0441\u043b\u043e\u0439. \u0423\u043c\u0435\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c GET \u0438 POST \u0447\u0435\u0440\u0435\u0437 <code>UnityWebRequest</code>. \u0420\u0430\u0437\u0431\u0438\u0440\u0430\u0435\u0442 \u043e\u0442\u0432\u0435\u0442 \u0432 <code>ApiResponse&lt;T&gt;</code> \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 <code>onSuccess</code> \u0438\u043b\u0438 <code>onError</code>. \u041d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0438\u0437 UI \u043d\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0435\u0440\u0435\u0437 <code>GameApiService</code>.</p> <pre><code>using System;\nusing System.Collections;\nusing System.Text;\nusing UnityEngine;\nusing UnityEngine.Networking;\n\nnamespace StrategyGame.API\n{\n    /// &lt;summary&gt;\n    /// \u041d\u0438\u0437\u043a\u043e\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u044b\u0439 HTTP-\u043a\u043b\u0438\u0435\u043d\u0442.\n    /// \u0423\u043c\u0435\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c GET \u0438 POST \u0441 JSON-\u0442\u0435\u043b\u043e\u043c.\n    /// \u041f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 AccessToken \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a Authorization.\n    /// \u0412\u0441\u0435 \u043c\u0435\u0442\u043e\u0434\u044b \u2014 \u043a\u043e\u0440\u0443\u0442\u0438\u043d\u044b: \u0432\u044b\u0437\u044b\u0432\u0430\u0439\u0442\u0435 \u0447\u0435\u0440\u0435\u0437 StartCoroutine().\n    /// &lt;/summary&gt;\n    public static class ApiClient\n    {\n        // \u2500\u2500\u2500 GET \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;\n        /// \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c GET-\u0437\u0430\u043f\u0440\u043e\u0441 \u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c JSON-\u043e\u0442\u0432\u0435\u0442.\n        /// &lt;/summary&gt;\n        public static IEnumerator Get&lt;TResponse&gt;(\n            string url,\n            Action&lt;TResponse&gt; onSuccess,\n            Action&lt;string&gt;    onError,\n            bool              withAuth = true)\n        {\n            using var req = UnityWebRequest.Get(url);\n\n            SetHeaders(req, withAuth);\n\n            yield return req.SendWebRequest();\n\n            HandleResponse(req, onSuccess, onError);\n        }\n\n        // \u2500\u2500\u2500 POST \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;\n        /// \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c POST-\u0437\u0430\u043f\u0440\u043e\u0441 \u0441 JSON-\u0442\u0435\u043b\u043e\u043c \u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c JSON-\u043e\u0442\u0432\u0435\u0442.\n        /// &lt;/summary&gt;\n        public static IEnumerator Post&lt;TRequest, TResponse&gt;(\n            string   url,\n            TRequest body,\n            Action&lt;TResponse&gt; onSuccess,\n            Action&lt;string&gt;    onError,\n            bool              withAuth = true)\n        {\n            string json = JsonUtility.ToJson(body);\n            byte[] bytes = Encoding.UTF8.GetBytes(json);\n\n            using var req = new UnityWebRequest(url, \"POST\");\n            req.uploadHandler   = new UploadHandlerRaw(bytes);\n            req.downloadHandler = new DownloadHandlerBuffer();\n\n            SetHeaders(req, withAuth);\n\n            yield return req.SendWebRequest();\n\n            HandleResponse&lt;TResponse&gt;(req, onSuccess, onError);\n        }\n\n        // \u2500\u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private static void SetHeaders(UnityWebRequest req, bool withAuth)\n        {\n            req.SetRequestHeader(\"Content-Type\",  \"application/json\");\n            req.SetRequestHeader(\"Accept\",        \"application/json\");\n\n            if (withAuth &amp;&amp; AuthSession.IsLoggedIn)\n                req.SetRequestHeader(\"Authorization\", \"Bearer \" + AuthSession.AccessToken);\n        }\n\n        private static void HandleResponse&lt;TResponse&gt;(\n            UnityWebRequest   req,\n            Action&lt;TResponse&gt; onSuccess,\n            Action&lt;string&gt;    onError)\n        {\n            if (req.result != UnityWebRequest.Result.Success)\n            {\n                // \u041f\u043e\u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u0440\u0430\u0441\u043f\u0430\u0440\u0441\u0438\u0442\u044c \u0442\u0435\u043b\u043e \u043e\u0448\u0438\u0431\u043a\u0438\n                string raw = req.downloadHandler?.text ?? \"\";\n                try\n                {\n                    var errWrapper = JsonUtility.FromJson&lt;ApiResponse&lt;TResponse&gt;&gt;(raw);\n                    string msg = errWrapper?.error?.message ?? req.error;\n                    onError?.Invoke($\"[{req.responseCode}] {msg}\");\n                }\n                catch\n                {\n                    onError?.Invoke($\"[{req.responseCode}] {req.error}\");\n                }\n                return;\n            }\n\n            try\n            {\n                var wrapper = JsonUtility.FromJson&lt;ApiResponse&lt;TResponse&gt;&gt;(req.downloadHandler.text);\n                if (wrapper.ok)\n                    onSuccess?.Invoke(wrapper.data);\n                else\n                    onError?.Invoke(wrapper.error?.message ?? \"Unknown server error\");\n            }\n            catch (Exception ex)\n            {\n                onError?.Invoke(\"Parse error: \" + ex.Message);\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#gameapiservicecs","title":"GameApiService.cs","text":"<p><code>MonoBehaviour</code>-\u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442. \u041e\u0434\u043d\u0430 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432. \u041a\u0430\u0436\u0434\u044b\u0439 \u043c\u0435\u0442\u043e\u0434 \u2014 \u043a\u043e\u0440\u0443\u0442\u0438\u043d\u0430. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430 GameObject \u0432 \u0441\u0446\u0435\u043d\u0435.</p> <pre><code>using System;\nusing System.Collections;\nusing UnityEngine;\n\nnamespace StrategyGame.API\n{\n    /// &lt;summary&gt;\n    /// \u0412\u044b\u0441\u043e\u043a\u043e\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u044b\u0439 \u0441\u0435\u0440\u0432\u0438\u0441 \u2014 \u043e\u0434\u043d\u0430 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 API.\n    /// \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 ApiClient \u0434\u043b\u044f HTTP \u0438 AuthSession \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u0430.\n    ///\n    /// \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:\n    ///   GameApiService svc = GetComponent&lt;GameApiService&gt;();\n    ///   StartCoroutine(svc.Login(\"alice@example.com\", \"password123\", onOk, onErr));\n    /// &lt;/summary&gt;\n    public class GameApiService : MonoBehaviour\n    {\n        // \u2500\u2500\u2500 Auth \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;POST /api/v1/auth/register&lt;/summary&gt;\n        public IEnumerator Register(\n            string email, string password, string nickname,\n            Action&lt;RegisterResponse&gt; onSuccess,\n            Action&lt;string&gt;           onError)\n        {\n            var body = new RegisterRequest\n            {\n                email    = email,\n                password = password,\n                nickname = nickname\n            };\n            yield return StartCoroutine(\n                ApiClient.Post&lt;RegisterRequest, RegisterResponse&gt;(\n                    ApiConfig.Register, body, onSuccess, onError, withAuth: false));\n        }\n\n        /// &lt;summary&gt;POST /api/v1/auth/login \u2014 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0442\u043e\u043a\u0435\u043d \u0432 AuthSession&lt;/summary&gt;\n        public IEnumerator Login(\n            string email, string password,\n            Action&lt;LoginResponse&gt; onSuccess,\n            Action&lt;string&gt;        onError)\n        {\n            var body = new LoginRequest { email = email, password = password };\n            yield return StartCoroutine(\n                ApiClient.Post&lt;LoginRequest, LoginResponse&gt;(\n                    ApiConfig.Login, body,\n                    resp =&gt;\n                    {\n                        AuthSession.Save(resp);\n                        onSuccess?.Invoke(resp);\n                    },\n                    onError,\n                    withAuth: false));\n        }\n\n        public void Logout() =&gt; AuthSession.Clear();\n\n        // \u2500\u2500\u2500 Profile \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;GET /api/v1/profile \u2014 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438&lt;/summary&gt;\n        public IEnumerator GetProfile(\n            Action&lt;ProfileResponse&gt; onSuccess,\n            Action&lt;string&gt;          onError)\n        {\n            yield return StartCoroutine(\n                ApiClient.Get&lt;ProfileResponse&gt;(\n                    ApiConfig.Profile, onSuccess, onError));\n        }\n\n        // \u2500\u2500\u2500 Events \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;POST /api/v1/events \u2014 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u0433\u0440\u043e\u0432\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435&lt;/summary&gt;\n        public IEnumerator SendEvent(\n            string eventType,\n            object payload,\n            Action&lt;EventResponse&gt; onSuccess,\n            Action&lt;string&gt;        onError,\n            int?  sessionId  = null,\n            string clientTime = null)\n        {\n            var body = new EventRequest\n            {\n                eventId    = Guid.NewGuid().ToString(),   // \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 UUID \u0434\u043b\u044f \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438\n                eventType  = eventType,\n                sessionId  = sessionId,\n                clientTime = clientTime ?? DateTime.UtcNow.ToString(\"o\"),\n                payload    = payload\n            };\n            yield return StartCoroutine(\n                ApiClient.Post&lt;EventRequest, EventResponse&gt;(\n                    ApiConfig.Events, body, onSuccess, onError));\n        }\n\n        // \u2500\u2500\u2500 Match \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;POST /api/v1/match/finish \u2014 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043c\u0430\u0442\u0447&lt;/summary&gt;\n        public IEnumerator FinishMatch(\n            int  matchId,\n            bool isWin,\n            int  score,\n            int  durationSeconds,\n            Action&lt;MatchFinishResponse&gt; onSuccess,\n            Action&lt;string&gt;              onError,\n            int? powerDelta = null)\n        {\n            var body = new MatchFinishRequest\n            {\n                matchId = matchId,\n                result  = new MatchResult\n                {\n                    isWin           = isWin,\n                    score           = score,\n                    durationSeconds = durationSeconds,\n                    powerDelta      = powerDelta\n                }\n            };\n            yield return StartCoroutine(\n                ApiClient.Post&lt;MatchFinishRequest, MatchFinishResponse&gt;(\n                    ApiConfig.MatchFinish, body, onSuccess, onError));\n        }\n\n        // \u2500\u2500\u2500 Leaderboard \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;GET /api/v1/leaderboard?boardCode=...&amp;season=...&amp;limit=...&lt;/summary&gt;\n        public IEnumerator GetLeaderboard(\n            Action&lt;LeaderboardResponse&gt; onSuccess,\n            Action&lt;string&gt;              onError,\n            string boardCode = ApiConfig.DefaultBoard,\n            int    season    = ApiConfig.DefaultSeason,\n            int    limit     = ApiConfig.DefaultLimit)\n        {\n            string url = $\"{ApiConfig.Leaderboard}?boardCode={boardCode}&amp;season={season}&amp;limit={limit}\";\n            yield return StartCoroutine(\n                ApiClient.Get&lt;LeaderboardResponse&gt;(url, onSuccess, onError));\n        }\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#authcontrollercs","title":"AuthController.cs","text":"<p>\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 UI-\u043b\u043e\u0433\u0438\u043a\u043e\u0439 \u044d\u043a\u0440\u0430\u043d\u0430 \u0432\u0445\u043e\u0434\u0430/\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438. \u041f\u043e\u0441\u043b\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u0432\u0445\u043e\u0434\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e \u0441\u0446\u0435\u043d\u0443 \u0447\u0435\u0440\u0435\u0437 <code>SceneManager.LoadScene()</code>.</p> <pre><code>using UnityEngine;\nusing UnityEngine.UI;\nusing TMPro;\nusing StrategyGame.API;\n\nnamespace StrategyGame.UI\n{\n    /// &lt;summary&gt;\n    /// \u041a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u044d\u043a\u0440\u0430\u043d\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438.\n    ///\n    /// \u041a\u0430\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0432 \u0441\u0446\u0435\u043d\u0435:\n    ///   1. \u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 GameObject \"AuthManager\".\n    ///   2. \u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b AuthController \u0438 GameApiService.\n    ///   3. \u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435 UI-\u043f\u043e\u043b\u044f \u0432 Inspector.\n    ///   4. \u0423\u043a\u0430\u0436\u0438\u0442\u0435 onLoginSuccess: \u0438\u043c\u044f \u0441\u0446\u0435\u043d\u044b \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u043d\u0430\u0434\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043e\u0441\u043b\u0435 \u0432\u0445\u043e\u0434\u0430.\n    /// &lt;/summary&gt;\n    public class AuthController : MonoBehaviour\n    {\n        [Header(\"Panels\")]\n        [SerializeField] private GameObject loginPanel;\n        [SerializeField] private GameObject registerPanel;\n\n        [Header(\"Login Fields\")]\n        [SerializeField] private TMP_InputField loginEmail;\n        [SerializeField] private TMP_InputField loginPassword;\n        [SerializeField] private Button         loginButton;\n\n        [Header(\"Register Fields\")]\n        [SerializeField] private TMP_InputField regEmail;\n        [SerializeField] private TMP_InputField regPassword;\n        [SerializeField] private TMP_InputField regNickname;\n        [SerializeField] private Button         registerButton;\n\n        [Header(\"Status\")]\n        [SerializeField] private TMP_Text statusText;\n\n        [Header(\"Navigation\")]\n        [SerializeField] private string sceneAfterLogin = \"MainMenu\";\n\n        private GameApiService _api;\n\n        private void Awake()\n        {\n            _api = GetComponent&lt;GameApiService&gt;();\n            if (_api == null)\n                _api = gameObject.AddComponent&lt;GameApiService&gt;();\n\n            loginButton   .onClick.AddListener(OnLoginClick);\n            registerButton.onClick.AddListener(OnRegisterClick);\n\n            ShowLogin();\n        }\n\n        // \u2500\u2500\u2500 \u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u043d\u0435\u043b\u0435\u0439 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        public void ShowLogin()\n        {\n            loginPanel   .SetActive(true);\n            registerPanel.SetActive(false);\n            SetStatus(\"\");\n        }\n\n        public void ShowRegister()\n        {\n            loginPanel   .SetActive(false);\n            registerPanel.SetActive(true);\n            SetStatus(\"\");\n        }\n\n        // \u2500\u2500\u2500 \u041b\u043e\u0433\u0438\u043d \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void OnLoginClick()\n        {\n            string email = loginEmail.text.Trim();\n            string pass  = loginPassword.text;\n\n            if (string.IsNullOrEmpty(email) || string.IsNullOrEmpty(pass))\n            {\n                SetStatus(\"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 email \u0438 \u043f\u0430\u0440\u043e\u043b\u044c\", error: true);\n                return;\n            }\n\n            SetStatus(\"\u0412\u0445\u043e\u0434...\");\n            SetInteractable(false);\n\n            StartCoroutine(_api.Login(email, pass,\n                onSuccess: resp =&gt;\n                {\n                    SetStatus($\"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c, {resp.nickname}!\");\n                    SetInteractable(true);\n                    // \u041f\u0435\u0440\u0435\u0445\u043e\u0434 \u0432 \u0433\u043b\u0430\u0432\u043d\u043e\u0435 \u043c\u0435\u043d\u044e\n                    UnityEngine.SceneManagement.SceneManager.LoadScene(sceneAfterLogin);\n                },\n                onError: err =&gt;\n                {\n                    SetStatus(err, error: true);\n                    SetInteractable(true);\n                }));\n        }\n\n        // \u2500\u2500\u2500 \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void OnRegisterClick()\n        {\n            string email    = regEmail.text.Trim();\n            string pass     = regPassword.text;\n            string nickname = regNickname.text.Trim();\n\n            if (string.IsNullOrEmpty(email) || string.IsNullOrEmpty(pass) || string.IsNullOrEmpty(nickname))\n            {\n                SetStatus(\"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f\", error: true);\n                return;\n            }\n\n            SetStatus(\"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f...\");\n            SetInteractable(false);\n\n            StartCoroutine(_api.Register(email, pass, nickname,\n                onSuccess: resp =&gt;\n                {\n                    SetStatus(\"\u0410\u043a\u043a\u0430\u0443\u043d\u0442 \u0441\u043e\u0437\u0434\u0430\u043d! \u0412\u043e\u0439\u0434\u0438\u0442\u0435.\");\n                    SetInteractable(true);\n                    ShowLogin();\n                },\n                onError: err =&gt;\n                {\n                    SetStatus(err, error: true);\n                    SetInteractable(true);\n                }));\n        }\n\n        // \u2500\u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void SetStatus(string msg, bool error = false)\n        {\n            if (statusText == null) return;\n            statusText.text  = msg;\n            statusText.color = error ? Color.red : Color.white;\n        }\n\n        private void SetInteractable(bool value)\n        {\n            loginButton   .interactable = value;\n            registerButton.interactable = value;\n        }\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#profilecontrollercs","title":"ProfileController.cs","text":"<p>\u0417\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u043f\u0440\u0438 <code>Start()</code> \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 TMP_Text-\u043f\u043e\u043b\u044f\u0445. \u041a\u043d\u043e\u043f\u043a\u0430 <code>Refresh</code> \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441.</p> <pre><code>using UnityEngine;\nusing TMPro;\nusing StrategyGame.API;\n\nnamespace StrategyGame.UI\n{\n    /// &lt;summary&gt;\n    /// \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430.\n    ///\n    /// \u041a\u0430\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c:\n    ///   1. GameObject \"ProfilePanel\" \u2192 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c ProfileController + GameApiService.\n    ///   2. \u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c TMP-\u043f\u043e\u043b\u044f \u0432 Inspector.\n    ///   3. \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u0438 Start().\n    /// &lt;/summary&gt;\n    public class ProfileController : MonoBehaviour\n    {\n        [Header(\"UI Labels\")]\n        [SerializeField] private TMP_Text nicknameText;\n        [SerializeField] private TMP_Text emailText;\n        [SerializeField] private TMP_Text levelText;\n        [SerializeField] private TMP_Text xpText;\n        [SerializeField] private TMP_Text softCurrencyText;\n        [SerializeField] private TMP_Text hardCurrencyText;\n        [SerializeField] private TMP_Text statusText;\n\n        private GameApiService _api;\n\n        private void Awake()\n        {\n            _api = GetComponent&lt;GameApiService&gt;();\n            if (_api == null)\n                _api = gameObject.AddComponent&lt;GameApiService&gt;();\n        }\n\n        private void Start()\n        {\n            if (!AuthSession.IsLoggedIn)\n            {\n                SetStatus(\"\u041d\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043d\", error: true);\n                return;\n            }\n            Refresh();\n        }\n\n        /// &lt;summary&gt;\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0444\u0438\u043b\u044f \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.&lt;/summary&gt;\n        public void Refresh()\n        {\n            SetStatus(\"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...\");\n            StartCoroutine(_api.GetProfile(\n                onSuccess: data =&gt;\n                {\n                    ApplyProfile(data);\n                    SetStatus(\"\");\n                },\n                onError: err =&gt; SetStatus(err, error: true)));\n        }\n\n        // \u2500\u2500\u2500 \u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void ApplyProfile(ProfileResponse data)\n        {\n            if (nicknameText)     nicknameText.text     = data.nickname;\n            if (emailText)        emailText.text        = data.email;\n            if (levelText)        levelText.text        = $\"\u0423\u0440\u043e\u0432\u0435\u043d\u044c {data.progress?.level}\";\n            if (xpText)           xpText.text           = $\"XP: {data.progress?.xp}\";\n            if (softCurrencyText) softCurrencyText.text = $\"\u041c\u043e\u043d\u0435\u0442\u044b: {data.progress?.softCurrency}\";\n            if (hardCurrencyText) hardCurrencyText.text = $\"\u0413\u0435\u043c\u044b: {data.progress?.hardCurrency}\";\n        }\n\n        private void SetStatus(string msg, bool error = false)\n        {\n            if (statusText == null) return;\n            statusText.text  = msg;\n            statusText.color = error ? Color.red : Color.gray;\n        }\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#leaderboardcontrollercs","title":"LeaderboardController.cs","text":"<p>\u041f\u0440\u0438 <code>Start()</code> \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043b\u0438\u0434\u0435\u0440\u043e\u0432 \u0438 \u0441\u043e\u0437\u0434\u0430\u0451\u0442 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u044b <code>rowPrefab</code> \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438.</p> <pre><code>using UnityEngine;\nusing UnityEngine.UI;\nusing TMPro;\nusing StrategyGame.API;\n\nnamespace StrategyGame.UI\n{\n    /// &lt;summary&gt;\n    /// \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0438 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u043b\u0438\u0434\u0435\u0440\u043e\u0432.\n    ///\n    /// \u041a\u0430\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c:\n    ///   1. GameObject \"LeaderboardPanel\" \u2192 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c LeaderboardController + GameApiService.\n    ///   2. \u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 Prefab \u0441\u0442\u0440\u043e\u043a\u0438: TMP_Text rank | nickname | score.\n    ///      \u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435 \u043a\u0430\u043a rowPrefab.\n    ///   3. \u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435 ScrollView.Content \u043a\u0430\u043a rowContainer.\n    /// &lt;/summary&gt;\n    public class LeaderboardController : MonoBehaviour\n    {\n        [Header(\"List\")]\n        [SerializeField] private Transform rowContainer;   // ScrollView &gt; Viewport &gt; Content\n        [SerializeField] private GameObject rowPrefab;     // Prefab \u0441\u0442\u0440\u043e\u043a\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u044b\n\n        [Header(\"Status\")]\n        [SerializeField] private TMP_Text statusText;\n\n        [Header(\"Settings\")]\n        [SerializeField] private string boardCode = ApiConfig.DefaultBoard;\n        [SerializeField] private int    season    = ApiConfig.DefaultSeason;\n        [SerializeField] private int    limit     = ApiConfig.DefaultLimit;\n\n        private GameApiService _api;\n\n        private void Awake()\n        {\n            _api = GetComponent&lt;GameApiService&gt;();\n            if (_api == null)\n                _api = gameObject.AddComponent&lt;GameApiService&gt;();\n        }\n\n        private void Start() =&gt; Refresh();\n\n        /// &lt;summary&gt;\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.&lt;/summary&gt;\n        public void Refresh()\n        {\n            SetStatus(\"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...\");\n            StartCoroutine(_api.GetLeaderboard(\n                onSuccess: data =&gt;\n                {\n                    Render(data);\n                    SetStatus(\"\");\n                },\n                onError: err =&gt; SetStatus(err, error: true),\n                boardCode: boardCode,\n                season:    season,\n                limit:     limit));\n        }\n\n        // \u2500\u2500\u2500 \u0420\u0435\u043d\u0434\u0435\u0440 \u0441\u0442\u0440\u043e\u043a \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void Render(LeaderboardResponse data)\n        {\n            // \u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438\n            foreach (Transform child in rowContainer)\n                Destroy(child.gameObject);\n\n            if (data.items == null || data.items.Count == 0)\n            {\n                SetStatus(\"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043f\u0443\u0441\u0442\u0430\");\n                return;\n            }\n\n            foreach (var item in data.items)\n            {\n                var row = Instantiate(rowPrefab, rowContainer);\n\n                // \u0418\u0449\u0435\u043c TMP-\u043f\u043e\u043b\u044f \u0432 prefab \u043f\u043e \u0442\u0435\u0433\u0430\u043c \u0438\u043b\u0438 \u0438\u043c\u0435\u043d\u0430\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432\n                var labels = row.GetComponentsInChildren&lt;TMP_Text&gt;();\n                if (labels.Length &gt;= 3)\n                {\n                    labels[0].text = item.rank.ToString();\n                    labels[1].text = item.nickname;\n                    labels[2].text = item.score.ToString();\n                }\n            }\n        }\n\n        private void SetStatus(string msg, bool error = false)\n        {\n            if (statusText == null) return;\n            statusText.text  = msg;\n            statusText.color = error ? Color.red : Color.gray;\n        }\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#matchcontrollercs","title":"MatchController.cs","text":"<p>\u041f\u0440\u0438 <code>Start()</code> \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0442\u0430\u0439\u043c\u0435\u0440 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 <code>match_start</code> \u0441\u043e\u0431\u044b\u0442\u0438\u0435. \u041c\u0435\u0442\u043e\u0434 <code>EndMatch(isWin, score)</code> \u043e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0442\u0430\u0439\u043c\u0435\u0440 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 <code>POST /api/v1/match/finish</code>.</p> <pre><code>using System.Collections;\nusing UnityEngine;\nusing TMPro;\nusing StrategyGame.API;\n\nnamespace StrategyGame.Game\n{\n    /// &lt;summary&gt;\n    /// \u0423\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0436\u0438\u0437\u043d\u0435\u043d\u043d\u044b\u043c \u0446\u0438\u043a\u043b\u043e\u043c \u043c\u0430\u0442\u0447\u0430 \u0432 Unity:\n    ///   \u2022 \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 match_start\n    ///   \u2022 \u0421\u0447\u0438\u0442\u0430\u0435\u0442 \u0432\u0440\u0435\u043c\u044f \u043c\u0430\u0442\u0447\u0430\n    ///   \u2022 \u041f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 EndMatch() \u2014 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 POST /api/v1/match/finish\n    ///   \u2022 \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 (\u043d\u0430\u0433\u0440\u0430\u0434\u044b) \u0432 UI\n    ///\n    /// \u041a\u0430\u043a \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c:\n    ///   1. \u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 GameObject \"MatchManager\".\n    ///   2. \u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 MatchController + GameApiService.\n    ///   3. \u041f\u0440\u0438\u0432\u044f\u0436\u0438\u0442\u0435 UI-\u043f\u043e\u043b\u044f \u0432 Inspector.\n    ///   4. \u041d\u0430\u0437\u043d\u0430\u0447\u044c\u0442\u0435 matchId \u0432 Inspector (\u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u0439\u0442\u0435 \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u0434 \u043f\u0435\u0440\u0435\u0434 \u0441\u0442\u0430\u0440\u0442\u043e\u043c \u043c\u0430\u0442\u0447\u0430).\n    ///   5. \u0412\u044b\u0437\u044b\u0432\u0430\u0439\u0442\u0435 EndMatch(isWin, score) \u0438\u0437 \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u043b\u043e\u0433\u0438\u043a\u0438.\n    /// &lt;/summary&gt;\n    public class MatchController : MonoBehaviour\n    {\n        [Header(\"Match Settings\")]\n        [SerializeField] private int matchId = 9;    // id \u043c\u0430\u0442\u0447\u0430 \u0438\u0437 \u0411\u0414 (seed.sql \u2192 id=9)\n\n        [Header(\"UI\")]\n        [SerializeField] private TMP_Text timerText;\n        [SerializeField] private TMP_Text statusText;\n        [SerializeField] private TMP_Text rewardText;\n        [SerializeField] private GameObject resultPanel;\n\n        private GameApiService _api;\n        private float          _elapsed;\n        private bool           _running;\n\n        // \u2500\u2500\u2500 Lifecycle \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void Awake()\n        {\n            _api = GetComponent&lt;GameApiService&gt;();\n            if (_api == null)\n                _api = gameObject.AddComponent&lt;GameApiService&gt;();\n\n            if (resultPanel) resultPanel.SetActive(false);\n        }\n\n        private void Start()\n        {\n            StartMatch();\n        }\n\n        private void Update()\n        {\n            if (!_running) return;\n            _elapsed += Time.deltaTime;\n            if (timerText)\n                timerText.text = FormatTime(_elapsed);\n        }\n\n        // \u2500\u2500\u2500 \u0421\u0442\u0430\u0440\u0442 \u043c\u0430\u0442\u0447\u0430 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void StartMatch()\n        {\n            _elapsed = 0f;\n            _running = true;\n\n            SetStatus(\"\u041c\u0430\u0442\u0447 \u043d\u0430\u0447\u0430\u043b\u0441\u044f!\");\n\n            // \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 match_start\n            var payload = new MatchStartPayload\n            {\n                matchId  = matchId,\n                mode     = \"pve\",\n                mapCode  = \"coastal_siege\",\n                season   = 1\n            };\n\n            StartCoroutine(_api.SendEvent(\n                eventType: \"match_start\",\n                payload:   payload,\n                onSuccess: _ =&gt; Debug.Log(\"[Match] match_start \u043f\u0440\u0438\u043d\u044f\u0442\"),\n                onError:   err =&gt; Debug.LogWarning(\"[Match] match_start \u043e\u0448\u0438\u0431\u043a\u0430: \" + err)));\n        }\n\n        // \u2500\u2500\u2500 \u041a\u043e\u043d\u0435\u0446 \u043c\u0430\u0442\u0447\u0430 (\u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0438\u0437 \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u043b\u043e\u0433\u0438\u043a\u0438) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        /// &lt;summary&gt;\n        /// \u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043c\u0430\u0442\u0447. \u0412\u044b\u0437\u044b\u0432\u0430\u0439\u0442\u0435 \u043a\u043e\u0433\u0434\u0430 \u0438\u0433\u0440\u0430 \u0432\u044b\u0438\u0433\u0440\u0430\u043d\u0430 \u0438\u043b\u0438 \u043f\u0440\u043e\u0438\u0433\u0440\u0430\u043d\u0430.\n        /// &lt;/summary&gt;\n        public void EndMatch(bool isWin, int score)\n        {\n            if (!_running) return;\n            _running = false;\n\n            int duration = Mathf.RoundToInt(_elapsed);\n            SetStatus(isWin ? \"\u041f\u043e\u0431\u0435\u0434\u0430! \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442...\" : \"\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435... \u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442...\");\n\n            StartCoroutine(SendMatchFinish(isWin, score, duration));\n        }\n\n        private IEnumerator SendMatchFinish(bool isWin, int score, int duration)\n        {\n            yield return StartCoroutine(_api.FinishMatch(\n                matchId:         matchId,\n                isWin:           isWin,\n                score:           score,\n                durationSeconds: duration,\n                onSuccess: data =&gt;\n                {\n                    ShowResult(data);\n                },\n                onError: err =&gt;\n                {\n                    SetStatus(\"\u041e\u0448\u0438\u0431\u043a\u0430: \" + err, error: true);\n                    Debug.LogError(\"[Match] FinishMatch error: \" + err);\n                }));\n        }\n\n        // \u2500\u2500\u2500 \u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void ShowResult(MatchFinishResponse data)\n        {\n            if (resultPanel) resultPanel.SetActive(true);\n\n            string result = data.isWin ? \"\ud83c\udfc6 \u041f\u041e\u0411\u0415\u0414\u0410!\" : \"\ud83d\udc80 \u041f\u041e\u0420\u0410\u0416\u0415\u041d\u0418\u0415\";\n            SetStatus(result);\n\n            if (rewardText)\n                rewardText.text = $\"+{data.xpGained} XP\\n+{data.softCurrencyGained} \u043c\u043e\u043d\u0435\u0442\";\n\n            Debug.Log($\"[Match] \u0417\u0430\u0432\u0435\u0440\u0448\u0451\u043d. isWin={data.isWin} xp={data.xpGained} soft={data.softCurrencyGained}\");\n        }\n\n        // \u2500\u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n        private void SetStatus(string msg, bool error = false)\n        {\n            if (statusText == null) return;\n            statusText.text  = msg;\n            statusText.color = error ? Color.red : Color.white;\n        }\n\n        private static string FormatTime(float seconds)\n        {\n            int m = (int)seconds / 60;\n            int s = (int)seconds % 60;\n            return $\"{m:00}:{s:00}\";\n        }\n    }\n\n    // \u2500\u2500\u2500 Payload \u0434\u043b\u044f match_start \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [System.Serializable]\n    public class MatchStartPayload\n    {\n        public int    matchId;\n        public string mode;\n        public string mapCode;\n        public int    season;\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#eventsendercs","title":"EventSender.cs","text":"<p>\u0421\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0432\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043b\u0430\u0441\u0441. \u041c\u0435\u0442\u043e\u0434 <code>EventSender.Send(this, \"eventType\", payload)</code> \u0438\u0449\u0435\u0442 <code>GameApiService</code> \u0432 \u0441\u0446\u0435\u043d\u0435 \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435.</p> <pre><code>using System;\nusing UnityEngine;\nusing StrategyGame.API;\n\nnamespace StrategyGame.Game\n{\n    /// &lt;summary&gt;\n    /// \u0412\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u044b\u0445 \u0438\u0433\u0440\u043e\u0432\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439.\n    ///\n    /// \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u0437 \u043b\u044e\u0431\u043e\u0433\u043e MonoBehaviour:\n    ///   EventSender.Send(this, \"unit_deploy\", new { matchId=9, unitCode=\"cavalry\", amount=40 });\n    /// &lt;/summary&gt;\n    public static class EventSender\n    {\n        /// &lt;summary&gt;\n        /// \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 GameApiService, \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0439 \u0432 \u0441\u0446\u0435\u043d\u0435.\n        /// &lt;/summary&gt;\n        public static void Send(MonoBehaviour caller, string eventType, object payload,\n            Action onSuccess = null, Action&lt;string&gt; onError = null)\n        {\n            var svc = UnityEngine.Object.FindObjectOfType&lt;GameApiService&gt;();\n            if (svc == null)\n            {\n                Debug.LogError(\"[EventSender] GameApiService \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0446\u0435\u043d\u0435!\");\n                return;\n            }\n\n            caller.StartCoroutine(svc.SendEvent(\n                eventType: eventType,\n                payload:   payload,\n                onSuccess: resp =&gt;\n                {\n                    Debug.Log($\"[Event] {eventType} \u043f\u0440\u0438\u043d\u044f\u0442: {resp.eventId}\");\n                    onSuccess?.Invoke();\n                },\n                onError: err =&gt;\n                {\n                    Debug.LogWarning($\"[Event] {eventType} \u043e\u0448\u0438\u0431\u043a\u0430: {err}\");\n                    onError?.Invoke(err);\n                }));\n        }\n    }\n\n    // \u2500\u2500\u2500 \u0413\u043e\u0442\u043e\u0432\u044b\u0435 payload-\u043a\u043b\u0430\u0441\u0441\u044b \u0434\u043b\u044f \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n    [Serializable]\n    public class UnitDeployPayload\n    {\n        public int    matchId;\n        public string unitCode;   // infantry / cavalry / archer / siege\n        public int    amount;\n        public int    atSecond;\n    }\n\n    [Serializable]\n    public class UnitRetreatPayload\n    {\n        public int    matchId;\n        public string unitCode;\n        public int    lost;\n        public int    atSecond;\n    }\n\n    [Serializable]\n    public class BuildingUpgradePayload\n    {\n        public string buildingCode;  // barracks / farm / forge / walls\n        public int    fromLevel;\n        public int    toLevel;\n        public int    goldCost;\n    }\n}\n</code></pre>"},{"location":"practice/game_integration.html#7","title":"\u0427\u0430\u0441\u0442\u044c 7. \u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430","text":""},{"location":"practice/game_integration.html#_4","title":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435","text":"<ol> <li> <p>\u0412 <code>EventSender.cs</code> \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 payload-\u043a\u043b\u0430\u0441\u0441: </p><pre><code>[Serializable]\npublic class MyEventPayload { public int matchId; public string data; }\n</code></pre><p></p> </li> <li> <p>\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u0437 \u043b\u044e\u0431\u043e\u0433\u043e MonoBehaviour: </p><pre><code>EventSender.Send(this, \"my_event\", new MyEventPayload { matchId = 9, data = \"test\" });\n</code></pre><p></p> </li> </ol>"},{"location":"practice/game_integration.html#playerprefs","title":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0442\u043e\u043a\u0435\u043d \u043c\u0435\u0436\u0434\u0443 \u0441\u0435\u0441\u0441\u0438\u044f\u043c\u0438 (PlayerPrefs)","text":"<pre><code>// \u041f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438:\nPlayerPrefs.SetString(\"token\",    AuthSession.AccessToken);\nPlayerPrefs.SetInt   (\"userId\",   AuthSession.UserId);\nPlayerPrefs.SetString(\"nickname\", AuthSession.Nickname);\n\n// \u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435:\nif (PlayerPrefs.HasKey(\"token\"))\n{\n    var fakeResp = new LoginResponse {\n        accessToken = PlayerPrefs.GetString(\"token\"),\n        userId      = PlayerPrefs.GetInt(\"userId\"),\n        nickname    = PlayerPrefs.GetString(\"nickname\")\n    };\n    AuthSession.Save(fakeResp);\n}\n</code></pre>"},{"location":"practice/game_integration.html#dev-prod","title":"\u0421\u043c\u0435\u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (dev / prod)","text":"<p>\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 <code>ApiConfig.BaseUrl</code>: </p><pre><code>// \u041b\u043e\u043a\u0430\u043b\u044c\u043d\u043e:    \"http://127.0.0.1:5000\"\n// \u041f\u043e \u0441\u0435\u0442\u0438:     \"http://192.168.1.100:5000\"\n// Production:  \"https://your-server.com\"\n</code></pre><p></p>"},{"location":"practice/genre_adaptation.html","title":"\u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f \u0418\u0421","text":""},{"location":"practice/genre_adaptation.html#2-3","title":"2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430 3. \u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":""},{"location":"practice/genre_adaptation.html#31-3","title":"3.1. \u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0443 3 \u00ab\u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f\u00bb","text":""},{"location":"practice/genre_adaptation.html#_1","title":"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c","text":"<p>\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u0436\u0430\u043d\u0440 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: TD/Strategy, RPG, VN, Economic, Shooter, Survival, Idle) \u0438 \u0441\u0434\u0435\u043b\u0430\u0442\u044c:</p> <ol> <li>\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0435\u0434\u0438\u043d\u0438\u0446\u0443 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430: <code>match</code> / <code>run</code> / <code>episode</code> / <code>cycle</code>.</li> <li>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c 3\u20135 \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 (\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f + \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f), \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u043a <code>users</code> \u0438 \u043a \u0435\u0434\u0438\u043d\u0438\u0446\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.</li> <li>\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c 6 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (<code>event_type</code>) \u0434\u043b\u044f \u0436\u0430\u043d\u0440\u0430 + \u043f\u043e 1 \u043f\u0440\u0438\u043c\u0435\u0440\u0443 <code>payload</code> \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435.</li> </ol> <p>\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0432\u0441\u0451 \u0432 \u0444\u0430\u0439\u043b\u0435:</p> <pre><code>docs/03-genre.md\n</code></pre>"},{"location":"practice/genre_adaptation.html#311","title":"3.1.1. \u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0436\u0430\u043d\u0440\u043e\u0432\u043e\u0439 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438","text":"<ul> <li>\u042f\u0434\u0440\u043e \u043d\u0435 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f. \u0422\u0430\u0431\u043b\u0438\u0446\u044b \u044f\u0434\u0440\u0430 (Users/Sessions/Events/Progress/Stats/Leaderboard) \u043e\u0441\u0442\u0430\u044e\u0442\u0441\u044f \u043a\u0430\u043a \u0435\u0441\u0442\u044c.</li> <li> <p>\u0416\u0430\u043d\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435:</p> </li> <li> <p>\u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 <code>users</code>;</p> </li> <li>\u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u043e\u0439 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (<code>match/run/episode/cycle</code>).</li> <li>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0436\u0430\u043d\u0440\u0430 \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>game_events</code> (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u0448\u0438\u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439) \u0441 <code>event_type</code> \u0438 <code>payload_json</code>.</li> </ul>"},{"location":"practice/genre_adaptation.html#312","title":"3.1.2. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u043b\u044f \u0444\u0438\u043a\u0441\u0430\u0446\u0438\u0438","text":"<p>\u0427\u0442\u043e\u0431\u044b \u0448\u0430\u0433 3 \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u0431\u044b\u043b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435\u043c \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u0438 \u044f\u0434\u0440\u0430, \u0432 <code>docs/03-genre.md</code> \u043d\u0443\u0436\u043d\u043e \u044f\u0432\u043d\u043e \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c:</p> <ol> <li> <p>\u041a\u0430\u043a \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u043f\u043e \u043a\u043e\u043d\u0442\u0443\u0440\u0443 Client \u2192 API \u2192 Auth \u2192 BL \u2192 DB \u0434\u043b\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u043e\u0439 \u0435\u0434\u0438\u043d\u0438\u0446\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.    \u041d\u0435 \u043a\u043e\u0434, \u0430 3\u20135 \u0441\u0442\u0440\u043e\u043a: \u0433\u0434\u0435 \u0441\u043e\u0437\u0434\u0430\u0451\u0442\u0441\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441, \u0433\u0434\u0435 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442\u0441\u044f, \u0433\u0434\u0435 \u0432\u044b\u0434\u0430\u044e\u0442\u0441\u044f \u043d\u0430\u0433\u0440\u0430\u0434\u044b.</p> </li> <li> <p>\u041a\u0430\u043a\u0438\u0435 \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442\u044b \u0431\u0443\u0434\u0443\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2\u20133, \u0432 \u0441\u043f\u0438\u0441\u043a\u0435).    \u041f\u0440\u0438\u043c\u0435\u0440: <code>POST /api/v1/events</code> (\u0441 <code>eventType='match_start'</code>), <code>POST /api/v1/match/finish</code>, <code>GET /api/v1/profile</code>.</p> </li> <li> <p>\u041a\u0430\u043a \u0441\u043e\u0431\u044b\u0442\u0438\u044f (game_events) \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u043c\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c\u0438:    \u0432 \u043a\u0430\u0436\u0434\u043e\u043c payload \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (<code>matchId/runId/episodeId/cycleId</code>) + \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u043a\u043b\u044e\u0447\u0438 \u0434\u043e\u043c\u0435\u043d\u0430.</p> </li> <li> <p>\u041a\u0430\u043a\u0438\u0435 \u043f\u043e\u043b\u044f \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \"\u0438\u0441\u0442\u0438\u043d\u043e\u0439 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435\" (anti-cheat / \u0434\u043e\u0432\u0435\u0440\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u043c):</p> </li> <li> <p>\u043a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442 xp/\u043d\u0430\u0433\u0440\u0430\u0434\u044b \u043a\u0430\u043a \"\u0433\u043e\u0442\u043e\u0432\u044b\u0435\";</p> </li> <li> <p>\u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442 \u0444\u0430\u043a\u0442\u044b (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 score, isWin, durationSeconds), \u0430 \u0441\u0435\u0440\u0432\u0435\u0440 \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u043f\u043e \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430\u043c.</p> </li> <li> <p>\u0418\u043d\u0434\u0435\u043a\u0441\u044b \u0438 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e):</p> </li> <li> <p>FK + \u0438\u043d\u0434\u0435\u043a\u0441 \u043f\u043e FK;</p> </li> <li> <p>\u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0442\u0430\u043c, \u0433\u0434\u0435 \u043d\u0443\u0436\u043d\u043e (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 <code>UNIQUE(user_id, unit_code)</code>, <code>UNIQUE(user_id, building_code)</code>).</p> </li> <li> <p>\u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u0438\u0442\u043e\u0433\u043e\u0432:    \u043f\u0440\u0438 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c, \u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u043e:    <code>result \u2192 rewards \u2192 progress \u2192 leaderboard \u2192 stats</code>.</p> </li> </ol>"},{"location":"practice/genre_adaptation.html#32-docs03-genremd","title":"3.2. \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f \u043a \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u044e <code>docs/03-genre.md</code>","text":""},{"location":"practice/genre_adaptation.html#321","title":"3.2.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u0412 \u0444\u0430\u0439\u043b\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043e:</p> <ul> <li>\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0435\u0434\u0438\u043d\u0438\u0446\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (<code>match/run/episode/cycle</code>);</li> <li>\u0437\u0430\u0447\u0435\u043c \u043e\u043d\u0430 \u043d\u0443\u0436\u043d\u0430 (\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442, \u043c\u0435\u0442\u0440\u0438\u043a\u0438, \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u00ab\u0438\u0442\u043e\u0433 \u2192 \u043d\u0430\u0433\u0440\u0430\u0434\u0430 \u2192 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u00bb).</li> </ul> <p>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e (\u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0448\u0430\u0433\u043e\u0432 1\u20132):</p> <ul> <li>\u043a\u0430\u043a\u0438\u0435 endpoint(\u044b) \u0441\u043e\u0437\u0434\u0430\u044e\u0442 \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u044e\u0442 \u0435\u0434\u0438\u043d\u0438\u0446\u0443 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430;</li> <li>\u043a\u0430\u043a\u0438\u0435 \u043f\u043e\u043b\u044f \u0443 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0441\u0435\u0440\u0432\u0435\u0440 \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u044b\u043c\u0438 (\u0438\u0441\u0442\u0438\u043d\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435);</li> <li>\u043a\u0430\u043a\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u044f\u0434\u0440\u0430 \u0437\u0430\u0442\u0440\u0430\u0433\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u043f\u0440\u0438 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (\u043c\u0438\u043d\u0438\u043c\u0443\u043c: <code>player_progress</code>, \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e <code>leaderboard_scores</code>, <code>statistics_daily</code>, <code>game_events</code>).</li> </ul>"},{"location":"practice/genre_adaptation.html#322-35","title":"3.2.2. \u0416\u0430\u043d\u0440\u043e\u0432\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (3\u20135)","text":"<p>\u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0443\u043a\u0430\u0437\u0430\u0442\u044c:</p> <ul> <li>\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b;</li> <li>\u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 5\u20138 \u043f\u043e\u043b\u0435\u0439);</li> <li>\u0441\u0432\u044f\u0437\u0438 (FK) \u0441 <code>users</code> \u0438/\u0438\u043b\u0438 \u0435\u0434\u0438\u043d\u0438\u0446\u0435\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.</li> </ul> <p>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e (\u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0448\u0430\u0433\u0430 2):</p> <ul> <li>PK \u0442\u0438\u043f (INT/BIGINT) \u0438 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435;</li> <li>FK-\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f (ON DELETE);</li> <li>1\u20132 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 (\u043f\u043e FK/\u0432\u0440\u0435\u043c\u0435\u043d\u0438/\u043f\u043e\u0438\u0441\u043a\u043e\u0432\u043e\u043c\u0443 \u043f\u043e\u043b\u044e);</li> <li>1 CHECK \u0438\u043b\u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 <code>season &gt;= 1</code>, <code>duration_seconds &gt;= 0</code>).</li> </ul>"},{"location":"practice/genre_adaptation.html#323-6","title":"3.2.3. \u0421\u043e\u0431\u044b\u0442\u0438\u044f (6 \u0448\u0442.)","text":"<p>\u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0443\u043a\u0430\u0437\u0430\u0442\u044c:</p> <ul> <li><code>event_type</code> (\u0441\u0442\u0440\u043e\u043a\u0430);</li> <li>\u0441\u043c\u044b\u0441\u043b \u0441\u043e\u0431\u044b\u0442\u0438\u044f;</li> <li>\u043f\u0440\u0438\u043c\u0435\u0440 <code>payload</code> (JSON-\u043e\u0431\u044a\u0435\u043a\u0442).</li> </ul> <p>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e (\u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0448\u0430\u0433\u0430 2 / game_events):</p> <ul> <li> <p>payload \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0430\u0442\u044c:</p> </li> <li> <p>\u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (<code>matchId</code>/<code>runId</code>/<code>episodeId</code>/<code>cycleId</code>);</p> </li> <li>\"\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0444\u0430\u043a\u0442\u044b\" \u0434\u043b\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u0430;</li> <li>\u0437\u0430\u043f\u0440\u0435\u0442: \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0430\u0442\u044c \"\u043d\u0430\u0433\u0440\u0430\u0434\u0443 \u043a\u0430\u043a \u0438\u0441\u0442\u0438\u043d\u0443\", \u0435\u0441\u043b\u0438 \u044d\u0442\u043e \u0432\u044b\u0434\u0430\u0451\u0442 \u0441\u0435\u0440\u0432\u0435\u0440   (\u043d\u0430\u0433\u0440\u0430\u0434\u0430 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432 <code>reward_granted</code>, \u043d\u043e \u043a\u0430\u043a \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0430\u0441\u0447\u0451\u0442\u0430 BL).</li> </ul>"},{"location":"practice/genre_adaptation.html#33-strategy","title":"3.3. \u041f\u0440\u0438\u043c\u0435\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (Strategy)","text":"<p>\u042d\u0442\u043e\u0442 \u043f\u0440\u0438\u043c\u0435\u0440 \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u0433\u043e\u0442\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0444\u0430\u0439\u043b\u0430 <code>docs/03-genre.md</code> \u0434\u043b\u044f \u0436\u0430\u043d\u0440\u0430 Strategy. \u0412\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c\u0443 \u043f\u0440\u043e\u0435\u043a\u0442\u0443 <code>strategy-support-is</code>. \u0421\u0442\u0443\u0434\u0435\u043d\u0442 \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u0436\u0430\u043d\u0440\u0430 \u0434\u0435\u043b\u0430\u0435\u0442 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e.</p>"},{"location":"practice/genre_adaptation.html#331-match","title":"3.3.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430: <code>match</code>","text":"<p>\u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430: <code>match</code> \u2014 \u043e\u0434\u043d\u043e \u0441\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 pve \u0438\u043b\u0438 pvp. \u0417\u0430\u0447\u0435\u043c \u043d\u0443\u0436\u043d\u0430: \u043c\u0430\u0442\u0447 \u0438\u043c\u0435\u0435\u0442 \u0441\u0442\u0430\u0440\u0442/\u0444\u0438\u043d\u0438\u0448, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 (win/lose, score, duration) \u0438 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0441\u043d\u043e\u0432\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u00ab\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u2192 \u043d\u0430\u0433\u0440\u0430\u0434\u0430 \u2192 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u2192 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u00bb.</p> <p>\u0421\u0432\u044f\u0437\u044c \u0441 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043e\u0439:</p> <ul> <li>Client \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 <code>POST /api/v1/events</code> \u0441 <code>eventType='match_start'</code> \u2192 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043f\u0438\u0448\u0435\u0442\u0441\u044f \u0432 <code>game_events</code>.</li> <li>\u0412\u043e \u0432\u0440\u0435\u043c\u044f \u043c\u0430\u0442\u0447\u0430 Client \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (deploy, retreat) \u2192 \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0438\u0448\u0435\u0442 \u0432 <code>game_events</code>.</li> <li>Client \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 <code>POST /api/v1/match/finish</code> \u2192 \u0441\u0435\u0440\u0432\u0435\u0440 \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u0442 \u0438\u0442\u043e\u0433 \u0432 <code>matches</code> \u0438 <code>battle_results</code>, \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b, \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 <code>player_progress</code>, <code>leaderboard_scores</code>, <code>statistics_daily</code>.</li> </ul> <p>\u0427\u0442\u043e \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0441\u0442\u0438\u043d\u043e\u0439 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435:</p> <p>\u041a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442 <code>xpGained</code> \u0438 <code>softCurrencyGained</code>. \u0421\u0435\u0440\u0432\u0435\u0440 \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0438\u0445 \u0432 <code>match_service.py</code> \u043f\u043e \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430\u043c:</p> <pre><code>_XP_WIN   = 100   _XP_LOSS   = 30\n_SOFT_WIN = 50    _SOFT_LOSS = 10\n</code></pre>"},{"location":"practice/genre_adaptation.html#332-5","title":"3.3.2. \u0416\u0430\u043d\u0440\u043e\u0432\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (5)","text":""},{"location":"practice/genre_adaptation.html#1-matches","title":"1) <code>matches</code> \u2014 \u043c\u0430\u0442\u0447\u0438 (\u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430)","text":"<p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f:</p> <ul> <li><code>id</code> BIGINT PK AUTO_INCREMENT</li> <li><code>user_id</code> INT FK \u2192 users.id</li> <li><code>mode</code> ENUM('pve','pvp')</li> <li><code>map_code</code> VARCHAR(64) \u2014 \u043a\u043e\u0434 \u043a\u0430\u0440\u0442\u044b (<code>forest_raid</code>, <code>desert_clash</code>, <code>mountain_pass</code>, <code>coastal_siege</code>)</li> <li><code>season</code> INT DEFAULT 1</li> <li><code>status</code> ENUM('started','finished','abandoned')</li> <li><code>started_at</code> DATETIME(3)</li> <li><code>ended_at</code> DATETIME(3)</li> </ul> <p>\u0421\u0432\u044f\u0437\u0438:</p> <ul> <li>users 1:M matches</li> </ul> <p>\u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> <ul> <li>INDEX <code>(user_id, started_at)</code></li> <li>CHECK <code>season &gt;= 1</code></li> </ul>"},{"location":"practice/genre_adaptation.html#2-battle_results-11-matches","title":"2) <code>battle_results</code> \u2014 \u0438\u0442\u043e\u0433 \u043c\u0430\u0442\u0447\u0430 (1:1 \u0441 matches)","text":"<p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f:</p> <ul> <li><code>match_id</code> BIGINT PK FK \u2192 matches.id</li> <li><code>is_win</code> TINYINT(1)</li> <li><code>score</code> INT</li> <li><code>duration_seconds</code> INT</li> <li><code>units_lost</code> INT</li> <li><code>units_killed</code> INT</li> </ul> <p>\u0421\u0432\u044f\u0437\u0438:</p> <ul> <li>matches 1:1 battle_results</li> </ul> <p>\u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> <ul> <li>FK ON DELETE CASCADE</li> <li>CHECK <code>score &gt;= 0</code>, <code>duration_seconds &gt;= 0</code>, <code>units_lost &gt;= 0</code>, <code>units_killed &gt;= 0</code></li> </ul>"},{"location":"practice/genre_adaptation.html#3-army_units","title":"3) <code>army_units</code> \u2014 \u0430\u0440\u043c\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f","text":"<p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f:</p> <ul> <li><code>id</code> INT PK AUTO_INCREMENT</li> <li><code>user_id</code> INT FK \u2192 users.id</li> <li><code>unit_code</code> VARCHAR(64) \u2014 \u0442\u0438\u043f \u044e\u043d\u0438\u0442\u0430 (<code>infantry</code>, <code>cavalry</code>, <code>archer</code>, <code>siege</code>)</li> <li><code>amount</code> INT \u2014 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e</li> <li><code>power</code> INT \u2014 \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u0430\u044f \u0431\u043e\u0435\u0432\u0430\u044f \u0441\u0438\u043b\u0430</li> </ul> <p>\u0421\u0432\u044f\u0437\u0438:</p> <ul> <li>users 1:M army_units</li> </ul> <p>\u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> <ul> <li>UNIQUE <code>(user_id, unit_code)</code></li> <li>INDEX <code>(user_id)</code></li> <li>CHECK <code>amount &gt;= 0</code>, <code>power &gt;= 0</code></li> </ul>"},{"location":"practice/genre_adaptation.html#4-city_buildings","title":"4) <code>city_buildings</code> \u2014 \u0437\u0434\u0430\u043d\u0438\u044f \u0433\u043e\u0440\u043e\u0434\u0430","text":"<p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f:</p> <ul> <li><code>id</code> INT PK AUTO_INCREMENT</li> <li><code>user_id</code> INT FK \u2192 users.id</li> <li><code>building_code</code> VARCHAR(64) \u2014 \u0442\u0438\u043f \u0437\u0434\u0430\u043d\u0438\u044f (<code>barracks</code>, <code>farm</code>, <code>forge</code>, <code>walls</code>)</li> <li><code>level</code> INT DEFAULT 1</li> <li><code>status</code> ENUM('idle','upgrading')</li> </ul> <p>\u0421\u0432\u044f\u0437\u0438:</p> <ul> <li>users 1:M city_buildings</li> </ul> <p>\u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> <ul> <li>UNIQUE <code>(user_id, building_code)</code></li> <li>INDEX <code>(user_id)</code></li> <li>CHECK <code>level &gt;= 1</code></li> </ul>"},{"location":"practice/genre_adaptation.html#5-processed_events","title":"5) <code>processed_events</code> \u2014 \u0440\u0435\u0435\u0441\u0442\u0440 \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u0438","text":"<p>\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f:</p> <ul> <li><code>id</code> BIGINT PK AUTO_INCREMENT</li> <li><code>user_id</code> INT FK \u2192 users.id</li> <li><code>event_id</code> VARCHAR(128) \u2014 UUID \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043e\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430</li> <li><code>event_type</code> VARCHAR(64)</li> <li><code>processed_at</code> DATETIME(3)</li> </ul> <p>\u0421\u0432\u044f\u0437\u0438:</p> <ul> <li>users 1:M processed_events</li> </ul> <p>\u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> <ul> <li>UNIQUE <code>(user_id, event_id)</code> \u2014 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 <code>event_id</code> \u2192 IntegrityError \u2192 <code>409 EVENT_REJECTED</code></li> <li>INDEX <code>(user_id)</code></li> </ul>"},{"location":"practice/genre_adaptation.html#333-6-payload","title":"3.3.3. \u0421\u043e\u0431\u044b\u0442\u0438\u044f \u0436\u0430\u043d\u0440\u0430 (6 \u0448\u0442.) + payload","text":"<p>\u0421\u043e\u0431\u044b\u0442\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0432 <code>game_events</code> \u0447\u0435\u0440\u0435\u0437 <code>insert_game_event()</code> \u0432 <code>events_repo.py</code>. <code>user_id</code> \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0435\u0440\u0451\u0442\u0441\u044f \u0438\u0437 JWT, \u043d\u0435 \u0438\u0437 \u0442\u0435\u043b\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430. \u041a\u0430\u0436\u0434\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 <code>processed_events</code> \u0447\u0435\u0440\u0435\u0437 <code>register_event_or_conflict()</code> \u0434\u043b\u044f \u0437\u0430\u0449\u0438\u0442\u044b \u043e\u0442 \u0434\u0443\u0431\u043b\u0435\u0439.</p>"},{"location":"practice/genre_adaptation.html#1-match_start","title":"1) <code>match_start</code>","text":"<pre><code>{\n  \"matchId\": 9,\n  \"mode\": \"pve\",\n  \"mapCode\": \"coastal_siege\",\n  \"season\": 1\n}\n</code></pre>"},{"location":"practice/genre_adaptation.html#2-unit_deploy","title":"2) <code>unit_deploy</code>","text":"<pre><code>{\n  \"matchId\": 9,\n  \"unitCode\": \"cavalry\",\n  \"amount\": 40,\n  \"atSecond\": 15\n}\n</code></pre>"},{"location":"practice/genre_adaptation.html#3-unit_retreat","title":"3) <code>unit_retreat</code>","text":"<pre><code>{\n  \"matchId\": 9,\n  \"unitCode\": \"infantry\",\n  \"lost\": 25,\n  \"atSecond\": 180\n}\n</code></pre>"},{"location":"practice/genre_adaptation.html#4-match_finish","title":"4) <code>match_finish</code>","text":"<pre><code>{\n  \"matchId\": 9,\n  \"isWin\": true,\n  \"score\": 1850,\n  \"durationSeconds\": 1200\n}\n</code></pre> <p>\u041a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0435\u0442 <code>xpGained</code> \u0438 <code>softCurrencyGained</code> \u2014 \u0441\u0435\u0440\u0432\u0435\u0440 \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0441\u0430\u043c.</p>"},{"location":"practice/genre_adaptation.html#5-building_upgrade_started","title":"5) <code>building_upgrade_started</code>","text":"<pre><code>{\n  \"buildingCode\": \"barracks\",\n  \"fromLevel\": 4,\n  \"toLevel\": 5,\n  \"goldCost\": 500\n}\n</code></pre>"},{"location":"practice/genre_adaptation.html#6-reward_granted","title":"6) <code>reward_granted</code>","text":"<pre><code>{\n  \"matchId\": 9,\n  \"xp\": 100,\n  \"softCurrency\": 50,\n  \"reason\": \"match_finish\"\n}\n</code></pre> <p>\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u043f\u0438\u0448\u0435\u0442\u0441\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u043a\u0430\u043a \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0430\u0441\u0447\u0451\u0442\u0430 \u0432 <code>match_service.py</code>, \u043d\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c.</p>"},{"location":"practice/genre_adaptation.html#34","title":"3.4. \u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435: \u0441\u0432\u044f\u0437\u043a\u0430 \u0441 \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c\u0438 \u044f\u0434\u0440\u0430","text":"<p>\u0412 <code>docs/03-genre.md</code> \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c, \u043a\u0430\u043a\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u044f\u0434\u0440\u0430 \u0437\u0430\u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0442\u0441\u044f:</p> <ul> <li>game_events \u2014 \u043b\u043e\u0433 \u0432\u0441\u0435\u0445 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439; \u043f\u0438\u0448\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>events_repo.py \u2192 insert_game_event()</code></li> <li>processed_events \u2014 \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u043f\u043e <code>(user_id, event_id)</code> \u0447\u0435\u0440\u0435\u0437 <code>dedupe_repo.py \u2192 register_event_or_conflict()</code></li> <li>player_progress \u2014 \u0438\u0442\u043e\u0433: xp/\u0432\u0430\u043b\u044e\u0442\u0430 (\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430 match_finish \u0447\u0435\u0440\u0435\u0437 <code>add_progress_rewards()</code>)</li> <li>leaderboard_scores \u2014 upsert \u0441 <code>GREATEST(score)</code> \u043f\u043e \u0434\u043e\u0441\u043a\u0435 <code>default</code>, \u0441\u0435\u0437\u043e\u043d <code>1</code> (\u0447\u0435\u0440\u0435\u0437 <code>upsert_leaderboard_score()</code>)</li> <li>statistics_daily \u2014 upsert \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u043e\u0432 (events_count, playtime_seconds, wins/losses, score_sum) \u0447\u0435\u0440\u0435\u0437 <code>upsert_daily_stats()</code></li> </ul> <p>\u042d\u0442\u043e \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u043c 2 (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445) \u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u043c 1 (\u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0443\u0440).</p>"},{"location":"practice/genre_adaptation.html#35-docs03-genremd","title":"3.5. \u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u0430\u0439\u043b\u0430 <code>docs/03-genre.md</code>","text":"<pre><code># 3) \u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f (\u0440\u0430\u0437\u0434\u0435\u043b 3)\n\n## 3.1. \u0416\u0430\u043d\u0440: &lt;\u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0436\u0430\u043d\u0440&gt;\n\n## 3.2. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\n- \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430: &lt;match/run/episode/cycle&gt;\n- \u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: &lt;1\u20132 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f&gt;\n- \u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 endpoint(\u044b): &lt;\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2\u20133&gt;\n- \u0427\u0442\u043e \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u0441\u0442\u0438\u043d\u043e\u0439 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435: &lt;\u0447\u0442\u043e \u043a\u043b\u0438\u0435\u043d\u0442 \u041d\u0415 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u0441\u044b\u043b\u0430\u0442\u044c \u043a\u0430\u043a \"\u0433\u043e\u0442\u043e\u0432\u043e\u0435\"&gt;\n\n## 3.3. \u0416\u0430\u043d\u0440\u043e\u0432\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (3\u20135)\n\n### 1) &lt;table_1&gt; (\u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430)\n- PK: &lt;\u0442\u0438\u043f + \u043f\u043e\u043b\u0435&gt;\n- \u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f (5\u20138): ...\n- FK: ...\n- \u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438: ...\n- CHECK/\u043f\u0440\u0430\u0432\u0438\u043b\u0430: ...\n\n### 2) &lt;table_2&gt;\n- PK: ...\n- \u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f (5\u20138): ...\n- FK: ...\n- \u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438: ...\n- CHECK/\u043f\u0440\u0430\u0432\u0438\u043b\u0430: ...\n\n### 3) &lt;table_3&gt;\n- PK: ...\n- \u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043b\u044f (5\u20138): ...\n- FK: ...\n- \u0418\u043d\u0434\u0435\u043a\u0441\u044b/\u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438: ...\n- CHECK/\u043f\u0440\u0430\u0432\u0438\u043b\u0430: ...\n\n(\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e 5 \u0442\u0430\u0431\u043b\u0438\u0446)\n\n## 3.4. \u0421\u043e\u0431\u044b\u0442\u0438\u044f (6 event_type) + payload\n&gt; \u0421\u043e\u0431\u044b\u0442\u0438\u044f \u043f\u0438\u0448\u0443\u0442\u0441\u044f \u0432 game_events (event_type + payload_json).\n&gt; \u0412 payload \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (matchId/runId/episodeId/cycleId).\n\n1) event_type: `&lt;...&gt;` \u2014 &lt;\u0441\u043c\u044b\u0441\u043b&gt;\n```json\n{ ... }\n```\n\n2) event_type: `&lt;...&gt;` \u2014 &lt;\u0441\u043c\u044b\u0441\u043b&gt;\n```json\n{ ... }\n```\n\n3) event_type: `&lt;...&gt;` \u2014 &lt;\u0441\u043c\u044b\u0441\u043b&gt;\n```json\n{ ... }\n```\n\n4) event_type: `&lt;...&gt;` \u2014 &lt;\u0441\u043c\u044b\u0441\u043b&gt;\n```json\n{ ... }\n```\n\n5) event_type: `&lt;...&gt;` \u2014 &lt;\u0441\u043c\u044b\u0441\u043b&gt;\n```json\n{ ... }\n```\n\n6) event_type: `&lt;...&gt;` \u2014 &lt;\u0441\u043c\u044b\u0441\u043b&gt;\n```json\n{ ... }\n```\n\n## 3.5. \u0421\u0432\u044f\u0437\u043a\u0430 \u0441 \u044f\u0434\u0440\u043e\u043c (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e)\n- \u041a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0438\u0448\u0443\u0442\u0441\u044f \u0432 player_progress \u043f\u0440\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:\n  - xp: ...\n  - soft_currency: ...\n  - hard_currency: ...\n- \u041a\u0430\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f leaderboard_scores:\n  - board_code: ...\n  - season: ...\n  - score: ...\n- \u041a\u0430\u043a\u0438\u0435 \u043f\u043e\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0432 statistics_daily:\n  - sessions_count/events_count/playtime_seconds/wins/losses/score_sum: ...\n\n## 3.6. \u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \"\u0438\u0442\u043e\u0433 \u2192 \u043d\u0430\u0433\u0440\u0430\u0434\u0430 \u2192 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u2192 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\"\n\u041e\u043f\u0438\u0448\u0438\u0442\u0435 3\u20136 \u0441\u0442\u0440\u043e\u043a\u0430\u043c\u0438, \u0447\u0442\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u043e \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043f\u0440\u0438 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.\n</code></pre>"},{"location":"practice/universal_data_model.html","title":"\u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445","text":""},{"location":"practice/universal_data_model.html#2","title":"2. \u041f\u0440\u0430\u043a\u0442\u0438\u043a\u0430. \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445","text":""},{"location":"practice/universal_data_model.html#21-2","title":"2.1. \u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0443 2 \u00ab\u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445\u00bb","text":""},{"location":"practice/universal_data_model.html#_1","title":"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c","text":"<ol> <li>\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u044c \u044f\u0434\u0440\u043e ER-\u043c\u043e\u0434\u0435\u043b\u0438 (\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0435\u0439 \u0438 \u0441\u0432\u044f\u0437\u0435\u0439).</li> <li>\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u044c DDL MySQL 8.0 \u0434\u043b\u044f \u044f\u0434\u0440\u0430 (PK/FK/UNIQUE/CHECK, <code>game_events.payload_json</code> = <code>JSON</code>).</li> <li>\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u0432 \u0444\u0430\u0439\u043b\u0430\u0445:</li> </ol> <pre><code>db/schema.sql\ndocs/02-data-model.md\n</code></pre>"},{"location":"practice/universal_data_model.html#211-er","title":"2.1.1. \u042f\u0434\u0440\u043e ER (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438)","text":"<p>\u0421\u0434\u0430\u0442\u044c \u044f\u0434\u0440\u043e (\u043c\u043e\u0436\u043d\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c):</p> <ul> <li><code>Users</code></li> <li><code>Roles</code></li> <li><code>UserRoles</code></li> <li><code>GameSessions</code></li> <li><code>GameEvents</code></li> <li><code>PlayerProgress</code></li> <li><code>StatisticsDaily</code></li> <li><code>LeaderboardScores</code></li> </ul>"},{"location":"practice/universal_data_model.html#212-ddl-mysql","title":"2.1.2. DDL MySQL (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f)","text":"<p>DDL \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c:</p> <ul> <li>PK \u0443 \u043a\u0430\u0436\u0434\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b</li> <li>FK \u0441\u0432\u044f\u0437\u0438 (users \u2192 sessions/events/progress/stats/leaderboard)</li> <li> <p>UNIQUE \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f:</p> </li> <li> <p><code>users.email</code></p> </li> <li><code>roles.name</code></li> <li><code>statistics_daily (user_id, day)</code></li> <li><code>leaderboard_scores (user_id, board_code, season)</code></li> <li>CHECK \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e: \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043d\u0435 \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435, level &gt;= 1, season &gt;= 1)</li> <li><code>game_events.payload_json</code> \u0442\u0438\u043f\u0430 <code>JSON</code></li> </ul>"},{"location":"practice/universal_data_model.html#213","title":"2.1.3. \u041c\u0435\u0442\u043e\u0434\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 (\u0447\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0432\u044b \u0441\u0434\u0430\u0451\u0442\u0435 \u0438 \u043a\u0430\u043a \u044d\u0442\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c)","text":"<p>\u0427\u0442\u043e \u0441\u0434\u0430\u0451\u0442\u0441\u044f \"\u043f\u043e \u043c\u0438\u043d\u0438\u043c\u0443\u043c\u0443\" \u043d\u0430 \u044d\u0442\u043e\u043c \u044d\u0442\u0430\u043f\u0435:</p> <ul> <li>\u043d\u0435 \"\u0432\u0441\u044f \u0431\u0430\u0437\u0430 \u0438\u0433\u0440\u044b\", \u0430 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e\u0435 \u044f\u0434\u0440\u043e, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u0434\u043b\u044f \u043b\u044e\u0431\u043e\u0433\u043e \u0436\u0430\u043d\u0440\u0430;</li> <li> <p>\u044f\u0434\u0440\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0443\u043c\u0435\u0442\u044c:</p> </li> <li> <p>\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0438 \u0440\u043e\u043b\u0438,</p> </li> <li>\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u0438,</li> <li>\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f (telemetry / audit / gameplay),</li> <li>\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441,</li> <li>\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u043f\u043e \u0434\u043d\u044f\u043c,</li> <li>\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438.</li> </ul> <p>\u041a\u0430\u043a \u0434\u0435\u043b\u0430\u0442\u044c ER-\u044f\u0434\u0440\u043e \u0431\u044b\u0441\u0442\u0440\u043e:</p> <ol> <li>\u0412\u044b\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445.</li> <li>\u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \"\u0437\u0430\u0447\u0435\u043c \u043e\u043d\u0430 \u043d\u0443\u0436\u043d\u0430\" (1 \u0441\u0442\u0440\u043e\u043a\u0430).</li> <li>\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0441\u0432\u044f\u0437\u0438 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 1:1 / 1:M / M:N.</li> <li>\u041e\u0442\u043c\u0435\u0442\u044c\u0442\u0435 \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 (\u0434\u0435\u043d\u044c, \u0441\u0435\u0437\u043e\u043d, \u0434\u043e\u0441\u043a\u0430).</li> </ol> <p>\u041a\u0430\u043a \u0434\u0435\u043b\u0430\u0442\u044c DDL \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e:</p> <ul> <li>\u043d\u0430\u0447\u0438\u043d\u0430\u0439\u0442\u0435 \u0441 <code>roles</code>, \u0437\u0430\u0442\u0435\u043c <code>users</code>, \u0437\u0430\u0442\u0435\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0441\u043e \u0441\u0441\u044b\u043b\u043a\u0430\u043c\u0438;</li> <li>\u0434\u043b\u044f \u0441\u0432\u044f\u0437\u0435\u0439 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 <code>ON DELETE CASCADE</code> \u0442\u0430\u043c, \u0433\u0434\u0435 \u0431\u0435\u0437 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u0438\u043c\u0435\u044e\u0442 \u0441\u043c\u044b\u0441\u043b\u0430;</li> <li><code>payload_json</code> \u0434\u0435\u043b\u0430\u0439\u0442\u0435 <code>JSON NOT NULL</code> (\u044d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e \u0434\u043b\u044f \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438);</li> <li>\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 <code>INDEX</code> \u043d\u0430 \u0442\u0438\u043f\u043e\u0432\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b: (user_id, created_at), (board_code, season, score) \u0438 \u0442.\u0434.;</li> <li>CHECK \u0432 MySQL 8 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442, \u043d\u043e \u0432\u0430\u0436\u043d\u043e \u0437\u0430\u0434\u0430\u0432\u0430\u0442\u044c \u0440\u0435\u0430\u043b\u0438\u0441\u0442\u0438\u0447\u043d\u044b\u0435 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f (\u043d\u0435\u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435, level&gt;=1).</li> </ul> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435: \u043f\u043e\u043b\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 <code>users</code> \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f <code>password</code> \u0438 \u0445\u0440\u0430\u043d\u0438\u0442 bcrypt-\u0445\u044d\u0448 (\u043d\u0435 plaintext). \u042d\u0442\u043e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0432 <code>auth_service.py</code>, \u0433\u0434\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f <code>bcrypt.hashpw()</code> / <code>bcrypt.checkpw()</code>.</p>"},{"location":"practice/universal_data_model.html#214","title":"2.1.4. \u041d\u0430 \u0447\u0442\u043e \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u044c \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043f\u0440\u0438 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u043f\u043e\u0434 \u0441\u0432\u043e\u044e \u0438\u0433\u0440\u0443","text":"<p>1) \u041d\u0435 \"\u043b\u043e\u043c\u0430\u0439\u0442\u0435 \u044f\u0434\u0440\u043e\" \u0434\u043e\u043c\u0435\u043d\u043d\u044b\u043c\u0438 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044f\u043c\u0438. \u0414\u043e\u043c\u0435\u043d\u043d\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 <code>matches</code>, <code>army_units</code>, <code>city_buildings</code>) \u0438\u0434\u0443\u0442 \u043f\u043e\u0437\u0436\u0435 \u043a\u0430\u043a \u0436\u0430\u043d\u0440\u043e\u0432\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 (\u0440\u0430\u0437\u0434\u0435\u043b 3). \u0421\u0435\u0439\u0447\u0430\u0441 \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u044f\u0434\u0440\u043e.</p> <p>2) \u0421\u043e\u0431\u044b\u0442\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u043e\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0436\u0430\u043d\u0440\u043e\u0432\u0443\u044e \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0443 \u0447\u0435\u0440\u0435\u0437 JSON. \u0412 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438 \u0432\u044b \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u043d\u044b \u0434\u0435\u043b\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \"\u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e\" \u043d\u0430 \u044d\u0442\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u2014 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435:</p> <ul> <li><code>event_type = 'building_upgrade_started'</code></li> <li><code>payload_json = { \"buildingCode\": \"barracks\", \"fromLevel\": 4, \"toLevel\": 5, \"goldCost\": 500 }</code></li> </ul> <p>3) \u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u043c, \u043d\u043e \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u043c. \u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0432 \u0438\u0433\u0440\u0435 \u043d\u0435\u0442 \"level\", \u043e\u043d \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u0440\u0430\u0436\u0430\u0442\u044c \"tier/league/rank\" \u0438\u043b\u0438 \"stage\".</p> <p>4) LeaderboardScores \u2014 \u044d\u0442\u043e \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e PvP. \u041f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u0438 \u0434\u043b\u044f:</p> <ul> <li>\"\u043c\u0430\u043a\u0441. \u0432\u043e\u043b\u043d\u0430\", \"\u043c\u0430\u043a\u0441. \u043e\u0447\u043a\u0438\", \"\u0432\u0440\u0435\u043c\u044f\", \"\u0434\u043e\u0445\u043e\u0434/\u0447\u0430\u0441\", \"\u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c\".</li> <li>\u0432 \u043f\u0440\u043e\u0435\u043a\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043e\u0441\u043a\u0438 <code>default</code> \u0438 <code>pvp</code> (\u0441\u043c. <code>seed.sql</code>).</li> </ul> <p>5) StatisticsDaily \u2014 \u044d\u0442\u043e \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b, \u0430 \u043d\u0435 \u0441\u044b\u0440\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f. \u0421\u044b\u0440\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u2014 <code>game_events</code>. \u0410\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u2014 \u0437\u0430\u0440\u0430\u043d\u0435\u0435 \u043f\u043e\u0434\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435 \u0438\u0442\u043e\u0433\u0438 (\u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u044b\u0445 \u043e\u0442\u0447\u0451\u0442\u043e\u0432).</p>"},{"location":"practice/universal_data_model.html#22-flask","title":"2.2. \u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f \u043a \u043f\u0440\u043e\u0435\u043a\u0442\u0443 (Flask)","text":""},{"location":"practice/universal_data_model.html#_2","title":"\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u0441\u0442\u0435\u043a","text":"<ul> <li>\u042f\u0437\u044b\u043a: Python 3.10+</li> <li>Web-\u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a: Flask</li> <li>\u0411\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445: MySQL 8.0</li> <li>ORM (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f): SQLAlchemy</li> <li>\u041c\u0438\u0433\u0440\u0430\u0446\u0438\u0438 (\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f): Flask-Migrate</li> <li>\u0410\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f: JWT (<code>flask-jwt-extended</code>)</li> <li>\u0425\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u0435\u0439: bcrypt</li> <li>\u0424\u043e\u0440\u043c\u0430\u0442 \u043e\u0431\u043c\u0435\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u043c\u0438: JSON</li> <li>\u041f\u0440\u043e\u0442\u043e\u043a\u043e\u043b: HTTPS</li> </ul>"},{"location":"practice/universal_data_model.html#_3","title":"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (\u0434\u043e\u0440\u0430\u0431\u043e\u0442\u043a\u0430)","text":"<pre><code>project-root/\n\u2502\n\u251c\u2500\u2500 db/\n\u2502   \u2514\u2500\u2500 schema.sql\n\u2502\n\u251c\u2500\u2500 docs/\n\u2502   \u2514\u2500\u2500 02-data-model.md\n\u2502\n\u251c\u2500\u2500 app/               (\u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u0430)\n\u2502   \u2514\u2500\u2500 config.py      \u2190 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u0437\u0434\u0435\u0441\u044c, \u043d\u0435 \u0432 \u043a\u043e\u0440\u043d\u0435\n\u2514\u2500\u2500 wsgi.py            \u2190 \u0442\u043e\u0447\u043a\u0430 \u0432\u0445\u043e\u0434\u0430\n</code></pre>"},{"location":"practice/universal_data_model.html#_4","title":"\u041a\u0430\u043a \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b","text":"<ol> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u043f\u043a\u0443 <code>db</code></li> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b <code>db/schema.sql</code></li> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u043f\u043a\u0443 <code>docs</code></li> <li>\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0444\u0430\u0439\u043b <code>docs/02-data-model.md</code></li> <li>\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432 \u0444\u0430\u0439\u043b\u044b: \u043f\u0435\u0440\u0435\u0447\u0435\u043d\u044c \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0435\u0439/\u0441\u0432\u044f\u0437\u0435\u0439 \u0438 DDL</li> </ol>"},{"location":"practice/universal_data_model.html#23","title":"2.3. \u041f\u0440\u0438\u043c\u0435\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (\u044f\u0434\u0440\u043e \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u043e\u0434\u0435\u043b\u0438)","text":""},{"location":"practice/universal_data_model.html#231-docs02-data-modelmd","title":"2.3.1. \u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e <code>docs/02-data-model.md</code>","text":"<pre><code># 2) \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445 (\u044f\u0434\u0440\u043e)\n\n## \u0421\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u044f\u0434\u0440\u0430\n- users \u2014 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u044b \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 (email UNIQUE, password \u2014 bcrypt-\u0445\u044d\u0448)\n- roles \u2014 \u0440\u043e\u043b\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 (player/moderator/admin)\n- user_roles \u2014 \u0441\u0432\u044f\u0437\u044c users \u0438 roles (M:N)\n- game_sessions \u2014 \u0441\u0435\u0441\u0441\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (\u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430, IP, \u0432\u0440\u0435\u043c\u044f)\n- game_events \u2014 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (payload \u0432 JSON NOT NULL)\n- player_progress \u2014 \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n- statistics_daily \u2014 \u0434\u043d\u0435\u0432\u043d\u044b\u0435 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b\n- leaderboard_scores \u2014 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438 \u043f\u043e \u0434\u043e\u0441\u043a\u0430\u043c \u0438 \u0441\u0435\u0437\u043e\u043d\u0430\u043c\n\n## \u0421\u0432\u044f\u0437\u0438\n- users 1:M user_roles, roles 1:M user_roles\n- users 1:M game_sessions\n- users 1:M game_events\n- game_sessions 1:M game_events (\u0447\u0435\u0440\u0435\u0437 session_id, \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c NULL)\n- users 1:1 player_progress\n- users 1:M statistics_daily (UNIQUE(user_id, day))\n- users 1:M leaderboard_scores (UNIQUE(user_id, board_code, season))\n</code></pre>"},{"location":"practice/universal_data_model.html#232-dbschemasql-mysql-80","title":"2.3.2. \u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e <code>db/schema.sql</code> (MySQL 8.0)","text":"<pre><code>-- MySQL 8.0+\n-- ENGINE=InnoDB, CHARSET=utf8mb4, COLLATION=utf8mb4_0900_ai_ci\n\nCREATE TABLE roles (\n  id   INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(32) NOT NULL UNIQUE\n) ENGINE=InnoDB;\n\nCREATE TABLE users (\n  id            INT AUTO_INCREMENT PRIMARY KEY,\n  email         VARCHAR(255) NOT NULL UNIQUE,\n  password      VARCHAR(255) NOT NULL,      -- bcrypt-\u0445\u044d\u0448\n  nickname      VARCHAR(64)  NOT NULL,\n  created_at    DATETIME(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  last_login_at DATETIME(3)  NULL,\n  is_banned     TINYINT(1)   NOT NULL DEFAULT 0\n) ENGINE=InnoDB;\n\nCREATE TABLE user_roles (\n  user_id     INT NOT NULL,\n  role_id     INT NOT NULL,\n  assigned_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  PRIMARY KEY (user_id, role_id),\n  CONSTRAINT fk_user_roles_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT fk_user_roles_role FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE RESTRICT,\n  INDEX idx_user_roles_role_id (role_id)\n) ENGINE=InnoDB;\n\nCREATE TABLE game_sessions (\n  id              INT AUTO_INCREMENT PRIMARY KEY,\n  user_id         INT NOT NULL,\n  client_platform ENUM('unity','web','mobile') NOT NULL,\n  client_version  VARCHAR(32) NULL,\n  ip              VARCHAR(45) NULL,\n  started_at      DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  ended_at        DATETIME(3) NULL,\n  CONSTRAINT fk_sessions_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  INDEX idx_sessions_user_started (user_id, started_at)\n) ENGINE=InnoDB;\n\nCREATE TABLE game_events (\n  id           BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id      INT NOT NULL,\n  session_id   INT NULL,\n  event_type   VARCHAR(64) NOT NULL,\n  payload_json JSON NOT NULL,\n  created_at   DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_events_user    FOREIGN KEY (user_id)    REFERENCES users(id)         ON DELETE CASCADE,\n  CONSTRAINT fk_events_session FOREIGN KEY (session_id) REFERENCES game_sessions(id) ON DELETE SET NULL,\n\n  INDEX idx_events_user_time (user_id, created_at),\n  INDEX idx_events_type_time (event_type, created_at)\n) ENGINE=InnoDB;\n\nCREATE TABLE player_progress (\n  user_id        INT PRIMARY KEY,\n  level          INT NOT NULL DEFAULT 1,\n  xp             INT NOT NULL DEFAULT 0,\n  soft_currency  INT NOT NULL DEFAULT 0,\n  hard_currency  INT NOT NULL DEFAULT 0,\n  updated_at     DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_progress_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT chk_level CHECK (level &gt;= 1),\n  CONSTRAINT chk_xp    CHECK (xp &gt;= 0),\n  CONSTRAINT chk_soft  CHECK (soft_currency &gt;= 0),\n  CONSTRAINT chk_hard  CHECK (hard_currency &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE statistics_daily (\n  id               INT AUTO_INCREMENT PRIMARY KEY,\n  user_id          INT NOT NULL,\n  day              DATE NOT NULL,\n  sessions_count   INT NOT NULL DEFAULT 0,\n  events_count     INT NOT NULL DEFAULT 0,\n  playtime_seconds INT NOT NULL DEFAULT 0,\n  wins             INT NOT NULL DEFAULT 0,\n  losses           INT NOT NULL DEFAULT 0,\n  score_sum        INT NOT NULL DEFAULT 0,\n\n  CONSTRAINT fk_stats_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_stats_user_day (user_id, day),\n  INDEX idx_stats_day (day),\n\n  CONSTRAINT chk_sessions_count CHECK (sessions_count &gt;= 0),\n  CONSTRAINT chk_events_count   CHECK (events_count &gt;= 0),\n  CONSTRAINT chk_playtime       CHECK (playtime_seconds &gt;= 0),\n  CONSTRAINT chk_wins           CHECK (wins &gt;= 0),\n  CONSTRAINT chk_losses         CHECK (losses &gt;= 0),\n  CONSTRAINT chk_score_sum      CHECK (score_sum &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE leaderboard_scores (\n  id         INT AUTO_INCREMENT PRIMARY KEY,\n  user_id    INT NOT NULL,\n  board_code VARCHAR(64) NOT NULL,\n  season     INT NOT NULL DEFAULT 1,\n  score      INT NOT NULL DEFAULT 0,\n  updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_lb_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_lb_user_board_season (user_id, board_code, season),\n  INDEX idx_lb_board_season_score (board_code, season, score),\n\n  CONSTRAINT chk_season CHECK (season &gt;= 1),\n  CONSTRAINT chk_score  CHECK (score &gt;= 0)\n) ENGINE=InnoDB;\n</code></pre>"},{"location":"practice/universal_data_model.html#24","title":"2.4. \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430, \u0447\u0442\u043e \u0441\u0445\u0435\u043c\u0430 \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f)","text":""},{"location":"practice/universal_data_model.html#241","title":"2.4.1. \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u043e\u043b\u0438","text":"<pre><code>INSERT INTO roles (name) VALUES ('player'), ('moderator'), ('admin');\n</code></pre>"},{"location":"practice/universal_data_model.html#242","title":"2.4.2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f","text":"<p>\u041f\u043e\u043b\u0435 <code>password</code> \u0445\u0440\u0430\u043d\u0438\u0442 bcrypt-\u0445\u044d\u0448. \u0412 <code>seed.sql</code> \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0445\u044d\u0448 \u0441\u0442\u0440\u043e\u043a\u0438 <code>\"password123\"</code>.</p> <pre><code>INSERT INTO users (email, password, nickname)\nVALUES ('p1@example.com', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj6hsxq5/Qe2', 'PlayerOne');\n</code></pre>"},{"location":"practice/universal_data_model.html#243","title":"2.4.3. \u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0440\u043e\u043b\u044c \u0438\u0433\u0440\u043e\u043a\u0443","text":"<pre><code>INSERT INTO user_roles (user_id, role_id)\nSELECT u.id, r.id\nFROM users u, roles r\nWHERE u.email='p1@example.com' AND r.name='player';\n</code></pre>"},{"location":"practice/universal_data_model.html#244-progress","title":"2.4.4. \u0421\u043e\u0437\u0434\u0430\u0442\u044c progress","text":"<pre><code>INSERT IGNORE INTO player_progress (user_id)\nSELECT id FROM users WHERE email='p1@example.com';\n</code></pre>"},{"location":"practice/universal_data_model.html#245","title":"2.4.5. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e","text":"<pre><code>INSERT INTO game_sessions (user_id, client_platform, client_version, ip)\nSELECT id, 'unity', '1.2.0', '127.0.0.1'\nFROM users WHERE email='p1@example.com';\n</code></pre>"},{"location":"practice/universal_data_model.html#246","title":"2.4.6. \u0417\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435","text":"<pre><code>INSERT INTO game_events (user_id, session_id, event_type, payload_json)\nSELECT\n  u.id,\n  s.id,\n  'match_finish',\n  JSON_OBJECT('matchId', 9, 'score', 1850, 'durationSeconds', 1200, 'isWin', true)\nFROM users u\nJOIN game_sessions s ON s.user_id = u.id\nWHERE u.email='p1@example.com'\nORDER BY s.id DESC\nLIMIT 1;\n</code></pre>"},{"location":"practice/universal_data_model.html#25-servicedesk","title":"2.5. \u041f\u0440\u0438\u043c\u0435\u0440 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u043f\u043e\u0434 \u0434\u0440\u0443\u0433\u0443\u044e \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043d\u0443\u044e \u043e\u0431\u043b\u0430\u0441\u0442\u044c (ServiceDesk)","text":""},{"location":"practice/universal_data_model.html#_5","title":"\u0427\u0442\u043e \u043e\u0441\u0442\u0430\u0451\u0442\u0441\u044f \u0431\u0435\u0437 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 (\u044f\u0434\u0440\u043e)","text":"<ul> <li><code>users</code>, <code>roles</code>, <code>user_roles</code></li> <li><code>game_sessions</code> (\u0442\u0440\u0430\u043a\u0442\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a web-\u0441\u0435\u0441\u0441\u0438\u0438)</li> <li><code>game_events</code> (\u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0432 \u0434\u043e\u043c\u0435\u043d\u0435 \u0437\u0430\u044f\u0432\u043e\u043a)</li> <li><code>statistics_daily</code> (\u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u0438)</li> <li><code>leaderboard_scores</code> (\u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438/\u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c)</li> </ul>"},{"location":"practice/universal_data_model.html#payload_json","title":"\u041a\u0430\u043a \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0434\u043e\u043c\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0432 <code>payload_json</code>","text":"<p><code>event_type = 'ticket_status_changed'</code></p> <pre><code>{\n  \"ticketId\": 501,\n  \"fromStatus\": \"new\",\n  \"toStatus\": \"in_progress\",\n  \"priority\": \"high\"\n}\n</code></pre>"},{"location":"practice/universal_data_model.html#26-docs02-data-modelmd","title":"2.6. \u041f\u0443\u0441\u0442\u043e\u0439 \u0448\u0430\u0431\u043b\u043e\u043d <code>docs/02-data-model.md</code> \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u043c","text":"<pre><code># 2) \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445 (\u044f\u0434\u0440\u043e)\n\n## 1. \u0421\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u044f\u0434\u0440\u0430 (\u043e\u043f\u0438\u0441\u0430\u0442\u044c \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u0430\u0436\u0434\u043e\u0439)\n- users \u2014\n- roles \u2014\n- user_roles \u2014\n- game_sessions \u2014\n- game_events \u2014\n- player_progress \u2014\n- statistics_daily \u2014\n- leaderboard_scores \u2014\n\n## 2. \u0421\u0432\u044f\u0437\u0438 (\u043a\u0430\u0440\u0434\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438)\n- users 1:M ...\n- roles 1:M ...\n- users 1:1 ...\n- users 1:M ...\n- game_sessions 1:M ...\n\n## 3. \u0423\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 (UNIQUE)\n- users(email)\n- roles(name)\n- statistics_daily(user_id, day)\n- leaderboard_scores(user_id, board_code, season)\n\n## 4. CHECK \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e)\n- level &gt;= 1\n- season &gt;= 1\n- \u0432\u0441\u0435 \u0441\u0447\u0451\u0442\u0447\u0438\u043a\u0438/\u0432\u0430\u043b\u044e\u0442\u044b &gt;= 0\n\n## 5. \u041f\u0440\u0438\u043c\u0435\u0440\u044b \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0434\u043b\u044f \u0432\u0430\u0448\u0435\u0433\u043e \u0436\u0430\u043d\u0440\u0430 (event_type + payload_json)\n1) event_type =\n   payload_json =\n2) event_type =\n   payload_json =\n3) event_type =\n   payload_json =\n</code></pre>"},{"location":"practice/universal_data_model.html#27-dbschemasql","title":"2.7. \u041f\u0443\u0441\u0442\u043e\u0439 \u0448\u0430\u0431\u043b\u043e\u043d <code>db/schema.sql</code> (\u043a\u0430\u0440\u043a\u0430\u0441, \u0431\u0435\u0437 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439)","text":"<p>\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435: \u044d\u0442\u043e \u043a\u0430\u0440\u043a\u0430\u0441 \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f. \u041f\u0440\u0438 \u0441\u0434\u0430\u0447\u0435 \u043e\u043d \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c PK/FK/UNIQUE/CHECK \u0438 JSON. \u041f\u043e\u043b\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f <code>password</code> (\u0445\u0440\u0430\u043d\u0438\u0442 bcrypt-\u0445\u044d\u0448).</p> <pre><code>-- MySQL 8.0+\n-- ENGINE=InnoDB, CHARSET=utf8mb4, COLLATION=utf8mb4_0900_ai_ci\n\nCREATE TABLE roles (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(32) NOT NULL UNIQUE\n) ENGINE=InnoDB;\n\nCREATE TABLE users (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  email VARCHAR(255) NOT NULL UNIQUE,\n  password VARCHAR(255) NOT NULL,   -- bcrypt-\u0445\u044d\u0448\n  nickname VARCHAR(64) NOT NULL,\n  created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  last_login_at DATETIME(3) NULL,\n  is_banned TINYINT(1) NOT NULL DEFAULT 0\n) ENGINE=InnoDB;\n\nCREATE TABLE user_roles (\n  user_id INT NOT NULL,\n  role_id INT NOT NULL,\n  assigned_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  PRIMARY KEY (user_id, role_id),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE RESTRICT\n) ENGINE=InnoDB;\n\nCREATE TABLE game_sessions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  client_platform ENUM('unity','web','mobile') NOT NULL,\n  client_version VARCHAR(32) NULL,\n  ip VARCHAR(45) NULL,\n  started_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  ended_at DATETIME(3) NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n) ENGINE=InnoDB;\n\nCREATE TABLE game_events (\n  id BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  session_id INT NULL,\n  event_type VARCHAR(64) NOT NULL,\n  payload_json JSON NOT NULL,\n  created_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  FOREIGN KEY (user_id)    REFERENCES users(id)         ON DELETE CASCADE,\n  FOREIGN KEY (session_id) REFERENCES game_sessions(id) ON DELETE SET NULL\n) ENGINE=InnoDB;\n\nCREATE TABLE player_progress (\n  user_id INT PRIMARY KEY,\n  level INT NOT NULL DEFAULT 1,\n  xp INT NOT NULL DEFAULT 0,\n  soft_currency INT NOT NULL DEFAULT 0,\n  hard_currency INT NOT NULL DEFAULT 0,\n  updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT chk_level CHECK (level &gt;= 1),\n  CONSTRAINT chk_xp    CHECK (xp &gt;= 0),\n  CONSTRAINT chk_soft  CHECK (soft_currency &gt;= 0),\n  CONSTRAINT chk_hard  CHECK (hard_currency &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE statistics_daily (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  day DATE NOT NULL,\n  sessions_count INT NOT NULL DEFAULT 0,\n  events_count INT NOT NULL DEFAULT 0,\n  playtime_seconds INT NOT NULL DEFAULT 0,\n  wins INT NOT NULL DEFAULT 0,\n  losses INT NOT NULL DEFAULT 0,\n  score_sum INT NOT NULL DEFAULT 0,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_stats_user_day (user_id, day),\n  CONSTRAINT chk_sessions_count CHECK (sessions_count &gt;= 0),\n  CONSTRAINT chk_events_count   CHECK (events_count &gt;= 0),\n  CONSTRAINT chk_playtime       CHECK (playtime_seconds &gt;= 0),\n  CONSTRAINT chk_wins           CHECK (wins &gt;= 0),\n  CONSTRAINT chk_losses         CHECK (losses &gt;= 0),\n  CONSTRAINT chk_score_sum      CHECK (score_sum &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE leaderboard_scores (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  board_code VARCHAR(64) NOT NULL,\n  season INT NOT NULL DEFAULT 1,\n  score INT NOT NULL DEFAULT 0,\n  updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_lb_user_board_season (user_id, board_code, season),\n  CONSTRAINT chk_season CHECK (season &gt;= 1),\n  CONSTRAINT chk_score  CHECK (score &gt;= 0)\n) ENGINE=InnoDB;\n</code></pre>"},{"location":"theory/api_design.html","title":"API \u0434\u0438\u0437\u0430\u0439\u043d","text":""},{"location":"theory/api_design.html#1-5-api","title":"1. \u0422\u0435\u043e\u0440\u0438\u044f. 5. API \u0434\u0438\u0437\u0430\u0439\u043d \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":"<p>\u0426\u0435\u043b\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u2014 \u043d\u0430\u0443\u0447\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c API \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043e\u043d\u043e:</p> <ul> <li>\u0431\u044b\u043b\u043e \u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u044b\u043c \u0434\u043b\u044f Unity/Web/Mobile;</li> <li>\u0440\u0430\u0431\u043e\u0442\u0430\u043b\u043e \u043a\u0430\u043a stateless REST (\u0431\u0435\u0437 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0445 \u0441\u0435\u0441\u0441\u0438\u0439);</li> <li>\u0431\u044b\u043b\u043e \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u043c (JWT + RBAC + \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f);</li> <li>\u0431\u044b\u043b\u043e \u0443\u0434\u043e\u0431\u043d\u044b\u043c \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (Postman/Swagger);</li> <li>\u0438\u043c\u0435\u043b\u043e \u0435\u0434\u0438\u043d\u044b\u0435 \u043e\u0442\u0432\u0435\u0442\u044b \u0438 \u043e\u0448\u0438\u0431\u043a\u0438 (\u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442).</li> </ul>"},{"location":"theory/api_design.html#51-rest","title":"5.1. \u041f\u0440\u0438\u043d\u0446\u0438\u043f\u044b REST (\u0447\u0442\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043e\u0431\u044f\u0437\u0430\u043d \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u0442\u044c)","text":""},{"location":"theory/api_design.html#511-resource-first","title":"5.1.1. \u0420\u0435\u0441\u0443\u0440\u0441\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434 (\u043f\u043e\u0447\u0435\u043c\u0443 \u201cresource-first\u201d)","text":"<p>REST \u2014 \u044d\u0442\u043e \u043f\u0440\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u044b (\u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u0438\u0445 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f), \u0430 \u043d\u0435 \u043f\u0440\u043e \u201c\u043a\u043e\u043c\u0430\u043d\u0434\u044b\u201d.</p> <ul> <li>\u043f\u043b\u043e\u0445\u043e: <code>/doLogin</code>, <code>/updateProgressNow</code>, <code>/sendEventCommand</code></li> <li>\u0445\u043e\u0440\u043e\u0448\u043e: <code>/auth/login</code>, <code>/progress</code>, <code>/events</code></li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e (\u0438\u043d\u0436\u0435\u043d\u0435\u0440\u043d\u043e):</p> <ol> <li> <p>\u041f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u043e\u0441\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0443    Unity/Web/Mobile \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u043c \u0432\u0430\u0436\u043d\u043e \u201c\u0443\u0433\u0430\u0434\u044b\u0432\u0430\u0442\u044c\u201d API:    \u0435\u0441\u043b\u0438 \u0432\u0441\u0451 \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u043e \u043a\u0430\u043a \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u2014 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u0431\u044b\u0441\u0442\u0440\u043e \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u043d\u0443\u0436\u043d\u044b\u0439 endpoint.</p> </li> <li> <p>\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0438 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0449\u0435    Swagger/OpenAPI \u201c\u043b\u044e\u0431\u0438\u0442\u201d \u0440\u0435\u0441\u0443\u0440\u0441\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434: \u0441\u0445\u0435\u043c\u044b \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432, \u0435\u0434\u0438\u043d\u044b\u0435 \u043f\u0430\u0442\u0442\u0435\u0440\u043d\u044b, \u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439.</p> </li> <li> <p>\u042d\u0432\u043e\u043b\u044e\u0446\u0438\u044f \u0431\u0435\u0437 \u043b\u043e\u043c\u043a\u0438    \u041a\u043e\u043c\u0430\u043d\u0434\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434 \u0447\u0430\u0441\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0445\u0430\u043e\u0441\u0443: <code>/doX</code>, <code>/doX2</code>, <code>/doXNow</code>.    \u0420\u0435\u0441\u0443\u0440\u0441\u043d\u044b\u0439 \u043f\u043e\u0434\u0445\u043e\u0434 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0439.</p> </li> </ol> <p>\u041f\u0440\u0430\u0432\u0438\u043b\u043e \u0434\u043b\u044f \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430: \u0435\u0441\u043b\u0438 endpoint \u0437\u0432\u0443\u0447\u0438\u0442 \u043a\u0430\u043a \u0433\u043b\u0430\u0433\u043e\u043b \u201c\u0441\u0434\u0435\u043b\u0430\u0439\u201d \u2014 \u044d\u0442\u043e \u0441\u0438\u0433\u043d\u0430\u043b, \u0447\u0442\u043e \u0432\u044b \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u0443\u0435\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b, \u0430 \u043d\u0435 REST.</p> <p>\u0418\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 (\u0432\u0430\u0436\u043d\u043e\u0435 \u0434\u043b\u044f \u0438\u0433\u0440): \u0432 \u0438\u0433\u0440\u0430\u0445 \u0435\u0441\u0442\u044c \u201c\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f\u201d, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u043b\u043e\u0436\u043d\u043e \u0432\u044b\u0440\u0430\u0437\u0438\u0442\u044c \u0447\u0438\u0441\u0442\u044b\u043c CRUD (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>match/finish</code>). \u0422\u043e\u0433\u0434\u0430 \u0434\u0435\u043b\u0430\u0435\u043c \u201c\u0440\u0435\u0441\u0443\u0440\u0441 + \u043f\u043e\u0434\u0440\u0435\u0441\u0443\u0440\u0441-\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435\u201d, \u043d\u043e \u0432 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c\u043e\u043c \u0432\u0438\u0434\u0435:</p> <ul> <li><code>POST /matches/{id}/finish</code></li> <li><code>POST /matches/{id}/events</code></li> </ul> <p>\u042d\u0442\u043e \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u201c\u0440\u0435\u0441\u0443\u0440\u0441\u043d\u043e\u201d, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u043e\u0431\u044a\u0435\u043a\u0442 \u2014 <code>match</code>.</p>"},{"location":"theory/api_design.html#512-stateless-server-sessions","title":"5.1.2. Stateless (\u043f\u043e\u0447\u0435\u043c\u0443 \u201c\u043d\u0438\u043a\u0430\u043a\u0438\u0445 server sessions\u201d)","text":"<p>\u041a\u0430\u0436\u0434\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435\u0441\u0451\u0442 \u0432 \u0441\u0435\u0431\u0435 \u0432\u0441\u0451 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0435:</p> <ul> <li><code>Authorization: Bearer &lt;JWT&gt;</code></li> <li>JSON body / query params</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0432 \u0438\u0433\u0440\u043e\u0432\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0445:</p> <ol> <li> <p>\u0413\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u044c\u043d\u043e\u0435 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435    \u0415\u0441\u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u0445\u0440\u0430\u043d\u0438\u0442 \u0441\u0435\u0441\u0441\u0438\u044e \u0432 \u043f\u0430\u043c\u044f\u0442\u0438, \u0437\u0430\u043f\u0440\u043e\u0441 \u21161 \u043f\u043e\u043f\u0430\u043b \u043d\u0430 \u0438\u043d\u0441\u0442\u0430\u043d\u0441 A, \u0437\u0430\u043f\u0440\u043e\u0441 \u21162 \u2014 \u043d\u0430 B.    B \u043d\u0435 \u0437\u043d\u0430\u0435\u0442 \u201c\u0441\u0435\u0441\u0441\u0438\u044e\u201d \u2192 \u043e\u0448\u0438\u0431\u043a\u0438, \u0440\u0430\u0441\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044f.</p> </li> <li> <p>\u041f\u043e\u0432\u0442\u043e\u0440\u044b \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 (\u0441\u0435\u0442\u0435\u0432\u044b\u0435 \u0440\u0435\u0442\u0440\u0430\u0438)    \u041c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u043d\u0435\u0441\u0442\u0430\u0431\u0438\u043b\u0435\u043d: \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u0437\u0430\u043f\u0440\u043e\u0441.    Stateless API \u043f\u0440\u043e\u0449\u0435 \u0434\u0435\u043b\u0430\u0435\u0442 idempotency / \u0434\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044e (\u043f\u043e requestId/eventId).</p> </li> <li> <p>\u0418\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430: \u0431\u0430\u043b\u0430\u043d\u0441\u0438\u0440\u043e\u0432\u043a\u0430, autoscaling    Stateless \u0443\u043f\u0440\u043e\u0449\u0430\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 Load Balancer \u0438 \u0437\u0430\u043f\u0443\u0441\u043a \u043d\u043e\u0432\u044b\u0445 \u0438\u043d\u0441\u0442\u0430\u043d\u0441\u043e\u0432 \u0431\u0435\u0437 \u043f\u0440\u043e\u0433\u0440\u0435\u0432\u0430 \u201c\u043f\u0430\u043c\u044f\u0442\u0438 \u0441\u0435\u0441\u0441\u0438\u0439\u201d.</p> </li> </ol> <p>\u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e: \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0432 \u0411\u0414 (progress/stats), \u0430 \u043d\u0435 \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.</p>"},{"location":"theory/api_design.html#513-json","title":"5.1.3. \u0415\u0434\u0438\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 JSON (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0438)","text":"<p>API \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 JSON (\u0434\u0430\u0436\u0435 \u043d\u0430 \u043e\u0448\u0438\u0431\u043a\u0430\u0445), \u0447\u0442\u043e\u0431\u044b Unity/Web/Mobile:</p> <ul> <li>\u043d\u0435 \u043f\u0430\u0434\u0430\u043b\u0438 \u043d\u0430 HTML-\u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u043e\u0448\u0438\u0431\u043a\u0438,</li> <li>\u043c\u043e\u0433\u043b\u0438 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u043b\u044e\u0431\u0443\u044e \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044e.</li> </ul> <p>\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442:</p> <p>Success</p> <pre><code>{ \"ok\": true, \"data\": {} }\n</code></pre> <p>Error</p> <pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Field level must be &gt;= 1\",\n    \"requestId\": \"req_...\"\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e (\u0430 \u043d\u0435 \u201c\u043c\u043e\u0436\u043d\u043e \u0438 \u0442\u0430\u043a\u201d):</p> <ol> <li> <p>\u041a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u0430\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u0442\u0440\u0438\u0432\u0438\u0430\u043b\u044c\u043d\u043e\u0439    \u041e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u043a\u043e\u0434 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043e\u0448\u0438\u0431\u043e\u043a \u0434\u043b\u044f \u0432\u0441\u0435\u0445 endpoint\u2019\u043e\u0432.</p> </li> <li> <p>requestId \u0441\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u0441\u0435\u0440\u0432\u0435\u0440    \u0415\u0441\u043b\u0438 \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043f\u043e\u0442\u043e\u043c \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, requestId \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 \u043d\u0430\u0439\u0442\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432 \u043b\u043e\u0433\u0430\u0445.</p> </li> <li> <p>\u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e    Postman \u043a\u043e\u043b\u043b\u0435\u043a\u0446\u0438\u0438/\u0430\u0432\u0442\u043e\u0442\u0435\u0441\u0442\u044b \u043c\u043e\u0433\u0443\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c <code>ok</code>, <code>error.code</code>, <code>error.requestId</code>.</p> </li> </ol> <p>\u041f\u0440\u0430\u0432\u0438\u043b\u043e \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438: \u0432 <code>message</code> \u043d\u0435\u043b\u044c\u0437\u044f \u043e\u0442\u0434\u0430\u0432\u0430\u0442\u044c stack trace \u0438 SQL-\u043e\u0448\u0438\u0431\u043a\u0438 \u0432 \u043f\u0440\u043e\u0434\u0435. \u0412 \u043b\u043e\u0433 \u2014 \u043c\u043e\u0436\u043d\u043e, \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u2014 \u043d\u0435\u0442.</p>"},{"location":"theory/api_design.html#52-endpoint","title":"5.2. \u0418\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 endpoint\u2019\u043e\u0432 (\u043f\u0440\u0430\u0432\u0438\u043b\u0430)","text":""},{"location":"theory/api_design.html#521-url","title":"5.2.1. \u041d\u043e\u0442\u0430\u0446\u0438\u044f URL","text":"<ul> <li>\u0442\u043e\u043b\u044c\u043a\u043e lowercase</li> <li>\u0441\u043b\u043e\u0432\u0430 \u0447\u0435\u0440\u0435\u0437 <code>-</code> \u0438\u043b\u0438 <code>_</code> (\u043b\u0443\u0447\u0448\u0435 \u0431\u0435\u0437 \u043f\u043e\u0434\u0447\u0435\u0440\u043a\u0438\u0432\u0430\u043d\u0438\u0439 \u0432 URL)</li> <li>\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435: <code>/profile</code>, <code>/events</code>, <code>/leaderboard</code></li> <li>\u0432\u0435\u0440\u0441\u0438\u0438 API: <code>/api/v1/...</code> (\u0435\u0441\u043b\u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0440\u0430\u0437\u0432\u0438\u0442\u0438\u0435)</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440:</p> <ul> <li><code>/api/v1/auth/login</code></li> <li><code>/api/v1/profile</code></li> <li><code>/api/v1/progress</code></li> <li><code>/api/v1/events</code></li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u0435\u0440\u0441\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u0430\u0436\u043d\u043e \u0441\u0440\u0430\u0437\u0443 (\u0434\u0430\u0436\u0435 \u0432 \u0443\u0447\u0435\u0431\u043d\u043e\u043c \u043f\u0440\u043e\u0435\u043a\u0442\u0435):</p> <ul> <li>\u0432\u044b \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u043b\u044f/\u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0431\u0435\u0437 \u201c\u043b\u043e\u043c\u0430\u043d\u0438\u044f\u201d \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432;</li> <li>\u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044e \u043f\u0440\u043e\u0449\u0435 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u0435 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0438 \u043f\u0440\u043e\u0435\u043a\u0442\u0430;</li> <li>\u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u0432\u0438\u0434\u0438\u0442 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0443 \u0438\u043d\u0434\u0443\u0441\u0442\u0440\u0438\u0438.</li> </ul> <p>\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043d\u0435\u0439\u043c\u0438\u043d\u0433:</p> <ul> <li><code>boardCode</code>, <code>season</code>, <code>limit</code> \u2014 \u0432 query</li> <li><code>eventType</code>, <code>payload</code> \u2014 \u0432 body</li> </ul>"},{"location":"theory/api_design.html#522-query-params-vs-body","title":"5.2.2. Query params vs Body","text":"<ul> <li>GET: \u0444\u0438\u043b\u044c\u0442\u0440\u044b \u0432 query</li> <li>POST: \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 body</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440:</p> <ul> <li><code>GET /leaderboard?boardCode=td_score&amp;season=1&amp;limit=100</code></li> <li><code>POST /events</code> \u2014 body \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 payload \u0441\u043e\u0431\u044b\u0442\u0438\u044f</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 GET \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439:</p> <ul> <li>GET \u043c\u043e\u0436\u0435\u0442 \u043a\u044d\u0448\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043f\u0440\u043e\u043a\u0441\u0438/\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c;</li> <li>GET \u043d\u0435 \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d \u0434\u043b\u044f \u043f\u043e\u0431\u043e\u0447\u043d\u044b\u0445 \u044d\u0444\u0444\u0435\u043a\u0442\u043e\u0432;</li> <li>\u043b\u043e\u0433\u0438\u043a\u0430 \u201cGET \u0437\u0430\u043f\u0438\u0441\u0430\u043b \u0434\u0430\u043d\u043d\u044b\u0435\u201d \u043b\u043e\u043c\u0430\u0435\u0442 \u0434\u0435\u0431\u0430\u0433, \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u0438 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c.</li> </ul>"},{"location":"theory/api_design.html#53-http","title":"5.3. HTTP \u043c\u0435\u0442\u043e\u0434\u044b \u0438 \u043a\u043e\u0434\u044b (\u0447\u0442\u043e \u0438 \u0437\u0430\u0447\u0435\u043c)","text":""},{"location":"theory/api_design.html#531","title":"5.3.1. \u041c\u0435\u0442\u043e\u0434\u044b","text":"<ul> <li><code>POST</code> \u2014 \u0441\u043e\u0437\u0434\u0430\u0442\u044c / \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435 / \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e \u0437\u0430\u043f\u0438\u0441\u0438</li> <li><code>GET</code> \u2014 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 (\u0431\u0435\u0437 \u043f\u043e\u0431\u043e\u0447\u043d\u044b\u0445 \u044d\u0444\u0444\u0435\u043a\u0442\u043e\u0432)</li> </ul> <p>(\u0414\u043b\u044f MVP \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e POST/GET. PUT/PATCH/DELETE \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u0437\u0436\u0435.)</p> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432 MVP \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e:</p> <ul> <li>\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443 \u0432\u0430\u0436\u043d\u0435\u0435 \u043e\u0441\u0432\u043e\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0443\u0440: auth \u2192 validation \u2192 service \u2192 db \u2192 response;</li> <li>PATCH/PUT \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044e\u0442 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c (\u0447\u0430\u0441\u0442\u0438\u0447\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u0438\u0434\u0435\u043c\u043f\u043e\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c), \u044d\u0442\u043e \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u044f \u21162.</li> </ul>"},{"location":"theory/api_design.html#532","title":"5.3.2. \u041a\u043e\u0434\u044b \u043e\u0442\u0432\u0435\u0442\u0430 (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440)","text":"<ul> <li><code>200 OK</code> \u2014 \u0443\u0441\u043f\u0435\u0448\u043d\u043e</li> <li><code>201 Created</code> \u2014 \u0441\u043e\u0437\u0434\u0430\u043d \u0440\u0435\u0441\u0443\u0440\u0441 (register/match_start)</li> <li><code>400 Bad Request</code> \u2014 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f/\u043f\u043e\u043b\u044f \u043d\u0435\u0432\u0435\u0440\u043d\u044b</li> <li><code>401 Unauthorized</code> \u2014 \u043d\u0435\u0442 JWT/\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u0435\u043d</li> <li><code>403 Forbidden</code> \u2014 \u043d\u0435\u0442 \u043f\u0440\u0430\u0432 / user banned</li> <li><code>404 Not Found</code> \u2014 \u0440\u0435\u0441\u0443\u0440\u0441 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d</li> <li><code>409 Conflict</code> \u2014 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043c\u0430\u0442\u0447 \u0443\u0436\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d)</li> <li><code>429 Too Many Requests</code> \u2014 rate limit</li> <li><code>500 Internal Server Error</code> \u2014 \u043d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u0436\u043d\u043e \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u043a\u043e\u0434\u044b: \u043a\u043b\u0438\u0435\u043d\u0442\u044b (Unity/Web) \u043c\u043e\u0433\u0443\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c:</p> <ul> <li>\u201c\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u0438\u043d\u043e\u0432\u0430\u0442\u201d (400),</li> <li>\u201c\u043d\u0435\u0442 \u0442\u043e\u043a\u0435\u043d\u0430\u201d (401),</li> <li>\u201c\u043f\u0440\u0430\u0432 \u043d\u0435\u0442\u201d (403),</li> <li>\u201c\u0441\u0435\u0440\u0432\u0435\u0440 \u0443\u043f\u0430\u043b\u201d (500).</li> </ul> <p>\u041a\u043b\u0430\u0441\u0441\u0438\u043a\u0430 \u0430\u043d\u0442\u0438-\u043f\u0430\u0442\u0442\u0435\u0440\u043d\u0430 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432: \u201c\u0432\u0441\u0435\u0433\u0434\u0430 200 \u0438 \u0432\u043d\u0443\u0442\u0440\u0438 ok:false\u201d. \u041f\u043e\u0447\u0435\u043c\u0443 \u043f\u043b\u043e\u0445\u043e: \u043c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u0438 \u043f\u0440\u043e\u043a\u0441\u0438 \u0432\u0438\u0434\u044f\u0442 \u201c\u0432\u0441\u0451 \u043e\u043a\u201d, \u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u043f\u0430\u0434\u0430\u0435\u0442.</p>"},{"location":"theory/api_design.html#54-endpoints","title":"5.4. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0435 endpoints (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435) \u2014 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f + \u043f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u041d\u0438\u0436\u0435 \u2014 \u043d\u0430\u0431\u043e\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0431\u044f\u0437\u0430\u043d \u0431\u044b\u0442\u044c \u0443 MVP.</p>"},{"location":"theory/api_design.html#541-post-register","title":"5.4.1. <code>POST /register</code> \u2014 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442, \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0440\u043e\u043b\u044c <code>player</code>.</p> <p>Request</p> <pre><code>POST /api/v1/auth/register\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"email\": \"player1@example.com\",\n  \"password\": \"P@ssw0rd!\",\n  \"nickname\": \"PlayerOne\"\n}\n</code></pre> <p>Response (201)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"userId\": 101\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400 VALIDATION_ERROR</code> (email \u043d\u0435\u0432\u0430\u043b\u0438\u0434\u0435\u043d, \u043f\u0430\u0440\u043e\u043b\u044c \u0441\u043b\u0430\u0431\u044b\u0439)</li> <li><code>409 EMAIL_ALREADY_EXISTS</code></li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 409: \u044d\u0442\u043e \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 <code>users.email</code>.</p> <p>\u0427\u0442\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u0447\u0435\u0441\u0442\u044c (\u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a):</p> <ul> <li>\u043f\u0430\u0440\u043e\u043b\u044c \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u043a hash (bcrypt/argon2), \u0438\u043d\u0430\u0447\u0435 \u044d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c;</li> <li>email \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u2014 \u0444\u043e\u0440\u043c\u0430\u0442);</li> <li>nickname \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u044c \u043f\u043e \u0434\u043b\u0438\u043d\u0435, \u0438\u043d\u0430\u0447\u0435 \u043c\u0443\u0441\u043e\u0440 \u0438 XSS \u0432 UI.</li> </ul>"},{"location":"theory/api_design.html#542-post-login-jwt","title":"5.4.2. <code>POST /login</code> \u2014 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 JWT","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0432\u044b\u0434\u0430\u0442\u044c <code>accessToken</code>.</p> <p>Request</p> <pre><code>POST /api/v1/auth/login\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"email\": \"player1@example.com\",\n  \"password\": \"P@ssw0rd!\"\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIs...\",\n    \"tokenType\": \"Bearer\",\n    \"expiresInSeconds\": 3600\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>401 INVALID_CREDENTIALS</code></li> <li><code>403 USER_BANNED</code></li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 403 \u0434\u043b\u044f ban: \u0442\u043e\u043a\u0435\u043d \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u0430\u043b\u0438\u0434\u0435\u043d, \u043d\u043e \u0434\u043e\u0441\u0442\u0443\u043f \u0437\u0430\u043f\u0440\u0435\u0449\u0451\u043d \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u043e\u0439.</p> <p>\u0420\u0435\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u044e\u0430\u043d\u0441: \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u0430\u043d\u0435\u043d \u043f\u043e\u0441\u043b\u0435 \u0432\u044b\u0434\u0430\u0447\u0438 \u0442\u043e\u043a\u0435\u043d\u0430 \u2014 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c <code>users.is_banned</code> \u043d\u0430 \u0437\u0430\u0449\u0438\u0449\u0451\u043d\u043d\u044b\u0445 endpoint\u2019\u0430\u0445 (\u0438\u043b\u0438 \u0434\u0435\u0440\u0436\u0430\u0442\u044c ban-cache). \u0418\u043d\u0430\u0447\u0435 \u0431\u0430\u043d \u201c\u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442\u201d \u0434\u043e \u0438\u0441\u0442\u0435\u0447\u0435\u043d\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u0430.</p>"},{"location":"theory/api_design.html#543-get-profile","title":"5.4.3. <code>GET /profile</code> \u2014 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0438\u0433\u0440\u043e\u043a\u0430","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043e\u0442\u0434\u0430\u0442\u044c \u201c\u0432\u0438\u0442\u0440\u0438\u043d\u0443\u201d \u043f\u0440\u043e\u0444\u0438\u043b\u044f: user + progress (+ \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f/\u043b\u0443\u0447\u0448\u0438\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b)</p> <p>Request</p> <pre><code>GET /api/v1/profile\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"user\": {\n      \"id\": 101,\n      \"email\": \"player1@example.com\",\n      \"nickname\": \"PlayerOne\",\n      \"createdAt\": \"2026-02-26T10:00:00.000Z\"\n    },\n    \"progress\": {\n      \"level\": 6,\n      \"xp\": 2450,\n      \"softCurrency\": 1200,\n      \"hardCurrency\": 10\n    }\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u0443\u0435\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0442\u0430\u0431\u043b\u0438\u0446: \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u043d\u0443\u0436\u0435\u043d \u043e\u0434\u0438\u043d \u0437\u0430\u043f\u0440\u043e\u0441 \u201c\u0432\u0441\u0451 \u0434\u043b\u044f \u044d\u043a\u0440\u0430\u043d\u0430 \u043f\u0440\u043e\u0444\u0438\u043b\u044f\u201d, \u0430 \u043d\u0435 5 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432.</p> <p>\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430: UI \u043f\u0440\u043e\u0444\u0438\u043b\u044f \u0434\u043e\u043b\u0436\u0435\u043d \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u0431\u044b\u0441\u0442\u0440\u043e \u0438 \u0434\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e \u2192 \u0441\u0435\u0440\u0432\u0435\u0440 \u043e\u0442\u0434\u0430\u0451\u0442 \u201c\u0432\u0438\u0442\u0440\u0438\u043d\u0443\u201d.</p>"},{"location":"theory/api_design.html#544-post-progress","title":"5.4.4. <code>POST /progress</code> \u2014 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 (level/xp/currency).</p> <p>Request</p> <pre><code>POST /api/v1/progress\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"level\": 6,\n  \"xp\": 2450,\n  \"softCurrency\": 1200,\n  \"hardCurrency\": 10,\n  \"reason\": \"match_finish\"\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"updatedAt\": \"2026-02-26T12:18:22.120Z\"\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400 VALIDATION_ERROR</code> (level &lt; 1, currency &lt; 0)</li> <li><code>409 PROGRESS_CONFLICT</code> (\u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0435 optimistic lock)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 progress \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043e\u0442 event: progress \u2014 \u201c\u0441\u043d\u0438\u043c\u043e\u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u201d, event \u2014 \u201c\u0436\u0443\u0440\u043d\u0430\u043b \u0444\u0430\u043a\u0442\u043e\u0432\u201d. \u0418\u0445 \u043d\u0435\u043b\u044c\u0437\u044f \u0441\u043c\u0435\u0448\u0438\u0432\u0430\u0442\u044c.</p> <p>\u041f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u201c\u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a\u201d \u043d\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u0435:</p> <ul> <li>\u0441\u043e\u0431\u044b\u0442\u0438\u0435 <code>currency_change</code> \u0433\u043e\u0432\u043e\u0440\u0438\u0442 \u201c\u043f\u043e\u0447\u0435\u043c\u0443 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c\u201d;</li> <li>progress \u0433\u043e\u0432\u043e\u0440\u0438\u0442 \u201c\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0441\u0442\u0430\u043b\u043e \u0441\u0435\u0439\u0447\u0430\u0441\u201d.   \u041e\u0431\u0430 \u043d\u0443\u0436\u043d\u044b: \u0430\u0443\u0434\u0438\u0442 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0438 + \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u043f\u0440\u043e\u0444\u0438\u043b\u044c.</li> </ul>"},{"location":"theory/api_design.html#545-post-event","title":"5.4.5. <code>POST /event</code> \u2014 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u044f","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0438\u0433\u0440\u043e\u043a\u0430 \u0438 (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e) \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b.</p> <p>Request</p> <pre><code>POST /api/v1/events\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"eventType\": \"match_finish\",\n  \"sessionId\": 555,\n  \"clientTime\": \"2026-02-26T12:20:10.000Z\",\n  \"payload\": {\n    \"mode\": \"td\",\n    \"mapCode\": \"forest_01\",\n    \"season\": 1,\n    \"isWin\": true,\n    \"score\": 12450,\n    \"durationSeconds\": 410,\n    \"waveReached\": 12\n  }\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"accepted\": true\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400 VALIDATION_ERROR</code> (payload \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0445\u0435\u043c\u0435)</li> <li><code>429 RATE_LIMITED</code></li> <li><code>409 EVENT_REJECTED</code> (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043d\u0435\u043a\u043e\u043d\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u201caccepted\u201d: \u0432 \u043f\u0440\u043e\u0434\u0435 \u0447\u0430\u0441\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043f\u0438\u0448\u0443\u0442\u0441\u044f \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u043e/\u0447\u0435\u0440\u0435\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u044c, \u0438 \u0432\u0430\u0436\u043d\u043e \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u0442\u044c \u201c\u043f\u0440\u0438\u043d\u044f\u0442\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c\u201d vs \u201c\u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u043e\u201d.</p> <p>\u0414\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0443\u0447\u0435\u0431\u043d\u043e\u0439 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0438 (\u0432\u0430\u0436\u043d\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443):</p> <ul> <li><code>userId</code> \u0431\u0435\u0440\u0451\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 JWT;</li> <li><code>createdAt</code> \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c;</li> <li><code>clientTime</code> \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043c\u043e\u0436\u043d\u043e, \u043d\u043e \u0434\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043d\u0435\u043b\u044c\u0437\u044f.</li> </ul>"},{"location":"theory/api_design.html#546-get-leaderboard","title":"5.4.6. <code>GET /leaderboard</code> \u2014 \u0442\u043e\u043f \u043f\u043e \u0434\u043e\u0441\u043a\u0435","text":"<p>Request</p> <pre><code>GET /api/v1/leaderboard?boardCode=td_score&amp;season=1&amp;limit=100\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"boardCode\": \"td_score\",\n    \"season\": 1,\n    \"items\": [\n      { \"rank\": 1, \"userId\": 10, \"nickname\": \"Max\", \"score\": 50000 },\n      { \"rank\": 2, \"userId\": 15, \"nickname\": \"Lina\", \"score\": 45000 }\n    ]\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 rank \u043c\u043e\u0436\u043d\u043e \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435: \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u043d\u0435 \u043d\u0430\u0434\u043e \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c \u043f\u043e\u0437\u0438\u0446\u0438\u044e \u2014 \u044d\u0442\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0438 \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u043f\u0440\u0430\u0432\u0438\u043b.</p> <p>\u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043d\u044e\u0430\u043d\u0441: \u0415\u0441\u043b\u0438 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u0431\u043e\u043b\u044c\u0448\u043e\u0439, rank \u043b\u0443\u0447\u0448\u0435 \u0441\u0447\u0438\u0442\u0430\u0442\u044c:</p> <ul> <li>window-\u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c\u0438 (MySQL 8), \u0438\u043b\u0438</li> <li>\u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0439 \u043b\u043e\u0433\u0438\u043a\u043e\u0439 \u201c\u043f\u043e\u0437\u0438\u0446\u0438\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430\u201d (\u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441).</li> </ul>"},{"location":"theory/api_design.html#547-get-stats","title":"5.4.7. <code>GET /stats</code> \u2014 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0438\u0433\u0440\u043e\u043a\u0430","text":"<p>Request</p> <pre><code>GET /api/v1/stats?from=2026-02-01&amp;to=2026-02-26\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"from\": \"2026-02-01\",\n    \"to\": \"2026-02-26\",\n    \"daily\": [\n      { \"day\": \"2026-02-25\", \"sessionsCount\": 2, \"playtimeSeconds\": 1200, \"wins\": 1, \"losses\": 0, \"scoreSum\": 12450 }\n    ],\n    \"summary\": {\n      \"daysActive\": 12,\n      \"playtimeSeconds\": 15300,\n      \"wins\": 18,\n      \"losses\": 9\n    }\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 summary \u043e\u0442\u0434\u0430\u0451\u043c \u0441\u0440\u0430\u0437\u0443: \u0447\u0442\u043e\u0431\u044b \u043a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u0441\u0443\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043b \u0441\u0430\u043c \u0438 \u043d\u0435 \u0434\u0435\u043b\u0430\u043b \u043b\u0438\u0448\u043d\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b.</p> <p>\u041f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u201c\u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a\u201d \u043d\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 Unity: \u0441\u0443\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435 = \u0440\u0438\u0441\u043a:</p> <ul> <li>\u0440\u0430\u0437\u043d\u044b\u0435 \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u044b \u0441\u0447\u0438\u0442\u0430\u044e\u0442 \u043f\u043e-\u0440\u0430\u0437\u043d\u043e\u043c\u0443 (\u043e\u043a\u0440\u0443\u0433\u043b\u0435\u043d\u0438\u044f, \u043e\u0448\u0438\u0431\u043a\u0438),</li> <li>\u0431\u043e\u043b\u044c\u0448\u0435 \u043a\u043e\u0434\u0430 \u0432 \u043a\u043b\u0438\u0435\u043d\u0442\u0435,</li> <li>\u0431\u043e\u043b\u044c\u0448\u0435 \u0431\u0430\u0433\u043e\u0432.</li> </ul>"},{"location":"theory/api_design.html#55-swagger-openapi","title":"5.5. Swagger / OpenAPI (\u0447\u0442\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043e\u0431\u044f\u0437\u0430\u043d \u043e\u0444\u043e\u0440\u043c\u0438\u0442\u044c)","text":""},{"location":"theory/api_design.html#551-openapi","title":"5.5.1. \u0427\u0442\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 OpenAPI","text":"<ul> <li>\u0432\u0441\u0435 endpoints \u0438\u0437 MVP</li> <li> <p>\u0441\u0445\u0435\u043c\u044b:</p> </li> <li> <p><code>RegisterRequest</code>, <code>LoginRequest</code></p> </li> <li><code>EventRequest</code> (\u0441 <code>eventType</code> + <code>payload</code>)</li> <li><code>ErrorResponse</code></li> <li>SecurityScheme: <code>bearerAuth</code></li> </ul> <p>\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442 (\u043f\u0440\u0438\u043c\u0435\u0440):</p> <pre><code>components:\n  securitySchemes:\n    bearerAuth:\n      type: http\n      scheme: bearer\n      bearerFormat: JWT\n</code></pre>"},{"location":"theory/api_design.html#swagger","title":"\u041f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u201c\u043f\u043e\u0447\u0435\u043c\u0443 Swagger \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d\u201d","text":"<ol> <li>\u042d\u0442\u043e \u201c\u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442\u201d: \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 backend \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0443.</li> <li>\u042d\u0442\u043e QA-\u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442: \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c/\u0442\u0435\u0441\u0442\u0435\u0440 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0433\u043d\u0430\u0442\u044c API \u0431\u0435\u0437 \u0447\u0442\u0435\u043d\u0438\u044f \u043a\u043e\u0434\u0430.</li> <li>\u042d\u0442\u043e \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f: \u0435\u0441\u043b\u0438 \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u043f\u0438\u0441\u0430\u0442\u044c endpoint \u0432 OpenAPI \u2014 \u0437\u043d\u0430\u0447\u0438\u0442 \u043e\u043d \u0441\u0430\u043c \u043d\u0435 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442.</li> </ol>"},{"location":"theory/api_design.html#swagger_1","title":"\u0427\u0442\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043e\u0431\u044b\u0447\u043d\u043e \u0437\u0430\u0431\u044b\u0432\u0430\u0435\u0442 (\u0438 \u044d\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442 Swagger)","text":"<ul> <li>\u043e\u043f\u0438\u0441\u0430\u0442\u044c <code>401/403/409/429</code> \u043a\u0430\u043a \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u043e\u0442\u0432\u0435\u0442\u044b;</li> <li>\u043e\u043f\u0438\u0441\u0430\u0442\u044c <code>ErrorResponse</code> \u0435\u0434\u0438\u043d\u043e\u043e\u0431\u0440\u0430\u0437\u043d\u043e;</li> <li>\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c <code>security</code> \u043d\u0430 \u0437\u0430\u0449\u0438\u0449\u0451\u043d\u043d\u044b\u0435 endpoint\u2019\u044b:</li> </ul> <pre><code>security:\n  - bearerAuth: []\n</code></pre>"},{"location":"theory/architecture.html","title":"\u0410\u0440\u0445\u0438\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c","text":""},{"location":"theory/architecture.html#1-1","title":"1. \u0422\u0435\u043e\u0440\u0438\u044f. 1. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":""},{"location":"theory/architecture.html#11","title":"1.1. \u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":"<p>\u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430 \u2014 \u044d\u0442\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (Unity/Web/Mobile), \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u0430, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0432 \u0411\u0414 \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b (\u043f\u0440\u043e\u0444\u0438\u043b\u044c, \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u044b, \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0443).</p>"},{"location":"theory/architecture.html#12","title":"1.2. \u041a\u043b\u0438\u0435\u043d\u0442\u2013\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0432 \u0438\u0433\u0440\u0435","text":"<ul> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 UI/UX \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439/\u0441\u043e\u0431\u044b\u0442\u0438\u0439.</li> <li>\u0421\u0435\u0440\u0432\u0435\u0440 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 (\u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f, \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441), \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443, \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c \u0438 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435.</li> <li>\u0411\u0414 \u2014 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b (\u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u0439, \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f, \u043c\u0435\u0442\u0440\u0438\u043a\u0438).</li> </ul>"},{"location":"theory/architecture.html#13-mermaid-","title":"1.3. Mermaid-\u0441\u0445\u0435\u043c\u0430 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b","text":"<pre><code>flowchart LR\n  %% Clients\n  subgraph C[Game Client]\n    U[Unity Client]\n    W[Web Client]\n    M[Mobile Client]\n  end\n\n  %% Transport\n  U --&gt;|HTTPS + JSON| API\n  W --&gt;|HTTPS + JSON| API\n  M --&gt;|HTTPS + JSON| API\n\n  %% Backend\n  subgraph B[REST API Backend Stateless]\n    API[API Gateway / Router]\n    AUTH[JWT Auth + RBAC]\n    VAL[Validation]\n    BL[Business Logic\\nProgress / Events / Stats / Leaderboard]\n    ERR[Error Handling]\n    LOG[Logging &amp; Monitoring]\n    API --&gt; AUTH --&gt; VAL --&gt; BL --&gt; ERR --&gt; LOG\n  end\n\n  %% Storage\n  subgraph S[Data Layer]\n    DB[(Relational DB\\nMySQL 8.0+)]\n    CACHE[(Redis Cache\\noptional)]\n    MQ[(Message Queue\\noptional)]\n    OBJ[(Object Storage\\noptional)]\n  end\n\n  BL --&gt; DB\n  BL -. cache read/write .-&gt; CACHE\n  BL -. publish events .-&gt; MQ\n  LOG -. store logs/artifacts .-&gt; OBJ</code></pre>"},{"location":"theory/architecture.html#14-er-","title":"1.4. \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f ER-\u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445","text":"<p>\u042d\u0442\u043e \u0431\u0430\u0437\u043e\u0432\u0430\u044f \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u0441\u0445\u0435\u043c\u0430 \u043f\u043e\u0434 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430 (Users/Roles/Sessions/Events/Progress/Achievements/Stats/Leaderboard). \u0414\u0430\u043b\u0435\u0435 \u0435\u0451 \u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c \u043f\u043e\u0434 \u0436\u0430\u043d\u0440 (\u0432 \u0442.\u0447. Strategy/Tower Defense).</p> <pre><code>erDiagram\n  USERS {\n    int id PK\n    string email\n    string password_hash\n    string nickname\n    datetime created_at\n    datetime last_login_at\n    bool is_banned\n  }\n\n  ROLES {\n    int id PK\n    string name\n  }\n\n  USER_ROLES {\n    int user_id PK, FK\n    int role_id PK, FK\n    datetime assigned_at\n  }\n\n  GAME_SESSIONS {\n    int id PK\n    int user_id FK\n    string client_platform\n    string client_version\n    string ip\n    datetime started_at\n    datetime ended_at\n  }\n\n  GAME_EVENTS {\n    bigint id PK\n    int user_id FK\n    int session_id FK\n    string event_type\n    string payload_json\n    datetime created_at\n  }\n\n  PLAYER_PROGRESS {\n    int user_id PK, FK\n    int level\n    int xp\n    int soft_currency\n    int hard_currency\n    datetime updated_at\n  }\n\n  ACHIEVEMENTS {\n    int id PK\n    string code\n    string title\n    string description\n    int points\n  }\n\n  USER_ACHIEVEMENTS {\n    int user_id PK, FK\n    int achievement_id PK, FK\n    datetime unlocked_at\n  }\n\n  STATISTICS_DAILY {\n    int id PK\n    int user_id FK\n    date day\n    int sessions_count\n    int events_count\n    int playtime_seconds\n    int wins\n    int losses\n    int score_sum\n  }\n\n  LEADERBOARD_SCORES {\n    int id PK\n    int user_id FK\n    string board_code\n    int season\n    int score\n    datetime updated_at\n  }\n\n  USERS ||--o{ USER_ROLES : has\n  ROLES ||--o{ USER_ROLES : includes\n\n  USERS ||--o{ GAME_SESSIONS : starts\n  GAME_SESSIONS ||--o{ GAME_EVENTS : contains\n  USERS ||--o{ GAME_EVENTS : produces\n\n  USERS ||--|| PLAYER_PROGRESS : owns\n\n  USERS ||--o{ USER_ACHIEVEMENTS : unlocks\n  ACHIEVEMENTS ||--o{ USER_ACHIEVEMENTS : granted\n\n  USERS ||--o{ STATISTICS_DAILY : aggregates\n  USERS ||--o{ LEADERBOARD_SCORES : ranks\n\n  %% Constraints (not supported as attributes in Mermaid erDiagram):\n  %% USERS.email UNIQUE\n  %% ROLES.name UNIQUE\n  %% ACHIEVEMENTS.code UNIQUE\n  %% STATISTICS_DAILY UNIQUE (user_id, day)\n  %% LEADERBOARD_SCORES UNIQUE (user_id, board_code, season)</code></pre>"},{"location":"theory/architecture.html#15-mysql-80-postgresql","title":"1.5. \u041c\u043e\u0434\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f \u0441\u0445\u0435\u043c\u044b \u043f\u043e\u0434 MySQL 8.0 (\u0432\u043c\u0435\u0441\u0442\u043e PostgreSQL)","text":"<p>\u041d\u0438\u0436\u0435 \u2014 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u043d\u044b\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u043e\u0434 MySQL 8.0+: <code>json</code>, <code>generated columns</code> \u0434\u043b\u044f \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u0438 JSON, <code>datetime(3)</code> \u0434\u043b\u044f \u043c\u0438\u043b\u043b\u0438\u0441\u0435\u043a\u0443\u043d\u0434, <code>inet</code> \u0437\u0430\u043c\u0435\u043d\u044f\u0435\u043c \u043d\u0430 <code>varchar(45)</code>.</p>"},{"location":"theory/architecture.html#151-usersrolesprogresssessionseventsstatsleaderboard-mysql","title":"1.5.1. \u0411\u0430\u0437\u0430: Users/Roles/Progress/Sessions/Events/Stats/Leaderboard (MySQL)","text":"<pre><code>-- \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u043e:\n-- ENGINE=InnoDB, CHARSET=utf8mb4, COLLATION=utf8mb4_0900_ai_ci\n\nCREATE TABLE roles (\n  id   INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(32) NOT NULL UNIQUE\n) ENGINE=InnoDB;\n\nCREATE TABLE users (\n  id            INT AUTO_INCREMENT PRIMARY KEY,\n  email         VARCHAR(255) NOT NULL UNIQUE,\n  password_hash VARCHAR(255) NOT NULL,\n  nickname      VARCHAR(64)  NOT NULL,\n  created_at    DATETIME(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  last_login_at DATETIME(3)  NULL,\n  is_banned     TINYINT(1)   NOT NULL DEFAULT 0\n) ENGINE=InnoDB;\n\nCREATE TABLE user_roles (\n  user_id   INT NOT NULL,\n  role_id   INT NOT NULL,\n  assigned_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  PRIMARY KEY (user_id, role_id),\n  CONSTRAINT fk_user_roles_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT fk_user_roles_role FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE RESTRICT,\n  INDEX idx_user_roles_role_id (role_id)\n) ENGINE=InnoDB;\n\nCREATE TABLE game_sessions (\n  id             INT AUTO_INCREMENT PRIMARY KEY,\n  user_id        INT NOT NULL,\n  client_platform ENUM('unity','web','mobile') NOT NULL,\n  client_version VARCHAR(32) NULL,\n  ip             VARCHAR(45) NULL,\n  started_at     DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  ended_at       DATETIME(3) NULL,\n  CONSTRAINT fk_sessions_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  INDEX idx_sessions_user_started (user_id, started_at)\n) ENGINE=InnoDB;\n\nCREATE TABLE game_events (\n  id          BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id     INT NOT NULL,\n  session_id  INT NULL,\n  event_type  VARCHAR(64) NOT NULL,\n  payload_json JSON NOT NULL,\n  created_at  DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_events_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT fk_events_session FOREIGN KEY (session_id) REFERENCES game_sessions(id) ON DELETE SET NULL,\n\n  INDEX idx_events_user_time (user_id, created_at),\n  INDEX idx_events_type_time (event_type, created_at)\n) ENGINE=InnoDB;\n\nCREATE TABLE player_progress (\n  user_id        INT PRIMARY KEY,\n  level          INT NOT NULL DEFAULT 1,\n  xp             INT NOT NULL DEFAULT 0,\n  soft_currency  INT NOT NULL DEFAULT 0,\n  hard_currency  INT NOT NULL DEFAULT 0,\n  updated_at     DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_progress_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT chk_level CHECK (level &gt;= 1),\n  CONSTRAINT chk_xp CHECK (xp &gt;= 0),\n  CONSTRAINT chk_soft CHECK (soft_currency &gt;= 0),\n  CONSTRAINT chk_hard CHECK (hard_currency &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE achievements (\n  id          INT AUTO_INCREMENT PRIMARY KEY,\n  code        VARCHAR(64) NOT NULL UNIQUE,\n  title       VARCHAR(128) NOT NULL,\n  description TEXT NULL,\n  points      INT NOT NULL DEFAULT 0,\n  CONSTRAINT chk_points CHECK (points &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE user_achievements (\n  user_id        INT NOT NULL,\n  achievement_id INT NOT NULL,\n  unlocked_at    DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n\n  PRIMARY KEY (user_id, achievement_id),\n  CONSTRAINT fk_ua_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  CONSTRAINT fk_ua_ach  FOREIGN KEY (achievement_id) REFERENCES achievements(id) ON DELETE CASCADE,\n  INDEX idx_ua_ach (achievement_id)\n) ENGINE=InnoDB;\n\nCREATE TABLE statistics_daily (\n  id               INT AUTO_INCREMENT PRIMARY KEY,\n  user_id          INT NOT NULL,\n  day              DATE NOT NULL,\n  sessions_count   INT NOT NULL DEFAULT 0,\n  events_count     INT NOT NULL DEFAULT 0,\n  playtime_seconds INT NOT NULL DEFAULT 0,\n  wins             INT NOT NULL DEFAULT 0,\n  losses           INT NOT NULL DEFAULT 0,\n  score_sum        INT NOT NULL DEFAULT 0,\n\n  CONSTRAINT fk_stats_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_stats_user_day (user_id, day),\n  INDEX idx_stats_day (day),\n  INDEX idx_stats_user_day (user_id, day)\n) ENGINE=InnoDB;\n\nCREATE TABLE leaderboard_scores (\n  id         INT AUTO_INCREMENT PRIMARY KEY,\n  user_id    INT NOT NULL,\n  board_code VARCHAR(64) NOT NULL,\n  season     INT NOT NULL DEFAULT 1,\n  score      INT NOT NULL DEFAULT 0,\n  updated_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_lb_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_lb_user_board_season (user_id, board_code, season),\n  INDEX idx_lb_board_season_score (board_code, season, score),\n  INDEX idx_lb_user (user_id),\n  CONSTRAINT chk_season CHECK (season &gt;= 1)\n) ENGINE=InnoDB;\n</code></pre>"},{"location":"theory/architecture.html#16-strategy-tower-defense","title":"1.6. \u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f: Strategy / Tower Defense (\u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043f\u0440\u0438\u043c\u0435\u0440)","text":"<p>\u041d\u0438\u0436\u0435 \u2014 \u043a\u0430\u043a\u0438\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f, \u0447\u0442\u043e \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435, \u043a\u0430\u043a\u0438\u0435 \u043c\u0435\u0442\u0440\u0438\u043a\u0438 \u0441\u0447\u0438\u0442\u0430\u0442\u044c. \u041b\u043e\u0433\u0438\u043a\u0430: \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u2014 \u044d\u0442\u043e \u043d\u0430\u0431\u043e\u0440 \u043c\u0430\u0442\u0447\u0435\u0439/\u0432\u043e\u043b\u043d, \u044e\u043d\u0438\u0442\u043e\u0432, \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043a, \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0438, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u0432 \u0431\u043e\u044f.</p>"},{"location":"theory/architecture.html#161-strategytd","title":"1.6.1. \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 (Strategy/TD)","text":"<p>\u041d\u043e\u0432\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435):</p> <ul> <li><code>matches</code> \u2014 \u043c\u0430\u0442\u0447\u0438 (PvE/PvP), \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</li> <li><code>waves</code> \u2014 \u0432\u043e\u043b\u043d\u044b (\u0434\u043b\u044f TD)</li> <li><code>towers</code> / <code>buildings</code> \u2014 \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0438 \u0438\u0445 \u0443\u0440\u043e\u0432\u043d\u0438</li> <li><code>units</code> \u2014 \u044e\u043d\u0438\u0442\u044b/\u0432\u0440\u0430\u0433\u0438 (\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u0442\u0438\u043f\u043e\u0432)</li> <li><code>player_inventory</code> \u2014 \u043a\u0430\u0440\u0442\u044b/\u0440\u0435\u0441\u0443\u0440\u0441\u044b/\u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f</li> <li><code>research</code> \u2014 \u0438\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u044f/\u0442\u0430\u043b\u0430\u043d\u0442\u044b</li> <li><code>battle_results</code> \u2014 \u0438\u0442\u043e\u0433 \u043c\u0430\u0442\u0447\u0430 (\u0443\u0440\u043e\u043d, \u043f\u043e\u0442\u0435\u0440\u0438, \u0432\u0440\u0435\u043c\u044f, \u0440\u0435\u0439\u0442\u0438\u043d\u0433)</li> </ul>"},{"location":"theory/architecture.html#162","title":"1.6.2. \u0427\u0442\u043e \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 (\u0447\u0442\u043e\u0431\u044b \u0431\u044b\u043b\u043e \u201c\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u201d)","text":"<p>\u0421\u0435\u0440\u0432\u0435\u0440 \u0445\u0440\u0430\u043d\u0438\u0442 \u0438 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442:</p> <ul> <li>\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043c\u0430\u0442\u0447\u0430 (win/lose, \u0432\u0440\u0435\u043c\u044f, score);</li> <li>\u043d\u0430\u0433\u0440\u0430\u0434\u044b (gold, gems, \u043e\u043f\u044b\u0442);</li> <li>\u0430\u043f\u0433\u0440\u0435\u0439\u0434\u044b \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043a/\u044e\u043d\u0438\u0442\u043e\u0432;</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c/\u0433\u043b\u0430\u0432\u0430\u043c/\u0432\u043e\u043b\u043d\u0430\u043c;</li> <li>\u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438 \u0438 MMR (\u0435\u0441\u043b\u0438 PvP);</li> <li>\u0430\u043d\u0442\u0438\u0447\u0438\u0442-\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f (\u043b\u0438\u043c\u0438\u0442\u044b \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432, \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f).</li> </ul> <p>\u041a\u043b\u0438\u0435\u043d\u0442 \u043c\u043e\u0436\u0435\u0442 \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e (\u043a\u044d\u0448):</p> <ul> <li>\u0432\u0438\u0437\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438;</li> <li>\u043a\u0435\u0448\u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u043e\u0432 (\u043a\u0430\u0442\u0430\u043b\u043e\u0433 \u0431\u0430\u0448\u0435\u043d/\u044e\u043d\u0438\u0442\u043e\u0432), \u043d\u043e \u0441 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435\u043c \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430.</li> </ul>"},{"location":"theory/architecture.html#163","title":"1.6.3. \u041c\u0435\u0442\u0440\u0438\u043a\u0438 (\u0447\u0442\u043e \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0438 \u0433\u0434\u0435)","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 (\u0434\u043b\u044f \u0438\u0433\u0440\u043e\u043a\u0430):</p> <ul> <li>win rate (wins / matches)</li> <li>average match duration</li> <li>best wave reached (TD)</li> <li>DPS / damage dealt</li> <li>resources spent / earned</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435 (\u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0438):</p> <ul> <li>retention D1/D7/D30 (\u043f\u043e login/session)</li> <li>churn (\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u0445\u043e\u0434\u043e\u0432 N \u0434\u043d\u0435\u0439)</li> <li>conversion (\u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043f\u043e\u043a\u0443\u043f\u043a\u0438)</li> <li>difficulty funnel (\u0433\u0434\u0435 \u0447\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u043f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u044e\u0442)</li> <li>balance metrics (\u043a\u0430\u043a\u0438\u0435 \u0431\u0430\u0448\u043d\u0438/\u044e\u043d\u0438\u0442\u044b \u201c\u0438\u043c\u0431\u0430\u201d)</li> </ul>"},{"location":"theory/architecture.html#17-strategytd-er-sql-mysql","title":"1.7. Strategy/TD: \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 ER (\u0434\u043e\u0431\u0430\u0432\u043e\u0447\u043d\u044b\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b) + SQL (MySQL)","text":""},{"location":"theory/architecture.html#171-mermaid-er","title":"1.7.1. Mermaid ER (\u0434\u043e\u0431\u0430\u0432\u043a\u0430 \u043a \u0431\u0430\u0437\u043e\u0432\u043e\u0439)","text":"<pre><code>erDiagram\n  MATCHES {\n    bigint id PK\n    int user_id FK\n    string mode \"pve|pvp|td\"\n    string map_code\n    int season\n    string status \"started|finished|abandoned\"\n    datetime started_at\n    datetime ended_at\n  }\n\n  MATCH_WAVES {\n    bigint id PK\n    bigint match_id FK\n    int wave_number\n    int enemies_spawned\n    int enemies_killed\n    int base_hp_left\n  }\n\n  PLAYER_BUILDINGS {\n    bigint id PK\n    int user_id FK\n    string building_code\n    int level\n    datetime updated_at\n  }\n\n  MATCH_BUILD_ACTIONS {\n    bigint id PK\n    bigint match_id FK\n    string action_type \"build|upgrade|sell\"\n    string building_code\n    int at_second\n    int cost\n  }\n\n  BATTLE_RESULTS {\n    bigint match_id PK, FK\n    bool is_win\n    int score\n    int damage_dealt\n    int damage_taken\n    int duration_seconds\n    int wave_reached\n  }\n\n  USERS ||--o{ MATCHES : plays\n  MATCHES ||--o{ MATCH_WAVES : contains\n  USERS ||--o{ PLAYER_BUILDINGS : owns\n  MATCHES ||--o{ MATCH_BUILD_ACTIONS : logs\n  MATCHES ||--|| BATTLE_RESULTS : ends_with</code></pre>"},{"location":"theory/architecture.html#172-strategytd-mysql","title":"1.7.2. Strategy/TD \u0442\u0430\u0431\u043b\u0438\u0446\u044b (MySQL)","text":"<pre><code>CREATE TABLE matches (\n  id         BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id    INT NOT NULL,\n  mode       ENUM('pve','pvp','td') NOT NULL,\n  map_code   VARCHAR(64) NOT NULL,\n  season     INT NOT NULL DEFAULT 1,\n  status     ENUM('started','finished','abandoned') NOT NULL DEFAULT 'started',\n  started_at DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),\n  ended_at   DATETIME(3) NULL,\n\n  CONSTRAINT fk_matches_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  INDEX idx_matches_user_time (user_id, started_at),\n  INDEX idx_matches_mode_season (mode, season),\n  CONSTRAINT chk_match_season CHECK (season &gt;= 1)\n) ENGINE=InnoDB;\n\nCREATE TABLE match_waves (\n  id              BIGINT AUTO_INCREMENT PRIMARY KEY,\n  match_id        BIGINT NOT NULL,\n  wave_number     INT NOT NULL,\n  enemies_spawned INT NOT NULL DEFAULT 0,\n  enemies_killed  INT NOT NULL DEFAULT 0,\n  base_hp_left    INT NOT NULL DEFAULT 0,\n\n  CONSTRAINT fk_waves_match FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_wave (match_id, wave_number),\n  INDEX idx_waves_match (match_id),\n  CONSTRAINT chk_wave_number CHECK (wave_number &gt;= 1),\n  CONSTRAINT chk_spawned CHECK (enemies_spawned &gt;= 0),\n  CONSTRAINT chk_killed CHECK (enemies_killed &gt;= 0),\n  CONSTRAINT chk_basehp CHECK (base_hp_left &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE player_buildings (\n  id            BIGINT AUTO_INCREMENT PRIMARY KEY,\n  user_id       INT NOT NULL,\n  building_code VARCHAR(64) NOT NULL,\n  level         INT NOT NULL DEFAULT 1,\n  updated_at    DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),\n\n  CONSTRAINT fk_pb_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  UNIQUE KEY uq_building (user_id, building_code),\n  INDEX idx_buildings_user (user_id),\n  CONSTRAINT chk_building_level CHECK (level &gt;= 1)\n) ENGINE=InnoDB;\n\nCREATE TABLE match_build_actions (\n  id            BIGINT AUTO_INCREMENT PRIMARY KEY,\n  match_id      BIGINT NOT NULL,\n  action_type   ENUM('build','upgrade','sell') NOT NULL,\n  building_code VARCHAR(64) NOT NULL,\n  at_second     INT NOT NULL,\n  cost          INT NOT NULL DEFAULT 0,\n\n  CONSTRAINT fk_actions_match FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE CASCADE,\n  INDEX idx_actions_match_time (match_id, at_second),\n  CONSTRAINT chk_at_second CHECK (at_second &gt;= 0)\n) ENGINE=InnoDB;\n\nCREATE TABLE battle_results (\n  match_id         BIGINT PRIMARY KEY,\n  is_win           TINYINT(1) NOT NULL,\n  score            INT NOT NULL DEFAULT 0,\n  damage_dealt     INT NOT NULL DEFAULT 0,\n  damage_taken     INT NOT NULL DEFAULT 0,\n  duration_seconds INT NOT NULL DEFAULT 0,\n  wave_reached     INT NOT NULL DEFAULT 0,\n\n  CONSTRAINT fk_results_match FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE CASCADE,\n  CONSTRAINT chk_damage_dealt CHECK (damage_dealt &gt;= 0),\n  CONSTRAINT chk_damage_taken CHECK (damage_taken &gt;= 0),\n  CONSTRAINT chk_duration CHECK (duration_seconds &gt;= 0),\n  CONSTRAINT chk_wave_reached CHECK (wave_reached &gt;= 0)\n) ENGINE=InnoDB;\n</code></pre>"},{"location":"theory/architecture.html#18-sql-leaderboard-winrate-difficulty-funnel-mysql","title":"1.8. \u041f\u0440\u0438\u043c\u0435\u0440\u044b SQL-\u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432: leaderboard, winrate, difficulty funnel (MySQL)","text":""},{"location":"theory/architecture.html#181-top-n-score-desc","title":"1.8.1. Top N \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u043f\u043e \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0443 (score DESC)","text":"<p>\u0422\u043e\u043f-100 \u043f\u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0434\u043e\u0441\u043a\u0435 \u0438 \u0441\u0435\u0437\u043e\u043d\u0443:</p> <pre><code>SELECT\n  ls.user_id,\n  u.nickname,\n  ls.score,\n  ls.updated_at\nFROM leaderboard_scores ls\nJOIN users u ON u.id = ls.user_id\nWHERE ls.board_code = 'td_score'\n  AND ls.season = 1\nORDER BY ls.score DESC, ls.updated_at ASC\nLIMIT 100;\n</code></pre> <p>\u041f\u043e\u0437\u0438\u0446\u0438\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0438\u0433\u0440\u043e\u043a\u0430 (rank) \u2014 MySQL 8 window function:</p> <pre><code>SELECT *\nFROM (\n  SELECT\n    ls.user_id,\n    u.nickname,\n    ls.score,\n    DENSE_RANK() OVER (ORDER BY ls.score DESC) AS rnk\n  FROM leaderboard_scores ls\n  JOIN users u ON u.id = ls.user_id\n  WHERE ls.board_code = 'td_score' AND ls.season = 1\n) t\nWHERE t.user_id = 15;\n</code></pre>"},{"location":"theory/architecture.html#182-winrate","title":"1.8.2. Winrate \u0438\u0433\u0440\u043e\u043a\u0430 \u0437\u0430 \u043f\u0435\u0440\u0438\u043e\u0434","text":"<p>Winrate \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 30 \u0434\u043d\u0435\u0439 (\u043f\u043e finished \u043c\u0430\u0442\u0447\u0430\u043c):</p> <pre><code>SELECT\n  m.user_id,\n  u.nickname,\n  SUM(CASE WHEN br.is_win = 1 THEN 1 ELSE 0 END) AS wins,\n  SUM(CASE WHEN br.is_win = 0 THEN 1 ELSE 0 END) AS losses,\n  COUNT(*) AS matches,\n  ROUND(100 * SUM(CASE WHEN br.is_win = 1 THEN 1 ELSE 0 END) / COUNT(*), 2) AS winrate_pct\nFROM matches m\nJOIN battle_results br ON br.match_id = m.id\nJOIN users u ON u.id = m.user_id\nWHERE m.status = 'finished'\n  AND m.started_at &gt;= (NOW(3) - INTERVAL 30 DAY)\n  AND m.mode IN ('td','pve','pvp')\nGROUP BY m.user_id, u.nickname\nHAVING COUNT(*) &gt;= 5\nORDER BY winrate_pct DESC, matches DESC;\n</code></pre>"},{"location":"theory/architecture.html#183-difficulty-funnel-td","title":"1.8.3. Difficulty funnel (\u0433\u0434\u0435 \u0447\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u201c\u043e\u0442\u0432\u0430\u043b\u0438\u0432\u0430\u044e\u0442\u0441\u044f\u201d) \u0434\u043b\u044f TD \u043f\u043e \u0432\u043e\u043b\u043d\u0430\u043c","text":"<p>\u0418\u0434\u0435\u044f: \u043d\u0430 \u043a\u0430\u043a\u043e\u0439 \u0432\u043e\u043b\u043d\u0435 \u0438\u0433\u0440\u043e\u043a\u0438 \u0447\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0442 \u043c\u0430\u0442\u0447 \u043f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c.</p> <p>\u0421\u0447\u0438\u0442\u0430\u0435\u043c \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043f\u043e <code>wave_reached</code>:</p> <pre><code>SELECT\n  br.wave_reached,\n  COUNT(*) AS losses_count\nFROM matches m\nJOIN battle_results br ON br.match_id = m.id\nWHERE m.mode = 'td'\n  AND m.status = 'finished'\n  AND br.is_win = 0\n  AND m.season = 1\nGROUP BY br.wave_reached\nORDER BY losses_count DESC, br.wave_reached ASC;\n</code></pre> <p>Funnel \u043f\u043e \u0432\u043e\u043b\u043d\u0430\u043c: \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043c\u0430\u0442\u0447\u0435\u0439 \u201c\u0434\u043e\u0448\u043b\u0438 \u0445\u043e\u0442\u044f \u0431\u044b \u0434\u043e wave N\u201d (\u0447\u0430\u0441\u0442\u043e \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u0431\u0430\u043b\u0430\u043d\u0441\u0430: \u0433\u0434\u0435 \u0440\u0435\u0437\u043a\u0438\u0439 \u0441\u043f\u0430\u0434 \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f)</p> <pre><code>SELECT\n  w.wave_number,\n  COUNT(DISTINCT w.match_id) AS matches_reached_wave\nFROM match_waves w\nJOIN matches m ON m.id = w.match_id\nWHERE m.mode = 'td'\n  AND m.status IN ('finished','abandoned')\n  AND m.season = 1\nGROUP BY w.wave_number\nORDER BY w.wave_number ASC;\n</code></pre>"},{"location":"theory/architecture.html#19-rest-endpoints-strategytd-json","title":"1.9. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0435 REST endpoints \u0434\u043b\u044f Strategy/TD + JSON \u043f\u0440\u0438\u043c\u0435\u0440\u044b","text":"<p>\u041d\u0438\u0436\u0435 \u2014 \u201c\u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043c\u0438\u043d\u0438\u043c\u0443\u043c\u201d \u0434\u043b\u044f \u043c\u0430\u0442\u0447\u0435\u0439. \u0412\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b (\u043a\u0440\u043e\u043c\u0435 register/login) \u0442\u0440\u0435\u0431\u0443\u044e\u0442 JWT.</p>"},{"location":"theory/architecture.html#191-post-matchstart","title":"1.9.1. POST <code>/match/start</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043c\u0430\u0442\u0447, \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e \u043c\u0430\u0442\u0447\u0430, \u0432\u0435\u0440\u043d\u0443\u0442\u044c <code>matchId</code>.</p> <p>Request</p> <pre><code>POST /match/start\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"mode\": \"td\",\n  \"mapCode\": \"forest_01\",\n  \"season\": 1,\n  \"clientVersion\": \"1.0.3\"\n}\n</code></pre> <p>Response (201)</p> <pre><code>{\n  \"matchId\": 987654321,\n  \"status\": \"started\",\n  \"startedAt\": \"2026-02-25T22:10:12.345Z\"\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400</code> \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u043f\u043e\u043b\u044f</li> <li><code>401</code> \u043d\u0435\u0442/\u043d\u0435\u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0439 JWT</li> <li><code>409</code> \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u043c\u0430\u0442\u0447 (\u0435\u0441\u043b\u0438 \u0437\u0430\u043f\u0440\u0435\u0449\u0430\u0435\u0442\u0435 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0435)</li> </ul>"},{"location":"theory/architecture.html#192-post-matchevent","title":"1.9.2. POST <code>/match/event</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043c\u0430\u0442\u0447\u0430 (\u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e, \u0430\u043f\u0433\u0440\u0435\u0439\u0434, \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0432\u043e\u043b\u043d\u044b, \u0443\u0440\u043e\u043d \u0431\u0430\u0437\u0435 \u0438 \u0442.\u0434.).</p> <p>Request</p> <pre><code>POST /match/event\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"matchId\": 987654321,\n  \"eventType\": \"wave_end\",\n  \"atSecond\": 73,\n  \"payload\": {\n    \"waveNumber\": 3,\n    \"enemiesSpawned\": 20,\n    \"enemiesKilled\": 18,\n    \"baseHpLeft\": 85\n  }\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"ok\": true\n}\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0430:</p> <pre><code>{\n  \"matchId\": 987654321,\n  \"eventType\": \"build\",\n  \"atSecond\": 12,\n  \"payload\": {\n    \"buildingCode\": \"tower_arrow\",\n    \"cell\": { \"x\": 5, \"y\": 7 },\n    \"cost\": 100\n  }\n}\n</code></pre>"},{"location":"theory/architecture.html#193-post-matchfinish","title":"1.9.3. POST <code>/match/finish</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043c\u0430\u0442\u0447, \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c <code>battle_results</code>, \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441/\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0443/leaderboard \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u043e\u043d\u043d\u043e.</p> <p>Request</p> <pre><code>POST /match/finish\nAuthorization: Bearer &lt;JWT&gt;\nContent-Type: application/json\n</code></pre> <pre><code>{\n  \"matchId\": 987654321,\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 12450,\n    \"durationSeconds\": 410,\n    \"waveReached\": 12,\n    \"damageDealt\": 56000,\n    \"damageTaken\": 12000\n  },\n  \"rewards\": {\n    \"xp\": 150,\n    \"softCurrency\": 300\n  }\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"matchId\": 987654321,\n  \"status\": \"finished\",\n  \"serverAccepted\": true,\n  \"updatedProgress\": {\n    \"level\": 6,\n    \"xp\": 2450,\n    \"softCurrency\": 1200,\n    \"hardCurrency\": 10\n  },\n  \"leaderboardUpdate\": {\n    \"boardCode\": \"td_score\",\n    \"season\": 1,\n    \"newScore\": 12450\n  }\n}\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0438:</p> <ul> <li><code>400</code> \u043d\u0435\u043a\u043e\u043d\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f</li> <li><code>403</code> \u043c\u0430\u0442\u0447 \u043d\u0435 \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e</li> <li><code>409</code> \u043c\u0430\u0442\u0447 \u0443\u0436\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d</li> </ul>"},{"location":"theory/architecture.html#194-get-matchid","title":"1.9.4. GET <code>/match/{id}</code>","text":"<p>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435: \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438 \u043c\u0430\u0442\u0447\u0430 (\u0434\u043b\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u043e\u0442\u043b\u0430\u0434\u043a\u0438, \u0440\u0435\u043f\u043b\u0435\u044f, \u0430\u0434\u043c\u0438\u043d\u043a\u0438).</p> <p>Request</p> <pre><code>GET /match/987654321\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"match\": {\n    \"id\": 987654321,\n    \"mode\": \"td\",\n    \"mapCode\": \"forest_01\",\n    \"season\": 1,\n    \"status\": \"finished\",\n    \"startedAt\": \"2026-02-25T22:10:12.345Z\",\n    \"endedAt\": \"2026-02-25T22:17:02.120Z\"\n  },\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 12450,\n    \"durationSeconds\": 410,\n    \"waveReached\": 12\n  },\n  \"waves\": [\n    { \"waveNumber\": 1, \"enemiesSpawned\": 10, \"enemiesKilled\": 10, \"baseHpLeft\": 100 },\n    { \"waveNumber\": 2, \"enemiesSpawned\": 15, \"enemiesKilled\": 14, \"baseHpLeft\": 92 }\n  ],\n  \"eventsCount\": 57\n}\n</code></pre>"},{"location":"theory/architecture.html#110-","title":"1.10. \u0410\u043d\u0442\u0438\u0447\u0438\u0442-\u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f (\u0447\u0442\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435)","text":"<p>\u0426\u0435\u043b\u044c: \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0430\u0432\u0434\u043e\u043f\u043e\u0434\u043e\u0431\u043d\u044b\u0435 \u0438 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b. \u0412 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435 \u044d\u0442\u043e \u043e\u0431\u044b\u0447\u043d\u043e \u201c\u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u0430\u043d\u0442\u0438\u0447\u0438\u0442\u201d, \u0431\u0435\u0437 ML.</p>"},{"location":"theory/architecture.html#1101","title":"1.10.1. \u041e\u0431\u0449\u0430\u044f \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0430 \u0434\u043e\u0432\u0435\u0440\u0438\u044f","text":"<ul> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b, \u043a\u043b\u0438\u0435\u043d\u0442 \u2014 \u201c\u0437\u0430\u044f\u0432\u043a\u0430\u201d.</li> <li> <p>\u0421\u0435\u0440\u0432\u0435\u0440 \u0440\u0435\u0448\u0430\u0435\u0442:</p> </li> <li> <p>\u043c\u043e\u0436\u043d\u043e \u043b\u0438 \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u043c\u0430\u0442\u0447;</p> </li> <li>\u043a\u0430\u043a\u0438\u0435 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u0432\u044b\u0434\u0430\u0442\u044c;</li> <li>\u0447\u0442\u043e \u043f\u043e\u043f\u0430\u0434\u0435\u0442 \u0432 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434.</li> </ul>"},{"location":"theory/architecture.html#1102-matchstart","title":"1.10.2. \u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u043d\u0430 <code>/match/start</code>","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c:</p> <ul> <li><code>mode</code>, <code>mapCode</code>, <code>season</code> \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0442 \u0438 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u044b.</li> <li>\u0438\u0433\u0440\u043e\u043a \u043d\u0435 \u0437\u0430\u0431\u0430\u043d\u0435\u043d (<code>users.is_banned</code>).</li> <li>\u043d\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043c\u0430\u0442\u0447\u0430 (\u0435\u0441\u043b\u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u201c\u043e\u0434\u0438\u043d \u043c\u0430\u0442\u0447 \u043e\u0434\u043d\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u201d).</li> <li>\u043b\u0438\u043c\u0438\u0442 \u0447\u0430\u0441\u0442\u043e\u0442\u044b: \u043d\u0435 \u0447\u0430\u0449\u0435 N \u0441\u0442\u0430\u0440\u0442\u043e\u0432 \u0432 \u043c\u0438\u043d\u0443\u0442\u0443 (rate limit).</li> </ul>"},{"location":"theory/architecture.html#1103-matchevent","title":"1.10.3. \u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u043d\u0430 <code>/match/event</code>","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c:</p> <ul> <li>\u043c\u0430\u0442\u0447 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 <code>userId</code> \u0438\u0437 JWT, \u0441\u0442\u0430\u0442\u0443\u0441 <code>started</code>.</li> <li><code>atSecond</code> \u043d\u0435 \u0443\u0445\u043e\u0434\u0438\u0442 \u043d\u0430\u0437\u0430\u0434 (\u043c\u043e\u043d\u043e\u0442\u043e\u043d\u043d\u043e\u0441\u0442\u044c) \u0438\u043b\u0438 \u0434\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u043c\u0430\u043b\u044b\u0439 \u043b\u0430\u0433 (\u00b12 \u0441\u0435\u043a).</li> <li>\u0442\u0438\u043f \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0431\u0435\u043b\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a.</li> <li> <p>payload \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0445\u0435\u043c\u0435 (json schema / \u0440\u0443\u0447\u043d\u0430\u044f \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f):</p> </li> <li> <p><code>waveNumber</code> &gt;= 1</p> </li> <li><code>enemiesKilled &lt;= enemiesSpawned</code></li> <li><code>baseHpLeft</code> \u0432 \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 [0..maxBaseHp]</li> <li>\u0447\u0430\u0441\u0442\u043e\u0442\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439: \u043d\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 X \u0441\u043e\u0431\u044b\u0442\u0438\u0439/\u0441\u0435\u043a (\u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u0441\u043f\u0430\u043c\u0430).</li> </ul> <p>\u0414\u043b\u044f build/upgrade:</p> <ul> <li>\u0443 \u0438\u0433\u0440\u043e\u043a\u0430 \u0445\u0432\u0430\u0442\u0430\u043b\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u043d\u0430 \u043c\u043e\u043c\u0435\u043d\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (\u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u0435\u0434\u0435\u0442 \u201c\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u0431\u0430\u043b\u0430\u043d\u0441\u201d).</li> <li>\u0430\u043f\u0433\u0440\u0435\u0439\u0434 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d (\u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0437\u0434\u0430\u043d\u0438\u044f \u043d\u0435 \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 max, \u0435\u0441\u0442\u044c prerequisites).</li> <li>\u043a\u043e\u043e\u0440\u0434\u0438\u043d\u0430\u0442\u044b \u043a\u043b\u0435\u0442\u043a\u0438 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b (\u0432 \u043f\u0440\u0435\u0434\u0435\u043b\u0430\u0445 \u043a\u0430\u0440\u0442\u044b, \u043d\u0435 \u0437\u0430\u043d\u044f\u0442\u043e).</li> </ul> <p>\u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043c\u0438\u043d\u0438\u043c\u0443\u043c: \u0441\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u043d \u201c\u0441\u0438\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0431\u043e\u0439\u201d, \u043d\u043e \u043e\u0431\u044f\u0437\u0430\u043d \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0443 \u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043d\u044b\u0435 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f.</p>"},{"location":"theory/architecture.html#1104-matchfinish","title":"1.10.4. \u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u043d\u0430 <code>/match/finish</code> (\u0441\u0430\u043c\u043e\u0435 \u0432\u0430\u0436\u043d\u043e\u0435)","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043a\u043e\u043d\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c:</p> <ul> <li>\u043c\u0430\u0442\u0447 <code>started</code>, \u043d\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d.</li> <li> <p><code>durationSeconds</code> \u0441\u043e\u0433\u043b\u0430\u0441\u0443\u0435\u0442\u0441\u044f \u0441 (ended_at - started_at):</p> </li> <li> <p>\u0434\u043e\u043f\u0443\u0441\u043a\u0430\u0439\u0442\u0435 \u043f\u043e\u0433\u0440\u0435\u0448\u043d\u043e\u0441\u0442\u044c, \u043d\u043e \u043b\u043e\u0432\u0438\u0442\u0435 \u044f\u0432\u043d\u044b\u0435 \u0444\u0435\u0439\u043a\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, 30 \u0441\u0435\u043a \u0432\u043c\u0435\u0441\u0442\u043e 10 \u043c\u0438\u043d).</p> </li> <li> <p><code>waveReached</code> \u0441\u043e\u0433\u043b\u0430\u0441\u0443\u0435\u0442\u0441\u044f \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c\u0438 <code>match_waves</code>:</p> </li> <li> <p>\u043d\u0435\u043b\u044c\u0437\u044f \u0437\u0430\u044f\u0432\u0438\u0442\u044c <code>waveReached=20</code>, \u0435\u0441\u043b\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439/\u0432\u043e\u043b\u043d \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 7.</p> </li> <li> <p><code>score</code> \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u043c \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u044b/\u0440\u0435\u0436\u0438\u043c\u0430/\u0434\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438:</p> </li> <li> <p>\u043f\u0440\u0430\u0432\u0438\u043b\u043e \u201c\u0432\u0435\u0440\u0445\u043d\u0435\u0439 \u0433\u0440\u0430\u043d\u0438\u0446\u044b\u201d = \u043f\u0440\u043e\u0441\u0442\u0430\u044f \u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043c\u0438\u043b\u043b\u0438\u043e\u043d\u043e\u0432 \u043e\u0447\u043a\u043e\u0432.</p> </li> <li><code>damageDealt</code>, <code>damageTaken</code> \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043e\u0442\u0440\u0438\u0446\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438 \u0438 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u0443\u043c\u043d\u044b\u043c\u0438 \u0434\u043b\u044f \u0440\u0435\u0436\u0438\u043c\u0430.</li> </ul> <p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043d\u0430\u0433\u0440\u0430\u0434\u044b:</p> <ul> <li>\u043d\u0435 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c rewards \u043e\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043a\u0430\u043a \u0438\u0441\u0442\u0438\u043d\u0443.</li> <li> <p>\u0441\u0435\u0440\u0432\u0435\u0440 \u0441\u0430\u043c \u0440\u0430\u0441\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u043f\u043e \u0444\u043e\u0440\u043c\u0443\u043b\u0435:</p> </li> <li> <p><code>xp = baseXp(map) + k * waveReached + winBonus</code></p> </li> <li><code>softCurrency = base + waveReached * factor</code></li> <li>\u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0438\u0441\u043b\u0430\u043b rewards \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u043a \u201c\u043f\u043e\u0436\u0435\u043b\u0430\u043d\u0438\u0435\u201d, \u043d\u043e \u0441\u0440\u0430\u0432\u043d\u0438\u0432\u0430\u0439\u0442\u0435 \u0438 \u0440\u0435\u0436\u044c\u0442\u0435 \u0434\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f.</li> </ul> <p>\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 leaderboard:</p> <ul> <li> <p>\u0432 leaderboard \u0438\u0434\u0443\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b:</p> </li> <li> <p>\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u044b\u0435 \u043c\u0430\u0442\u0447\u0438</p> </li> <li>\u0431\u0435\u0437 \u0444\u043b\u0430\u0433\u043e\u0432 \u043f\u043e\u0434\u043e\u0437\u0440\u0435\u043d\u0438\u044f</li> <li>\u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438 \u2014 \u0442\u043e\u043b\u044c\u043a\u043e <code>is_win=1</code> \u0438\u043b\u0438 \u0442\u043e\u043b\u044c\u043a\u043e ranked \u0440\u0435\u0436\u0438\u043c</li> </ul>"},{"location":"theory/architecture.html#1105","title":"1.10.5. \u201c\u0424\u043b\u0430\u0433\u0438 \u043f\u043e\u0434\u043e\u0437\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438\u201d (\u0431\u0435\u0437 \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u043e\u043a, \u043d\u043e \u0434\u043b\u044f \u043b\u043e\u0433\u043e\u0432)","text":"<p>\u0421\u0442\u0430\u0432\u044c\u0442\u0435 <code>suspicion_flags</code> (\u043c\u043e\u0436\u043d\u043e \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 <code>matches</code> \u0438\u043b\u0438 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0443\u044e):</p> <ul> <li>\u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0432\u044b\u0441\u043e\u043a\u0430\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u043d\u0430\u0431\u043e\u0440\u0430 \u043e\u0447\u043a\u043e\u0432: <code>score / durationSeconds &gt; threshold</code></li> <li>\u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0443\u0440\u043e\u0432\u043d\u044f</li> <li>\u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0447\u0430\u0441\u0442\u044b\u0435 \u043c\u0430\u0442\u0447\u0438/\u0447\u0430\u0441</li> <li>\u043d\u0435\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u043e\u043b\u043d/\u043e\u0447\u043a\u043e\u0432/\u0434\u043b\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438</li> </ul> <p>\u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442, \u043b\u043e\u0433\u0438\u0440\u0443\u0439\u0442\u0435:</p> <ul> <li>userId, matchId, \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u043f\u0440\u0438\u0447\u0438\u043d\u0430 \u0444\u043b\u0430\u0433\u0430.</li> </ul>"},{"location":"theory/architecture.html#111-finish","title":"1.11. \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u0430\u044f \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u043d\u0430 finish (\u043b\u043e\u0433\u0438\u043a\u0430)","text":"<p>\u041d\u0430 <code>POST /match/finish</code> \u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u043e (\u0432 \u043e\u0434\u043d\u043e\u0439 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438):</p> <ol> <li>\u0437\u0430\u043a\u0440\u044b\u0442\u044c \u043c\u0430\u0442\u0447 (<code>matches.status='finished', ended_at=now</code>)</li> <li>\u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c <code>battle_results</code></li> <li>\u043d\u0430\u0447\u0438\u0441\u043b\u0438\u0442\u044c \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u2192 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c <code>player_progress</code></li> <li>\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c <code>statistics_daily</code></li> <li>\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c <code>leaderboard_scores</code> (upsert)</li> </ol> <p>\u0414\u043b\u044f MySQL: <code>START TRANSACTION; ... COMMIT;</code> \u0414\u043b\u044f upsert: <code>INSERT ... ON DUPLICATE KEY UPDATE ...</code></p> <p>\u041f\u0440\u0438\u043c\u0435\u0440 upsert \u0432 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434:</p> <pre><code>INSERT INTO leaderboard_scores (user_id, board_code, season, score)\nVALUES (?, 'td_score', ?, ?)\nON DUPLICATE KEY UPDATE\n  score = GREATEST(score, VALUES(score)),\n  updated_at = CURRENT_TIMESTAMP(3);\n</code></pre>"},{"location":"theory/backend_implementation.html","title":"\u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f backend\u0430","text":""},{"location":"theory/backend_implementation.html#1-4-backend","title":"1. \u0422\u0435\u043e\u0440\u0438\u044f. 4. \u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f backend\u2019\u0430 \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":"<p>\u0426\u0435\u043b\u044c \u0440\u0430\u0437\u0434\u0435\u043b\u0430 \u2014 \u043d\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \u201c\u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440\u201d, \u0430 \u043d\u0430\u0443\u0447\u0438\u0442\u044c\u0441\u044f \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c backend \u043a\u0430\u043a \u043f\u0440\u043e\u043c\u044b\u0448\u043b\u0435\u043d\u043d\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c, \u0433\u0434\u0435:</p> <ul> <li>\u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u0432\u0435\u0440\u044f\u0442\u044c (\u043a\u043b\u0438\u0435\u043d\u0442 \u2014 \u043d\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b);</li> <li>\u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u0443\u0435\u0442\u0441\u044f (stateless);</li> <li>\u043e\u0448\u0438\u0431\u043a\u0438 \u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u044b (\u0435\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442);</li> <li>\u0434\u0430\u043d\u043d\u044b\u0435 \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u044b (\u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 + \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f);</li> <li>\u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0435\u043c\u043e (\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 + requestId).</li> </ul>"},{"location":"theory/backend_implementation.html#40-backend-crud","title":"4.0. \u041f\u043e\u0447\u0435\u043c\u0443 backend \u0438\u0433\u0440\u044b \u2014 \u044d\u0442\u043e \u043d\u0435 \u043f\u0440\u043e\u0441\u0442\u043e CRUD","text":"<p>\u0418\u0433\u0440\u043e\u0432\u043e\u0439 backend \u0440\u0435\u0448\u0430\u0435\u0442 3 \u043a\u043b\u0430\u0441\u0441\u0430 \u0437\u0430\u0434\u0430\u0447:</p> <ol> <li>\u0413\u0435\u0439\u043c\u043f\u043b\u0435\u0439\u043d\u044b\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430: \u043a\u0442\u043e \u0447\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u0442\u044c, \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043d\u0430\u0447\u0438\u0441\u043b\u0438\u0442\u044c, \u0447\u0442\u043e \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u044c.</li> <li>\u0426\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u044c: \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u0432\u0430\u043b\u044e\u0442\u0430, \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u043c\u0430\u0442\u0447\u0435\u0439 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0441\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f.</li> <li>\u041d\u0430\u0431\u043b\u044e\u0434\u0430\u0435\u043c\u043e\u0441\u0442\u044c \u0438 \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435: \u0435\u0441\u043b\u0438 \u0438\u0433\u0440\u043e\u043a \u043f\u0438\u0448\u0435\u0442 \u201c\u0443 \u043c\u0435\u043d\u044f \u043f\u0440\u043e\u043f\u0430\u043b\u0430 \u0432\u0430\u043b\u044e\u0442\u0430\u201d \u0438\u043b\u0438 \u201c\u043c\u0435\u043d\u044f \u0431\u0430\u043d\u044f\u0442 \u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e\u201d, \u043d\u0443\u0436\u043d\u044b \u0441\u043e\u0431\u044b\u0442\u0438\u044f, \u043b\u043e\u0433\u0438, \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u044f.</li> </ol> <p>\u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u201c\u0431\u044b\u0441\u0442\u0440\u043e \u043d\u0430\u043a\u0438\u0434\u0430\u0442\u044c \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442\u044b\u201d \u043d\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u2014 \u043d\u0443\u0436\u043d\u0430 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430.</p>"},{"location":"theory/backend_implementation.html#41-backend-mvp","title":"4.1. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0447\u0430\u044f \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 backend (MVP) \u2014 \u043f\u043e\u0447\u0435\u043c\u0443 \u0438\u043c\u0435\u043d\u043d\u043e \u0442\u0430\u043a\u043e\u0439 \u043a\u043e\u043d\u0432\u0435\u0439\u0435\u0440","text":"<p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u043e\u0442\u043e\u043a\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430:</p> <pre><code>Request\n  \u2192 requestId + logging\n  \u2192 JWT auth\n  \u2192 Validation\n  \u2192 Controller\n  \u2192 Service (business + transactions)\n  \u2192 Repository (SQL)\n  \u2192 Response (JSON)\nError \u2192 errorHandler \u2192 JSON + logging\n</code></pre>"},{"location":"theory/backend_implementation.html#_1","title":"\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435 \u201c\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u0441\u0440\u0430\u0437\u0443 \u0432 \u0411\u0414\u201d?","text":"<p>\u041f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0432 \u0438\u0433\u0440\u0430\u0445 \u043d\u0435\u0438\u0437\u0431\u0435\u0436\u043d\u043e \u043f\u043e\u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f:</p> <ul> <li>\u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043d\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0442\u0430\u0431\u043b\u0438\u0446;</li> <li>\u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0430\u043d\u0442\u0438\u0447\u0438\u0442\u0430;</li> <li>\u0440\u0430\u0441\u0447\u0451\u0442 \u043d\u0430\u0433\u0440\u0430\u0434;</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 + \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u0430.</li> </ul> <p>\u0415\u0441\u043b\u0438 \u0432\u0441\u0451 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0432 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435, \u0442\u043e:</p> <ul> <li>\u043a\u043e\u0434 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0431\u0435\u0437 HTTP;</li> <li>\u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u201cfinish match\u201d \u0438\u0437 \u0434\u0432\u0443\u0445 \u0440\u0430\u0437\u043d\u044b\u0445 \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442\u043e\u0432);</li> <li>\u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u043e\u0432\u044b\u0445 \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0445\u0430\u043e\u0441\u0443.</li> </ul>"},{"location":"theory/backend_implementation.html#411-post-event","title":"4.1.1. \u041f\u0440\u0438\u043c\u0435\u0440 \u201c\u043a\u0430\u043a \u0437\u0430\u043f\u0440\u043e\u0441 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u043f\u043e \u0441\u043b\u043e\u044f\u043c\u201d (POST <code>/event</code>)","text":"<p>1) RequestId + logging \u041f\u043e\u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f <code>requestId=abc123</code> \u0438 \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0444\u0430\u043a\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u0430.</p> <p>2) JWT auth \u0418\u0437 \u0442\u043e\u043a\u0435\u043d\u0430 \u0434\u043e\u0441\u0442\u0430\u0451\u043c <code>userId=15</code>, <code>roles=['player']</code>.</p> <p>3) Validation \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u0447\u0442\u043e:</p> <ul> <li><code>eventType</code> \u0441\u0442\u0440\u043e\u043a\u0430 \u0438\u0437 whitelist</li> <li><code>payload</code> \u043e\u0431\u044a\u0435\u043a\u0442</li> <li><code>sessionId</code> \u0447\u0438\u0441\u043b\u043e \u0438\u043b\u0438 null</li> </ul> <p>\u0415\u0441\u043b\u0438 \u043d\u0435 \u0442\u0430\u043a \u2014 400 \u0431\u0435\u0437 \u043f\u043e\u0445\u043e\u0434\u0430 \u0432 \u0411\u0414.</p> <p>4) Controller \u0422\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u0442 HTTP \u2192 \u043a\u043e\u043c\u0430\u043d\u0434\u0443:</p> <ul> <li>\u0432\u0437\u044f\u0442\u044c body</li> <li>\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c userId</li> <li>\u0432\u044b\u0437\u0432\u0430\u0442\u044c service</li> </ul> <p>5) Service \u0420\u0435\u0448\u0430\u0435\u0442 \u0431\u0438\u0437\u043d\u0435\u0441:</p> <ul> <li>\u043c\u043e\u0436\u043d\u043e \u043b\u0438 \u044d\u0442\u043e\u043c\u0443 user \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0442\u0430\u043a\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f?</li> <li>\u043d\u0430\u0434\u043e \u043b\u0438 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441/\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0443?</li> <li>\u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u0438\u043c\u0438\u0442\u044b \u0447\u0430\u0441\u0442\u043e\u0442\u044b \u0441\u043e\u0431\u044b\u0442\u0438\u0439</li> <li>\u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0435</li> </ul> <p>6) Repository \u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 SQL <code>INSERT INTO game_events ...</code>.</p> <p>7) Response \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 <code>{ ok:true }</code>.</p>"},{"location":"theory/backend_implementation.html#42","title":"4.2. \u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f) \u2014 \u0437\u0430\u0447\u0435\u043c \u0442\u0430\u043a\u043e\u0435 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435","text":"<pre><code>/src\n  /config\n  /models\n  /repositories\n  /services\n  /controllers\n  /middleware\n  /routes\n  /docs\n  app.js\n  server.js\n</code></pre>"},{"location":"theory/backend_implementation.html#controllers","title":"\u041f\u043e\u0447\u0435\u043c\u0443 <code>controllers</code> \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u201c\u0442\u043e\u043d\u043a\u0438\u043c\u0438\u201d","text":"<p>\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u2014 \u044d\u0442\u043e \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u043d\u044b\u0439 \u0441\u043b\u043e\u0439. \u041e\u043d \u043e\u0431\u044f\u0437\u0430\u043d:</p> <ul> <li>\u0447\u0438\u0442\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441,</li> <li>\u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0443,</li> <li>\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442.</li> </ul> <p>\u0415\u0441\u043b\u0438 \u0432 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435 \u043e\u043a\u0430\u0436\u0443\u0442\u0441\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u0430:</p> <ul> <li>\u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 (progress \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432 3 \u043c\u0435\u0441\u0442\u0430\u0445);</li> <li>\u0432\u044b \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u201cfinish match\u201d \u0438\u0437 \u0430\u0434\u043c\u0438\u043d\u043a\u0438;</li> <li>unit-\u0442\u0435\u0441\u0442\u044b \u043f\u0440\u0435\u0432\u0440\u0430\u0442\u044f\u0442\u0441\u044f \u0432 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 (\u0434\u043e\u043b\u0433\u043e \u0438 \u0431\u043e\u043b\u044c\u043d\u043e).</li> </ul>"},{"location":"theory/backend_implementation.html#services","title":"\u041f\u043e\u0447\u0435\u043c\u0443 <code>services</code> \u2014 \u044d\u0442\u043e \u0446\u0435\u043d\u0442\u0440 \u0441\u0438\u0441\u0442\u0435\u043c\u044b","text":"<p>\u041f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0441\u0435\u0440\u0432\u0438\u0441\u044b:</p> <ul> <li>\u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 (\u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f, \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f, \u0430\u043d\u0442\u0438\u0447\u0438\u0442-\u043f\u043e\u0440\u043e\u0433\u0438);</li> <li>\u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f\u043c\u0438;</li> <li>\u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0435\u0432.</li> </ul> <p>\u0418\u043c\u0435\u043d\u043d\u043e \u0441\u0435\u0440\u0432\u0438\u0441\u044b \u2014 \u0442\u043e, \u0447\u0442\u043e \u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c \u043f\u043e\u0434 \u0436\u0430\u043d\u0440\u044b.</p>"},{"location":"theory/backend_implementation.html#repositories-sql","title":"\u041f\u043e\u0447\u0435\u043c\u0443 <code>repositories</code> \u2014 \u0442\u043e\u043b\u044c\u043a\u043e SQL","text":"<p>\u0427\u0442\u043e\u0431\u044b \u0431\u044b\u043b\u043e \u043f\u0440\u0430\u0432\u0438\u043b\u043e:</p> <p>\u0435\u0441\u043b\u0438 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0411\u0414/\u0438\u043d\u0434\u0435\u043a\u0441\u044b/\u0437\u0430\u043f\u0440\u043e\u0441\u044b \u2014 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439, \u0430 \u043d\u0435 \u0431\u0438\u0437\u043d\u0435\u0441-\u043b\u043e\u0433\u0438\u043a\u0430.</p> <p>\u042d\u0442\u043e \u0434\u0430\u0451\u0442:</p> <ul> <li>\u0437\u0430\u043c\u0435\u043d\u044f\u0435\u043c\u043e\u0441\u0442\u044c (MySQL \u2192 Postgres, \u0435\u0441\u043b\u0438 \u043d\u0430\u0434\u043e);</li> <li>\u0447\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u044c;</li> <li>\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0435\u0440\u0432\u0438\u0441\u044b, \u043f\u043e\u0434\u043c\u0435\u043d\u044f\u044f \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0438.</li> </ul>"},{"location":"theory/backend_implementation.html#43","title":"4.3. \u0422\u0435\u043e\u0440\u0438\u044f \u201c\u043a\u043e\u0440\u043e\u0442\u043a\u043e, \u043d\u043e \u0433\u043b\u0443\u0431\u0436\u0435\u201d: \u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a, \u0430 \u043d\u0435 \u0438\u043d\u0430\u0447\u0435","text":""},{"location":"theory/backend_implementation.html#431-stateless-rest","title":"4.3.1. Stateless REST: \u043f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435\u043b\u044c\u0437\u044f \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0430","text":"<p>\u041f\u043b\u043e\u0445\u043e\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442: \u0441\u0435\u0440\u0432\u0435\u0440 \u0445\u0440\u0430\u043d\u0438\u0442 \u201c\u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043c\u0430\u0442\u0447\u201d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.</p> <p>\u0427\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442\u0441\u044f:</p> <ul> <li>\u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0432\u0441\u0451 \u201c\u0442\u0435\u0440\u044f\u0435\u0442\u0441\u044f\u201d;</li> <li>\u043f\u0440\u0438 \u0434\u0432\u0443\u0445 \u0438\u043d\u0441\u0442\u0430\u043d\u0441\u0430\u0445 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u0432 \u0440\u0430\u0437\u043d\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043f\u043e\u043f\u0430\u0434\u0443\u0442 \u043d\u0430 \u0440\u0430\u0437\u043d\u044b\u0435 \u0438\u043d\u0441\u0442\u0430\u043d\u0441\u044b \u0438 \u201c\u043f\u0430\u043c\u044f\u0442\u044c \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0451\u0442\u201d;</li> <li>\u0441\u043a\u0435\u0439\u043b\u0438\u043d\u0433 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d \u0431\u0435\u0437 sticky sessions.</li> </ul> <p>\u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442:</p> <ul> <li>\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u2014 \u0432 \u0411\u0414 (<code>matches</code>, <code>player_progress</code>);</li> <li>\u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0435\u0441\u0443\u0442 JWT + \u043d\u0443\u0436\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435;</li> <li>\u0441\u0435\u0440\u0432\u0435\u0440 \u043c\u043e\u0436\u043d\u043e \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0448\u0438\u0440\u044c.</li> </ul>"},{"location":"theory/backend_implementation.html#432-json-xml","title":"4.3.2. JSON \u043a\u0430\u043a \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442: \u043f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435 \u201c\u043f\u0440\u043e\u0441\u0442\u043e \u0441\u0442\u0440\u043e\u043a\u0438\u201d \u0438 \u043d\u0435 \u201cXML\u201d","text":"<p>JSON:</p> <ul> <li>\u043d\u0430\u0442\u0438\u0432\u0435\u043d \u0434\u043b\u044f Web (<code>fetch</code>) \u0438 \u0443\u0434\u043e\u0431\u0435\u043d \u0434\u043b\u044f Unity (JsonUtility/Newtonsoft);</li> <li>\u0445\u043e\u0440\u043e\u0448\u043e \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f OpenAPI/Swagger;</li> <li>\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0445\u0440\u0430\u043d\u0438\u0442\u044c <code>payload</code> \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0433\u0438\u0431\u043a\u043e.</li> </ul> <p>\u0412\u0430\u0436\u043d\u043e: JSON \u043d\u0435 \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u044e \u2014 \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043d\u0443\u0436\u043d\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0441\u0445\u0435\u043c\u043e\u0439, \u0438\u043d\u0430\u0447\u0435 \u0432 \u0411\u0414 \u043e\u043a\u0430\u0436\u0435\u0442\u0441\u044f \u043c\u0443\u0441\u043e\u0440.</p>"},{"location":"theory/backend_implementation.html#433-jwt","title":"4.3.3. JWT: \u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u043e\u043a\u0435\u043d, \u0430 \u043d\u0435 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u0441\u0435\u0441\u0441\u0438\u044f","text":"<p>JWT \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442:</p> <ul> <li>stateless \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044e (\u0441\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u0445\u0440\u0430\u043d\u0438\u0442 session store);</li> <li>\u0431\u044b\u0441\u0442\u0440\u044b\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u0435;</li> <li>\u043f\u0440\u043e\u0441\u0442\u0443\u044e \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044e \u0441 Unity/Web/Mobile.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0442\u043e\u043a\u0435\u043d \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043a\u043e\u0440\u043e\u0442\u043a\u043e\u0436\u0438\u0432\u0443\u0449\u0438\u043c:</p> <ul> <li>\u0435\u0441\u043b\u0438 \u0442\u043e\u043a\u0435\u043d \u201c\u0432\u0435\u0447\u043d\u044b\u0439\u201d, \u0443\u043a\u0440\u0430\u043b\u0438 \u2192 \u0432\u0441\u0451, \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0441\u043a\u043e\u043c\u043f\u0440\u043e\u043c\u0435\u0442\u0438\u0440\u043e\u0432\u0430\u043d;</li> <li>\u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u0441\u0440\u043e\u043a + refresh (\u0435\u0441\u043b\u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0435) \u2014 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u0435\u0435.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0440\u043e\u043b\u0438 \u0432 \u0442\u043e\u043a\u0435\u043d\u0435 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u044b:</p> <ul> <li>\u044d\u0442\u043e \u0443\u0441\u043a\u043e\u0440\u044f\u0435\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 (RBAC);</li> <li>\u043d\u043e \u0431\u0430\u043d/\u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u0432 \u0411\u0414 (is_banned), \u0438\u043d\u0430\u0447\u0435 \u0442\u043e\u043a\u0435\u043d \u201c\u043e\u0431\u0445\u043e\u0434\u0438\u0442 \u0431\u0430\u043d\u201d.</li> </ul>"},{"location":"theory/backend_implementation.html#44","title":"4.4. \u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u0438 \u043e\u0448\u0438\u0431\u043e\u043a \u2014 \u0437\u0430\u0447\u0435\u043c \u044d\u0442\u043e \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0439 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435","text":"<p>\u0415\u0441\u043b\u0438 \u043e\u0448\u0438\u0431\u043a\u0438 \u0443 \u0440\u0430\u0437\u043d\u044b\u0445 \u044d\u043d\u0434\u043f\u043e\u0438\u043d\u0442\u043e\u0432 \u0440\u0430\u0437\u043d\u044b\u0435:</p> <ul> <li>\u043a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c (Unity \u043d\u0430\u0447\u043d\u0451\u0442 \u201c\u043f\u0430\u0434\u0430\u0442\u044c\u201d \u043d\u0430 \u043d\u0435\u043e\u0436\u0438\u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u043b\u044f\u0445);</li> <li>\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0432 \u0430\u0434;</li> <li>\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0441 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u043e\u0439.</li> </ul>"},{"location":"theory/backend_implementation.html#_2","title":"\u0423\u0441\u043f\u0435\u0445","text":"<pre><code>{ \"ok\": true, \"data\": { } }\n</code></pre>"},{"location":"theory/backend_implementation.html#_3","title":"\u041e\u0448\u0438\u0431\u043a\u0430","text":"<pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Field level must be &gt;= 1\",\n    \"requestId\": \"req_01HF...\"\n  }\n}\n</code></pre>"},{"location":"theory/backend_implementation.html#requestid","title":"\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0443\u0436\u0435\u043d requestId","text":"<p>\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439 \u0438\u0437 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0438:</p> <ul> <li>\u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u0442\u0435\u0441\u0442\u0438\u0440\u0443\u0435\u0442 <code>/progress</code>, \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443 \u201c500\u201d.</li> <li> <p>\u043f\u043e requestId \u0432\u044b \u0432 \u043b\u043e\u0433\u0430\u0445 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0435:</p> </li> <li> <p>SQL \u043e\u0448\u0438\u0431\u043a\u0443,</p> </li> <li>userId,</li> <li>\u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b,</li> <li>stack trace.</li> </ul> <p>\u0411\u0435\u0437 requestId \u044d\u0442\u043e \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0432 \u201c\u043d\u0435 \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0441\u044f\u201d.</p>"},{"location":"theory/backend_implementation.html#45-middleware","title":"4.5. Middleware (\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435) \u2014 \u043f\u043e\u0447\u0435\u043c\u0443 \u0438\u043c\u0435\u043d\u043d\u043e \u043e\u043d\u0438 \u0438 \u0433\u0434\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b","text":""},{"location":"theory/backend_implementation.html#451-requestidmiddleware","title":"4.5.1. requestId.middleware \u2014 \u043f\u0440\u0438\u043c\u0435\u0440","text":"<p>\u0417\u0430\u0434\u0430\u0447\u0430: \u043a\u043e\u0440\u0440\u0435\u043b\u044f\u0446\u0438\u044f \u043b\u043e\u0433\u043e\u0432 \u0438 \u043e\u0442\u0432\u0435\u0442\u0430.</p> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f:</p> <ul> <li>Header \u043e\u0442\u0432\u0435\u0442\u0430: <code>X-Request-Id: req_abc123</code></li> <li>\u041b\u043e\u0433: <code>req_abc123 POST /event 200 12ms user=15</code></li> </ul>"},{"location":"theory/backend_implementation.html#452-loggermiddleware","title":"4.5.2. logger.middleware \u2014 \u0447\u0442\u043e \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0447\u0435\u0433\u043e \u043d\u0435\u043b\u044c\u0437\u044f","text":"<p>\u041b\u043e\u0433\u0438\u0440\u0443\u0435\u043c:</p> <ul> <li>\u043c\u0435\u0442\u043e\u0434, \u043f\u0443\u0442\u044c, \u0441\u0442\u0430\u0442\u0443\u0441, duration</li> <li>requestId</li> <li>userId (\u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c)</li> <li>\u043e\u0448\u0438\u0431\u043a\u0438</li> </ul> <p>\u041d\u0435\u043b\u044c\u0437\u044f \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c:</p> <ul> <li>\u043f\u0430\u0440\u043e\u043b\u044c</li> <li>\u043f\u043e\u043b\u043d\u044b\u0439 JWT</li> <li>\u043f\u043b\u0430\u0442\u0435\u0436\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u0442\u0440\u043e\u043a\u0438 \u043b\u043e\u0433\u0430:</p> <pre><code>req_abc123 user=15 POST /progress 200 18ms\n</code></pre>"},{"location":"theory/backend_implementation.html#453-authjwtmiddleware","title":"4.5.3. authJwt.middleware \u2014 \u043f\u0440\u0438\u043c\u0435\u0440 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:</p> <pre><code>GET /profile\nAuthorization: Bearer &lt;JWT&gt;\n</code></pre> <p>\u041f\u043e\u0441\u043b\u0435 middleware:</p> <pre><code>req.user = { id: 15, roles: [\"player\"] }\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0443\u0434\u043e\u0431\u043d\u043e:</p> <ul> <li>\u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u044b \u043d\u0435 \u201c\u043f\u0430\u0440\u0441\u044f\u0442\u201d JWT \u0441\u0430\u043c\u0438;</li> <li>\u043b\u044e\u0431\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u0430 (401).</li> </ul>"},{"location":"theory/backend_implementation.html#454-validatemiddleware","title":"4.5.4. validate.middleware \u2014 \u043f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0434\u043e \u0411\u0414","text":"<p>\u0415\u0441\u043b\u0438 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438 \u043d\u0435\u0442:</p> <ul> <li>\u0432 \u0411\u0414 \u043f\u043e\u043f\u0430\u0434\u0443\u0442 <code>level = -999</code>;</li> <li>\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430/\u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u044b \u0441\u043b\u043e\u043c\u0430\u044e\u0442\u0441\u044f;</li> <li>\u0430\u043d\u0442\u0438\u0447\u0438\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d.</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440 \u201c\u0441\u0445\u0435\u043c\u044b\u201d \u0434\u043b\u044f <code>/event</code> (\u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0443\u0430\u043b\u044c\u043d\u043e):</p> <ul> <li><code>eventType</code>: string enum</li> <li><code>sessionId</code>: number|null</li> <li><code>payload</code>: object</li> </ul>"},{"location":"theory/backend_implementation.html#455-ratelimitmiddleware","title":"4.5.5. rateLimit.middleware \u2014 \u0437\u0430\u0447\u0435\u043c \u0432 \u0438\u0433\u0440\u0430\u0445 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e","text":"<p>\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u043a\u043b\u0438\u0435\u043d\u0442 \u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043e\u0447\u0435\u043d\u044c \u0447\u0430\u0441\u0442\u043e. \u0415\u0441\u043b\u0438 \u0438\u0433\u0440\u043e\u043a (\u0438\u043b\u0438 \u0431\u043e\u0442) \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 500 req/s:</p> <ul> <li>\u0441\u0435\u0440\u0432\u0435\u0440 \u043b\u043e\u0436\u0438\u0442\u0441\u044f;</li> <li>\u0411\u0414 \u043f\u0435\u0440\u0435\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f;</li> <li>\u0443 \u0432\u0430\u0441 DoS \u0441\u0432\u043e\u0438\u043c\u0438 \u0440\u0443\u043a\u0430\u043c\u0438.</li> </ul> <p>\u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043c\u0438\u043d\u0438\u043c\u0443\u043c:</p> <ul> <li><code>/login</code> \u2014 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u043a\u0438 (brute force)</li> <li><code>/event</code> \u2014 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u044c \u0447\u0430\u0441\u0442\u043e\u0442\u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u0439</li> <li><code>/progress</code> \u2014 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442\u044c \u0430\u043f\u0434\u0435\u0439\u0442\u044b \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430</li> </ul>"},{"location":"theory/backend_implementation.html#456-errormiddleware-trycatch","title":"4.5.6. error.middleware \u2014 \u043f\u043e\u0447\u0435\u043c\u0443 \u0435\u0434\u0438\u043d\u044b\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043b\u0443\u0447\u0448\u0435 \u201ctry/catch \u0432\u0435\u0437\u0434\u0435\u201d","text":"<p>\u0415\u0441\u043b\u0438 try/catch \u0432 \u043a\u0430\u0436\u0434\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440\u0435:</p> <ul> <li>\u0447\u0430\u0441\u0442\u044c \u043e\u0448\u0438\u0431\u043e\u043a \u0437\u0430\u0431\u044b\u0432\u0430\u044e\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c;</li> <li>\u043e\u0442\u0432\u0435\u0442\u044b \u0441\u0442\u0430\u043d\u043e\u0432\u044f\u0442\u0441\u044f \u0440\u0430\u0437\u043d\u044b\u043c\u0438;</li> <li>stack trace \u0442\u0435\u0440\u044f\u0435\u0442\u0441\u044f.</li> </ul> <p>\u0415\u0434\u0438\u043d\u044b\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a:</p> <ul> <li>\u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u0438\u0442 \u043b\u044e\u0431\u043e\u0435 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435;</li> <li>\u0432\u0435\u0440\u043d\u0451\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0439 JSON;</li> <li>\u0437\u0430\u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442.</li> </ul>"},{"location":"theory/backend_implementation.html#46-backend","title":"4.6. \u0421\u043b\u043e\u0438 backend: \u0447\u0442\u043e \u0432 \u043a\u0430\u043a\u043e\u043c \u0444\u0430\u0439\u043b\u0435 (\u0441 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u043c\u0438 \u201c\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u043d\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0435\u0442\u044c\u201d)","text":"<p>\u041d\u0438\u0436\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043a\u043e\u0434\u0430 (\u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0435, \u0447\u0442\u043e\u0431\u044b \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043f\u043e\u043d\u044f\u043b \u0438\u0434\u0435\u044e).</p>"},{"location":"theory/backend_implementation.html#461-controller-progress","title":"4.6.1. Controller: \u0442\u043e\u043d\u043a\u0438\u0439 \u0441\u043b\u043e\u0439 (\u043f\u0440\u0438\u043c\u0435\u0440 <code>/progress</code>)","text":"<pre><code>// progress.controller.js (\u0438\u0434\u0435\u043e\u043b\u043e\u0433\u0438\u044f)\nasync function postProgress(req, res, next) {\n  try {\n    const userId = req.user.id;\n    const dto = req.body;              // \u0443\u0436\u0435 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u0434\u0438\u0440\u043e\u0432\u0430\u043d middleware\n    const result = await progressService.updateProgress(userId, dto);\n    res.json({ ok: true, data: result });\n  } catch (e) { next(e); }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a: \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u043b\u0435\u0440 \u043d\u0435 \u0437\u043d\u0430\u0435\u0442 \u043f\u0440\u043e SQL \u0438 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438.</p>"},{"location":"theory/backend_implementation.html#462-service-","title":"4.6.2. Service: \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u0440\u0430\u0432\u0438\u043b\u0430 + \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438","text":"<pre><code>// progress.service.js (\u0438\u0434\u0435\u043e\u043b\u043e\u0433\u0438\u044f)\nasync function updateProgress(userId, dto) {\n  // \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u0440\u0430\u0432\u0438\u043b\u0430: \u0434\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u044b, \u0430\u043d\u0442\u0438\u0447\u0438\u0442-\u043f\u043e\u0440\u043e\u0433\u0438, \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c\n  // \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f: progress + event log + stats update\n  return db.transaction(async (tx) =&gt; {\n    await progressRepo.upsert(tx, userId, dto);\n    await eventRepo.insert(tx, userId, null, \"progress_update\", dto);\n    await statsRepo.incrementDaily(tx, userId, { events: 1 });\n    return await progressRepo.getByUserId(tx, userId);\n  });\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a: \u0435\u0441\u043b\u0438 \u0437\u0430\u043f\u0438\u0441\u0430\u043b\u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u043d\u043e \u043d\u0435 \u0437\u0430\u043f\u0438\u0441\u0430\u043b\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u2014 \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u043c. \u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u0440\u0435\u0448\u0430\u0435\u0442.</p>"},{"location":"theory/backend_implementation.html#463-repository-sql","title":"4.6.3. Repository: \u0442\u043e\u043b\u044c\u043a\u043e SQL","text":"<pre><code>// progress.repo.js (\u0438\u0434\u0435\u043e\u043b\u043e\u0433\u0438\u044f)\nasync function upsert(tx, userId, dto) {\n  // INSERT ... ON DUPLICATE KEY UPDATE\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0442\u0430\u043a: \u0440\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439 \u043d\u0435 \u0440\u0435\u0448\u0430\u0435\u0442 \u201c\u043c\u043e\u0436\u043d\u043e/\u043d\u0435\u043b\u044c\u0437\u044f\u201d, \u043e\u043d \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0437\u0430\u043f\u0440\u043e\u0441.</p>"},{"location":"theory/backend_implementation.html#47-endpoints","title":"4.7. \u0420\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u043c\u043e\u0434\u0443\u043b\u0435\u0439 \u043f\u043e endpoints (\u0441 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u043c\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432/\u043e\u0442\u0432\u0435\u0442\u043e\u0432)","text":""},{"location":"theory/backend_implementation.html#471-post-register","title":"4.7.1. POST <code>/register</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u043e \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u0442\u044c \u0440\u043e\u043b\u044c \u0441\u0440\u0430\u0437\u0443: \u0438\u043d\u0430\u0447\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u201c\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439\u201d \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u044b \u0440\u0430\u0437\u044a\u0435\u0434\u0443\u0442\u0441\u044f.</p> <p>Request</p> <pre><code>{ \"email\": \"a@b.com\", \"password\": \"12345678\", \"nickname\": \"Player1\" }\n</code></pre> <p>Response 201</p> <pre><code>{ \"ok\": true, \"data\": { \"userId\": 15 } }\n</code></pre>"},{"location":"theory/backend_implementation.html#472-post-login","title":"4.7.2. POST <code>/login</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c ban \u043d\u0430 login: \u0438\u043d\u0430\u0447\u0435 \u0437\u0430\u0431\u0430\u043d\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0442\u043e\u043a\u0435\u043d\u043e\u043c.</p> <p>Request</p> <pre><code>{ \"email\": \"a@b.com\", \"password\": \"12345678\" }\n</code></pre> <p>Response 200</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"accessToken\": \"&lt;JWT&gt;\",\n    \"tokenType\": \"Bearer\",\n    \"expiresInSeconds\": 3600\n  }\n}\n</code></pre>"},{"location":"theory/backend_implementation.html#473-get-profile","title":"4.7.3. GET <code>/profile</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u043c, \u0430 \u043d\u0435 \u043e\u0434\u043d\u0438\u043c SELECT: \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u044d\u0442\u043e \u201c\u0432\u0438\u0442\u0440\u0438\u043d\u0430\u201d \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u043e\u0432 (users + progress + leaderboard snapshot).</p> <p>Response</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"user\": { \"id\": 15, \"email\": \"a@b.com\", \"nickname\": \"Player1\" },\n    \"progress\": { \"level\": 6, \"xp\": 2450, \"softCurrency\": 1200, \"hardCurrency\": 10 }\n  }\n}\n</code></pre>"},{"location":"theory/backend_implementation.html#474-post-event","title":"4.7.4. POST <code>/event</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 whitelist event_type: \u0438\u043d\u0430\u0447\u0435 \u0438\u0433\u0440\u043e\u043a \u0441\u043c\u043e\u0436\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u201cadmin_grant_currency\u201d.</p> <p>Request</p> <pre><code>{\n  \"sessionId\": 991,\n  \"eventType\": \"match_finish\",\n  \"payload\": { \"isWin\": true, \"score\": 12450, \"durationSeconds\": 410 }\n}\n</code></pre> <p>Response</p> <pre><code>{ \"ok\": true, \"data\": { \"accepted\": true } }\n</code></pre>"},{"location":"theory/backend_implementation.html#475-post-progress","title":"4.7.5. POST <code>/progress</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u201c\u043a\u0430\u043a \u0435\u0441\u0442\u044c\u201d: \u0438\u0433\u0440\u043e\u043a \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0441\u043b\u0430\u0442\u044c <code>hard_currency=999999</code>.</p> <p>\u041f\u043e\u044d\u0442\u043e\u043c\u0443:</p> <ul> <li>\u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043a\u0430\u043a \u201c\u0437\u0430\u044f\u0432\u043a\u0443\u201d</li> <li>\u0440\u0435\u0436\u0435\u0442/\u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u043e \u043f\u0440\u0430\u0432\u0438\u043b\u0430\u043c (\u0430\u043d\u0442\u0438\u0447\u0438\u0442)</li> </ul> <p>Request</p> <pre><code>{ \"level\": 6, \"xp\": 2450, \"softCurrency\": 1200, \"hardCurrency\": 10 }\n</code></pre>"},{"location":"theory/backend_implementation.html#476-get-leaderboard","title":"4.7.6. GET <code>/leaderboard</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 leaderboard \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u0430: \u0438\u043d\u0430\u0447\u0435 \u043f\u0440\u0438\u0434\u0451\u0442\u0441\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c events \u0438\u043b\u0438 stats \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437.</p> <p>Response</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"boardCode\": \"td_score\",\n    \"season\": 1,\n    \"top\": [\n      { \"rank\": 1, \"userId\": 15, \"nickname\": \"Player1\", \"score\": 12450 },\n      { \"rank\": 2, \"userId\": 18, \"nickname\": \"Player2\", \"score\": 12010 }\n    ]\n  }\n}\n</code></pre>"},{"location":"theory/backend_implementation.html#477-get-stats","title":"4.7.7. GET <code>/stats</code>","text":"<p>\u041f\u043e\u0447\u0435\u043c\u0443 stats \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u0443\u044e\u0442\u0441\u044f: \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e events \u0440\u0430\u0441\u0442\u0443\u0442 \u0431\u044b\u0441\u0442\u0440\u043e \u0438 \u0434\u043e\u0440\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f.</p> <p>Response</p> <pre><code>{\n  \"ok\": true,\n  \"data\": {\n    \"from\": \"2026-02-01\",\n    \"to\": \"2026-02-26\",\n    \"daily\": [\n      { \"day\": \"2026-02-25\", \"sessions\": 2, \"playtimeSeconds\": 1800, \"wins\": 1, \"losses\": 0 }\n    ]\n  }\n}\n</code></pre>"},{"location":"theory/backend_implementation.html#48","title":"4.8. \u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438: \u0433\u0434\u0435 \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e \u0438 \u0447\u0442\u043e \u0431\u0443\u0434\u0435\u0442, \u0435\u0441\u043b\u0438 \u0438\u0445 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c","text":""},{"location":"theory/backend_implementation.html#481","title":"4.8.1. \u0422\u0438\u043f\u043e\u0432\u043e\u0439 \u201c\u043a\u0440\u0438\u0442\u0438\u0447\u043d\u044b\u0439\u201d \u043a\u0435\u0439\u0441: \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0447\u0430","text":"<p>\u041d\u0430 finish \u043c\u0430\u0442\u0447\u0430 \u043e\u0431\u044b\u0447\u043d\u043e \u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f 4 \u043e\u0431\u043b\u0430\u0441\u0442\u0438:</p> <ol> <li>\u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 (battle_results / event)</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 (xp/level/currency)</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c stats_daily</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c leaderboard (upsert)</li> </ol> <p>\u0415\u0441\u043b\u0438 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0431\u0435\u0437 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438:</p> <ul> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043e\u0431\u043d\u043e\u0432\u0438\u043b\u0441\u044f, \u043d\u043e \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u2014 \u043d\u0435\u0442 \u2192 \u0438\u0433\u0440\u043e\u043a \u043d\u0435\u0434\u043e\u0432\u043e\u043b\u0435\u043d</li> <li>\u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u043e\u0431\u043d\u043e\u0432\u0438\u043b\u0441\u044f, \u043d\u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u2014 \u043d\u0435\u0442 \u2192 \u201c\u0443\u043a\u0440\u0430\u043b\u0438 \u043d\u0430\u0433\u0440\u0430\u0434\u0443\u201d</li> <li>\u0437\u0430\u043f\u0438\u0441\u0430\u043b\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0434\u0432\u0430\u0436\u0434\u044b (\u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441) \u2192 \u043d\u0430\u043a\u0440\u0443\u0442\u043a\u0430</li> </ul> <p>\u0421 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0435\u0439:</p> <ul> <li>\u043b\u0438\u0431\u043e \u0432\u0441\u0451 \u0432\u043c\u0435\u0441\u0442\u0435</li> <li>\u043b\u0438\u0431\u043e \u043d\u0438\u0447\u0435\u0433\u043e</li> </ul>"},{"location":"theory/game_integration.html","title":"\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 \u0438\u0433\u0440\u043e\u0439","text":""},{"location":"theory/game_integration.html#1-6-unity-web-mobile","title":"1. \u0422\u0435\u043e\u0440\u0438\u044f. 6. \u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0441 \u0438\u0433\u0440\u043e\u0439 (Unity / Web / Mobile)","text":""},{"location":"theory/game_integration.html#61-mvp-","title":"6.1. \u0427\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0438\u043d\u0442\u0435\u0433\u0440\u0438\u0440\u0443\u0435\u043c (MVP-\u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438)","text":"<p>\u0421\u0442\u0443\u0434\u0435\u043d\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u0443\u043c\u0435\u0442\u044c \u0441\u0432\u044f\u0437\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442 \u0441 backend \u043f\u043e \u0446\u0435\u043f\u043e\u0447\u043a\u0435:</p> <ol> <li>\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f/\u043b\u043e\u0433\u0438\u043d \u2192 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c <code>accessToken</code> (JWT)</li> <li>\u041f\u0440\u043e\u0444\u0438\u043b\u044c \u2192 <code>GET /profile</code> (\u0432\u0438\u0442\u0440\u0438\u043d\u0430: user + progress)</li> <li>\u0421\u043e\u0431\u044b\u0442\u0438\u044f \u2192 <code>POST /events</code> (\u0442\u0435\u043b\u0435\u043c\u0435\u0442\u0440\u0438\u044f: match_finish, currency_change\u2026)</li> <li>\u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u2192 <code>POST /progress</code> (\u0435\u0441\u043b\u0438 \u0432\u044b \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0435 snapshot \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e)</li> <li>\u041b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434/\u0441\u0442\u0430\u0442\u0430 \u2192 <code>GET /leaderboard</code>, <code>GET /stats</code></li> <li>\u041e\u0448\u0438\u0431\u043a\u0438/\u043b\u0438\u043c\u0438\u0442\u044b/\u0431\u0430\u043d \u2192 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c 400/401/403/409/429/500</li> </ol> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0438\u043c\u0435\u043d\u043d\u043e \u044d\u0442\u0438 6 \u0448\u0430\u0433\u043e\u0432: \u043e\u043d\u0438 \u043f\u043e\u043a\u0440\u044b\u0432\u0430\u044e\u0442 \u0432\u0435\u0441\u044c \u043a\u043e\u043d\u0442\u0443\u0440 \u201c\u043a\u043b\u0438\u0435\u043d\u0442 \u2192 \u0441\u0435\u0440\u0432\u0435\u0440 \u2192 \u0411\u0414 \u2192 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u201d, \u0438 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0442, \u0447\u0442\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0443, \u0430 \u043d\u0435 \u201c\u043f\u0440\u043e\u0441\u0442\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b \u0437\u0430\u043f\u0440\u043e\u0441\u201d.</p>"},{"location":"theory/game_integration.html#62","title":"6.2. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0441\u043a\u043e\u0433\u043e \u0441\u0435\u0442\u0435\u0432\u043e\u0433\u043e \u0441\u043b\u043e\u044f (\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0443\u0441\u0442\u0440\u043e\u0435\u043d\u043e)","text":""},{"location":"theory/game_integration.html#621","title":"6.2.1. \u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b \u043d\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0435","text":"<p>1) ApiClient \u2014 \u0443\u043c\u0435\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c HTTP, \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c JWT, \u043f\u0430\u0440\u0441\u0438\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b 2) TokenStore \u2014 \u0445\u0440\u0430\u043d\u0438\u0442 \u0442\u043e\u043a\u0435\u043d (\u0432 Unity: PlayerPrefs/secure storage; Web: memory/secure storage) 3) EventQueue \u2014 \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u043f\u0440\u0438 \u043e\u0444\u043b\u0430\u0439\u043d\u0435/\u043e\u0448\u0438\u0431\u043a\u0430\u0445 4) ErrorMapper \u2014 \u043f\u0435\u0440\u0435\u0432\u043e\u0434 <code>error.code</code> \u0432 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f (logout/backoff)</p> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435\u043b\u044c\u0437\u044f \u201c\u043f\u0440\u044f\u043c\u043e \u0432 \u043a\u043d\u043e\u043f\u043a\u0435 \u0441\u0434\u0435\u043b\u0430\u0442\u044c fetch()\u201d:</p> <ul> <li>\u0442\u043e\u043a\u0435\u043d \u0437\u0430\u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043e\u0434\u043d\u043e\u043c \u0438\u0437 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432;</li> <li>\u043e\u0448\u0438\u0431\u043a\u0438 \u0431\u0443\u0434\u0443\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b \u043f\u043e-\u0440\u0430\u0437\u043d\u043e\u043c\u0443;</li> <li>\u043d\u0435\u043b\u044c\u0437\u044f \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0435\u0442\u0440\u0430\u0438, \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u0442\u0430\u0439\u043c\u0430\u0443\u0442.</li> </ul>"},{"location":"theory/game_integration.html#63-httpjson","title":"6.3. \u041a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 HTTP/JSON: \u0447\u0442\u043e \u043e\u0431\u044f\u0437\u0430\u043d\u043e \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u0442\u044c\u0441\u044f","text":""},{"location":"theory/game_integration.html#631","title":"6.3.1. \u0415\u0434\u0438\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u043e\u0442\u0432\u0435\u0442\u0430 (\u0447\u0442\u043e\u0431\u044b \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u0441\u0435\u0433\u0434\u0430 \u0437\u043d\u0430\u043b, \u0447\u0442\u043e \u043f\u0430\u0440\u0441\u0438\u0442\u044c)","text":"<p>\u0423\u0441\u043f\u0435\u0445:</p> <pre><code>{ \"ok\": true, \"data\": { } }\n</code></pre> <p>\u041e\u0448\u0438\u0431\u043a\u0430:</p> <pre><code>{\n  \"ok\": false,\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Field level must be &gt;= 1\",\n    \"requestId\": \"req_01HF...\"\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 <code>requestId</code> \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d: \u0432 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435 \u044d\u0442\u043e \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u043e\u0442\u043b\u0430\u0434\u043a\u0438: \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043f\u0438\u0448\u0435\u0442 \u0432 \u043e\u0442\u0447\u0451\u0442\u0435 \u201c\u043f\u043e\u043b\u0443\u0447\u0438\u043b \u043e\u0448\u0438\u0431\u043a\u0443 \u0441 requestId=...\u201d, \u0430 \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c/\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433 \u043b\u0435\u0433\u043a\u043e \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u043f\u0440\u0438\u0447\u0438\u043d\u0443.</p>"},{"location":"theory/game_integration.html#632","title":"6.3.2. \u0420\u0430\u0437\u0434\u0435\u043b\u044f\u0435\u043c \u201c\u0441\u043e\u0431\u044b\u0442\u0438\u044f\u201d \u0438 \u201c\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u201d (\u043d\u0435 \u0441\u043c\u0435\u0448\u0438\u0432\u0430\u0435\u043c)","text":"<ul> <li><code>/events</code> \u2014 \u0436\u0443\u0440\u043d\u0430\u043b \u0444\u0430\u043a\u0442\u043e\u0432 (\u201c\u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e\u201d)</li> <li><code>/progress</code> \u2014 \u0441\u043d\u0438\u043c\u043e\u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f (\u201c\u0447\u0442\u043e \u0441\u0435\u0439\u0447\u0430\u0441\u201d)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u0438\u043d\u0446\u0438\u043f\u0438\u0430\u043b\u044c\u043d\u043e: \u0435\u0441\u043b\u0438 \u0432\u044b \u201c\u043f\u0438\u0448\u0435\u0442\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043a\u0430\u043a \u0441\u043e\u0431\u044b\u0442\u0438\u0435\u201d \u2014 \u0432\u044b \u0442\u0435\u0440\u044f\u0435\u0442\u0435 \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u043e \u0432\u0438\u0442\u0440\u0438\u043d \u0438 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0435 \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0432\u0441\u0451 \u0438\u0437 events. \u0435\u0441\u043b\u0438 \u0432\u044b \u201c\u043f\u0438\u0448\u0435\u0442\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043a\u0430\u043a \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u201d \u2014 \u0432\u044b \u0442\u0435\u0440\u044f\u0435\u0442\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u044e (\u201c\u043f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u043b\u044e\u0442\u0430 \u0441\u0442\u0430\u043b\u0430 1200?\u201d).</p>"},{"location":"theory/game_integration.html#633-eventid","title":"6.3.3. \u0414\u0435\u0434\u0443\u043f\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u0439: <code>eventId</code> \u043a\u0430\u043a \u0437\u0430\u0449\u0438\u0442\u0430 \u043e\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043e\u0432","text":"<p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430: \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u0430\u044f \u0441\u0435\u0442\u044c \u2192 \u0437\u0430\u043f\u0440\u043e\u0441 \u0443\u043b\u0435\u0442\u0435\u043b \u2192 \u043e\u0442\u0432\u0435\u0442 \u043d\u0435 \u043f\u0440\u0438\u0448\u0451\u043b \u2192 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u043b \u2192 \u0441\u0435\u0440\u0432\u0435\u0440 \u0437\u0430\u043f\u0438\u0441\u0430\u043b \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0434\u0432\u0430\u0436\u0434\u044b.</p> <p>\u0420\u0435\u0448\u0435\u043d\u0438\u0435: <code>eventId</code> (UUID) + \u0434\u0435\u0434\u0443\u043f \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435.</p> <p>\u041f\u0440\u0438\u043c\u0435\u0440 payload:</p> <pre><code>{\n  \"eventId\": \"c2a4f7be-0f0c-4e69-9f20-93f8c4f50a4d\",\n  \"eventType\": \"match_finish\",\n  \"sessionId\": 555,\n  \"clientTime\": \"2026-02-26T12:20:10.000Z\",\n  \"payload\": { \"score\": 12450, \"durationSeconds\": 410 }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 UUID \u043b\u0443\u0447\u0448\u0435, \u0447\u0435\u043c \u201ctimestamp\u201d: timestamp \u043c\u043e\u0436\u0435\u0442 \u0441\u043e\u0432\u043f\u0430\u0441\u0442\u044c/\u0431\u044b\u0442\u044c \u043f\u043e\u0434\u043c\u0435\u043d\u0451\u043d, UUID \u2014 \u043f\u043e\u0447\u0442\u0438 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c.</p>"},{"location":"theory/game_integration.html#64-unity-unitywebrequest","title":"6.4. Unity \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f (UnityWebRequest) \u2014 \u201c\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e, \u043d\u0435 \u0445\u0440\u0443\u043f\u043a\u043e\u201d","text":""},{"location":"theory/game_integration.html#641-jsonutility","title":"6.4.1. \u041f\u043e\u0447\u0435\u043c\u0443 <code>JsonUtility</code> \u0447\u0430\u0441\u0442\u043e \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u0435\u043d","text":"<p><code>JsonUtility</code>:</p> <ul> <li>\u043f\u043b\u043e\u0445\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441 <code>Dictionary</code>, <code>object payload</code>, \u043c\u0430\u0441\u0441\u0438\u0432\u0430\u043c\u0438 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432,</li> <li>\u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u201c\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0439 payload\u201d.</li> </ul> <p>\u041d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0435: \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 Newtonsoft.Json (Json.NET for Unity) \u2014 \u044d\u0442\u043e \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0436\u0435\u043d\u0435\u0440\u043d\u0430\u044f \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c.</p>"},{"location":"theory/game_integration.html#642-dto-unity-newtonsoft","title":"6.4.2. DTO \u0438 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0435 \u043e\u0442\u0432\u0435\u0442\u044b (Unity + Newtonsoft)","text":"<p>DTO:</p> <pre><code>public class ApiResponse&lt;T&gt;\n{\n    public bool ok;\n    public T data;\n    public ApiError error;\n}\n\npublic class ApiError\n{\n    public string code;\n    public string message;\n    public string requestId;\n}\n</code></pre> <p>Login:</p> <pre><code>public class LoginRequest { public string email; public string password; }\npublic class LoginData { public string accessToken; public string tokenType; public int expiresInSeconds; }\n</code></pre> <p>Event:</p> <pre><code>public class EventRequest&lt;TPayload&gt;\n{\n    public string eventId;\n    public string eventType;\n    public int sessionId;\n    public string clientTime;\n    public TPayload payload;\n}\n</code></pre>"},{"location":"theory/game_integration.html#643-unity-apiclient-postget-jwt-json","title":"6.4.3. Unity ApiClient: POST/GET, JWT, \u0442\u0430\u0439\u043c\u0430\u0443\u0442, \u043f\u0430\u0440\u0441\u0438\u043d\u0433 JSON","text":"<pre><code>using System;\nusing System.Text;\nusing System.Collections;\nusing UnityEngine;\nusing UnityEngine.Networking;\nusing Newtonsoft.Json;\n\npublic class ApiClient : MonoBehaviour\n{\n    [SerializeField] private string baseUrl = \"https://localhost:3000/api/v1\";\n    public string AccessToken { get; private set; }\n\n    public void SetToken(string token)\n    {\n        AccessToken = token;\n        PlayerPrefs.SetString(\"accessToken\", token); // \u0432 \u043f\u0440\u043e\u0434\u0435 \u043b\u0443\u0447\u0448\u0435 secure storage\n    }\n\n    public IEnumerator Post&lt;TReq, TRes&gt;(string path, TReq body, Action&lt;TRes&gt; onOk, Action&lt;ApiError&gt; onErr)\n    {\n        var url = baseUrl + path;\n        var json = JsonConvert.SerializeObject(body);\n        var bytes = Encoding.UTF8.GetBytes(json);\n\n        using var req = new UnityWebRequest(url, \"POST\");\n        req.uploadHandler = new UploadHandlerRaw(bytes);\n        req.downloadHandler = new DownloadHandlerBuffer();\n        req.SetRequestHeader(\"Content-Type\", \"application/json\");\n        if (!string.IsNullOrEmpty(AccessToken))\n            req.SetRequestHeader(\"Authorization\", \"Bearer \" + AccessToken);\n\n        req.timeout = 15;\n\n        var started = Time.realtimeSinceStartup;\n        yield return req.SendWebRequest();\n        var durationMs = (Time.realtimeSinceStartup - started) * 1000f;\n\n        // 1) \u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c\n        if (req.result != UnityWebRequest.Result.Success)\n        {\n            onErr?.Invoke(new ApiError { code = \"NETWORK_ERROR\", message = req.error, requestId = null });\n            yield break;\n        }\n\n        // 2) JSON \u0443\u0440\u043e\u0432\u0435\u043d\u044c\n        ApiResponse&lt;TRes&gt; resp = null;\n        try { resp = JsonConvert.DeserializeObject&lt;ApiResponse&lt;TRes&gt;&gt;(req.downloadHandler.text); }\n        catch\n        {\n            onErr?.Invoke(new ApiError { code = \"BAD_JSON\", message = \"Response is not valid JSON\", requestId = null });\n            yield break;\n        }\n\n        // 3) \u041a\u043e\u043d\u0442\u0440\u0430\u043a\u0442\u043d\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c\n        if (resp != null &amp;&amp; resp.ok)\n            onOk?.Invoke(resp.data);\n        else\n            onErr?.Invoke(resp?.error ?? new ApiError { code = \"UNKNOWN_ERROR\", message = \"Unknown API error\", requestId = null });\n\n        Debug.Log($\"[API] POST {path} status={req.responseCode} ({durationMs:F0} ms)\");\n    }\n\n    public IEnumerator Get&lt;TRes&gt;(string path, Action&lt;TRes&gt; onOk, Action&lt;ApiError&gt; onErr)\n    {\n        var url = baseUrl + path;\n\n        using var req = UnityWebRequest.Get(url);\n        req.downloadHandler = new DownloadHandlerBuffer();\n        if (!string.IsNullOrEmpty(AccessToken))\n            req.SetRequestHeader(\"Authorization\", \"Bearer \" + AccessToken);\n        req.timeout = 15;\n\n        yield return req.SendWebRequest();\n\n        if (req.result != UnityWebRequest.Result.Success)\n        {\n            onErr?.Invoke(new ApiError { code = \"NETWORK_ERROR\", message = req.error, requestId = null });\n            yield break;\n        }\n\n        ApiResponse&lt;TRes&gt; resp = null;\n        try { resp = JsonConvert.DeserializeObject&lt;ApiResponse&lt;TRes&gt;&gt;(req.downloadHandler.text); }\n        catch\n        {\n            onErr?.Invoke(new ApiError { code = \"BAD_JSON\", message = \"Response is not valid JSON\", requestId = null });\n            yield break;\n        }\n\n        if (resp != null &amp;&amp; resp.ok) onOk?.Invoke(resp.data);\n        else onErr?.Invoke(resp?.error ?? new ApiError { code=\"UNKNOWN_ERROR\", message=\"Unknown API error\" });\n    }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0437\u0434\u0435\u0441\u044c \u0442\u0440\u0438 \u0443\u0440\u043e\u0432\u043d\u044f \u043e\u0448\u0438\u0431\u043e\u043a:</p> <ul> <li>\u0441\u0435\u0442\u044c (\u043d\u0435\u0442 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0430, DNS, TLS),</li> <li>JSON (\u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0440\u0438\u0441\u043b\u0430\u043b \u043d\u0435 JSON),</li> <li>\u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 (\u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0440\u0438\u0441\u043b\u0430\u043b JSON, \u043d\u043e <code>ok=false</code>).</li> </ul>"},{"location":"theory/game_integration.html#644-unity-login-profile","title":"6.4.4. \u041f\u0440\u0438\u043c\u0435\u0440: Unity login \u2192 profile","text":"<pre><code>public class ProfileData {\n    public UserDto user;\n    public ProgressDto progress;\n}\npublic class UserDto { public int id; public string email; public string nickname; public string createdAt; }\npublic class ProgressDto { public int level; public int xp; public int softCurrency; public int hardCurrency; }\n\npublic void DoLogin(ApiClient api, string email, string password)\n{\n    StartCoroutine(api.Post&lt;LoginRequest, LoginData&gt;(\n        \"/auth/login\",\n        new LoginRequest { email = email, password = password },\n        data =&gt; { api.SetToken(data.accessToken); Debug.Log(\"Logged in\"); },\n        err =&gt; { Debug.LogError($\"{err.code}: {err.message} req={err.requestId}\"); }\n    ));\n}\n\npublic void LoadProfile(ApiClient api)\n{\n    StartCoroutine(api.Get&lt;ProfileData&gt;(\n        \"/profile\",\n        data =&gt; { Debug.Log($\"Hello {data.user.nickname}, lvl={data.progress.level}\"); },\n        err =&gt; HandleApiError(err)\n    ));\n}\n\nprivate void HandleApiError(ApiError err)\n{\n    if (err.code == \"INVALID_CREDENTIALS\" || err.code == \"UNAUTHORIZED\")\n    {\n        // \u0440\u0430\u0437\u043b\u043e\u0433\u0438\u043d\u0438\u0442\u044c\n    }\n    Debug.LogError($\"API error {err.code}: {err.message} req={err.requestId}\");\n}\n</code></pre>"},{"location":"theory/game_integration.html#65-web-fetch","title":"6.5. Web \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f (fetch) \u2014 \u201c\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e, \u043d\u0435 \u043b\u043e\u043c\u043a\u043e\u201d","text":""},{"location":"theory/game_integration.html#651-apifetch-abortcontroller","title":"6.5.1. apiFetch \u0441 \u0442\u0430\u0439\u043c\u0430\u0443\u0442\u043e\u043c (AbortController)","text":"<pre><code>const API_BASE = \"https://localhost:3000/api/v1\";\nlet accessToken = null;\n\nexport function setToken(t) { accessToken = t; }\n\nexport async function apiFetch(path, { method=\"GET\", body=null, query=null, timeoutMs=15000 } = {}) {\n  const url = new URL(API_BASE + path);\n  if (query) Object.entries(query).forEach(([k,v]) =&gt; url.searchParams.set(k, String(v)));\n\n  const ctrl = new AbortController();\n  const timer = setTimeout(() =&gt; ctrl.abort(), timeoutMs);\n\n  try {\n    const res = await fetch(url.toString(), {\n      method,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...(accessToken ? { Authorization: `Bearer ${accessToken}` } : {})\n      },\n      body: body ? JSON.stringify(body) : undefined,\n      signal: ctrl.signal\n    });\n\n    let json;\n    try { json = await res.json(); }\n    catch { throw { code: \"BAD_JSON\", message: \"Server returned non-JSON\" }; }\n\n    if (!res.ok || json.ok === false) throw (json.error ?? { code: \"HTTP_ERROR\", message: `HTTP ${res.status}` });\n\n    return json.data;\n  } finally {\n    clearTimeout(timer);\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0443\u0436\u0435\u043d AbortController: \u0438\u043d\u0430\u0447\u0435 fetch \u043c\u043e\u0436\u0435\u0442 \u201c\u0432\u0438\u0441\u0435\u0442\u044c\u201d \u043e\u0447\u0435\u043d\u044c \u0434\u043e\u043b\u0433\u043e, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0434\u0443\u043c\u0430\u0435\u0442, \u0447\u0442\u043e \u0438\u0433\u0440\u0430 \u0437\u0430\u0432\u0438\u0441\u043b\u0430.</p>"},{"location":"theory/game_integration.html#652-login-event-leaderboard","title":"6.5.2. \u041f\u0440\u0438\u043c\u0435\u0440: login + event + leaderboard","text":"<pre><code>// login\nconst login = await apiFetch(\"/auth/login\", {\n  method: \"POST\",\n  body: { email, password }\n});\nsetToken(login.accessToken);\n\n// send event\nawait apiFetch(\"/events\", {\n  method: \"POST\",\n  body: {\n    eventId: crypto.randomUUID(),\n    eventType: \"session_start\",\n    sessionId: 555,\n    clientTime: new Date().toISOString(),\n    payload: { platform: \"web\", locale: \"ru-RU\" }\n  }\n});\n\n// leaderboard\nconst lb = await apiFetch(\"/leaderboard\", {\n  query: { boardCode: \"td_score\", season: 1, limit: 50 }\n});\nconsole.log(lb.items);\n</code></pre>"},{"location":"theory/game_integration.html#66-mobile-androidios","title":"6.6. Mobile-\u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430 (Android/iOS) \u2014 \u0447\u0442\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043e\u0431\u044f\u0437\u0430\u043d \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c","text":""},{"location":"theory/game_integration.html#661-offline-first","title":"6.6.1. Offline-first \u0434\u043b\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (\u043e\u0447\u0435\u0440\u0435\u0434\u044c)","text":"<p>\u041f\u0440\u0430\u0432\u0438\u043b\u043e: \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043d\u0435 \u0442\u0435\u0440\u044f\u0435\u043c. \u0415\u0441\u043b\u0438 \u0441\u0435\u0442\u044c \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u2014 \u043a\u043b\u0430\u0434\u0451\u043c \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c \u043f\u043e\u0437\u0436\u0435.</p> <p>\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f:</p> <ul> <li>\u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0432 \u043f\u0430\u043c\u044f\u0442\u0438 + \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0432 \u0444\u0430\u0439\u043b/\u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0411\u0414 (SQLite) \u0440\u0430\u0437 \u0432 N \u0441\u0435\u043a\u0443\u043d\u0434,</li> <li>flush \u043f\u0440\u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0441\u0435\u0442\u0438.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443: \u0432 \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u043e\u0439 \u0438\u0433\u0440\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0447\u0430\u0441\u0442\u043e \u0438\u0433\u0440\u0430\u0435\u0442 \u0432 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u0435/\u043b\u0438\u0444\u0442\u0435.</p>"},{"location":"theory/game_integration.html#662-backoff-429-rate-limit","title":"6.6.2. Backoff \u043f\u0440\u0438 429 (rate limit)","text":"<p>\u0415\u0441\u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442:</p> <ul> <li><code>429 RATE_LIMITED</code> \u2192 \u043d\u0435 \u0441\u043f\u0430\u043c\u0438\u0442\u044c \u043f\u043e\u0432\u0442\u043e\u0440\u043e\u043c.</li> </ul> <p>\u041f\u0440\u0430\u0432\u0438\u043b\u043e: \u044d\u043a\u0441\u043f\u043e\u043d\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u0430\u044f \u0437\u0430\u0434\u0435\u0440\u0436\u043a\u0430:</p> <ul> <li>1s \u2192 2s \u2192 4s \u2192 8s (\u0434\u043e \u043f\u043e\u0442\u043e\u043b\u043a\u0430, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 30s).</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443: \u0438\u043d\u0430\u0447\u0435 \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u201c\u0441\u0430\u043c \u0443\u0441\u0442\u0440\u043e\u0438\u0442 \u043d\u0430\u0433\u0440\u0443\u0437\u043e\u0447\u043d\u043e\u0435 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u201d \u0441\u0435\u0440\u0432\u0435\u0440\u0443.</p>"},{"location":"theory/game_integration.html#67-eventqueue","title":"6.7. \u041e\u0447\u0435\u0440\u0435\u0434\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (EventQueue) \u2014 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u0442\u0442\u0435\u0440\u043d \u0434\u043b\u044f \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0438","text":""},{"location":"theory/game_integration.html#671","title":"6.7.1. \u0427\u0442\u043e \u0434\u043e\u043b\u0436\u0435\u043d \u0434\u0435\u043b\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442","text":"<ol> <li>\u041f\u0440\u0438 \u043a\u043b\u0438\u043a\u0435/\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0438 \u2192 \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c <code>EventRequest</code> \u0441 <code>eventId</code></li> <li>\u041f\u043e\u043b\u043e\u0436\u0438\u0442\u044c \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u044c</li> <li>\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443/\u043f\u0430\u043a\u0435\u0442\u0430\u043c\u0438</li> <li>\u041f\u0440\u0438 \u0443\u0441\u043f\u0435\u0445\u0435 \u2192 \u0443\u0434\u0430\u043b\u0438\u0442\u044c</li> <li>\u041f\u0440\u0438 401/403 \u2192 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0438 \u0440\u0430\u0437\u043b\u043e\u0433\u0438\u043d\u0438\u0442\u044c</li> <li>\u041f\u0440\u0438 429 \u2192 backoff</li> <li>\u041f\u0440\u0438 NETWORK_ERROR \u2192 \u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438</li> </ol>"},{"location":"theory/game_integration.html#672-batch","title":"6.7.2. \u041f\u043e\u0447\u0435\u043c\u0443 \u043b\u0443\u0447\u0448\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043f\u0430\u0447\u043a\u0430\u043c\u0438 (batch) \u2014 \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e","text":"<p>\u041c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c <code>POST /events/batch</code>:</p> <ul> <li>\u043c\u0435\u043d\u044c\u0448\u0435 overhead TLS/HTTP,</li> <li>\u0431\u044b\u0441\u0442\u0440\u0435\u0435 \u043d\u0430 \u043c\u043e\u0431\u0438\u043b\u043a\u0430\u0445.</li> </ul> <p>\u041d\u043e \u0434\u043b\u044f MVP \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e \u043e\u0434\u0438\u043d\u043e\u0447\u043d\u043e\u0435 <code>/events</code>.</p>"},{"location":"theory/game_integration.html#68","title":"6.8. \u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u201c\u043e\u0448\u0438\u0431\u043a\u0430 \u2192 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\u201d (\u043e\u0447\u0435\u043d\u044c \u043f\u043e\u043b\u0435\u0437\u043d\u043e \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430\u043c)","text":"\u0421\u0438\u0442\u0443\u0430\u0446\u0438\u044f HTTP / code \u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u041d\u0435 \u0442\u043e\u0442 JSON/\u043f\u043e\u043b\u044f 400 / VALIDATION_ERROR \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u201c\u043e\u0448\u0438\u0431\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445\u201d, \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c requestId (\u044d\u0442\u043e \u0431\u0430\u0433 \u043a\u043b\u0438\u0435\u043d\u0442\u0430) \u041d\u0435\u0442 \u0442\u043e\u043a\u0435\u043d\u0430/\u0438\u0441\u0442\u0451\u043a 401 / UNAUTHORIZED \u0440\u0430\u0437\u043b\u043e\u0433\u0438\u043d\u0438\u0442\u044c, \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u044d\u043a\u0440\u0430\u043d login \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0431\u0430\u043d\u0435\u043d 403 / USER_BANNED \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u201c\u0434\u043e\u0441\u0442\u0443\u043f \u0437\u0430\u043f\u0440\u0435\u0449\u0451\u043d\u201d, \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f 409 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 (GET /profile), \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u201c\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c\u201d \u0421\u043b\u0438\u0448\u043a\u043e\u043c \u0447\u0430\u0441\u0442\u043e 429 / RATE_LIMITED backoff, \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443/\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u0421\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 500 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u201c\u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435\u201d, \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c requestId"},{"location":"theory/game_integration.html#69-payload-eventtype","title":"6.9. \u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 payload \u043f\u043e\u0434 \u0440\u0430\u0437\u043d\u044b\u0435 eventType","text":""},{"location":"theory/game_integration.html#691-session_start","title":"6.9.1. session_start (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0439)","text":"<pre><code>{\n  \"eventId\": \"uuid\",\n  \"eventType\": \"session_start\",\n  \"sessionId\": 555,\n  \"clientTime\": \"2026-02-26T12:10:05.120Z\",\n  \"payload\": {\n    \"platform\": \"unity\",\n    \"clientVersion\": \"1.0.3\",\n    \"device\": { \"os\": \"Android\", \"model\": \"Pixel 7\" },\n    \"locale\": \"ru-RU\"\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u0436\u043d\u043e: \u0441 \u044d\u0442\u043e\u0433\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0441\u0442\u0440\u043e\u044f\u0442\u0441\u044f retention, \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043f\u043e \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0430\u043c, \u0434\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0430 \u0432\u0435\u0440\u0441\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430.</p>"},{"location":"theory/game_integration.html#692-currency_change","title":"6.9.2. currency_change (\u0430\u0443\u0434\u0438\u0442 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0438)","text":"<pre><code>{\n  \"eventId\": \"uuid\",\n  \"eventType\": \"currency_change\",\n  \"sessionId\": 555,\n  \"clientTime\": \"2026-02-26T12:12:00.000Z\",\n  \"payload\": {\n    \"currency\": \"soft\",\n    \"delta\": 300,\n    \"reason\": \"reward_match_finish\"\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u0436\u043d\u043e: \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0433\u043e\u0432\u043e\u0440\u0438\u0442 \u201c\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0441\u0442\u0430\u043b\u043e\u201d, \u0430 \u044d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u2014 \u201c\u043f\u043e\u0447\u0435\u043c\u0443 \u0441\u0442\u0430\u043b\u043e\u201d.</p>"},{"location":"theory/game_integration.html#693-match_finish","title":"6.9.3. match_finish (\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435)","text":"<pre><code>{\n  \"eventId\": \"uuid\",\n  \"eventType\": \"match_finish\",\n  \"sessionId\": 555,\n  \"clientTime\": \"2026-02-26T12:20:10.000Z\",\n  \"payload\": {\n    \"mode\": \"td\",\n    \"mapCode\": \"forest_01\",\n    \"season\": 1,\n    \"isWin\": true,\n    \"score\": 12450,\n    \"durationSeconds\": 410,\n    \"waveReached\": 12\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u044b\u0434\u0435\u043b\u044f\u0435\u043c: \u044d\u0442\u043e \u201c\u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u0444\u0430\u043a\u0442\u201d, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 progress/stats/leaderboard.</p>"},{"location":"theory/genre_adaptation.html","title":"\u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044e \u0418\u0421","text":""},{"location":"theory/genre_adaptation.html#1-3","title":"1. \u0422\u0435\u043e\u0440\u0438\u044f. 3. \u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430","text":"<p>\u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f \u2014 \u044d\u0442\u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430\u0434\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043d\u0430\u0434 \u044f\u0434\u0440\u043e\u043c. \u042f\u0434\u0440\u043e (Users/Sessions/Events/Progress/Stats/Leaderboard) \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u043e\u0431\u0449\u0438\u0435 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u044b \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f, \u0430 \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0437\u0430 \u0434\u043e\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0438\u0433\u0440\u044b: \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0430, \u0431\u043e\u0438, \u0441\u044e\u0436\u0435\u0442, \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435, \u0432\u044b\u0436\u0438\u0432\u0430\u043d\u0438\u0435.</p> <p>\u041a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u043e \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u043e\u0440\u0430:</p> <p>\u042f\u0434\u0440\u043e \u043d\u0435 \u043b\u043e\u043c\u0430\u0435\u043c. \u041b\u044e\u0431\u043e\u0439 \u0436\u0430\u043d\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u0438\u0432\u044f\u0437\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u043a <code>users</code> \u0438 \u043a \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u043e\u0439 \u201c\u0435\u0434\u0438\u043d\u0438\u0446\u0435 \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\u201d (<code>match/run/episode/cycle</code>). \u0412\u0441\u0435 \u0432\u0430\u0436\u043d\u044b\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043b\u043e\u0433\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>game_events</code> (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u0448\u0438\u043d\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439).</p>"},{"location":"theory/genre_adaptation.html#31","title":"3.1. \u0428\u0430\u0431\u043b\u043e\u043d \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f \u043f\u043e\u0434 \u0436\u0430\u043d\u0440 (\u043a\u0430\u043a \u043c\u044b\u0441\u043b\u0438\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e)","text":"<p>\u041f\u0435\u0440\u0435\u0434 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435\u043c \u0442\u0430\u0431\u043b\u0438\u0446 \u0441\u0442\u0443\u0434\u0435\u043d\u0442 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043d\u0430 5 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 (\u0442\u0430\u043a \u043c\u0435\u043d\u044c\u0448\u0435 \u043e\u0448\u0438\u0431\u043e\u043a):</p>"},{"location":"theory/genre_adaptation.html#311","title":"3.1.1. \u041a\u0430\u043a\u0430\u044f \u201c\u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\u201d?","text":"<p>\u042d\u0442\u043e \u043e\u0431\u044a\u0435\u043a\u0442, \u0432\u043e\u043a\u0440\u0443\u0433 \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0441\u0442\u0440\u043e\u0438\u0442\u0441\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0430:</p> <ul> <li>match \u2014 \u043a\u043e\u0440\u043e\u0442\u043a\u0430\u044f \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u0430\u044f \u0441\u0435\u0441\u0441\u0438\u044f \u0441 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u043c (Shooter/TD/Strategy)</li> <li>run \u2014 \u043f\u043e\u043f\u044b\u0442\u043a\u0430 \u201c\u0432\u044b\u0436\u0438\u0442\u044c/\u043f\u0440\u043e\u0439\u0442\u0438\u201d, \u0447\u0430\u0441\u0442\u043e \u0441 \u043f\u0435\u0440\u043c\u0430\u043d\u0435\u043d\u0442\u043d\u043e\u0439 \u0441\u043c\u0435\u0440\u0442\u044c\u044e (Survival/Roguelike)</li> <li>episode/chapter \u2014 \u043f\u0440\u043e\u0434\u0432\u0438\u0436\u0435\u043d\u0438\u0435 \u043f\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u0438 (Visual Novel)</li> <li>cycle/day/tick \u2014 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0430 \u043f\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430\u043c (Economic)</li> <li>session + offline period \u2014 \u0434\u043e\u0445\u043e\u0434/\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0432\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (Idle)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u0436\u043d\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u201c\u0435\u0434\u0438\u043d\u0438\u0446\u0443\u201d: \u0431\u0435\u0437 \u043d\u0435\u0451 \u0432\u044b \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435:</p> <ul> <li>\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442,</li> <li>\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u043c\u0435\u0442\u0440\u0438\u043a\u0438 (winrate, completion),</li> <li>\u0434\u0435\u043b\u0430\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u201c\u0438\u0442\u043e\u0433 \u2192 \u043d\u0430\u0433\u0440\u0430\u0434\u0430 \u2192 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u201d.</li> </ul>"},{"location":"theory/genre_adaptation.html#312","title":"3.1.2. \u0427\u0442\u043e \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442 \u043a\u0430\u043a \u201c\u0438\u0441\u0442\u0438\u043d\u0443\u201d?","text":"<p>\u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442 \u0442\u043e, \u0447\u0442\u043e \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430:</p> <ul> <li>\u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0443 (\u0432\u0430\u043b\u044e\u0442\u0430/\u0440\u0435\u0441\u0443\u0440\u0441\u044b/\u043f\u043e\u043a\u0443\u043f\u043a\u0438/\u0430\u043f\u0433\u0440\u0435\u0439\u0434\u044b),</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 (\u0443\u0440\u043e\u0432\u043d\u0438, \u0433\u043b\u0430\u0432\u044b, \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0435 \u0437\u043e\u043d\u044b),</li> <li>\u0441\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u043d\u0438\u0435 (score/win/lose/MMR),</li> <li>\u0430\u043d\u0442\u0438\u0447\u0438\u0442 (\u043f\u0440\u0435\u0434\u0435\u043b\u044b \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439, \u043c\u043e\u043d\u043e\u0442\u043e\u043d\u043d\u043e\u0441\u0442\u044c \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u043b\u0438\u043c\u0438\u0442\u044b \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0439).</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043d\u0435 \u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443: \u043a\u043b\u0438\u0435\u043d\u0442 \u043c\u043e\u0436\u043d\u043e \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c; \u0435\u0441\u043b\u0438 \u0434\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0435\u043c\u0443 \u0432\u0430\u043b\u044e\u0442\u0443/\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b \u2014 \u0438\u0433\u0440\u043e\u043a \u201c\u043d\u0430\u0440\u0438\u0441\u0443\u0435\u0442\u201d \u0441\u0435\u0431\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441.</p>"},{"location":"theory/genre_adaptation.html#313","title":"3.1.3. \u041a\u0430\u043a\u0438\u0435 \u043c\u0435\u0442\u0440\u0438\u043a\u0438 \u043d\u0443\u0436\u043d\u044b?","text":"<p>\u0414\u0432\u0435 \u0433\u0440\u0443\u043f\u043f\u044b:</p> <p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 (\u0434\u043b\u044f UI \u0438\u0433\u0440\u043e\u043a\u0430)</p> <ul> <li>\u0442\u043e, \u0447\u0442\u043e \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u0435/\u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u043c\u0430\u0442\u0447\u0435\u0439/\u044d\u043a\u0440\u0430\u043d \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438.</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435 (\u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0438)</p> <ul> <li>retention, churn, \u0431\u0430\u043b\u0430\u043d\u0441, \u043c\u043e\u043d\u0435\u0442\u0438\u0437\u0430\u0446\u0438\u044f, \u0442\u043e\u0447\u043a\u0438 \u201c\u043e\u0442\u0432\u0430\u043b\u0430\u201d.</li> </ul>"},{"location":"theory/genre_adaptation.html#314","title":"3.1.4. \u041a\u0430\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u201c\u0441\u043d\u0438\u043c\u043a\u043e\u043c\u201d \u0438 \u043a\u0430\u043a\u0438\u0435 \u201c\u0436\u0443\u0440\u043d\u0430\u043b\u043e\u043c\u201d?","text":"<ul> <li>\u0416\u0443\u0440\u043d\u0430\u043b (log): <code>game_events</code> \u0438 \u0436\u0430\u043d\u0440\u043e\u0432\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b (actions, transactions) \u2014 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0439.</li> <li>\u0421\u043d\u0438\u043c\u043e\u043a (state): <code>player_progress</code>, <code>user_story_state</code>, <code>company_resources</code> \u2014 \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u0431\u044b\u0441\u0442\u0440\u044b\u0445 \u0437\u0430\u0433\u0440\u0443\u0437\u043e\u043a.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u0435\u043c: \u0436\u0443\u0440\u043d\u0430\u043b \u0440\u0430\u0441\u0442\u0451\u0442, \u0441\u043d\u0438\u043c\u043e\u043a \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0431\u044b\u0441\u0442\u0440\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0447\u0451\u0442\u043e\u0432.</p>"},{"location":"theory/genre_adaptation.html#315","title":"3.1.5. \u0413\u0434\u0435 \u043d\u0443\u0436\u043d\u044b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438?","text":"<p>\u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b \u0442\u0430\u043c, \u0433\u0434\u0435 \u0432 \u043e\u0434\u043d\u043e\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0438 \u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f:</p> <ul> <li>\u0444\u0430\u043a\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 (match_finish/run_end),</li> <li>\u043d\u0430\u0433\u0440\u0430\u0434\u0430,</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441,</li> <li>\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430,</li> <li>\u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434.</li> </ul> <p>\u0415\u0441\u043b\u0438 \u043d\u0435 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044e, \u043f\u043e\u044f\u0432\u0438\u0442\u0441\u044f \u201c\u043f\u043e\u043b\u0443-\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0443\u0441\u043f\u0435\u0445\u201d.</p>"},{"location":"theory/genre_adaptation.html#316","title":"3.1.6. \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u0442\u0442\u0435\u0440\u043d \u0441\u0445\u0435\u043c\u044b \u0436\u0430\u043d\u0440\u0430","text":"<p>\u041f\u043e\u0447\u0442\u0438 \u043b\u044e\u0431\u043e\u0439 \u0436\u0430\u043d\u0440 \u0443\u043a\u043b\u0430\u0434\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e:</p> <ul> <li><code>X</code> \u2014 \u0446\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u0430\u044f \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (<code>matches</code>, <code>runs</code>, <code>episodes</code>, <code>cycles</code>)</li> <li><code>X_events</code> / <code>X_actions</code> \u2014 \u0436\u0443\u0440\u043d\u0430\u043b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 \u0432\u043d\u0443\u0442\u0440\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430</li> <li><code>X_result</code> \u2014 \u0438\u0442\u043e\u0433 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (score/win/duration/ending)</li> <li><code>user_X_state</code> \u2014 \u201c\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u0432 \u0436\u0430\u043d\u0440\u0435\u201d (\u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e)</li> </ul> <p>\u0418 \u0432\u0441\u0451 \u044d\u0442\u043e:</p> <ul> <li>\u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u043e \u043a <code>users</code></li> <li>\u0438 \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0432 <code>game_events</code> \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u043c\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f\u043c\u0438</li> </ul>"},{"location":"theory/genre_adaptation.html#32-economic","title":"3.2. \u042d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0438\u043c\u0443\u043b\u044f\u0442\u043e\u0440 (Economic)","text":""},{"location":"theory/genre_adaptation.html#321","title":"3.2.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u0426\u0438\u043a\u043b \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0438: <code>day/tick/cycle</code>. \u0412 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0435 \u201c\u043c\u0430\u0442\u0447\u0430\u201d \u043e\u0431\u044b\u0447\u043d\u043e \u043d\u0435\u0442, \u0437\u0430\u0442\u043e \u0435\u0441\u0442\u044c \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u043e/\u0440\u044b\u043d\u043e\u043a.</p>"},{"location":"theory/genre_adaptation.html#322","title":"3.2.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 (\u0442\u0430\u0431\u043b\u0438\u0446\u044b) \u2014 \u0441 \u043b\u043e\u0433\u0438\u043a\u043e\u0439 \u0437\u0430\u0447\u0435\u043c","text":"<ul> <li><code>companies</code> \u2014 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0431\u0438\u0437\u043d\u0435\u0441\u0430 \u0438\u0433\u0440\u043e\u043a\u0430 (\u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0438, \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f)</li> <li><code>assets</code> \u2014 \u0430\u043a\u0442\u0438\u0432\u044b (\u0437\u0430\u0432\u043e\u0434\u044b, \u043e\u0444\u0438\u0441\u044b, \u0442\u0435\u0445\u043d\u0438\u043a\u0430) + \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0430\u043f\u0433\u0440\u0435\u0439\u0434\u0430</li> <li><code>resources</code> \u2014 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 (\u0434\u0435\u0440\u0435\u0432\u043e, \u043c\u0435\u0442\u0430\u043b\u043b, \u044d\u043d\u0435\u0440\u0433\u0438\u044f)</li> <li><code>company_resources</code> \u2014 \u043e\u0441\u0442\u0430\u0442\u043a\u0438 (\u0441\u043a\u043b\u0430\u0434): \u0441\u043d\u0438\u043c\u043e\u043a \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432</li> <li><code>production_jobs</code> \u2014 \u0437\u0430\u0434\u0430\u043d\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u0430 (\u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u043c, \u0441\u043a\u043e\u043b\u044c\u043a\u043e, \u043a\u043e\u0433\u0434\u0430 \u0433\u043e\u0442\u043e\u0432\u043e)</li> <li><code>contracts</code> \u2014 \u0441\u0434\u0435\u043b\u043a\u0438 (\u043f\u043e\u0441\u0442\u0430\u0432\u043a\u0438/\u0437\u0430\u043a\u0430\u0437\u044b) + \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435</li> <li><code>market_prices</code> \u2014 \u0446\u0435\u043d\u044b \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438/\u0440\u0435\u0433\u0438\u043e\u043d\u0443 (\u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0440\u044b\u043d\u043e\u043a)</li> <li><code>transactions</code> \u2014 \u0444\u0438\u043d\u0430\u043d\u0441\u043e\u0432\u044b\u0439 \u0436\u0443\u0440\u043d\u0430\u043b (\u043f\u0440\u0438\u0445\u043e\u0434/\u0440\u0430\u0441\u0445\u043e\u0434)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 <code>transactions</code> \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e: \u0431\u0435\u0437 \u0436\u0443\u0440\u043d\u0430\u043b\u0430 \u0444\u0438\u043d\u0430\u043d\u0441\u043e\u0432 \u0432\u044b \u043d\u0435 \u0434\u043e\u043a\u0430\u0436\u0435\u0442\u0435, \u043f\u043e\u0447\u0435\u043c\u0443 \u201c\u043f\u0440\u043e\u043f\u0430\u043b\u0438 \u0434\u0435\u043d\u044c\u0433\u0438\u201d.</p>"},{"location":"theory/genre_adaptation.html#323","title":"3.2.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442 \u043a\u0430\u043a \u0438\u0441\u0442\u0438\u043d\u0443","text":"<ul> <li>\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0438 \u043d\u0430\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u0434\u0435\u043d\u0435\u0433/\u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 (\u043f\u043e \u043f\u0440\u0430\u0432\u0438\u043b\u0430\u043c, \u043d\u0435 \u043f\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0443),</li> <li>\u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u0430 \u0438 \u0432\u044b\u043f\u0443\u0441\u043a \u043f\u0440\u043e\u0434\u0443\u043a\u0446\u0438\u0438,</li> <li>\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442\u043e\u0432,</li> <li>\u0440\u044b\u043d\u043e\u0447\u043d\u044b\u0435 \u0446\u0435\u043d\u044b (\u0435\u0441\u043b\u0438 \u043e\u0431\u0449\u0438\u0439 \u0440\u044b\u043d\u043e\u043a).</li> </ul>"},{"location":"theory/genre_adaptation.html#324","title":"3.2.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>cash balance, inventory by resource</li> <li>profit/day, revenue/day</li> <li>production throughput (\u0435\u0434\u0438\u043d\u0438\u0446/\u0447\u0430\u0441)</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>ROI \u0430\u043f\u0433\u0440\u0435\u0439\u0434\u043e\u0432</li> <li>bottlenecks: \u0433\u0434\u0435 \u0434\u0435\u0444\u0438\u0446\u0438\u0442 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432</li> <li>\u0446\u0435\u043d\u043e\u0432\u0430\u044f \u044d\u043b\u0430\u0441\u0442\u0438\u0447\u043d\u043e\u0441\u0442\u044c: \u043a\u0430\u043a \u0438\u0433\u0440\u043e\u043a\u0438 \u0440\u0435\u0430\u0433\u0438\u0440\u0443\u044e\u0442 \u043d\u0430 \u0440\u044b\u043d\u043e\u043a</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u201c\u0443\u0440\u043e\u0432\u043d\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0438\u201d</li> </ul>"},{"location":"theory/genre_adaptation.html#325-game_events","title":"3.2.5. \u041f\u0440\u0438\u043c\u0435\u0440\u044b \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (game_events)","text":"<ul> <li><code>production_start</code>, <code>production_finish</code></li> <li><code>contract_accept</code>, <code>contract_complete</code></li> <li><code>transaction</code> (\u0438\u043b\u0438 <code>currency_change</code>)</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440 payload:</p> <pre><code>{\n  \"eventType\": \"contract_complete\",\n  \"payload\": {\n    \"contractId\": 501,\n    \"reward\": { \"money\": 1200 },\n    \"spent\": { \"wood\": 20, \"metal\": 10 }\n  }\n}\n</code></pre>"},{"location":"theory/genre_adaptation.html#33-idle-clicker","title":"3.3. Idle / Clicker","text":""},{"location":"theory/genre_adaptation.html#331","title":"3.3.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u0421\u0435\u0441\u0441\u0438\u044f + \u043e\u0444\u043b\u0430\u0439\u043d-\u043f\u0435\u0440\u0438\u043e\u0434. \u0413\u043b\u0430\u0432\u043d\u0430\u044f \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0436\u0430\u043d\u0440\u0430 \u2014 \u0447\u0435\u0441\u0442\u043d\u043e \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0432\u0440\u0435\u043c\u044f \u0438 \u0434\u043e\u0445\u043e\u0434.</p>"},{"location":"theory/genre_adaptation.html#332","title":"3.3.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u0441 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435\u043c","text":"<ul> <li><code>generators</code> \u2014 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0434\u043e\u0445\u043e\u0434\u0430 (\u0448\u0430\u0445\u0442\u0430, \u0444\u0435\u0440\u043c\u0430)</li> <li><code>user_generators</code> \u2014 \u0443\u0440\u043e\u0432\u0435\u043d\u044c/\u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0438\u0433\u0440\u043e\u043a\u0430 (\u0441\u043d\u0438\u043c\u043e\u043a)</li> <li><code>upgrades</code> + <code>user_upgrades</code> \u2014 \u043f\u0435\u0440\u043a\u0438, \u0432\u043b\u0438\u044f\u044e\u0449\u0438\u0435 \u043d\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0434\u043e\u0445\u043e\u0434\u0430</li> <li><code>boosters</code> \u2014 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u0443\u0441\u0438\u043b\u0438\u0442\u0435\u043b\u0438</li> <li><code>offline_income</code> \u2014 \u0444\u0430\u043a\u0442 \u0432\u044b\u0434\u0430\u0447\u0438 \u043e\u0444\u043b\u0430\u0439\u043d-\u0434\u043e\u0445\u043e\u0434\u0430 (\u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0432\u0430\u0436\u0434\u044b)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 <code>offline_income</code> \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d: \u0438\u043d\u0430\u0447\u0435 \u0438\u0433\u0440\u043e\u043a \u0441\u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u201c\u0437\u0430\u0431\u0440\u0430\u0442\u044c \u043e\u0444\u043b\u0430\u0439\u043d-\u043d\u0430\u0433\u0440\u0430\u0434\u0443\u201d.</p>"},{"location":"theory/genre_adaptation.html#333","title":"3.3.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u0438,</li> <li>\u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u043e\u0444\u043b\u0430\u0439\u043d-\u0434\u043e\u0445\u043e\u0434\u0430,</li> <li>\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0432\u0430\u043b\u044e\u0442\u044b \u0437\u0430 \u0430\u043f\u0433\u0440\u0435\u0439\u0434\u044b,</li> <li>\u043b\u0438\u043c\u0438\u0442\u044b \u0431\u0443\u0441\u0442\u0435\u0440\u043e\u0432.</li> </ul>"},{"location":"theory/genre_adaptation.html#334","title":"3.3.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>income_per_second</li> <li>offline_income_claimed</li> <li>generator_distribution (\u043a\u0430\u043a\u0438\u0435 \u0443\u0440\u043e\u0432\u043d\u0438 \u0443 \u0438\u0433\u0440\u043e\u043a\u043e\u0432)</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>progression curve (\u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0440\u043e\u0441\u0442\u0430)</li> <li>retention vs offline reward</li> <li>pay conversion \u043d\u0430 \u0443\u0441\u043a\u043e\u0440\u0438\u0442\u0435\u043b\u0438</li> </ul>"},{"location":"theory/genre_adaptation.html#335","title":"3.3.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>offline_claim</code></li> <li><code>generator_upgrade</code></li> <li><code>booster_activate</code></li> </ul>"},{"location":"theory/genre_adaptation.html#34-rpg","title":"3.4. RPG","text":""},{"location":"theory/genre_adaptation.html#341","title":"3.4.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u041f\u0435\u0440\u0441\u043e\u043d\u0430\u0436 + \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u0438 (\u043a\u0432\u0435\u0441\u0442\u044b/\u0431\u043e\u0438/\u0434\u0430\u043d\u0436\u0438).</p>"},{"location":"theory/genre_adaptation.html#342","title":"3.4.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u0447\u0442\u043e \u0437\u0430 \u0447\u0442\u043e \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442","text":"<ul> <li><code>characters</code> \u2014 \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e (\u043a\u043b\u0430\u0441\u0441, \u0443\u0440\u043e\u0432\u0435\u043d\u044c)</li> <li><code>character_stats</code> \u2014 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b (STR/DEX/HP/MP)</li> <li><code>items</code> \u2014 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043e\u0432</li> <li><code>inventory_items</code> \u2014 \u0438\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044c (item_id, qty, bind, durability)</li> <li><code>equipment_slots</code> / <code>character_equipment</code> \u2014 \u044d\u043a\u0438\u043f\u0438\u0440\u043e\u0432\u043a\u0430</li> <li><code>skills</code> / <code>character_skills</code> \u2014 \u043d\u0430\u0432\u044b\u043a\u0438</li> <li><code>quests</code> / <code>quest_steps</code> / <code>user_quests</code> \u2014 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043a\u0432\u0435\u0441\u0442\u043e\u0432</li> <li><code>loot_drops</code> \u2014 \u0444\u0430\u043a\u0442 \u0432\u044b\u0434\u0430\u0447\u0438 \u043b\u0443\u0442\u0430 (\u0434\u043b\u044f \u0430\u043d\u0442\u0438\u0447\u0438\u0442\u0430 \u0438 \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0439)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 <code>loot_drops</code> \u0447\u0430\u0441\u0442\u043e \u043d\u0443\u0436\u0435\u043d: \u0438\u043d\u0430\u0447\u0435 \u201c\u044f \u0432\u044b\u0431\u0438\u043b \u043b\u0435\u0433\u0435\u043d\u0434\u0430\u0440\u043a\u0443, \u043d\u043e \u043f\u0440\u043e\u043f\u0430\u043b\u0430\u201d \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u044c.</p>"},{"location":"theory/genre_adaptation.html#343","title":"3.4.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u0432\u044b\u0434\u0430\u0447\u0443 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043e\u0432 (drop) \u0438 \u0438\u0445 \u0440\u0435\u0434\u043a\u043e\u0441\u0442\u044c,</li> <li>\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043a\u0432\u0435\u0441\u0442\u043e\u0432 \u0438 \u043d\u0430\u0433\u0440\u0430\u0434\u044b,</li> <li>\u043f\u0440\u043e\u043a\u0430\u0447\u043a\u0443 \u043d\u0430\u0432\u044b\u043a\u043e\u0432,</li> <li>\u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0438\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044f (\u043d\u0435\u043b\u044c\u0437\u044f \u201c\u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u201d \u043f\u0440\u0435\u0434\u043c\u0435\u0442).</li> </ul>"},{"location":"theory/genre_adaptation.html#344","title":"3.4.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043f\u043e \u043a\u0432\u0435\u0441\u0442\u0430\u043c, \u0441\u0438\u043b\u0430 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0430 (power)</li> <li>rarity distribution</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>quest funnel (\u0433\u0434\u0435 \u0437\u0430\u0441\u0442\u0440\u0435\u0432\u0430\u044e\u0442)</li> <li>\u0431\u0430\u043b\u0430\u043d\u0441 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043e\u0432/\u0431\u0438\u043b\u0434\u043e\u0432</li> <li>\u0442\u0435\u043c\u043f \u043f\u0440\u043e\u043a\u0430\u0447\u043a\u0438 \u043f\u043e \u0443\u0440\u043e\u0432\u043d\u044f\u043c</li> </ul>"},{"location":"theory/genre_adaptation.html#345","title":"3.4.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>quest_complete</code></li> <li><code>item_grant</code>, <code>item_equip</code></li> <li><code>skill_upgrade</code></li> </ul>"},{"location":"theory/genre_adaptation.html#35-strategy-tower-defense","title":"3.5. Strategy / Tower Defense","text":""},{"location":"theory/genre_adaptation.html#351","title":"3.5.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u041c\u0430\u0442\u0447/\u0437\u0430\u0431\u0435\u0433 + \u0432\u043e\u043b\u043d\u044b.</p>"},{"location":"theory/genre_adaptation.html#352","title":"3.5.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u201c\u0431\u043e\u0435\u0432\u043e\u0439 \u043c\u043e\u0434\u0443\u043b\u044c\u201d","text":"<ul> <li><code>matches</code> \u2014 \u043c\u0430\u0442\u0447 (mode/map/season/status)</li> <li><code>match_waves</code> \u2014 \u0432\u043e\u043b\u043d\u044b (wave_number, enemies_killed, base_hp_left)</li> <li><code>towers/buildings</code> \u2014 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a</li> <li><code>player_buildings</code> \u2014 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u0439 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0431\u0430\u0448\u0435\u043d \u0438\u0433\u0440\u043e\u043a\u0430 (\u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c)</li> <li><code>match_build_actions</code> \u2014 \u0436\u0443\u0440\u043d\u0430\u043b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 (build/upgrade/sell)</li> <li><code>battle_results</code> \u2014 \u0438\u0442\u043e\u0433 (is_win, score, duration, wave_reached)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 <code>match_build_actions</code> \u043f\u043e\u043b\u0435\u0437\u0435\u043d: \u044d\u0442\u043e \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0431\u0430\u043b\u0430\u043d\u0441\u0430 \u0438 \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0439 \u201c\u043a\u0430\u043a \u0438\u0433\u0440\u043e\u043a \u043f\u0440\u043e\u0448\u0451\u043b \u0432\u043e\u043b\u043d\u0443\u201d.</p>"},{"location":"theory/genre_adaptation.html#353","title":"3.5.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0443 \u0441\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0430 (\u0445\u0432\u0430\u0442\u0430\u043b\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432),</li> <li>\u0432\u0430\u043b\u0438\u0434\u043d\u043e\u0441\u0442\u044c \u0432\u043e\u043b\u043d\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430,</li> <li>\u0440\u0430\u0441\u0447\u0451\u0442 \u043d\u0430\u0433\u0440\u0430\u0434,</li> <li>\u043f\u043e\u043f\u0430\u0434\u0430\u043d\u0438\u0435 \u0432 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434.</li> </ul>"},{"location":"theory/genre_adaptation.html#354","title":"3.5.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>winrate, wave_reached, avg_duration</li> <li>base_hp_left trend</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>difficulty funnel \u043f\u043e \u0432\u043e\u043b\u043d\u0430\u043c</li> <li>\u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c \u0431\u0430\u0448\u0435\u043d (pick rate vs win)</li> <li>\u0431\u0430\u043b\u0430\u043d\u0441 \u043a\u0430\u0440\u0442</li> </ul>"},{"location":"theory/genre_adaptation.html#355","title":"3.5.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>match_start</code>, <code>match_finish</code></li> <li><code>build</code>, <code>upgrade</code></li> <li><code>wave_end</code></li> </ul>"},{"location":"theory/genre_adaptation.html#36-shooter-action","title":"3.6. Shooter / Action","text":""},{"location":"theory/genre_adaptation.html#361","title":"3.6.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u041c\u0430\u0442\u0447, \u0438\u043d\u043e\u0433\u0434\u0430 \u0440\u0430\u0443\u043d\u0434\u044b.</p>"},{"location":"theory/genre_adaptation.html#362","title":"3.6.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u201c\u0442\u0435\u043b\u0435\u043c\u0435\u0442\u0440\u0438\u044f \u0431\u043e\u044f\u201d","text":"<ul> <li><code>matches</code> / <code>rounds</code></li> <li><code>weapons</code></li> <li><code>player_loadouts</code></li> <li><code>match_kills</code> / <code>match_deaths</code> / <code>assists</code></li> <li><code>shots_agg</code> (shots_fired, shots_hit) \u2014 \u043b\u0443\u0447\u0448\u0435 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u043e\u043c, \u0430 \u043d\u0435 \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u044b\u0441\u0442\u0440\u0435\u043b</li> <li><code>damage_events</code> (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0439)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u201c\u0432\u044b\u0441\u0442\u0440\u0435\u043b\u044b \u043b\u0443\u0447\u0448\u0435 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u043e\u043c\u201d: \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u044b\u0441\u0442\u0440\u0435\u043b = \u043e\u0433\u0440\u043e\u043c\u043d\u044b\u0439 \u043e\u0431\u044a\u0451\u043c events \u2192 \u0411\u0414 \u201c\u0443\u043c\u0438\u0440\u0430\u0435\u0442\u201d.</p>"},{"location":"theory/genre_adaptation.html#363","title":"3.6.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043c\u0430\u0442\u0447\u0430,</li> <li>\u0430\u043d\u0442\u0438\u0447\u0438\u0442 \u043f\u043e\u0440\u043e\u0433\u0438 (accuracy, fire rate),</li> <li>\u0440\u0435\u0439\u0442\u0438\u043d\u0433/\u0440\u0430\u043d\u0433,</li> <li>\u043d\u0430\u0433\u0440\u0430\u0434\u044b.</li> </ul>"},{"location":"theory/genre_adaptation.html#364","title":"3.6.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>K/D, accuracy, HS rate</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>weapon balance</li> <li>\u043f\u043e\u0434\u043e\u0437\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u0435\u0439</li> <li>\u0443\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435 \u043f\u043e \u0440\u0435\u0436\u0438\u043c\u0430\u043c</li> </ul>"},{"location":"theory/genre_adaptation.html#365","title":"3.6.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>match_finish</code></li> <li><code>kill</code> (\u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c: \u043a\u0442\u043e/\u0447\u0435\u043c/\u0433\u0434\u0435)</li> <li><code>shots_summary</code></li> </ul>"},{"location":"theory/genre_adaptation.html#37-visual-novel","title":"3.7. Visual Novel","text":""},{"location":"theory/genre_adaptation.html#371","title":"3.7.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u042d\u043f\u0438\u0437\u043e\u0434/\u0433\u043b\u0430\u0432\u0430/\u0443\u0437\u0435\u043b \u0438\u0441\u0442\u043e\u0440\u0438\u0438.</p>"},{"location":"theory/genre_adaptation.html#372","title":"3.7.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u201c\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438\u201d","text":"<ul> <li><code>story_nodes</code> \u2014 \u0443\u0437\u043b\u044b \u0441\u044e\u0436\u0435\u0442\u0430</li> <li><code>choices</code> \u2014 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u044b \u0432\u044b\u0431\u043e\u0440\u0430</li> <li><code>user_story_state</code> \u2014 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0443\u0437\u0435\u043b + \u0444\u043b\u0430\u0433\u0438 \u0432\u0435\u0442\u043e\u043a (\u0441\u043d\u0438\u043c\u043e\u043a)</li> <li><code>user_choices</code> \u2014 \u0444\u0430\u043a\u0442\u044b \u0432\u044b\u0431\u043e\u0440\u043e\u0432 (\u0436\u0443\u0440\u043d\u0430\u043b)</li> <li><code>endings</code> + <code>user_endings</code> \u2014 \u043a\u043e\u043d\u0446\u043e\u0432\u043a\u0438</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0443\u0436\u0435\u043d \u0438 snapshot, \u0438 journal:</p> <ul> <li>snapshot \u0431\u044b\u0441\u0442\u0440\u043e \u0433\u0440\u0443\u0437\u0438\u0442 \u201c\u0433\u0434\u0435 \u044f \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043b\u0441\u044f\u201d</li> <li>journal \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u201c\u043a\u0430\u043a\u0438\u0435 \u0432\u044b\u0431\u043e\u0440\u044b \u044f \u0434\u0435\u043b\u0430\u043b\u201d (\u0438 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u043c\u0435\u0442\u0440\u0438\u043a\u0430\u043c).</li> </ul>"},{"location":"theory/genre_adaptation.html#373","title":"3.7.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u0444\u0430\u043a\u0442\u044b \u0432\u044b\u0431\u043e\u0440\u0430,</li> <li>\u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0435 \u043a\u043e\u043d\u0446\u043e\u0432\u043e\u043a,</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043d\u0430 \u0440\u0430\u0437\u043d\u044b\u0445 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430\u0445.</li> </ul>"},{"location":"theory/genre_adaptation.html#374","title":"3.7.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>current node/chapter</li> <li>endings unlocked</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>distribution choices</li> <li>chapter funnel (\u0433\u0434\u0435 \u0431\u0440\u043e\u0441\u0430\u044e\u0442)</li> <li>completion rate</li> </ul>"},{"location":"theory/genre_adaptation.html#375","title":"3.7.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>choice_made</code></li> <li><code>chapter_complete</code></li> <li><code>ending_unlocked</code></li> </ul>"},{"location":"theory/genre_adaptation.html#38-educational-game","title":"3.8. Educational Game","text":""},{"location":"theory/genre_adaptation.html#381","title":"3.8.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>\u0423\u0440\u043e\u043a/\u043c\u043e\u0434\u0443\u043b\u044c + \u043f\u043e\u043f\u044b\u0442\u043a\u0430.</p>"},{"location":"theory/genre_adaptation.html#382","title":"3.8.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u201c\u043e\u0431\u0443\u0447\u0430\u044e\u0449\u0438\u0439 \u043a\u043e\u043d\u0442\u0443\u0440\u201d","text":"<ul> <li><code>lessons/modules</code></li> <li><code>tasks/questions</code></li> <li><code>attempts</code> \u2014 \u043f\u043e\u043f\u044b\u0442\u043a\u0438 (start_at, end_at, score)</li> <li><code>answers</code> (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)</li> <li><code>mastery</code> \u2014 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043e\u0441\u0432\u043e\u0435\u043d\u0438\u044f</li> <li><code>certificates</code> (\u0435\u0441\u043b\u0438 \u0432\u044b\u0434\u0430\u044e\u0442\u0441\u044f)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 attempts \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e: \u044d\u0442\u043e \u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u0430\u0443\u0434\u0438\u0442: \u043a\u0442\u043e \u043a\u043e\u0433\u0434\u0430 \u0440\u0435\u0448\u0430\u043b \u0438 \u043a\u0430\u043a\u043e\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442.</p>"},{"location":"theory/genre_adaptation.html#383","title":"3.8.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u043e\u0446\u0435\u043d\u0438\u0432\u0430\u043d\u0438\u0435 (\u043d\u0435 \u0434\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u201c\u044f \u0440\u0435\u0448\u0438\u043b \u043d\u0430 100\u201d),</li> <li>\u043b\u0438\u043c\u0438\u0442\u044b \u043f\u043e\u043f\u044b\u0442\u043e\u043a,</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 mastery.</li> </ul>"},{"location":"theory/genre_adaptation.html#384","title":"3.8.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>score per lesson</li> <li>time per task</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>error frequency by topic</li> <li>learning curve</li> <li>dropout points</li> </ul>"},{"location":"theory/genre_adaptation.html#385","title":"3.8.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>attempt_start</code>, <code>attempt_finish</code></li> <li><code>task_failed</code> (\u0441 \u0442\u0438\u043f\u043e\u043c \u043e\u0448\u0438\u0431\u043a\u0438)</li> <li><code>module_complete</code></li> </ul>"},{"location":"theory/genre_adaptation.html#39-survival","title":"3.9. Survival","text":""},{"location":"theory/genre_adaptation.html#391","title":"3.9.1. \u0415\u0434\u0438\u043d\u0438\u0446\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430","text":"<p>Run / survival_session (\u0437\u0430\u0431\u0435\u0433/\u0436\u0438\u0437\u043d\u044c).</p>"},{"location":"theory/genre_adaptation.html#392","title":"3.9.2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u2014 \u201c\u043a\u043e\u043d\u0442\u0443\u0440 \u0432\u044b\u0436\u0438\u0432\u0430\u043d\u0438\u044f\u201d","text":"<ul> <li><code>runs</code> \u2014 \u0437\u0430\u0431\u0435\u0433\u0438 (start/end/status)</li> <li><code>run_states</code> (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u044b \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f)</li> <li><code>resources_collected</code></li> <li><code>crafting_recipes</code> + <code>crafted_items</code></li> <li><code>world_events</code></li> <li><code>death_events</code> (\u043f\u0440\u0438\u0447\u0438\u043d\u0430 \u0441\u043c\u0435\u0440\u0442\u0438)</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 run_states \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e: \u043d\u0443\u0436\u0435\u043d, \u0435\u0441\u043b\u0438 \u0438\u0433\u0440\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442:</p> <ul> <li>resume,</li> <li>\u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435,</li> <li>\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0430\u0446\u0438\u044e \u043c\u0435\u0436\u0434\u0443 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430\u043c\u0438.</li> </ul>"},{"location":"theory/genre_adaptation.html#393","title":"3.9.3. \u0421\u0435\u0440\u0432\u0435\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442","text":"<ul> <li>\u0432\u0440\u0435\u043c\u044f \u0432\u044b\u0436\u0438\u0432\u0430\u043d\u0438\u044f,</li> <li>\u043a\u0440\u0430\u0444\u0442 \u0438 \u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435,</li> <li>\u043f\u0440\u0438\u0447\u0438\u043d\u0443 \u0441\u043c\u0435\u0440\u0442\u0438,</li> <li>\u043d\u0430\u0433\u0440\u0430\u0434\u044b/\u0448\u0442\u0440\u0430\u0444\u044b.</li> </ul>"},{"location":"theory/genre_adaptation.html#394","title":"3.9.4. \u041c\u0435\u0442\u0440\u0438\u043a\u0438","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435:</p> <ul> <li>survival_time</li> <li>resources/min</li> </ul> <p>\u041f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432\u044b\u0435:</p> <ul> <li>death reasons distribution</li> <li>difficulty spikes</li> <li>retention vs run length</li> </ul>"},{"location":"theory/genre_adaptation.html#395","title":"3.9.5. \u0421\u043e\u0431\u044b\u0442\u0438\u044f","text":"<ul> <li><code>run_start</code>, <code>run_end</code></li> <li><code>craft_item</code></li> <li><code>death</code></li> </ul>"},{"location":"theory/universal_data_model.html","title":"\u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445","text":""},{"location":"theory/universal_data_model.html#1-2","title":"1. \u0422\u0435\u043e\u0440\u0438\u044f. 2. \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445 (\u0430\u0434\u0430\u043f\u0442\u0438\u0440\u0443\u0435\u043c\u0430\u044f \u043f\u043e\u0434 \u0436\u0430\u043d\u0440)","text":"<p>\u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u0430\u043d\u043d\u044b\u0445 \u2014 \u044d\u0442\u043e \u044f\u0434\u0440\u043e \u0418\u0421 \u0441\u043e\u043f\u0440\u043e\u0432\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438\u0433\u0440\u043e\u0432\u043e\u0433\u043e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430. \u041e\u043d\u0430 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043d\u0430 5 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432:</p> <ol> <li>\u041a\u0442\u043e \u0438\u0433\u0440\u0430\u0435\u0442? (Users, Roles)</li> <li>\u041a\u043e\u0433\u0434\u0430 \u0438 \u043e\u0442\u043a\u0443\u0434\u0430 \u043e\u043d \u0438\u0433\u0440\u0430\u0435\u0442? (GameSessions)</li> <li>\u0427\u0442\u043e \u043e\u043d \u0434\u0435\u043b\u0430\u0435\u0442? (GameEvents)</li> <li>\u041a\u0430\u043a\u043e\u0439 \u0438\u0442\u043e\u0433 \u044d\u0442\u043e \u0434\u0430\u0451\u0442 \u201c\u043f\u0440\u044f\u043c\u043e \u0441\u0435\u0439\u0447\u0430\u0441\u201d? (PlayerProgress)</li> <li>\u041a\u0430\u043a \u044d\u0442\u043e \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0432 \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0443 \u0438 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435? (Statistics, Leaderboard)</li> </ol> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u043e\u0434\u0435\u043b\u044c \u0436\u0430\u043d\u0440\u043e\u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u0430\u044f: \u043b\u044e\u0431\u043e\u0439 \u0436\u0430\u043d\u0440 (RPG/TD/VN/Survival) \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043f\u043e\u0440\u043e\u0436\u0434\u0430\u0435\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0439 \u043a\u043e\u043d\u0432\u0435\u0439\u0435\u0440 \u0434\u0430\u043d\u043d\u044b\u0445:</p> <p>\u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u2192 \u0441\u0435\u0441\u0441\u0438\u0438 \u2192 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u2192 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u2192 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u2192 \u0440\u0435\u0439\u0442\u0438\u043d\u0433</p>"},{"location":"theory/universal_data_model.html#21","title":"2.1. \u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0438 \u0440\u043e\u043b\u044c \u0411\u0414","text":"<pre><code>Game Client (Unity / Web / Mobile)\n        \u2193 JSON / HTTPS\nREST API (Stateless + JWT)\n        \u2193\nBackend (Business Logic)\n        \u2193\nRelational DB (MySQL 8.0+)\n</code></pre>"},{"location":"theory/universal_data_model.html#_1","title":"\u041f\u043e\u0447\u0435\u043c\u0443 \u0438\u043c\u0435\u043d\u043d\u043e \u0442\u0430\u043a\u0430\u044f \u0441\u0445\u0435\u043c\u0430 (\u0430 \u043d\u0435 \u201c\u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u0441\u0451 \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0441\u0430\u043c\u201d)?","text":"<ul> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435\u043b\u044c\u0437\u044f \u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u043e\u043c \u0438\u0441\u0442\u0438\u043d\u044b: \u043e\u043d \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d, \u201c\u043d\u0430\u043a\u0440\u0443\u0447\u0435\u043d\u201d, \u043c\u043e\u0436\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u043e\u0444\u043b\u0430\u0439\u043d \u0438\u043b\u0438 \u0441 \u043e\u0448\u0438\u0431\u043a\u0430\u043c\u0438.</li> <li>\u0421\u0435\u0440\u0432\u0435\u0440 \u2014 \u043c\u0435\u0441\u0442\u043e, \u0433\u0434\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f \u043f\u0440\u0430\u0432\u0438\u043b\u0430: \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0430, \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438, \u0430\u043d\u0442\u0438\u0447\u0438\u0442.</li> <li>\u0411\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u2014 \u201c\u043f\u0430\u043c\u044f\u0442\u044c \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u201d: \u0431\u0435\u0437 \u043d\u0435\u0451 \u043d\u0435\u043b\u044c\u0437\u044f \u0434\u043e\u043a\u0430\u0437\u0430\u0442\u044c, \u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e, \u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435.</li> </ul>"},{"location":"theory/universal_data_model.html#_2","title":"\u041a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u0441\u043c\u044b\u0441\u043b \u043a\u043e\u043d\u0442\u0443\u0440\u0430 (\u043b\u043e\u0433\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445)","text":"<ol> <li>\u041a\u043b\u0438\u0435\u043d\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u0435: \u201c\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u043b \u0431\u0430\u0448\u043d\u044e\u201d, \u201c\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b \u043c\u0430\u0442\u0447\u201d, \u201c\u043f\u043e\u043b\u0443\u0447\u0438\u043b \u043d\u0430\u0433\u0440\u0430\u0434\u0443\u201d.</li> <li>API \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442: JSON \u0432\u0430\u043b\u0438\u0434\u0435\u043d? JWT \u0432\u0430\u043b\u0438\u0434\u0435\u043d? \u0438\u0433\u0440\u043e\u043a \u043d\u0435 \u0437\u0430\u0431\u0430\u043d\u0435\u043d? \u0447\u0430\u0441\u0442\u043e\u0442\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043d\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u0430\u044f?</li> <li> <p>Backend:</p> </li> <li> <p>\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u0444\u0430\u043a\u0442 (event),</p> </li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 (progress),</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b (stats),</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 (leaderboard).</li> <li>\u0411\u0414 \u2014 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0438\u0441\u0442\u0438\u043d\u044b: \u0441\u0435\u0440\u0432\u0435\u0440 \u0440\u0435\u0448\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0440\u0438\u043d\u044f\u0442\u044c, \u0430 \u0447\u0442\u043e \u043e\u0442\u043a\u043b\u043e\u043d\u0438\u0442\u044c.</li> </ol>"},{"location":"theory/universal_data_model.html#22-8","title":"2.2. \u041a\u043e\u043d\u0446\u0435\u043f\u0446\u0438\u044f \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u043e\u0434\u0435\u043b\u0438: 8 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0431\u043b\u043e\u043a\u043e\u0432 \u044f\u0434\u0440\u0430","text":""},{"location":"theory/universal_data_model.html#221-users","title":"2.2.1. Users (\u0430\u043a\u043a\u0430\u0443\u043d\u0442)","text":"<p>\u0425\u0440\u0430\u043d\u0438\u043c:</p> <ul> <li>\u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440,</li> <li>email (\u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d),</li> <li>password_hash (\u043d\u0435 \u043f\u0430\u0440\u043e\u043b\u044c),</li> <li>nickname,</li> <li>created_at/last_login_at,</li> <li>is_banned.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e <code>is_banned</code> \u0432 users: \u0431\u0430\u043d \u2014 \u044d\u0442\u043e \u201c\u0441\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u0430\u201d, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e \u043e\u0442\u043a\u043b\u044e\u0447\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430.</p>"},{"location":"theory/universal_data_model.html#222-roles","title":"2.2.2. Roles (\u043f\u0440\u0430\u0432\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u0430)","text":"<p>\u0420\u043e\u043b\u0438 \u043d\u0443\u0436\u043d\u044b, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043e\u0434\u043d\u0430 \u0418\u0421 \u043e\u0431\u0441\u043b\u0443\u0436\u0438\u0432\u0430\u0435\u0442:</p> <ul> <li>\u0438\u0433\u0440\u043e\u043a\u043e\u0432,</li> <li>\u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u0432 (\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043b\u043e\u0433\u043e\u0432/\u0436\u0430\u043b\u043e\u0431),</li> <li>\u0430\u0434\u043c\u0438\u043d\u043e\u0432 (\u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0444\u0438\u0433\u0430\u043c\u0438/\u0441\u0435\u0437\u043e\u043d\u0430\u043c\u0438/\u0434\u043e\u0441\u043a\u0430\u043c\u0438).</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0440\u043e\u043b\u0438 \u2014 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044c, \u0430 \u043d\u0435 \u043f\u043e\u043b\u0435 <code>users.role</code>: \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e:</p> <ul> <li>\u0440\u043e\u043b\u0435\u0439 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e (M:N),</li> <li>\u043f\u0440\u0430\u0432\u0430 \u043c\u043e\u0433\u0443\u0442 \u043c\u0435\u043d\u044f\u0442\u044c\u0441\u044f,</li> <li>\u0430\u0434\u043c\u0438\u043d\u043a\u0430/\u043c\u043e\u0434\u0435\u0440\u0430\u0446\u0438\u044f \u0440\u0430\u0437\u0432\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043e\u0442 \u0438\u0433\u0440\u044b.</li> </ul>"},{"location":"theory/universal_data_model.html#223-gamesessions","title":"2.2.3. GameSessions (\u0441\u0435\u0441\u0441\u0438\u0438)","text":"<p>\u0421\u0435\u0441\u0441\u0438\u044f \u2014 \u0444\u0430\u043a\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0438\u0433\u0440\u044b \u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b.</p> <p>\u0417\u0430\u0447\u0435\u043c \u0441\u0435\u0441\u0441\u0438\u0438 \u043d\u0443\u0436\u043d\u044b \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u0447\u0430\u0445:</p> <ul> <li>retention D1/D7/D30 (\u043f\u043e \u0444\u0430\u043a\u0442\u0443 \u0432\u0445\u043e\u0434\u043e\u0432),</li> <li>playtime (\u0432\u0440\u0435\u043c\u044f \u0432 \u0438\u0433\u0440\u0435),</li> <li>\u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u201c\u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u043b\u043e \u043f\u0435\u0440\u0435\u0434 \u0431\u0430\u0433\u043e\u043c/\u0431\u0430\u043d\u043e\u043c\u201d.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0441\u0435\u0441\u0441\u0438\u044f \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043e\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u0439: \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u043c\u043d\u043e\u0433\u043e, \u0430 \u0441\u0435\u0441\u0441\u0438\u044f \u2014 \u201c\u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u201d, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0443\u043f\u0440\u043e\u0449\u0430\u0435\u0442 \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0443 \u0438 \u0430\u0443\u0434\u0438\u0442.</p>"},{"location":"theory/universal_data_model.html#224-gameevents","title":"2.2.4. GameEvents (\u043f\u043e\u0442\u043e\u043a \u0441\u043e\u0431\u044b\u0442\u0438\u0439)","text":"<p>Events \u2014 \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u201c\u0441\u044b\u0440\u043e\u0439 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u201d \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f.</p> <p>\u041f\u043e\u0447\u0435\u043c\u0443 events \u043d\u0443\u0436\u043d\u044b, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c progress/stats:</p> <ul> <li>progress \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u201c\u0447\u0442\u043e \u0441\u0435\u0439\u0447\u0430\u0441\u201d, \u043d\u043e \u043d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u201c\u043a\u0430\u043a \u043a \u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u0438\u0448\u043b\u0438\u201d.</li> <li> <p>events \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0442:</p> </li> <li> <p>\u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e,</p> </li> <li>\u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u044c,</li> <li>\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0443 \u0431\u0430\u043b\u0430\u043d\u0441\u0430,</li> <li>\u0432\u0438\u0434\u0435\u0442\u044c \u0430\u043d\u043e\u043c\u0430\u043b\u0438\u0438 (\u0430\u043d\u0442\u0438\u0447\u0438\u0442).</li> </ul>"},{"location":"theory/universal_data_model.html#225-playerprogress","title":"2.2.5. PlayerProgress (\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0438\u0433\u0440\u043e\u043a\u0430 \u0441\u0435\u0439\u0447\u0430\u0441)","text":"<p>Progress \u2014 \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u201c\u0441\u0430\u043b\u044c\u0434\u043e\u201d:</p> <ul> <li>level, xp,</li> <li>soft/hard currency,</li> <li>updated_at.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 progress \u043d\u0435\u043b\u044c\u0437\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437 \u0438\u0437 events: \u0438\u0437-\u0437\u0430 \u043e\u0431\u044a\u0451\u043c\u0430 \u0438 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438:</p> <ul> <li>events \u0431\u044b\u0441\u0442\u0440\u043e \u0440\u0430\u0441\u0442\u0443\u0442 \u0434\u043e \u043c\u0438\u043b\u043b\u0438\u043e\u043d\u043e\u0432 \u0441\u0442\u0440\u043e\u043a,</li> <li>\u043f\u0435\u0440\u0435\u0441\u0447\u0451\u0442 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u201c\u043d\u0430 \u043b\u0435\u0442\u0443\u201d \u0443\u0431\u0438\u0432\u0430\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c,</li> <li>UI \u043f\u0440\u043e\u0444\u0438\u043b\u044f \u0434\u043e\u043b\u0436\u0435\u043d \u0433\u0440\u0443\u0437\u0438\u0442\u044c\u0441\u044f \u0431\u044b\u0441\u0442\u0440\u043e.</li> </ul>"},{"location":"theory/universal_data_model.html#226-achievements-userachievements","title":"2.2.6. Achievements (\u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a) + UserAchievements (\u0444\u0430\u043a\u0442\u044b \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f)","text":"<p>\u0420\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435:</p> <ul> <li>achievements: \u201c\u0447\u0442\u043e \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442\u201d,</li> <li>user_achievements: \u201c\u043a\u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u201d.</li> </ul> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0432\u0430\u0436\u043d\u043e: \u0435\u0441\u043b\u0438 \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u0432\u043d\u0443\u0442\u0440\u0438 <code>user_achievements</code>, \u043b\u044e\u0431\u043e\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u043f\u043e\u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c \u0442\u044b\u0441\u044f\u0447\u0438 \u0441\u0442\u0440\u043e\u043a.</p>"},{"location":"theory/universal_data_model.html#227-statistics","title":"2.2.7. Statistics (\u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b)","text":"<p>\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043f\u043e \u0434\u043d\u044f\u043c/\u043d\u0435\u0434\u0435\u043b\u044f\u043c/\u0441\u0435\u0437\u043e\u043d\u0430\u043c.</p> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u0432\u044b\u043d\u0435\u0441\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043e\u0442 events: \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0442\u0438\u043f\u0430 \u201c\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0438\u0433\u0440\u043e\u043a\u043e\u0432 \u0438\u0433\u0440\u0430\u043b\u0438 \u0432\u0447\u0435\u0440\u0430\u201d \u0438\u043b\u0438 \u201c\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043f\u0440\u043e\u0432\u0451\u043b \u0438\u0433\u0440\u043e\u043a \u0437\u0430 \u043d\u0435\u0434\u0435\u043b\u044e\u201d \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 events.</p>"},{"location":"theory/universal_data_model.html#228-leaderboard","title":"2.2.8. Leaderboard (\u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0438)","text":"<p>\u041b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u0432\u044b\u043d\u0435\u0441\u0435\u043d \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e:</p> <ul> <li>\u0434\u043e\u0441\u043e\u043a \u043c\u043d\u043e\u0433\u043e,</li> <li>\u0441\u0435\u0437\u043e\u043d\u044b \u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f,</li> <li>\u043f\u0440\u0430\u0432\u0438\u043b\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430 \u0440\u0430\u0437\u043d\u044b\u0435.</li> </ul>"},{"location":"theory/universal_data_model.html#229","title":"2.2.9. \u041a\u043e\u043d\u0432\u0435\u0439\u0435\u0440 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438: \u201c\u0441\u044b\u0440\u044c\u0451 \u2192 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u201d","text":"<p>Events \u2014 \u0441\u044b\u0440\u044c\u0451 Progress / Stats / Leaderboard \u2014 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u044b \u043f\u0435\u0440\u0435\u0440\u0430\u0431\u043e\u0442\u043a\u0438</p>"},{"location":"theory/universal_data_model.html#match_finish","title":"\u041f\u0440\u0438\u043c\u0435\u0440 \u043a\u043e\u043d\u0432\u0435\u0439\u0435\u0440\u0430 (match_finish)","text":"<ol> <li>\u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442 event: <code>match_finish</code> (score, duration, isWin)</li> <li> <p>\u0441\u0435\u0440\u0432\u0435\u0440:</p> </li> <li> <p>\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u0441\u043e\u0431\u044b\u0442\u0438\u0435,</p> </li> <li>\u043d\u0430\u0447\u0438\u0441\u043b\u044f\u0435\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b (xp/currency),</li> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 progress,</li> <li>\u0443\u0432\u0435\u043b\u0438\u0447\u0438\u0432\u0430\u0435\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0443 \u0434\u043d\u044f,</li> <li>\u0434\u0435\u043b\u0430\u0435\u0442 upsert \u0432 leaderboard.</li> </ol>"},{"location":"theory/universal_data_model.html#23-er-","title":"2.3. \u041b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0430\u044f ER-\u043c\u043e\u0434\u0435\u043b\u044c (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e\u0435 \u044f\u0434\u0440\u043e)","text":"<p>```mermaid id=\"z2u6kq\" erDiagram   USERS {     int id PK     string email UNIQUE     string password_hash     string nickname     datetime created_at     datetime last_login_at     bool is_banned   }</p> <p>ROLES {     int id PK     string name UNIQUE   }</p> <p>USER_ROLES {     int user_id PK, FK     int role_id PK, FK     datetime assigned_at   }</p> <p>GAME_SESSIONS {     int id PK     int user_id FK     string client_platform     string client_version     string ip     datetime started_at     datetime ended_at   }</p> <p>GAME_EVENTS {     bigint id PK     int user_id FK     int session_id FK     string event_type     json payload_json     datetime created_at   }</p> <p>PLAYER_PROGRESS {     int user_id PK, FK     int level     int xp     int soft_currency     int hard_currency     datetime updated_at   }</p> <p>ACHIEVEMENTS {     int id PK     string code UNIQUE     string title     string description     int points   }</p> <p>USER_ACHIEVEMENTS {     int user_id PK, FK     int achievement_id PK, FK     datetime unlocked_at   }</p> <p>STATISTICS_DAILY {     int id PK     int user_id FK     date day     int sessions_count     int events_count     int playtime_seconds     int wins     int losses     int score_sum   }</p> <p>LEADERBOARD_SCORES {     int id PK     int user_id FK     string board_code     int season     int score     datetime updated_at   }</p> <p>USERS ||--o{ USER_ROLES : has   ROLES ||--o{ USER_ROLES : includes</p> <p>USERS ||--o{ GAME_SESSIONS : starts   GAME_SESSIONS ||--o{ GAME_EVENTS : contains   USERS ||--o{ GAME_EVENTS : produces</p> <p>USERS ||--|| PLAYER_PROGRESS : owns</p> <p>USERS ||--o{ USER_ACHIEVEMENTS : unlocks   ACHIEVEMENTS ||--o{ USER_ACHIEVEMENTS : granted</p> <p>USERS ||--o{ STATISTICS_DAILY : aggregates   USERS ||--o{ LEADERBOARD_SCORES : ranks </p><pre><code>---\n\n## 2.4. \u041b\u043e\u0433\u0438\u043a\u0430 \u0441\u0432\u044f\u0437\u0435\u0439: \u0447\u0442\u043e \u043e\u043d\u0438 \u0434\u0430\u044e\u0442 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 (\u0441 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u043c\u0438 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0435\u0432)\n\n### 2.4.1. Users \u2194 Roles (M:N)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b \u0438\u0433\u0440\u043e\u043a\u0430\u201d\n\n* \u043c\u043e\u0434\u0435\u0440\u0430\u0442\u043e\u0440 \u0438\u043c\u0435\u0435\u0442 \u0440\u043e\u043b\u044c `moderator`,\n* \u0441\u0435\u0440\u0432\u0435\u0440 \u0434\u0430\u0451\u0442 \u0434\u043e\u0441\u0442\u0443\u043f \u043a `/admin/ban`,\n* \u0438\u0433\u0440\u043e\u043a \u043f\u043e\u0441\u043b\u0435 \u0431\u0430\u043d\u0430 \u043d\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 auth-check.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 M:N:** \u043e\u0434\u0438\u043d \u0447\u0435\u043b\u043e\u0432\u0435\u043a \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0438 `player`, \u0438 `moderator` (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0449\u0438\u043a).\n\n---\n\n### 2.4.2. Users \u2192 GameSessions (1:M)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0442\u044c D7 retention\u201d\n\n* \u0431\u0435\u0440\u0451\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u0443 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0435\u0441\u0442\u044c session \u0432 \u0434\u0435\u043d\u044c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 + session \u0447\u0435\u0440\u0435\u0437 7 \u0434\u043d\u0435\u0439.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 \u0441\u0435\u0441\u0441\u0438\u0438 \u043d\u0443\u0436\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e:** \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043c\u043e\u0433\u0443\u0442 \u043d\u0435 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u201c\u0432\u0445\u043e\u0434\u201d, \u0430 \u0441\u0435\u0441\u0441\u0438\u044f \u2014 \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u0442.\n\n---\n\n### 2.4.3. GameSessions \u2192 GameEvents (1:M)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u0438\u0433\u0440\u0430 \u0432\u044b\u043b\u0435\u0442\u0430\u0435\u0442 \u2014 \u043a\u0430\u043a\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0431\u044b\u043b\u0438 \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u043b\u0435\u0442\u043e\u043c?\u201d\n\n* \u0431\u0435\u0440\u0451\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044e\u044e \u0441\u0435\u0441\u0441\u0438\u044e,\n* \u0431\u0435\u0440\u0451\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 20 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u044d\u0442\u043e\u0439 \u0441\u0435\u0441\u0441\u0438\u0438,\n* \u0432\u0438\u0434\u0438\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 payload_json:** \u0440\u0430\u0437\u043d\u044b\u0435 \u0436\u0430\u043d\u0440\u044b \u0442\u0440\u0435\u0431\u0443\u044e\u0442 \u0440\u0430\u0437\u043d\u044b\u0435 \u043f\u043e\u043b\u044f, \u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u2014 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u0448\u0438\u043d\u0430.\n\n---\n\n### 2.4.4. Users \u2192 PlayerProgress (1:1)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0437\u0430 100 \u043c\u0441\u201d\n\n* \u043e\u0434\u0438\u043d SELECT users + \u043e\u0434\u0438\u043d SELECT progress,\n* \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c events.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 1:1:** \u044d\u0442\u043e \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043e\u043d\u043e \u043e\u0434\u043d\u043e.\n\n---\n\n### 2.4.5. Users \u2194 Achievements (M:N)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0435 \u0437\u0430 100 \u043f\u043e\u0431\u0435\u0434\u201d\n\n* \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430/\u0438\u0432\u0435\u043d\u0442\u044b \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u044e\u0442 \u0443\u0441\u043b\u043e\u0432\u0438\u0435,\n* \u0437\u0430\u043f\u0438\u0441\u044c \u0432 `user_achievements` \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u0442 \u0444\u0430\u043a\u0442 \u043d\u0430\u0432\u0441\u0435\u0433\u0434\u0430.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0439 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e:** \u043c\u0435\u043d\u044f\u0435\u043c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0438 \u043d\u0435 \u0442\u0440\u043e\u0433\u0430\u0435\u043c \u0438\u0441\u0442\u043e\u0440\u0438\u044e.\n\n---\n\n### 2.4.6. Users \u2192 StatisticsDaily (1:M)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430: \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0438\u0433\u0440\u0430\u044e\u0442 \u043f\u043e \u0434\u043d\u044f\u043c\u201d\n\n* \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u0434\u0430\u044e\u0442 \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0431\u0435\u0437 \u0441\u043e\u0431\u044b\u0442\u0438\u0439.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 \u0434\u043d\u0435\u0432\u043d\u0430\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430:** \u0441\u0430\u043c\u044b\u0439 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u043d\u044b\u0439 \u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u0441\u043b\u043e\u0439 (\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u044c weekly/monthly).\n\n---\n\n### 2.4.7. Users \u2192 LeaderboardScores (1:M)\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u201c\u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 TD \u0437\u0430 \u0441\u0435\u0437\u043e\u043d 3\u201d\n\n* \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u043c \u043f\u043e board_code+season,\n* \u0441\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u043c score DESC,\n* \u0432\u044b\u0434\u0430\u0451\u043c top-N.\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 leaderboard \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0434\u0443\u043a\u0442:** \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u2014 \u044d\u0442\u043e \u043d\u0435 \u201c\u0441\u0432\u043e\u0439\u0441\u0442\u0432\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u201d, \u0430 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u0430\u044f \u0431\u0438\u0437\u043d\u0435\u0441-\u0444\u0443\u043d\u043a\u0446\u0438\u044f.\n\n---\n\n## 2.5. \u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0434\u043e 3NF \u2014 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u201c\u043a\u0430\u043a \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u201d \u0438 \u201c\u043a\u0430\u043a \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u201d\n\n### \u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e (\u0442\u0438\u043f\u0438\u0447\u043d\u044b\u0439 \u0441\u0442\u0443\u0434\u0435\u043d\u0447\u0435\u0441\u043a\u0438\u0439 \u0430\u043d\u0442\u0438-\u043f\u0430\u0442\u0442\u0435\u0440\u043d)\n\n`users`:\n\n* email\n* password_hash\n* role_name\n* level\n* xp\n* soft_currency\n* best_score\n* last_10_events (\u0442\u0435\u043a\u0441\u0442\u043e\u043c)\n\n\u041f\u043e\u0447\u0435\u043c\u0443 \u043f\u043b\u043e\u0445\u043e:\n\n* \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u0440\u043e\u043b\u0438 \u0438\u043b\u0438 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0435 users;\n* \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043d\u0435\u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0445;\n* \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u0442\u044c.\n\n### \u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e (3NF)\n\n* \u0440\u043e\u043b\u044c \u0436\u0438\u0432\u0451\u0442 \u0432 roles/user_roles,\n* \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u2014 \u0432 player_progress,\n* \u043b\u0443\u0447\u0448\u0438\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u2014 \u0432 leaderboard_scores,\n* \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u2014 \u0432 game_events.\n\n---\n\n## 2.6. \u0418\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u044f \u2014 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c, \u043a\u0430\u043a\u0438\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u201c\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u201d \u0438\u043d\u0434\u0435\u043a\u0441\n\n### 2.6.1. Login\n\n\u0417\u0430\u043f\u0440\u043e\u0441:\n\n```sql\nSELECT id, password_hash, is_banned\nFROM users\nWHERE email = ?;\n</code></pre><p></p> <p>\u0418\u043d\u0434\u0435\u043a\u0441: <code>UNIQUE(users.email)</code>.</p>"},{"location":"theory/universal_data_model.html#262","title":"2.6.2. \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u0435\u0441\u0441\u0438\u0439 \u0438\u0433\u0440\u043e\u043a\u0430","text":"<pre><code>SELECT *\nFROM game_sessions\nWHERE user_id = ?\nORDER BY started_at DESC\nLIMIT 20;\n</code></pre> <p>\u0418\u043d\u0434\u0435\u043a\u0441: <code>(user_id, started_at)</code>.</p>"},{"location":"theory/universal_data_model.html#263","title":"2.6.3. \u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438\u0433\u0440\u043e\u043a\u0430","text":"<pre><code>SELECT *\nFROM game_events\nWHERE user_id = ?\nORDER BY created_at DESC\nLIMIT 50;\n</code></pre> <p>\u0418\u043d\u0434\u0435\u043a\u0441: <code>(user_id, created_at)</code>.</p>"},{"location":"theory/universal_data_model.html#264","title":"2.6.4. \u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430 \u043f\u043e \u0442\u0438\u043f\u0443 \u0441\u043e\u0431\u044b\u0442\u0438\u044f","text":"<pre><code>SELECT COUNT(*)\nFROM game_events\nWHERE event_type = 'purchase'\n  AND created_at &gt;= NOW() - INTERVAL 7 DAY;\n</code></pre> <p>\u0418\u043d\u0434\u0435\u043a\u0441: <code>(event_type, created_at)</code>.</p>"},{"location":"theory/universal_data_model.html#265","title":"2.6.5. \u041b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434","text":"<pre><code>SELECT user_id, score\nFROM leaderboard_scores\nWHERE board_code = ? AND season = ?\nORDER BY score DESC\nLIMIT 100;\n</code></pre> <p>\u0418\u043d\u0434\u0435\u043a\u0441: <code>(board_code, season, score)</code>.</p>"},{"location":"theory/universal_data_model.html#27","title":"2.7. \u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u044f \u0446\u0435\u043b\u043e\u0441\u0442\u043d\u043e\u0441\u0442\u0438 \u2014 \u043f\u043e\u0447\u0435\u043c\u0443 \u201c\u0411\u0414 \u0434\u043e\u043b\u0436\u043d\u0430 \u0437\u0430\u0449\u0438\u0449\u0430\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u0443\u201d","text":""},{"location":"theory/universal_data_model.html#fk","title":"FK \u0437\u0430\u0449\u0438\u0449\u0430\u044e\u0442 \u043e\u0442 \u201c\u0432\u0438\u0441\u044f\u0447\u0438\u0445\u201d \u0434\u0430\u043d\u043d\u044b\u0445","text":"<p>\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0431\u0435\u0437 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u2014 \u043c\u0443\u0441\u043e\u0440 \u0438 \u043e\u0448\u0438\u0431\u043a\u0430 \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0438.</p>"},{"location":"theory/universal_data_model.html#unique","title":"UNIQUE \u0437\u0430\u0449\u0438\u0449\u0430\u044e\u0442 \u043e\u0442 \u0434\u0443\u0431\u043b\u0435\u0439","text":"<p>\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:</p> <ul> <li>stats \u043d\u0430 (user_id, day) \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043e\u0434\u043d\u0438, \u0438\u043d\u0430\u0447\u0435 \u0430\u0433\u0440\u0435\u0433\u0430\u0442\u044b \u0431\u0443\u0434\u0443\u0442 \u043d\u0435\u0432\u0435\u0440\u043d\u044b.</li> </ul>"},{"location":"theory/universal_data_model.html#check","title":"CHECK \u0437\u0430\u0449\u0438\u0449\u0430\u044e\u0442 \u043e\u0442 \u0430\u0431\u0441\u0443\u0440\u0434\u0430","text":"<p>\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:</p> <ul> <li>level = -5 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0434\u0430\u0436\u0435 \u043f\u043e \u043e\u0448\u0438\u0431\u043a\u0435.</li> </ul>"},{"location":"theory/universal_data_model.html#28-mysql-","title":"2.8. MySQL-\u0441\u043f\u0435\u0446\u0438\u0444\u0438\u043a\u0430: \u0447\u0442\u043e \u0432\u0430\u0436\u043d\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0437\u0434\u0435\u0441\u044c","text":"<ul> <li><code>utf8mb4</code> \u2014 \u043d\u0438\u043a\u043d\u0435\u0439\u043c\u044b/\u044d\u043c\u043e\u0434\u0437\u0438/\u043b\u043e\u043a\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f.</li> <li><code>datetime(3)</code> \u2014 \u0432\u0430\u0436\u043d\u0430 \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u0438 \u043f\u043b\u043e\u0442\u043d\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u044f\u0445.</li> <li><code>JSON</code> \u2014 \u0443\u0434\u043e\u0431\u043d\u043e \u0434\u043b\u044f payload, \u043d\u043e \u043d\u0435 \u0437\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u0446\u0438\u044e \u043f\u043e event_type/time.</li> <li><code>ON DUPLICATE KEY UPDATE</code> \u2014 must-have \u0434\u043b\u044f leaderboard/stats (upsert).</li> </ul>"},{"location":"theory/universal_data_model.html#29","title":"2.9. \u0416\u0430\u043d\u0440\u043e\u0432\u0430\u044f \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u044f \u2014 \u043f\u0440\u0438\u043d\u0446\u0438\u043f \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f (\u043f\u043e\u0434\u0447\u0451\u0440\u043a\u043d\u0443\u0442\u043e \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u043d\u043e)","text":"<p>\u041f\u0440\u0430\u0432\u0438\u043b\u043e \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u043e\u0440\u0430:</p> <ul> <li>\u044f\u0434\u0440\u043e \u043e\u0441\u0442\u0430\u0451\u0442\u0441\u044f \u043d\u0435\u0438\u0437\u043c\u0435\u043d\u043d\u044b\u043c;</li> <li> <p>\u0436\u0430\u043d\u0440 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u201c\u0446\u0435\u043d\u0442\u0440\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\u201d:</p> </li> <li> <p>match/run/episode/cycle,</p> </li> <li>\u043f\u043b\u044e\u0441 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0432\u043e\u043a\u0440\u0443\u0433 \u043d\u0435\u0451.</li> </ul> <p>\u041f\u0440\u0438\u043c\u0435\u0440:</p> <ul> <li>TD: <code>matches</code>, <code>waves</code>, <code>battle_results</code></li> <li>VN: <code>story_nodes</code>, <code>user_choices</code></li> <li>Idle: <code>user_generators</code>, <code>offline_income</code></li> </ul> <p>\u0418 \u0432\u0441\u0451 \u044d\u0442\u043e \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u043e \u043a <code>users</code> \u0438 \u043b\u043e\u0433\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>game_events</code>.</p>"},{"location":"theory/universal_data_model.html#210-mvp","title":"2.10. \u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0436\u0438\u0437\u043d\u0435\u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0435 \u044f\u0434\u0440\u043e (MVP) \u2014 \u043f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e\u0433\u043e \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e","text":"<p>\u0414\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430 MVP, \u0433\u0434\u0435 \u0435\u0441\u0442\u044c:</p> <ul> <li>\u0430\u043a\u043a\u0430\u0443\u043d\u0442\u044b,</li> <li>\u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f,</li> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441,</li> <li>\u0441\u043e\u0431\u044b\u0442\u0438\u044f,</li> <li>\u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434,</li> </ul> <p>\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e:</p> <ul> <li><code>users</code></li> <li><code>roles</code>, <code>user_roles</code></li> <li><code>game_sessions</code></li> <li><code>game_events</code></li> <li><code>player_progress</code></li> <li><code>leaderboard_scores</code></li> </ul>"},{"location":"theory/universal_data_model.html#achievementsstatistics","title":"\u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043b\u043e\u0436\u0438\u0442\u044c achievements/statistics","text":"<ul> <li>\u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f \u0438 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u2014 \u044d\u0442\u043e \u201c\u043d\u0430\u0434\u0441\u0442\u0440\u043e\u0439\u043a\u0438\u201d \u043d\u0430\u0434 \u0441\u043e\u0431\u044b\u0442\u0438\u044f\u043c\u0438 \u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u043e\u043c;</li> <li>\u0438\u0445 \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0435\u0439 \u21162, \u043d\u0435 \u043b\u043e\u043c\u0430\u044f \u044f\u0434\u0440\u043e.</li> </ul>"},{"location":"theory/universal_data_model.html#211-event_type-payload_json","title":"2.11. \u041d\u0430\u0431\u043e\u0440 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 <code>event_type</code> + \u043f\u0440\u0438\u043c\u0435\u0440\u044b <code>payload_json</code> (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043b\u043e\u0432\u0430\u0440\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u0439)","text":"<p>\u0426\u0435\u043b\u044c \u0441\u043b\u043e\u0432\u0430\u0440\u044f \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u2014 \u0437\u0430\u0434\u0430\u0442\u044c \u0435\u0434\u0438\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0440\u0430\u043a\u0442 \u0442\u0435\u043b\u0435\u043c\u0435\u0442\u0440\u0438\u0438 \u043c\u0435\u0436\u0434\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c \u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c. \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0432\u0430\u0436\u043d\u043e:</p> <ul> <li>\u0435\u0434\u0438\u043d\u0430\u044f \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430: \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0436\u0430\u043d\u0440\u0430\u0445 \u0434\u0430\u044e\u0442 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u0438\u043c\u044b\u0435 \u043c\u0435\u0442\u0440\u0438\u043a\u0438;</li> <li>\u0440\u0430\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c: \u043f\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 \u0432\u0438\u0434\u043d\u043e, \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u043b \u0438\u0433\u0440\u043e\u043a;</li> <li>\u0430\u043d\u0442\u0438\u0447\u0438\u0442-\u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f: \u0441\u0435\u0440\u0432\u0435\u0440 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u044f;</li> <li>\u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0435\u043c\u043e\u0441\u0442\u044c \u043f\u043e\u0434 \u0436\u0430\u043d\u0440\u044b: \u043d\u043e\u0432\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0431\u0435\u0437 \u043b\u043e\u043c\u043a\u0438 \u044f\u0434\u0440\u0430.</li> </ul>"},{"location":"theory/universal_data_model.html#2111-payload","title":"2.11.1. \u041e\u0431\u0449\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (\u043a\u0430\u043a \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u044b\u0433\u043b\u044f\u0434\u0435\u0442\u044c payload)","text":"<p>\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0448\u0430\u0431\u043b\u043e\u043d, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439:</p> <pre><code>{\n  \"eventType\": \"string\",\n  \"sessionId\": 123,\n  \"clientTime\": \"2026-02-26T12:10:05.120Z\",\n  \"clientVersion\": \"1.0.3\",\n  \"payload\": {}\n}\n</code></pre> <p>\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u044d\u0442\u043e \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0432 \u0437\u0430\u043f\u0438\u0441\u044c <code>game_events</code>:</p> <ul> <li><code>user_id</code> \u2014 \u0438\u0437 JWT (\u043d\u0435 \u0438\u0437 \u043a\u043b\u0438\u0435\u043d\u0442\u0430!)</li> <li><code>session_id</code> \u2014 \u0438\u0437 body (\u043c\u043e\u0436\u043d\u043e null)</li> <li><code>event_type</code> \u2014 \u0441\u0442\u0440\u043e\u043a\u0430</li> <li><code>payload_json</code> \u2014 \u043e\u0431\u044a\u0435\u043a\u0442</li> <li><code>created_at</code> \u2014 \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f</li> </ul>"},{"location":"theory/universal_data_model.html#2112","title":"2.11.2. \u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0441\u043e\u0431\u044b\u0442\u0438\u0439 (\u044f\u0434\u0440\u043e)","text":"<p>\u041d\u0438\u0436\u0435 \u2014 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043d\u0430\u0431\u043e\u0440 \u0441\u043e\u0431\u044b\u0442\u0438\u0439, \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u044b\u0439 \u0434\u043b\u044f \u043b\u044e\u0431\u043e\u0439 \u0438\u0433\u0440\u044b.</p>"},{"location":"theory/universal_data_model.html#a","title":"A) \u0421\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (\u0436\u0438\u0437\u043d\u0435\u043d\u043d\u044b\u0439 \u0446\u0438\u043a\u043b)","text":"<ol> <li><code>session_start</code> \u2014 \u043d\u0430\u0447\u0430\u043b\u043e \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u0441\u0435\u0441\u0441\u0438\u0438</li> <li><code>session_end</code> \u2014 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 (\u0438\u043b\u0438 heartbeat)</li> </ol> <p>session_start</p> <pre><code>{\n  \"platform\": \"unity\",\n  \"device\": { \"os\": \"Android\", \"model\": \"Pixel 7\" },\n  \"locale\": \"ru-RU\",\n  \"tzOffsetMin\": 180\n}\n</code></pre> <p>session_end</p> <pre><code>{\n  \"reason\": \"user_exit\",\n  \"playtimeSeconds\": 842\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043d\u0443\u0436\u043d\u044b, \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c <code>game_sessions</code>: <code>game_sessions</code> \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u0442 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435, \u043d\u043e <code>session_end</code> \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u043f\u043e\u043d\u044f\u0442\u044c \u043f\u043e\u0447\u0435\u043c\u0443 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u043b\u043e\u0441\u044c (exit/crash/network).</p>"},{"location":"theory/universal_data_model.html#b","title":"B) \u0421\u043e\u0431\u044b\u0442\u0438\u044f \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 \u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438","text":"<ol> <li><code>register</code> \u2014 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c)</li> <li><code>login_success</code> / <code>login_failed</code></li> </ol> <p>login_failed</p> <pre><code>{\n  \"reason\": \"invalid_password\",\n  \"emailHash\": \"sha256:....\"\n}\n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e: \u043d\u0435 \u0445\u0440\u0430\u043d\u0438\u0442\u044c email \u0432 \u0447\u0438\u0441\u0442\u043e\u043c \u0432\u0438\u0434\u0435 \u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u044f\u0445, \u043b\u0443\u0447\u0448\u0435 hash/\u043c\u0430\u0441\u043a\u0430.</p>"},{"location":"theory/universal_data_model.html#c","title":"C) \u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0438 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0430 (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e)","text":"<ol> <li><code>progress_update</code> \u2014 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 (\u0435\u0441\u043b\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441)</li> <li><code>currency_change</code> \u2014 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0432\u0430\u043b\u044e\u0442\u044b</li> <li><code>item_grant</code> \u2014 \u0432\u044b\u0434\u0430\u0447\u0430 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u0430/\u043d\u0430\u0433\u0440\u0430\u0434\u044b</li> <li><code>item_spend</code> \u2014 \u0442\u0440\u0430\u0442\u0430 \u0440\u0435\u0441\u0443\u0440\u0441\u0430/\u043f\u0440\u0435\u0434\u043c\u0435\u0442\u0430</li> </ol> <p>progress_update</p> <pre><code>{\n  \"levelBefore\": 5,\n  \"levelAfter\": 6,\n  \"xpBefore\": 2300,\n  \"xpAfter\": 2450,\n  \"reason\": \"match_finish\"\n}\n</code></pre> <p>currency_change</p> <pre><code>{\n  \"currency\": \"soft\",\n  \"delta\": 300,\n  \"balanceAfter\": 1200,\n  \"reason\": \"reward\"\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 currency_change \u043f\u043e\u043b\u0435\u0437\u0435\u043d \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c <code>player_progress</code>: \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u201c\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0441\u0442\u0430\u043b\u043e\u201d, \u0430 currency_change \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u043f\u043e\u0447\u0435\u043c\u0443 \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c (\u0430\u0443\u0434\u0438\u0442 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0438).</p>"},{"location":"theory/universal_data_model.html#d","title":"D) \u0421\u043e\u0431\u044b\u0442\u0438\u044f \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 (\u0447\u0442\u043e \u0438\u0433\u0440\u043e\u043a \u0434\u0435\u043b\u0430\u0435\u0442 \u0432 \u0438\u0433\u0440\u0435)","text":"<ol> <li><code>level_start</code> / <code>level_complete</code> (\u0438\u043b\u0438 <code>stage_start</code>/<code>stage_complete</code>)</li> <li><code>quest_start</code> / <code>quest_complete</code> (\u0435\u0441\u043b\u0438 RPG/\u043a\u0432\u0435\u0441\u0442\u044b)</li> <li><code>tutorial_step</code> (\u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435)</li> </ol> <p>level_complete</p> <pre><code>{\n  \"levelCode\": \"level_03\",\n  \"result\": \"win\",\n  \"durationSeconds\": 410,\n  \"score\": 12450\n}\n</code></pre> <p>tutorial_step</p> <pre><code>{\n  \"step\": 3,\n  \"status\": \"completed\",\n  \"durationSeconds\": 18\n}\n</code></pre>"},{"location":"theory/universal_data_model.html#e-match-based","title":"E) \u0421\u043e\u0440\u0435\u0432\u043d\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435/\u043c\u0430\u0442\u0447\u0435\u0432\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0430\u043b\u044c\u043d\u043e \u0434\u043b\u044f match-based)","text":"<ol> <li><code>match_start</code></li> <li><code>match_event</code> (\u0434\u043b\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 \u0432 \u043c\u0430\u0442\u0447\u0435)</li> <li><code>match_finish</code></li> </ol> <p>match_start</p> <pre><code>{\n  \"mode\": \"td\",\n  \"mapCode\": \"forest_01\",\n  \"season\": 1\n}\n</code></pre> <p>match_event (\u043f\u0440\u0438\u043c\u0435\u0440 \u0434\u043b\u044f TD build)</p> <pre><code>{\n  \"matchId\": 987654321,\n  \"event\": \"build\",\n  \"atSecond\": 12,\n  \"payload\": {\n    \"buildingCode\": \"tower_arrow\",\n    \"cell\": { \"x\": 5, \"y\": 7 },\n    \"cost\": 100\n  }\n}\n</code></pre> <p>match_finish</p> <pre><code>{\n  \"matchId\": 987654321,\n  \"result\": {\n    \"isWin\": true,\n    \"score\": 12450,\n    \"durationSeconds\": 410,\n    \"waveReached\": 12\n  }\n}\n</code></pre> <p>\u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u044b\u0434\u0435\u043b\u044f\u0435\u043c match_start/finish \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e: \u044d\u0442\u0438 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u043f\u043e\u0447\u0442\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044e\u0442 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044e \u201c\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u2192 \u043d\u0430\u0433\u0440\u0430\u0434\u044b \u2192 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u2192 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434\u201d.</p>"},{"location":"theory/universal_data_model.html#f","title":"F) \u0414\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f","text":"<ol> <li><code>achievement_unlocked</code></li> </ol> <pre><code>{\n  \"code\": \"FIRST_WIN\",\n  \"points\": 10,\n  \"context\": { \"mode\": \"td\", \"season\": 1 }\n}\n</code></pre>"},{"location":"theory/universal_data_model.html#g","title":"G) \u041e\u0448\u0438\u0431\u043a\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u043a\u0440\u0430\u0439\u043d\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u043e\u0432\u0430\u043d\u043e)","text":"<ol> <li><code>client_error</code></li> <li><code>crash_report</code> (\u0435\u0441\u043b\u0438 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u044f \u0435\u0441\u0442\u044c)</li> </ol> <p>client_error</p> <pre><code>{\n  \"type\": \"network\",\n  \"message\": \"timeout\",\n  \"endpoint\": \"/event\",\n  \"retryCount\": 2\n}\n</code></pre>"},{"location":"theory/universal_data_model.html#2113-event_type","title":"2.11.3. \u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f event_type (\u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0431\u044b\u043b\u043e \u0445\u0430\u043e\u0441\u0430)","text":"<p>1) \u0418\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435:</p> <ul> <li>lower_snake_case: <code>match_finish</code>, <code>currency_change</code></li> <li>\u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u044b\u0435 \u0438\u043c\u0435\u043d\u0430 (\u043d\u0435\u043b\u044c\u0437\u044f \u043c\u0435\u043d\u044f\u0442\u044c \u0431\u0435\u0437 \u043c\u0438\u0433\u0440\u0430\u0446\u0438\u0439 \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0438)</li> </ul> <p>2) Payload \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u201c\u0441\u0430\u043c\u043e\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u044b\u043c\u201d:</p> <ul> <li>\u043f\u0440\u0438\u0447\u0438\u043d\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f (<code>reason</code>)</li> <li>\u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430 (<code>score</code>, <code>durationSeconds</code>)</li> </ul> <p>3) \u0421\u0435\u0440\u0432\u0435\u0440\u043d\u0430\u044f \u0438\u0441\u0442\u0438\u043d\u0430:</p> <ul> <li><code>user_id</code> \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 JWT</li> <li><code>created_at</code> \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0435\u0440\u0432\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f</li> <li>\u043d\u0430\u0433\u0440\u0430\u0434\u044b \u043b\u0443\u0447\u0448\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c, \u0430 \u043d\u0435 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u201c\u043a\u0430\u043a \u0435\u0441\u0442\u044c\u201d</li> </ul>"},{"location":"theory/universal_data_model.html#212-endpoint","title":"2.12. \u0422\u0430\u0431\u043b\u0438\u0446\u0430: \u043a\u0430\u043a\u043e\u0439 endpoint \u043a\u0430\u043a\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0447\u0438\u0442\u0430\u0435\u0442/\u043f\u0438\u0448\u0435\u0442","text":"<p>\u0426\u0435\u043b\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u2014 \u0434\u0430\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0443 \u043a\u0430\u0440\u0442\u0443 \u0434\u0430\u043d\u043d\u044b\u0445: \u0447\u0442\u043e \u0442\u0440\u043e\u0433\u0430\u0435\u0442 \u043a\u0430\u0436\u0434\u044b\u0439 endpoint, \u0433\u0434\u0435 \u043d\u0443\u0436\u043d\u044b \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u0438, \u043a\u0430\u043a\u0438\u0435 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u044b.</p> <p>\u041e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f: R \u2014 Read (\u0447\u0438\u0442\u0430\u0435\u0442) W \u2014 Write (\u043f\u0438\u0448\u0435\u0442) TX \u2014 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0441\u044f/\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430</p> Endpoint \u0422\u0430\u0431\u043b\u0438\u0446\u044b (R) \u0422\u0430\u0431\u043b\u0438\u0446\u044b (W) TX \u0417\u0430\u0447\u0435\u043c / \u043f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f POST /register <code>users</code> (\u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 email), <code>roles</code> <code>users</code>, <code>user_roles</code>, (\u043e\u043f\u0446.) <code>player_progress</code> \u0434\u0430 \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442, \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0440\u043e\u043b\u044c <code>player</code>, \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 POST /login <code>users</code>, <code>user_roles</code>, <code>roles</code> <code>users</code> (\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c last_login_at), (\u043e\u043f\u0446.) <code>game_sessions</code> \u043d\u0435\u0442/\u043e\u043f\u0446. \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043f\u0430\u0440\u043e\u043b\u044f, \u0431\u0430\u043d\u043e\u0432, \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 JWT claims GET /profile <code>users</code>, <code>player_progress</code>, (\u043e\u043f\u0446.) <code>user_achievements</code>, <code>leaderboard_scores</code> \u2014 \u043d\u0435\u0442 \u0412\u0438\u0442\u0440\u0438\u043d\u0430 \u043f\u0440\u043e\u0444\u0438\u043b\u044f: \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 + \u043a\u0440\u0430\u0442\u043a\u0438\u0435 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u044f/\u043f\u043e\u0437\u0438\u0446\u0438\u0438 POST /progress <code>player_progress</code> (\u0442\u0435\u043a\u0443\u0449\u0435\u0435) <code>player_progress</code>, <code>game_events</code> (progress_update), (\u043e\u043f\u0446.) <code>statistics_daily</code> \u0434\u0430 \u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u044b\u043c \u0441 \u043b\u043e\u0433\u043e\u043c \u0441\u043e\u0431\u044b\u0442\u0438\u044f POST /event <code>game_sessions</code> (\u043e\u043f\u0446. \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430), (\u043e\u043f\u0446.) <code>player_progress</code> <code>game_events</code>, (\u043e\u043f\u0446.) <code>statistics_daily</code>, (\u043e\u043f\u0446.) <code>leaderboard_scores</code> \u0438\u043d\u043e\u0433\u0434\u0430 \u041f\u0440\u043e\u0441\u0442\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u2014 \u0431\u0435\u0437 TX, \u201c\u0438\u0442\u043e\u0433\u043e\u0432\u044b\u0435\u201d (match_finish) \u2014 \u043b\u0443\u0447\u0448\u0435 TX GET /leaderboard <code>leaderboard_scores</code>, <code>users</code> \u2014 \u043d\u0435\u0442 \u0422\u043e\u043f-N \u043f\u043e board_code/season, \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u043d\u0434\u0435\u043a\u0441 (board_code, season, score) GET /stats <code>statistics_daily</code> \u2014 \u043d\u0435\u0442 \u0414\u0438\u0430\u043f\u0430\u0437\u043e\u043d\u044b \u0434\u0430\u0442, \u0441\u0432\u043e\u0434\u043a\u0430 \u0437\u0430 7/30 \u0434\u043d\u0435\u0439 (\u043e\u043f\u0446.) POST /session/start \u2014 <code>game_sessions</code>, <code>game_events</code> (session_start) \u043d\u0435\u0442 \u0415\u0441\u043b\u0438 \u0441\u0435\u0441\u0441\u0438\u0438 \u0441\u043e\u0437\u0434\u0430\u0451\u0442\u0435 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u043c endpoint (\u043e\u043f\u0446.) POST /session/end <code>game_sessions</code> <code>game_sessions</code>, <code>game_events</code> (session_end) \u0434\u0430 \u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e + \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0438\u0447\u0438\u043d\u0443 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f"},{"location":"theory/universal_data_model.html#2121","title":"2.12.1. \u0413\u0434\u0435 \u0442\u043e\u0447\u043d\u043e \u043d\u0443\u0436\u043d\u0430 \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f (\u0442\u0438\u043f\u043e\u0432\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a)","text":"<p>\u0422\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430, \u0435\u0441\u043b\u0438 endpoint:</p> <ul> <li>\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 <code>player_progress</code> \u0438 \u043f\u0438\u0448\u0435\u0442 \u0432 <code>leaderboard_scores</code>/<code>statistics_daily</code>;</li> <li>\u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442 \u043c\u0430\u0442\u0447 (<code>match_finish</code>);</li> <li>\u0432\u044b\u0434\u0430\u0451\u0442 \u043d\u0430\u0433\u0440\u0430\u0434\u044b (item_grant/currency_change) \u0438 \u043c\u0435\u043d\u044f\u0435\u0442 \u0431\u0430\u043b\u0430\u043d\u0441.</li> </ul> <p>\u0418\u043d\u0430\u0447\u0435 \u043f\u043e\u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u201c\u043f\u043e\u043b\u0443-\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0435\u201d \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f:</p> <ul> <li>\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043e\u0431\u043d\u043e\u0432\u0438\u043b\u0441\u044f, \u0430 \u043b\u0438\u0434\u0435\u0440\u0431\u043e\u0440\u0434 \u043d\u0435\u0442;</li> <li>\u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0430\u043b\u043e\u0441\u044c, \u0430 \u043d\u0430\u0433\u0440\u0430\u0434\u0430 \u043d\u0435\u0442;</li> <li>\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u043b\u0430\u0441\u044c \u0434\u0432\u0430\u0436\u0434\u044b.</li> </ul>"}]}