<!DOCTYPE html><html lang="ru" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="api_design.html">
      
      
      
        
      
      
      <link rel="icon" href="../assets/icons/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Интеграция с игрой - Проектирование и разработка информационных систем</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-6-unity-strategy-support-is" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../index.html" title="Проектирование и разработка информационных систем" class="md-header__button md-logo" aria-label="Проектирование и разработка информационных систем" data-md-component="logo">
      
  <img src="../assets/icons/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Проектирование и разработка информационных систем
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Интеграция с игрой
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Проектирование и разработка информационных систем" class="md-nav__button md-logo" aria-label="Проектирование и разработка информационных систем" data-md-component="logo">
      
  <img src="../assets/icons/logo.png" alt="logo">

    </a>
    Проектирование и разработка информационных систем
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Главная
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Теория
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Теория
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Архиектурная модель
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/universal_data_model.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Универсальная модель данных
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/genre_adaptation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Жанровая адаптацию ИС
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/backend_implementation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Реализация backendа
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/api_design.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API дизайн
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../theory/game_integration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Интеграция с игрой
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Практика
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Практика
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Архиектурная модель
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="universal_data_model.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Универсальная модель данных
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="genre_adaptation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Жанровая адаптация ИС
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="backend_implementation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Реализация backendа
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="api_design.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API дизайн
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Интеграция с игрой
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="game_integration.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Интеграция с игрой
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Что это такое и зачем
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 1. Теория: как Unity общается с сервером
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 1. Теория: как Unity общается с сервером">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-rest-api-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. Что такое REST API и почему это важно для Unity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-http-" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. HTTP-методы
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. JSON — формат обмена данными
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-jwt" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4. JWT — как работает авторизация
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-unitywebrequest-http-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5. UnityWebRequest — HTTP в Unity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6. Контракт всех ответов сервера
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 2. Структура скриптов
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 2. Структура скриптов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Зависимости между слоями
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 3. Endpoint'ы сервера
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 3. Endpoint'ы сервера">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1. Таблица всех endpoint'ов
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2. Описание каждого endpoint'а
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2. Описание каждого endpoint'а">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-apiv1authregister" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/auth/register
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-apiv1authlogin" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/auth/login
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-apiv1profile" class="md-nav__link">
    <span class="md-ellipsis">
      
        GET /api/v1/profile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-apiv1events" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-apiv1matchfinish" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/match/finish
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-apiv1leaderboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        GET /api/v1/leaderboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 4. Пошаговая сборка проекта Unity
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 4. Пошаговая сборка проекта Unity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 1. Создать проект
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 2. Скопировать скрипты
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 3. Настроить адрес сервера
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 4. Запустить сервер
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-authscene" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 5. Сцена AuthScene — экран входа
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 5. Сцена AuthScene — экран входа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Создать сцену
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-canvas" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Создать Canvas
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-loginpanel" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3. Наполнить LoginPanel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-registerpanel" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4. Наполнить RegisterPanel (аналогично)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5. Создать менеджер
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-mainmenu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 6. Сцена MainMenu — профиль и лидерборд
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 6. Сцена MainMenu — профиль и лидерборд">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. Создать сцену
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. Панель профиля
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. Панель лидерборда
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-gamescene" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 7. Сцена GameScene — матч
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 7. Сцена GameScene — матч">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1. Создать сцену
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2. Создать менеджер матча
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3. Кнопки тестирования
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-build-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 8. Добавить сцены в Build Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 9. Проверить работу
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 10. Отладка
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 10. Отладка">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Консоль Unity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Частые проблемы
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-seedsql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 5. Тестовые учётные данные (из seed.sql)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 6. Описание каждого скрипта
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 6. Описание каждого скрипта">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apiconfigcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ApiConfig.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apimodelscs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ApiModels.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authsessioncs" class="md-nav__link">
    <span class="md-ellipsis">
      
        AuthSession.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apiclientcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ApiClient.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gameapiservicecs" class="md-nav__link">
    <span class="md-ellipsis">
      
        GameApiService.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authcontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        AuthController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profilecontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProfileController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaderboardcontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        LeaderboardController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matchcontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        MatchController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventsendercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        EventSender.cs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 7. Расширение проекта
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 7. Расширение проекта">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Добавить новое событие
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#playerprefs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Сохранить токен между сессиями (PlayerPrefs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-prod" class="md-nav__link">
    <span class="md-ellipsis">
      
        Смена сервера (dev / prod)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Что это такое и зачем
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 1. Теория: как Unity общается с сервером
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 1. Теория: как Unity общается с сервером">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-rest-api-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. Что такое REST API и почему это важно для Unity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-http-" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. HTTP-методы
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. JSON — формат обмена данными
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-jwt" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4. JWT — как работает авторизация
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-unitywebrequest-http-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5. UnityWebRequest — HTTP в Unity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6. Контракт всех ответов сервера
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 2. Структура скриптов
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 2. Структура скриптов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Зависимости между слоями
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 3. Endpoint'ы сервера
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 3. Endpoint'ы сервера">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1. Таблица всех endpoint'ов
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2. Описание каждого endpoint'а
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2. Описание каждого endpoint'а">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-apiv1authregister" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/auth/register
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-apiv1authlogin" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/auth/login
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-apiv1profile" class="md-nav__link">
    <span class="md-ellipsis">
      
        GET /api/v1/profile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-apiv1events" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-apiv1matchfinish" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST /api/v1/match/finish
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-apiv1leaderboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        GET /api/v1/leaderboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 4. Пошаговая сборка проекта Unity
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 4. Пошаговая сборка проекта Unity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 1. Создать проект
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 2. Скопировать скрипты
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 3. Настроить адрес сервера
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 4. Запустить сервер
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-authscene" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 5. Сцена AuthScene — экран входа
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 5. Сцена AuthScene — экран входа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1. Создать сцену
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-canvas" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2. Создать Canvas
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-loginpanel" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3. Наполнить LoginPanel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-registerpanel" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4. Наполнить RegisterPanel (аналогично)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5. Создать менеджер
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-mainmenu" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 6. Сцена MainMenu — профиль и лидерборд
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 6. Сцена MainMenu — профиль и лидерборд">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. Создать сцену
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. Панель профиля
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. Панель лидерборда
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-gamescene" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 7. Сцена GameScene — матч
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 7. Сцена GameScene — матч">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1. Создать сцену
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2. Создать менеджер матча
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3. Кнопки тестирования
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-build-settings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 8. Добавить сцены в Build Settings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 9. Проверить работу
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Шаг 10. Отладка
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Шаг 10. Отладка">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Консоль Unity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Частые проблемы
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-seedsql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 5. Тестовые учётные данные (из seed.sql)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 6. Описание каждого скрипта
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 6. Описание каждого скрипта">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apiconfigcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ApiConfig.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apimodelscs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ApiModels.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authsessioncs" class="md-nav__link">
    <span class="md-ellipsis">
      
        AuthSession.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apiclientcs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ApiClient.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gameapiservicecs" class="md-nav__link">
    <span class="md-ellipsis">
      
        GameApiService.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authcontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        AuthController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profilecontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        ProfileController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaderboardcontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        LeaderboardController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matchcontrollercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        MatchController.cs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventsendercs" class="md-nav__link">
    <span class="md-ellipsis">
      
        EventSender.cs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      
        Часть 7. Расширение проекта
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Часть 7. Расширение проекта">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Добавить новое событие
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#playerprefs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Сохранить токен между сессиями (PlayerPrefs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-prod" class="md-nav__link">
    <span class="md-ellipsis">
      
        Смена сервера (dev / prod)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="2-6-unity-strategy-support-is">2. Практика 6. Руководство по сборке Unity-клиента для strategy-support-is</h1>
<h2 id="_1">Что это такое и зачем</h2>
<p>Данный документ — пошаговая инструкция по созданию Unity-приложения, которое подключается к Flask-бэкенду <code>strategy-support-is</code> и обменивается с ним данными. Уровень реализации — учебный MVP: авторизация, профиль, события, завершение матча, лидерборд.</p>
<p>После выполнения всех шагов у вас будет Unity-приложение с тремя сценами, которое:
- Регистрирует и авторизует пользователей через Flask JWT
- Отображает профиль и прогресс игрока
- Отправляет игровые события с UUID-дедупликацией
- Завершает матч и получает начисленные сервером награды
- Показывает таблицу лидеров</p>
<hr>
<h2 id="1-unity">Часть 1. Теория: как Unity общается с сервером</h2>
<h3 id="61-rest-api-unity">6.1. Что такое REST API и почему это важно для Unity</h3>
<p>REST API — это набор URL-адресов (endpoint'ов) на сервере, к которым клиент обращается по протоколу HTTP. Unity выступает клиентом: она формирует запрос, отправляет его серверу и получает ответ в формате JSON.</p>
<p>Главное правило: <strong>сервер — источник истины</strong>. Unity не хранит постоянные данные о прогрессе, очках и наградах в себе. Всё это живёт в базе данных на сервере и запрашивается по API.</p>
<h3 id="62-http-">6.2. HTTP-методы</h3>
<table>
<thead>
<tr>
<th>Метод</th>
<th>Назначение</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>Получить данные</td>
<td><code>GET /api/v1/profile</code></td>
</tr>
<tr>
<td>POST</td>
<td>Создать / выполнить действие</td>
<td><code>POST /api/v1/match/finish</code></td>
</tr>
</tbody>
</table>
<h3 id="63-json">6.3. JSON — формат обмена данными</h3>
<p>Все запросы и ответы используют JSON. Unity сериализует классы C# в JSON с помощью <code>JsonUtility.ToJson()</code> и десериализует ответы обратно через <code>JsonUtility.FromJson&lt;T&gt;()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Пример запроса к /api/v1/auth/login</span>
<span class="p">{</span><span class="w"> </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@example.com"</span><span class="p">,</span><span class="w"> </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password123"</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Пример успешного ответа</span>
<span class="p">{</span><span class="w"> </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"accessToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ..."</span><span class="p">,</span><span class="w"> </span><span class="nt">"userId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Commander_Alice"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// Пример ответа с ошибкой</span>
<span class="p">{</span><span class="w"> </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UNAUTHORIZED"</span><span class="p">,</span><span class="w"> </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid credentials"</span><span class="p">,</span><span class="w"> </span><span class="nt">"requestId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"req_abc123"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<h3 id="64-jwt">6.4. JWT — как работает авторизация</h3>
<p><strong>JWT (JSON Web Token)</strong> — это зашифрованный токен, который сервер выдаёт после успешного входа. Все последующие запросы к защищённым endpoint'ам отправляются с заголовком:</p>
<div class="highlight"><pre><span></span><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
</code></pre></div>
<p>Токен хранится в памяти приложения (в классе <code>AuthSession</code>) и не сохраняется на диск (в учебном проекте). При перезапуске приложения нужно войти заново.</p>
<h3 id="65-unitywebrequest-http-unity">6.5. UnityWebRequest — HTTP в Unity</h3>
<p>Unity не может использовать <code>HttpClient</code> из .NET напрямую в корутинах. Для работы с HTTP используется <code>UnityWebRequest</code> — встроенный класс Unity.</p>
<p>Все вызовы API выполняются как <strong>корутины</strong> (IEnumerator + StartCoroutine). Это значит: HTTP-запрос не блокирует основной поток, а выполняется асинхронно в фоне.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Паттерн корутины</span>
<span class="n">StartCoroutine</span><span class="p">(</span><span class="n">api</span><span class="p">.</span><span class="n">Login</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span><span class="w"> </span><span class="s">"pass"</span><span class="p">,</span>
<span class="w">    </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">"OK: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="n">nickname</span><span class="p">),</span>
<span class="w">    </span><span class="n">onError</span><span class="p">:</span><span class="w">   </span><span class="n">err</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Debug</span><span class="p">.</span><span class="n">LogError</span><span class="p">(</span><span class="s">"Fail: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">err</span><span class="p">)));</span>
</code></pre></div>
<h3 id="66">6.6. Контракт всех ответов сервера</h3>
<p>Все ответы сервера имеют единую структуру:</p>
<div class="highlight"><pre><span></span><code>{ "ok": true/false, "data": {...} }   ← успех
{ "ok": false, "error": {...} }       ← ошибка
</code></pre></div>
<p>В Unity это отражено классом <code>ApiResponse&lt;T&gt;</code>:</p>
<div class="highlight"><pre><span></span><code><span class="na">[Serializable]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w">     </span><span class="n">ok</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w">        </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ApiError</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h2 id="2">Часть 2. Структура скриптов</h2>
<div class="highlight"><pre><span></span><code>Assets/
  Scripts/
    API/
      ApiConfig.cs        ← адрес сервера и все URL
      ApiModels.cs        ← все DTO (классы запросов/ответов)
      AuthSession.cs      ← хранит JWT-токен и UserId
      ApiClient.cs        ← низкоуровневый HTTP (Get/Post)
      GameApiService.cs   ← высокоуровневый сервис (Login/Profile/...)
    UI/
      AuthController.cs   ← экран входа/регистрации
      ProfileController.cs← экран профиля
      LeaderboardController.cs ← таблица лидеров
    Game/
      MatchController.cs  ← управление матчем
      EventSender.cs      ← отправка произвольных событий
</code></pre></div>
<h3 id="_2">Зависимости между слоями</h3>
<div class="highlight"><pre><span></span><code>UI / Game
    ↓  вызывают
GameApiService
    ↓  использует
ApiClient  +  AuthSession
    ↓  использует
UnityWebRequest  (встроен в Unity)
</code></pre></div>
<hr>
<h2 id="3-endpoint">Часть 3. Endpoint'ы сервера</h2>
<h3 id="31-endpoint">3.1. Таблица всех endpoint'ов</h3>
<table>
<thead>
<tr>
<th>Метод</th>
<th>URL</th>
<th>Авторизация</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/api/v1/auth/register</code></td>
<td>Нет</td>
<td>Регистрация</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/v1/auth/login</code></td>
<td>Нет</td>
<td>Вход, получить JWT</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/v1/profile</code></td>
<td>Bearer JWT</td>
<td>Профиль + прогресс</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/v1/events</code></td>
<td>Bearer JWT</td>
<td>Отправить игровое событие</td>
</tr>
<tr>
<td>POST</td>
<td><code>/api/v1/match/finish</code></td>
<td>Bearer JWT</td>
<td>Завершить матч</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/v1/leaderboard</code></td>
<td>Нет</td>
<td>Таблица лидеров</td>
</tr>
</tbody>
</table>
<h3 id="32-endpoint">3.2. Описание каждого endpoint'а</h3>
<h4 id="post-apiv1authregister">POST /api/v1/auth/register</h4>
<p><strong>Запрос:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"email"</span><span class="p">:</span><span class="w">    </span><span class="s2">"player@example.com"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mypassword"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Commander"</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ответ 201:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"userId"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Commander"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ошибки:</strong>
- <code>400</code> — не заполнены поля / пароль &lt; 6 символов
- <code>409</code> — email уже зарегистрирован</p>
<hr>
<h4 id="post-apiv1authlogin">POST /api/v1/auth/login</h4>
<p><strong>Запрос:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@example.com"</span><span class="p">,</span><span class="w"> </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password123"</span><span class="w"> </span><span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ответ 200:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"accessToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ..."</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"userId"</span><span class="p">:</span><span class="w">      </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w">    </span><span class="s2">"Commander_Alice"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ошибки:</strong>
- <code>401</code> — неверный пароль или email
- <code>403</code> — аккаунт заблокирован</p>
<blockquote>
<p>Данные из <code>seed.sql</code>: <code>alice@example.com</code> / <code>password123</code></p>
</blockquote>
<hr>
<h4 id="get-apiv1profile">GET /api/v1/profile</h4>
<p><strong>Заголовок:</strong> <code>Authorization: Bearer &lt;token&gt;</code></p>
<p><strong>Ответ 200:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"userId"</span><span class="p">:</span><span class="w">   </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"email"</span><span class="p">:</span><span class="w">    </span><span class="s2">"alice@example.com"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Commander_Alice"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"roles"</span><span class="p">:</span><span class="w">    </span><span class="p">[</span><span class="s2">"player"</span><span class="p">],</span>
<span class="w">    </span><span class="nt">"progress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"level"</span><span class="p">:</span><span class="w">        </span><span class="mi">42</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"xp"</span><span class="p">:</span><span class="w">           </span><span class="mi">85400</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"softCurrency"</span><span class="p">:</span><span class="w"> </span><span class="mi">12500</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"hardCurrency"</span><span class="p">:</span><span class="w"> </span><span class="mi">250</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ошибки:</strong>
- <code>401</code> — токен отсутствует или устарел
- <code>403</code> — аккаунт заблокирован</p>
<hr>
<h4 id="post-apiv1events">POST /api/v1/events</h4>
<p><strong>Заголовок:</strong> <code>Authorization: Bearer &lt;token&gt;</code></p>
<p><strong>Запрос:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"eventId"</span><span class="p">:</span><span class="w">   </span><span class="s2">"550e8400-e29b-41d4-a716-446655440000"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unit_deploy"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"sessionId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"clientTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2026-02-27T12:00:00.000Z"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"payload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"matchId"</span><span class="p">:</span><span class="w">  </span><span class="mi">9</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"unitCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cavalry"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"amount"</span><span class="p">:</span><span class="w">   </span><span class="mi">40</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"atSecond"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ответ 200:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"eventId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"550e..."</span><span class="p">,</span><span class="w"> </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"accepted"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Важно:</strong> <code>eventId</code> — уникальный UUID на каждое событие. Сервер отклонит повторный запрос с тем же <code>eventId</code> с кодом <code>409</code>.</p>
<p><strong>Ошибки:</strong>
- <code>400</code> — неверная структура
- <code>409</code> — дублирующийся <code>eventId</code></p>
<hr>
<h4 id="post-apiv1matchfinish">POST /api/v1/match/finish</h4>
<p><strong>Заголовок:</strong> <code>Authorization: Bearer &lt;token&gt;</code></p>
<p><strong>Запрос:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"matchId"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"isWin"</span><span class="p">:</span><span class="w">           </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"score"</span><span class="p">:</span><span class="w">           </span><span class="mi">1850</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"durationSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Ответ 200:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"matchId"</span><span class="p">:</span><span class="w">             </span><span class="mi">9</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"isWin"</span><span class="p">:</span><span class="w">               </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"xpGained"</span><span class="p">:</span><span class="w">            </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"softCurrencyGained"</span><span class="p">:</span><span class="w">  </span><span class="mi">50</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p></p>
<p><strong>Важно:</strong> XP и монеты <strong>рассчитывает сервер</strong>, клиент их не присылает.</p>
<p><strong>Ошибки:</strong>
- <code>404</code> — матч не найден
- <code>403</code> — матч принадлежит другому игроку
- <code>409</code> — матч уже завершён (status ≠ started)</p>
<hr>
<h4 id="get-apiv1leaderboard">GET /api/v1/leaderboard</h4>
<p><strong>Параметры запроса:</strong> <code>?boardCode=default&amp;season=1&amp;limit=10</code></p>
<p><strong>Ответ 200:</strong>
</p><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"boardCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"season"</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">"rank"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">"userId"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Siege_Eve"</span><span class="p">,</span><span class="w">     </span><span class="nt">"score"</span><span class="p">:</span><span class="w"> </span><span class="mi">9850</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nt">"rank"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">"userId"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nt">"nickname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WarLord_Carol"</span><span class="p">,</span><span class="w"> </span><span class="nt">"score"</span><span class="p">:</span><span class="w"> </span><span class="mi">8720</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p></p>
<hr>
<h2 id="4-unity">Часть 4. Пошаговая сборка проекта Unity</h2>
<h3 id="1">Шаг 1. Создать проект</h3>
<ol>
<li>Открыть <strong>Unity Hub</strong>.</li>
<li>Нажать <strong>New Project</strong> → выбрать шаблон <strong>2D</strong> (или <strong>3D</strong>) → назвать <code>StrategyClient</code>.</li>
<li>Нажать <strong>Create project</strong>.</li>
</ol>
<hr>
<h3 id="2_1">Шаг 2. Скопировать скрипты</h3>
<ol>
<li>В папке проекта откройте <code>Assets</code>.</li>
<li>Создайте структуру папок:
   <div class="highlight"><pre><span></span><code>Assets/Scripts/API/
Assets/Scripts/UI/
Assets/Scripts/Game/
</code></pre></div></li>
<li>Скопируйте все <code>.cs</code>-файлы из пакета в соответствующие папки:</li>
<li><code>API/</code> → <code>ApiConfig.cs</code>, <code>ApiModels.cs</code>, <code>AuthSession.cs</code>, <code>ApiClient.cs</code>, <code>GameApiService.cs</code></li>
<li><code>UI/</code>  → <code>AuthController.cs</code>, <code>ProfileController.cs</code>, <code>LeaderboardController.cs</code></li>
<li><code>Game/</code> → <code>MatchController.cs</code>, <code>EventSender.cs</code></li>
</ol>
<hr>
<h3 id="3">Шаг 3. Настроить адрес сервера</h3>
<p>Откройте <code>Assets/Scripts/API/ApiConfig.cs</code>. По умолчанию:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"http://127.0.0.1:5000"</span><span class="p">;</span>
</code></pre></div>
<p>Если Flask запущен на другом порту или машине — замените адрес здесь. Менять нужно только эту одну строчку.</p>
<hr>
<h3 id="4">Шаг 4. Запустить сервер</h3>
<p>Перед тестированием в Unity убедитесь, что Flask-сервер запущен:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>strategy-support-is
python<span class="w"> </span>wsgi.py
</code></pre></div>
<p>Сервер должен выводить:
</p><div class="highlight"><pre><span></span><code>* Running on http://127.0.0.1:5000
</code></pre></div><p></p>
<hr>
<h3 id="5-authscene">Шаг 5. Сцена AuthScene — экран входа</h3>
<h4 id="51">5.1. Создать сцену</h4>
<p><code>File → New Scene → Save As → Scenes/AuthScene</code>.</p>
<h4 id="52-canvas">5.2. Создать Canvas</h4>
<ol>
<li><code>GameObject → UI → Canvas</code>.</li>
<li>В Canvas создайте два панели: <code>LoginPanel</code> и <code>RegisterPanel</code>.</li>
</ol>
<h4 id="53-loginpanel">5.3. Наполнить LoginPanel</h4>
<p>Добавьте в <strong>LoginPanel</strong>:</p>
<table>
<thead>
<tr>
<th>Объект</th>
<th>Компонент</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EmailInput</code></td>
<td>TMP_InputField</td>
<td>Поле email</td>
</tr>
<tr>
<td><code>PasswordInput</code></td>
<td>TMP_InputField</td>
<td>Поле пароля (Password)</td>
</tr>
<tr>
<td><code>LoginButton</code></td>
<td>Button + TMP_Text</td>
<td>Кнопка "Войти"</td>
</tr>
<tr>
<td><code>StatusText</code></td>
<td>TMP_Text</td>
<td>Статус / ошибка</td>
</tr>
<tr>
<td><code>GoToRegisterButton</code></td>
<td>Button</td>
<td>Переключить панель</td>
</tr>
</tbody>
</table>
<h4 id="54-registerpanel">5.4. Наполнить RegisterPanel (аналогично)</h4>
<p>Добавьте поля email, password, nickname, кнопку регистрации и статус.</p>
<h4 id="55">5.5. Создать менеджер</h4>
<ol>
<li><code>GameObject → Create Empty</code> → назвать <code>AuthManager</code>.</li>
<li>Добавьте компоненты: <code>AuthController</code> и <code>GameApiService</code>.</li>
<li>Привяжите поля в Inspector:</li>
<li><code>loginPanel</code> → объект <code>LoginPanel</code></li>
<li><code>registerPanel</code> → объект <code>RegisterPanel</code></li>
<li><code>loginEmail</code> → <code>EmailInput</code></li>
<li><code>loginPassword</code> → <code>PasswordInput</code></li>
<li><code>loginButton</code> → <code>LoginButton</code></li>
<li><code>regEmail</code>, <code>regPassword</code>, <code>regNickname</code> → соответствующие поля</li>
<li><code>registerButton</code> → кнопка регистрации</li>
<li><code>statusText</code> → <code>StatusText</code></li>
<li>
<p><code>sceneAfterLogin</code> → <code>"MainMenu"</code> (имя следующей сцены)</p>
</li>
<li>
<p>На <code>GoToRegisterButton</code> в Inspector → <code>Button.OnClick</code>:</p>
</li>
<li>Добавить → выбрать <code>AuthManager</code> → метод <code>AuthController.ShowRegister</code>.</li>
</ol>
<hr>
<h3 id="6-mainmenu">Шаг 6. Сцена MainMenu — профиль и лидерборд</h3>
<h4 id="61">6.1. Создать сцену</h4>
<p><code>File → New Scene → Save As → Scenes/MainMenu</code>.</p>
<h4 id="62">6.2. Панель профиля</h4>
<ol>
<li>Создайте <code>GameObject → Create Empty</code> → <code>ProfileManager</code>.</li>
<li>Добавьте <code>ProfileController</code> и <code>GameApiService</code>.</li>
<li>В Canvas создайте панель <code>ProfilePanel</code> с TMP_Text-полями:</li>
<li><code>NicknameText</code>, <code>EmailText</code>, <code>LevelText</code>, <code>XpText</code>, <code>SoftText</code>, <code>HardText</code>, <code>StatusText</code></li>
<li>Привяжите все поля в Inspector у <code>ProfileController</code>.</li>
<li>Кнопка "Обновить" → <code>ProfileController.Refresh()</code>.</li>
</ol>
<h4 id="63">6.3. Панель лидерборда</h4>
<ol>
<li>Создайте <code>GameObject → Create Empty</code> → <code>LeaderboardManager</code>.</li>
<li>Добавьте <code>LeaderboardController</code> и <code>GameApiService</code>.</li>
<li>В Canvas создайте <code>ScrollView</code> для списка.</li>
<li>Создайте Prefab строки:</li>
<li><code>GameObject → Create Empty</code> → <code>LeaderboardRow</code>.</li>
<li>Добавьте три <code>TMP_Text</code>: <code>RankText</code>, <code>NicknameText</code>, <code>ScoreText</code>.</li>
<li>Сохраните в <code>Assets/Prefabs/LeaderboardRow.prefab</code>.</li>
<li>В Inspector <code>LeaderboardController</code>:</li>
<li><code>rowContainer</code> → <code>ScrollView/Viewport/Content</code></li>
<li><code>rowPrefab</code> → <code>LeaderboardRow.prefab</code></li>
</ol>
<hr>
<h3 id="7-gamescene">Шаг 7. Сцена GameScene — матч</h3>
<h4 id="71">7.1. Создать сцену</h4>
<p><code>File → New Scene → Save As → Scenes/GameScene</code>.</p>
<h4 id="72">7.2. Создать менеджер матча</h4>
<ol>
<li><code>GameObject → Create Empty</code> → <code>MatchManager</code>.</li>
<li>Добавьте <code>MatchController</code> и <code>GameApiService</code>.</li>
<li>В Inspector:</li>
<li><code>matchId</code> → <code>9</code> (матч из seed.sql, принадлежащий alice)</li>
<li>Привяжите: <code>timerText</code>, <code>statusText</code>, <code>rewardText</code>, <code>resultPanel</code></li>
</ol>
<h4 id="73">7.3. Кнопки тестирования</h4>
<p>Добавьте два Button:</p>
<ul>
<li><code>WinButton</code> → в OnClick: <code>MatchController.EndMatchWin()</code> или напишите обёртку:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Добавьте в MatchController для привязки кнопок в Inspector:</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EndMatchWin</span><span class="p">()</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">EndMatch</span><span class="p">(</span><span class="n">isWin</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w">  </span><span class="n">score</span><span class="p">:</span><span class="w"> </span><span class="mi">1850</span><span class="p">);</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EndMatchLose</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">EndMatch</span><span class="p">(</span><span class="n">isWin</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">:</span><span class="w">  </span><span class="mi">300</span><span class="p">);</span>
</code></pre></div>
<hr>
<h3 id="8-build-settings">Шаг 8. Добавить сцены в Build Settings</h3>
<ol>
<li><code>File → Build Settings</code>.</li>
<li>Нажать <strong>Add Open Scenes</strong> для каждой сцены: <code>AuthScene</code>, <code>MainMenu</code>, <code>GameScene</code>.</li>
<li>Убедиться, что <code>AuthScene</code> стоит первой (index 0).</li>
</ol>
<hr>
<h3 id="9">Шаг 9. Проверить работу</h3>
<p><strong>Порядок тестирования:</strong></p>
<ol>
<li>Запустить Flask: <code>python wsgi.py</code>.</li>
<li>Нажать <strong>Play</strong> в Unity.</li>
<li>Войти с данными из <code>seed.sql</code>: <code>alice@example.com</code> / <code>password123</code>.</li>
<li>После входа автоматически откроется <code>MainMenu</code>.</li>
<li>Проверить профиль — должны появиться данные уровня/XP.</li>
<li>Проверить лидерборд — должны появиться строки.</li>
<li>Перейти в <code>GameScene</code>, нажать "Победа" — должны появиться награды.</li>
</ol>
<hr>
<h3 id="10">Шаг 10. Отладка</h3>
<h4 id="unity">Консоль Unity</h4>
<p>Все запросы и ответы логируются через <code>Debug.Log</code>. При ошибке будет:
</p><div class="highlight"><pre><span></span><code>[Match] FinishMatch error: [409] Match is not in started state
</code></pre></div><p></p>
<h4 id="_3">Частые проблемы</h4>
<table>
<thead>
<tr>
<th>Проблема</th>
<th>Причина</th>
<th>Решение</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Connection refused</code></td>
<td>Flask не запущен</td>
<td><code>python wsgi.py</code></td>
</tr>
<tr>
<td><code>401 UNAUTHORIZED</code></td>
<td>Не выполнен вход</td>
<td>Вызвать Login() перед другими запросами</td>
</tr>
<tr>
<td><code>409 CONFLICT</code> при finish</td>
<td>Матч уже закрыт</td>
<td>Создать новый матч в БД или использовать другой <code>matchId</code></td>
</tr>
<tr>
<td><code>400 VALIDATION_ERROR</code></td>
<td>Неверный тип поля</td>
<td>Проверить DTO в <code>ApiModels.cs</code></td>
</tr>
<tr>
<td>JSON parse error</td>
<td>Ответ сервера не совпадает с моделью</td>
<td>Проверить поля класса в <code>ApiModels.cs</code></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="5-seedsql">Часть 5. Тестовые учётные данные (из seed.sql)</h2>
<table>
<thead>
<tr>
<th>Пользователь</th>
<th>Email</th>
<th>Пароль</th>
<th>Матч id=9</th>
</tr>
</thead>
<tbody>
<tr>
<td>alice</td>
<td><code>alice@example.com</code></td>
<td><code>password123</code></td>
<td>✅ owner</td>
</tr>
<tr>
<td>bob</td>
<td><code>bob@example.com</code></td>
<td><code>password123</code></td>
<td>—</td>
</tr>
<tr>
<td>banned</td>
<td><code>banned@example.com</code></td>
<td><code>password123</code></td>
<td>заблокирован</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="6">Часть 6. Описание каждого скрипта</h2>
<h3 id="apiconfigcs">ApiConfig.cs</h3>
<p>Единственное место где хранится <code>BaseUrl</code> и все строки URL. При смене адреса сервера меняется только здесь.</p>
<div class="highlight"><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.API</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Единая точка настройки адреса сервера.</span>
<span class="w">    </span><span class="c1">/// Меняйте BaseUrl под своё окружение:</span>
<span class="w">    </span><span class="c1">///   Локально:   http://127.0.0.1:5000</span>
<span class="w">    </span><span class="c1">///   Production: https://your-server.com</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiConfig</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"http://127.0.0.1:5000"</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Endpoints</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Register</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"/api/v1/auth/register"</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Login</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"/api/v1/auth/login"</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Profile</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"/api/v1/profile"</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Events</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"/api/v1/events"</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">MatchFinish</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"/api/v1/match/finish"</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Leaderboard</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">BaseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"/api/v1/leaderboard"</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Leaderboard defaults</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">DefaultBoard</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">"default"</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">DefaultSeason</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">DefaultLimit</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="apimodelscs">ApiModels.cs</h3>
<p>Все классы-модели данных (<code>[Serializable]</code>). Каждый класс точно соответствует полю <code>data</code> в ответе сервера. Нельзя переименовывать поля — JsonUtility сопоставляет их по имени.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.API</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// Общая обёртка ответов сервера</span>
<span class="w">    </span><span class="c1">// { "ok": true/false, "data": {...}, "error": {...} }</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">ok</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w">    </span><span class="n">data</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">ApiError</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiError</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">requestId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// POST /api/v1/auth/register</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RegisterRequest</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RegisterResponse</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">userId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// POST /api/v1/auth/login</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LoginRequest</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LoginResponse</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">accessToken</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">userId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// GET /api/v1/profile</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProfileUser</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">id</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">roles</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProfileProgress</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">xp</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">softCurrency</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hardCurrency</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProfileResponse</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">              </span><span class="n">userId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w">           </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w">           </span><span class="n">nickname</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">     </span><span class="n">roles</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">ProfileProgress</span><span class="w">  </span><span class="n">progress</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// POST /api/v1/events</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EventRequest</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">eventId</span><span class="p">;</span><span class="w">      </span><span class="c1">// UUID — обязателен для дедупликации</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">eventType</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w">   </span><span class="n">sessionId</span><span class="p">;</span><span class="w">    </span><span class="c1">// nullable</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">clientTime</span><span class="p">;</span><span class="w">   </span><span class="c1">// ISO 8601</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span><span class="w">      </span><span class="c1">// произвольный JSON-объект</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EventResponse</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">eventId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">       </span><span class="c1">// "accepted"</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// POST /api/v1/match/finish</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MatchResult</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="n">isWin</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">score</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">durationSeconds</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w">   </span><span class="n">powerDelta</span><span class="p">;</span><span class="w">    </span><span class="c1">// опционально</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MatchFinishRequest</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">         </span><span class="n">matchId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">MatchResult</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MatchFinishResponse</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">  </span><span class="n">matchId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isWin</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">  </span><span class="n">xpGained</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">  </span><span class="n">softCurrencyGained</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>
<span class="w">    </span><span class="c1">// GET /api/v1/leaderboard</span>
<span class="w">    </span><span class="c1">// ─────────────────────────────────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LeaderboardItem</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">rank</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">userId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">score</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LeaderboardResponse</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w">                </span><span class="n">boardCode</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">                   </span><span class="n">season</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LeaderboardItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="authsessioncs">AuthSession.cs</h3>
<p>Статический класс-синглтон. Хранит <code>AccessToken</code>, <code>UserId</code>, <code>Nickname</code> в памяти. Все API-клиенты читают токен из него автоматически.</p>
<div class="highlight"><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.API</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Хранит JWT-токен и данные текущего пользователя.</span>
<span class="w">    </span><span class="c1">/// Живёт в памяти на протяжении игровой сессии.</span>
<span class="w">    </span><span class="c1">/// Используется всеми API-клиентами для подстановки Bearer-заголовка.</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AuthSession</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">AccessToken</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">UserId</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Nickname</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="n">IsLoggedIn</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">AccessToken</span><span class="p">);</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Save</span><span class="p">(</span><span class="n">LoginResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">AccessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="n">accessToken</span><span class="p">;</span>
<span class="w">            </span><span class="n">UserId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="n">userId</span><span class="p">;</span>
<span class="w">            </span><span class="n">Nickname</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">resp</span><span class="p">.</span><span class="n">nickname</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">AccessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">            </span><span class="n">UserId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="n">Nickname</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="apiclientcs">ApiClient.cs</h3>
<p>Низкоуровневый слой. Умеет выполнять GET и POST через <code>UnityWebRequest</code>. Разбирает ответ в <code>ApiResponse&lt;T&gt;</code> и вызывает <code>onSuccess</code> или <code>onError</code>. Напрямую из UI не вызывается — только через <code>GameApiService</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine.Networking</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.API</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Низкоуровневый HTTP-клиент.</span>
<span class="w">    </span><span class="c1">/// Умеет отправлять GET и POST с JSON-телом.</span>
<span class="w">    </span><span class="c1">/// При наличии AccessToken автоматически добавляет заголовок Authorization.</span>
<span class="w">    </span><span class="c1">/// Все методы — корутины: вызывайте через StartCoroutine().</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApiClient</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ─── GET ────────────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Отправить GET-запрос и получить JSON-ответ.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="n">Get</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">url</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">    </span><span class="n">onError</span><span class="p">,</span>
<span class="w">            </span><span class="kt">bool</span><span class="w">              </span><span class="n">withAuth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UnityWebRequest</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

<span class="w">            </span><span class="n">SetHeaders</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">withAuth</span><span class="p">);</span>

<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="n">SendWebRequest</span><span class="p">();</span>

<span class="w">            </span><span class="n">HandleResponse</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── POST ───────────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Отправить POST-запрос с JSON-телом и получить JSON-ответ.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="n">Post</span><span class="o">&lt;</span><span class="n">TRequest</span><span class="p">,</span><span class="w"> </span><span class="n">TResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="kt">string</span><span class="w">   </span><span class="n">url</span><span class="p">,</span>
<span class="w">            </span><span class="n">TRequest</span><span class="w"> </span><span class="n">body</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">    </span><span class="n">onError</span><span class="p">,</span>
<span class="w">            </span><span class="kt">bool</span><span class="w">              </span><span class="n">withAuth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonUtility</span><span class="p">.</span><span class="n">ToJson</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
<span class="w">            </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>

<span class="w">            </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnityWebRequest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="s">"POST"</span><span class="p">);</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="n">uploadHandler</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UploadHandlerRaw</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="n">downloadHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DownloadHandlerBuffer</span><span class="p">();</span>

<span class="w">            </span><span class="n">SetHeaders</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">withAuth</span><span class="p">);</span>

<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="n">SendWebRequest</span><span class="p">();</span>

<span class="w">            </span><span class="n">HandleResponse</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Helpers ────────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetHeaders</span><span class="p">(</span><span class="n">UnityWebRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">withAuth</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="n">SetRequestHeader</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span><span class="w">  </span><span class="s">"application/json"</span><span class="p">);</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="n">SetRequestHeader</span><span class="p">(</span><span class="s">"Accept"</span><span class="p">,</span><span class="w">        </span><span class="s">"application/json"</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">withAuth</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">IsLoggedIn</span><span class="p">)</span>
<span class="w">                </span><span class="n">req</span><span class="p">.</span><span class="n">SetRequestHeader</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span><span class="w"> </span><span class="s">"Bearer "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">HandleResponse</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">UnityWebRequest</span><span class="w">   </span><span class="n">req</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">    </span><span class="n">onError</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UnityWebRequest</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Попытаться распарсить тело ошибки</span>
<span class="w">                </span><span class="kt">string</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="n">downloadHandler</span><span class="o">?.</span><span class="n">text</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s">""</span><span class="p">;</span>
<span class="w">                </span><span class="k">try</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kt">var</span><span class="w"> </span><span class="n">errWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonUtility</span><span class="p">.</span><span class="n">FromJson</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">raw</span><span class="p">);</span>
<span class="w">                    </span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errWrapper</span><span class="o">?.</span><span class="n">error</span><span class="o">?.</span><span class="n">message</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="n">error</span><span class="p">;</span>
<span class="w">                    </span><span class="n">onError</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="s">$"[{req.responseCode}] {msg}"</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">catch</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">onError</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="s">$"[{req.responseCode}] {req.error}"</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">try</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonUtility</span><span class="p">.</span><span class="n">FromJson</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">TResponse</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">downloadHandler</span><span class="p">.</span><span class="n">text</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wrapper</span><span class="p">.</span><span class="n">ok</span><span class="p">)</span>
<span class="w">                    </span><span class="n">onSuccess</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">wrapper</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="n">onError</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">wrapper</span><span class="p">.</span><span class="n">error</span><span class="o">?.</span><span class="n">message</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s">"Unknown server error"</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">onError</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="s">"Parse error: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="gameapiservicecs">GameApiService.cs</h3>
<p><code>MonoBehaviour</code>-компонент. Одна точка входа для всех вызовов. Каждый метод — корутина. Добавляется на GameObject в сцене.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.API</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Высокоуровневый сервис — одна точка входа для всех вызовов API.</span>
<span class="w">    </span><span class="c1">/// Использует ApiClient для HTTP и AuthSession для хранения токена.</span>
<span class="w">    </span><span class="c1">///</span>
<span class="w">    </span><span class="c1">/// Использование:</span>
<span class="w">    </span><span class="c1">///   GameApiService svc = GetComponent&lt;GameApiService&gt;();</span>
<span class="w">    </span><span class="c1">///   StartCoroutine(svc.Login("alice@example.com", "password123", onOk, onErr));</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">GameApiService</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ─── Auth ────────────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;POST /api/v1/auth/register&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">Register</span><span class="p">(</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">RegisterResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">           </span><span class="n">onError</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RegisterRequest</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">email</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">email</span><span class="p">,</span>
<span class="w">                </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">,</span>
<span class="w">                </span><span class="n">nickname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nickname</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span>
<span class="w">                </span><span class="n">ApiClient</span><span class="p">.</span><span class="n">Post</span><span class="o">&lt;</span><span class="n">RegisterRequest</span><span class="p">,</span><span class="w"> </span><span class="n">RegisterResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">Register</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">,</span><span class="w"> </span><span class="n">withAuth</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;POST /api/v1/auth/login — сохраняет токен в AuthSession&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">Login</span><span class="p">(</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">LoginResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">        </span><span class="n">onError</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoginRequest</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="p">};</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span>
<span class="w">                </span><span class="n">ApiClient</span><span class="p">.</span><span class="n">Post</span><span class="o">&lt;</span><span class="n">LoginRequest</span><span class="p">,</span><span class="w"> </span><span class="n">LoginResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">Login</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span>
<span class="w">                    </span><span class="n">resp</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">resp</span><span class="p">);</span>
<span class="w">                        </span><span class="n">onSuccess</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">resp</span><span class="p">);</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="n">onError</span><span class="p">,</span>
<span class="w">                    </span><span class="n">withAuth</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Logout</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ─── Profile ─────────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;GET /api/v1/profile — требует авторизации&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">GetProfile</span><span class="p">(</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">ProfileResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">          </span><span class="n">onError</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span>
<span class="w">                </span><span class="n">ApiClient</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">ProfileResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">Profile</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Events ──────────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;POST /api/v1/events — отправить игровое событие&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">SendEvent</span><span class="p">(</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">eventType</span><span class="p">,</span>
<span class="w">            </span><span class="kt">object</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">EventResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">        </span><span class="n">onError</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int?</span><span class="w">  </span><span class="n">sessionId</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">clientTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EventRequest</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">eventId</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">().</span><span class="n">ToString</span><span class="p">(),</span><span class="w">   </span><span class="c1">// уникальный UUID для дедупликации</span>
<span class="w">                </span><span class="n">eventType</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">eventType</span><span class="p">,</span>
<span class="w">                </span><span class="n">sessionId</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">sessionId</span><span class="p">,</span>
<span class="w">                </span><span class="n">clientTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clientTime</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">"o"</span><span class="p">),</span>
<span class="w">                </span><span class="n">payload</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span>
<span class="w">                </span><span class="n">ApiClient</span><span class="p">.</span><span class="n">Post</span><span class="o">&lt;</span><span class="n">EventRequest</span><span class="p">,</span><span class="w"> </span><span class="n">EventResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">Events</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Match ───────────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;POST /api/v1/match/finish — завершить матч&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">FinishMatch</span><span class="p">(</span>
<span class="w">            </span><span class="kt">int</span><span class="w">  </span><span class="n">matchId</span><span class="p">,</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">isWin</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w">  </span><span class="n">score</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w">  </span><span class="n">durationSeconds</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">MatchFinishResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">              </span><span class="n">onError</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int?</span><span class="w"> </span><span class="n">powerDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MatchFinishRequest</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">matchId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matchId</span><span class="p">,</span>
<span class="w">                </span><span class="n">result</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MatchResult</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isWin</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="n">isWin</span><span class="p">,</span>
<span class="w">                    </span><span class="n">score</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="n">score</span><span class="p">,</span>
<span class="w">                    </span><span class="n">durationSeconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">durationSeconds</span><span class="p">,</span>
<span class="w">                    </span><span class="n">powerDelta</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">powerDelta</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span>
<span class="w">                </span><span class="n">ApiClient</span><span class="p">.</span><span class="n">Post</span><span class="o">&lt;</span><span class="n">MatchFinishRequest</span><span class="p">,</span><span class="w"> </span><span class="n">MatchFinishResponse</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                    </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">MatchFinish</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Leaderboard ─────────────────────────────────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;GET /api/v1/leaderboard?boardCode=...&amp;season=...&amp;limit=...&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">GetLeaderboard</span><span class="p">(</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">LeaderboardResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w">              </span><span class="n">onError</span><span class="p">,</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">boardCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">DefaultBoard</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w">    </span><span class="n">season</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">DefaultSeason</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w">    </span><span class="n">limit</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">DefaultLimit</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$"{ApiConfig.Leaderboard}?boardCode={boardCode}&amp;season={season}&amp;limit={limit}"</span><span class="p">;</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span>
<span class="w">                </span><span class="n">ApiClient</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">LeaderboardResponse</span><span class="o">&gt;</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">onSuccess</span><span class="p">,</span><span class="w"> </span><span class="n">onError</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="authcontrollercs">AuthController.cs</h3>
<p>Управляет UI-логикой экрана входа/регистрации. После успешного входа загружает следующую сцену через <code>SceneManager.LoadScene()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine.UI</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">StrategyGame.API</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.UI</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Контроллер экрана авторизации.</span>
<span class="w">    </span><span class="c1">///</span>
<span class="w">    </span><span class="c1">/// Как подключить в сцене:</span>
<span class="w">    </span><span class="c1">///   1. Создайте пустой GameObject "AuthManager".</span>
<span class="w">    </span><span class="c1">///   2. Добавьте компоненты AuthController и GameApiService.</span>
<span class="w">    </span><span class="c1">///   3. Привяжите UI-поля в Inspector.</span>
<span class="w">    </span><span class="c1">///   4. Укажите onLoginSuccess: имя сцены которую надо загрузить после входа.</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AuthController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="na">[Header("Panels")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">GameObject</span><span class="w"> </span><span class="n">loginPanel</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">GameObject</span><span class="w"> </span><span class="n">registerPanel</span><span class="p">;</span>

<span class="w">        </span><span class="na">[Header("Login Fields")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_InputField</span><span class="w"> </span><span class="n">loginEmail</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_InputField</span><span class="w"> </span><span class="n">loginPassword</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">Button</span><span class="w">         </span><span class="n">loginButton</span><span class="p">;</span>

<span class="w">        </span><span class="na">[Header("Register Fields")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_InputField</span><span class="w"> </span><span class="n">regEmail</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_InputField</span><span class="w"> </span><span class="n">regPassword</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_InputField</span><span class="w"> </span><span class="n">regNickname</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">Button</span><span class="w">         </span><span class="n">registerButton</span><span class="p">;</span>

<span class="w">        </span><span class="na">[Header("Status")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">statusText</span><span class="p">;</span>

<span class="w">        </span><span class="na">[Header("Navigation")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">sceneAfterLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"MainMenu"</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="n">GameApiService</span><span class="w"> </span><span class="n">_api</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Awake</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_api</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">                </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">            </span><span class="n">loginButton</span><span class="w">   </span><span class="p">.</span><span class="n">onClick</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(</span><span class="n">OnLoginClick</span><span class="p">);</span>
<span class="w">            </span><span class="n">registerButton</span><span class="p">.</span><span class="n">onClick</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(</span><span class="n">OnRegisterClick</span><span class="p">);</span>

<span class="w">            </span><span class="n">ShowLogin</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Переключение панелей ────────────────────────────────</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ShowLogin</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">loginPanel</span><span class="w">   </span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">registerPanel</span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ShowRegister</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">loginPanel</span><span class="w">   </span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="w">            </span><span class="n">registerPanel</span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Логин ──────────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnLoginClick</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loginEmail</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">Trim</span><span class="p">();</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">pass</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">loginPassword</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">pass</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Заполните email и пароль"</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Вход..."</span><span class="p">);</span>
<span class="w">            </span><span class="n">SetInteractable</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="w">            </span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">_api</span><span class="p">.</span><span class="n">Login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">pass</span><span class="p">,</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">$"Добро пожаловать, {resp.nickname}!"</span><span class="p">);</span>
<span class="w">                    </span><span class="n">SetInteractable</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">                    </span><span class="c1">// Переход в главное меню</span>
<span class="w">                    </span><span class="n">UnityEngine</span><span class="p">.</span><span class="n">SceneManagement</span><span class="p">.</span><span class="n">SceneManager</span><span class="p">.</span><span class="n">LoadScene</span><span class="p">(</span><span class="n">sceneAfterLogin</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">                    </span><span class="n">SetInteractable</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">                </span><span class="p">}));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Регистрация ─────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnRegisterClick</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">regEmail</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">Trim</span><span class="p">();</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">pass</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">regPassword</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>
<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">nickname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regNickname</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">Trim</span><span class="p">();</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">pass</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">nickname</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Заполните все поля"</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Регистрация..."</span><span class="p">);</span>
<span class="w">            </span><span class="n">SetInteractable</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="w">            </span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">_api</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">pass</span><span class="p">,</span><span class="w"> </span><span class="n">nickname</span><span class="p">,</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Аккаунт создан! Войдите."</span><span class="p">);</span>
<span class="w">                    </span><span class="n">SetInteractable</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">                    </span><span class="n">ShowLogin</span><span class="p">();</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">                    </span><span class="n">SetInteractable</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="w">                </span><span class="p">}));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Helpers ─────────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetStatus</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">statusText</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetInteractable</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">loginButton</span><span class="w">   </span><span class="p">.</span><span class="n">interactable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">            </span><span class="n">registerButton</span><span class="p">.</span><span class="n">interactable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="profilecontrollercs">ProfileController.cs</h3>
<p>Запрашивает профиль при <code>Start()</code> и отображает данные в TMP_Text-полях. Кнопка <code>Refresh</code> вызывает повторный запрос.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">StrategyGame.API</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.UI</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Отображает профиль текущего игрока.</span>
<span class="w">    </span><span class="c1">///</span>
<span class="w">    </span><span class="c1">/// Как подключить:</span>
<span class="w">    </span><span class="c1">///   1. GameObject "ProfilePanel" → добавить ProfileController + GameApiService.</span>
<span class="w">    </span><span class="c1">///   2. Привязать TMP-поля в Inspector.</span>
<span class="w">    </span><span class="c1">///   3. Вызывается автоматически при Start().</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProfileController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="na">[Header("UI Labels")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">nicknameText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">emailText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">levelText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">xpText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">softCurrencyText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">hardCurrencyText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">statusText</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="n">GameApiService</span><span class="w"> </span><span class="n">_api</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Awake</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_api</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">                </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">AuthSession</span><span class="p">.</span><span class="n">IsLoggedIn</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Не авторизован"</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Refresh</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;Перезагрузить данные профиля с сервера.&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Refresh</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Загрузка..."</span><span class="p">);</span>
<span class="w">            </span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">_api</span><span class="p">.</span><span class="n">GetProfile</span><span class="p">(</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">ApplyProfile</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">SetStatus</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">)));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Применение данных ────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyProfile</span><span class="p">(</span><span class="n">ProfileResponse</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nicknameText</span><span class="p">)</span><span class="w">     </span><span class="n">nicknameText</span><span class="p">.</span><span class="n">text</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">nickname</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">emailText</span><span class="p">)</span><span class="w">        </span><span class="n">emailText</span><span class="p">.</span><span class="n">text</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">email</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">levelText</span><span class="p">)</span><span class="w">        </span><span class="n">levelText</span><span class="p">.</span><span class="n">text</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">$"Уровень {data.progress?.level}"</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xpText</span><span class="p">)</span><span class="w">           </span><span class="n">xpText</span><span class="p">.</span><span class="n">text</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s">$"XP: {data.progress?.xp}"</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">softCurrencyText</span><span class="p">)</span><span class="w"> </span><span class="n">softCurrencyText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$"Монеты: {data.progress?.softCurrency}"</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hardCurrencyText</span><span class="p">)</span><span class="w"> </span><span class="n">hardCurrencyText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$"Гемы: {data.progress?.hardCurrency}"</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetStatus</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">statusText</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">gray</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="leaderboardcontrollercs">LeaderboardController.cs</h3>
<p>При <code>Start()</code> запрашивает таблицу лидеров и создаёт экземпляры <code>rowPrefab</code> для каждой строки.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine.UI</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">StrategyGame.API</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.UI</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Загружает и отображает таблицу лидеров.</span>
<span class="w">    </span><span class="c1">///</span>
<span class="w">    </span><span class="c1">/// Как подключить:</span>
<span class="w">    </span><span class="c1">///   1. GameObject "LeaderboardPanel" → добавить LeaderboardController + GameApiService.</span>
<span class="w">    </span><span class="c1">///   2. Создайте Prefab строки: TMP_Text rank | nickname | score.</span>
<span class="w">    </span><span class="c1">///      Привяжите как rowPrefab.</span>
<span class="w">    </span><span class="c1">///   3. Привяжите ScrollView.Content как rowContainer.</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LeaderboardController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="na">[Header("List")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">Transform</span><span class="w"> </span><span class="n">rowContainer</span><span class="p">;</span><span class="w">   </span><span class="c1">// ScrollView &gt; Viewport &gt; Content</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">GameObject</span><span class="w"> </span><span class="n">rowPrefab</span><span class="p">;</span><span class="w">     </span><span class="c1">// Prefab строки таблицы</span>

<span class="w">        </span><span class="na">[Header("Status")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">statusText</span><span class="p">;</span>

<span class="w">        </span><span class="na">[Header("Settings")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">boardCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">DefaultBoard</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">season</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">DefaultSeason</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">limit</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ApiConfig</span><span class="p">.</span><span class="n">DefaultLimit</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="n">GameApiService</span><span class="w"> </span><span class="n">_api</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Awake</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_api</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">                </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Refresh</span><span class="p">();</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;Перезагрузить таблицу с сервера.&lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Refresh</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Загрузка..."</span><span class="p">);</span>
<span class="w">            </span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">_api</span><span class="p">.</span><span class="n">GetLeaderboard</span><span class="p">(</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Render</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">SetStatus</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">),</span>
<span class="w">                </span><span class="n">boardCode</span><span class="p">:</span><span class="w"> </span><span class="n">boardCode</span><span class="p">,</span>
<span class="w">                </span><span class="n">season</span><span class="p">:</span><span class="w">    </span><span class="n">season</span><span class="p">,</span>
<span class="w">                </span><span class="n">limit</span><span class="p">:</span><span class="w">     </span><span class="n">limit</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Рендер строк ─────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">(</span><span class="n">LeaderboardResponse</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Очистить старые строки</span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Transform</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">rowContainer</span><span class="p">)</span>
<span class="w">                </span><span class="n">Destroy</span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">gameObject</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">items</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Таблица пуста"</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instantiate</span><span class="p">(</span><span class="n">rowPrefab</span><span class="p">,</span><span class="w"> </span><span class="n">rowContainer</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// Ищем TMP-поля в prefab по тегам или именам объектов</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="p">.</span><span class="n">GetComponentsInChildren</span><span class="o">&lt;</span><span class="n">TMP_Text</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">labels</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">rank</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">                    </span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">nickname</span><span class="p">;</span>
<span class="w">                    </span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">score</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetStatus</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">statusText</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">gray</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="matchcontrollercs">MatchController.cs</h3>
<p>При <code>Start()</code> запускает таймер и отправляет <code>match_start</code> событие. Метод <code>EndMatch(isWin, score)</code> останавливает таймер и отправляет <code>POST /api/v1/match/finish</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">TMPro</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">StrategyGame.API</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.Game</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Управляет жизненным циклом матча в Unity:</span>
<span class="w">    </span><span class="c1">///   • Отправляет событие match_start</span>
<span class="w">    </span><span class="c1">///   • Считает время матча</span>
<span class="w">    </span><span class="c1">///   • При вызове EndMatch() — отправляет POST /api/v1/match/finish</span>
<span class="w">    </span><span class="c1">///   • Показывает результат (награды) в UI</span>
<span class="w">    </span><span class="c1">///</span>
<span class="w">    </span><span class="c1">/// Как подключить:</span>
<span class="w">    </span><span class="c1">///   1. Создайте GameObject "MatchManager".</span>
<span class="w">    </span><span class="c1">///   2. Добавьте MatchController + GameApiService.</span>
<span class="w">    </span><span class="c1">///   3. Привяжите UI-поля в Inspector.</span>
<span class="w">    </span><span class="c1">///   4. Назначьте matchId в Inspector (или задайте через код перед стартом матча).</span>
<span class="w">    </span><span class="c1">///   5. Вызывайте EndMatch(isWin, score) из игровой логики.</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MatchController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MonoBehaviour</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="na">[Header("Match Settings")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">matchId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w">    </span><span class="c1">// id матча из БД (seed.sql → id=9)</span>

<span class="w">        </span><span class="na">[Header("UI")]</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">timerText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">statusText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">TMP_Text</span><span class="w"> </span><span class="n">rewardText</span><span class="p">;</span>
<span class="w">        </span><span class="na">[SerializeField]</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">GameObject</span><span class="w"> </span><span class="n">resultPanel</span><span class="p">;</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="n">GameApiService</span><span class="w"> </span><span class="n">_api</span><span class="p">;</span>
<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="kt">float</span><span class="w">          </span><span class="n">_elapsed</span><span class="p">;</span>
<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w">           </span><span class="n">_running</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// ─── Lifecycle ───────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Awake</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_api</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">                </span><span class="n">_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultPanel</span><span class="p">)</span><span class="w"> </span><span class="n">resultPanel</span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">StartMatch</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_running</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">_elapsed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">timerText</span><span class="p">)</span>
<span class="w">                </span><span class="n">timerText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FormatTime</span><span class="p">(</span><span class="n">_elapsed</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Старт матча ─────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">StartMatch</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0f</span><span class="p">;</span>
<span class="w">            </span><span class="n">_running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>

<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Матч начался!"</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Отправляем событие match_start</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MatchStartPayload</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">matchId</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">matchId</span><span class="p">,</span>
<span class="w">                </span><span class="n">mode</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">"pve"</span><span class="p">,</span>
<span class="w">                </span><span class="n">mapCode</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">"coastal_siege"</span><span class="p">,</span>
<span class="w">                </span><span class="n">season</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">_api</span><span class="p">.</span><span class="n">SendEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">eventType</span><span class="p">:</span><span class="w"> </span><span class="s">"match_start"</span><span class="p">,</span>
<span class="w">                </span><span class="n">payload</span><span class="p">:</span><span class="w">   </span><span class="n">payload</span><span class="p">,</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">"[Match] match_start принят"</span><span class="p">),</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w">   </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Debug</span><span class="p">.</span><span class="n">LogWarning</span><span class="p">(</span><span class="s">"[Match] match_start ошибка: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">err</span><span class="p">)));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Конец матча (вызывать из игровой логики) ────────────</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Завершить матч. Вызывайте когда игра выиграна или проиграна.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EndMatch</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">isWin</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_running</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">_running</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mathf</span><span class="p">.</span><span class="n">RoundToInt</span><span class="p">(</span><span class="n">_elapsed</span><span class="p">);</span>
<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="n">isWin</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"Победа! Отправляем результат..."</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">"Поражение... Отправляем результат..."</span><span class="p">);</span>

<span class="w">            </span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">SendMatchFinish</span><span class="p">(</span><span class="n">isWin</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">SendMatchFinish</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">isWin</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">duration</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">StartCoroutine</span><span class="p">(</span><span class="n">_api</span><span class="p">.</span><span class="n">FinishMatch</span><span class="p">(</span>
<span class="w">                </span><span class="n">matchId</span><span class="p">:</span><span class="w">         </span><span class="n">matchId</span><span class="p">,</span>
<span class="w">                </span><span class="n">isWin</span><span class="p">:</span><span class="w">           </span><span class="n">isWin</span><span class="p">,</span>
<span class="w">                </span><span class="n">score</span><span class="p">:</span><span class="w">           </span><span class="n">score</span><span class="p">,</span>
<span class="w">                </span><span class="n">durationSeconds</span><span class="p">:</span><span class="w"> </span><span class="n">duration</span><span class="p">,</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">ShowResult</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">SetStatus</span><span class="p">(</span><span class="s">"Ошибка: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">LogError</span><span class="p">(</span><span class="s">"[Match] FinishMatch error: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<span class="w">                </span><span class="p">}));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Отображение результата ──────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ShowResult</span><span class="p">(</span><span class="n">MatchFinishResponse</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultPanel</span><span class="p">)</span><span class="w"> </span><span class="n">resultPanel</span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">isWin</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"🏆 ПОБЕДА!"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">"💀 ПОРАЖЕНИЕ"</span><span class="p">;</span>
<span class="w">            </span><span class="n">SetStatus</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rewardText</span><span class="p">)</span>
<span class="w">                </span><span class="n">rewardText</span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$"+{data.xpGained} XP\n+{data.softCurrencyGained} монет"</span><span class="p">;</span>

<span class="w">            </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">$"[Match] Завершён. isWin={data.isWin} xp={data.xpGained} soft={data.softCurrencyGained}"</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// ─── Helpers ─────────────────────────────────────────────</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetStatus</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">statusText</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">            </span><span class="n">statusText</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">FormatTime</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">seconds</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">seconds</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">60</span><span class="p">;</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">seconds</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">60</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">$"{m:00}:{s:00}"</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─── Payload для match_start ──────────────────────────────────</span>

<span class="w">    </span><span class="na">[System.Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MatchStartPayload</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">matchId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">mode</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">mapCode</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">season</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<h3 id="eventsendercs">EventSender.cs</h3>
<p>Статический вспомогательный класс. Метод <code>EventSender.Send(this, "eventType", payload)</code> ищет <code>GameApiService</code> в сцене и отправляет произвольное событие.</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">StrategyGame.API</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">StrategyGame.Game</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">    </span><span class="c1">/// Вспомогательный компонент для отправки произвольных игровых событий.</span>
<span class="w">    </span><span class="c1">///</span>
<span class="w">    </span><span class="c1">/// Использование из любого MonoBehaviour:</span>
<span class="w">    </span><span class="c1">///   EventSender.Send(this, "unit_deploy", new { matchId=9, unitCode="cavalry", amount=40 });</span>
<span class="w">    </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EventSender</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Отправить событие через GameApiService, найденный в сцене.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Send</span><span class="p">(</span><span class="n">MonoBehaviour</span><span class="w"> </span><span class="n">caller</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">eventType</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span>
<span class="w">            </span><span class="n">Action</span><span class="w"> </span><span class="n">onSuccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">svc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UnityEngine</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">FindObjectOfType</span><span class="o">&lt;</span><span class="n">GameApiService</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">svc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Debug</span><span class="p">.</span><span class="n">LogError</span><span class="p">(</span><span class="s">"[EventSender] GameApiService не найден в сцене!"</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">caller</span><span class="p">.</span><span class="n">StartCoroutine</span><span class="p">(</span><span class="n">svc</span><span class="p">.</span><span class="n">SendEvent</span><span class="p">(</span>
<span class="w">                </span><span class="n">eventType</span><span class="p">:</span><span class="w"> </span><span class="n">eventType</span><span class="p">,</span>
<span class="w">                </span><span class="n">payload</span><span class="p">:</span><span class="w">   </span><span class="n">payload</span><span class="p">,</span>
<span class="w">                </span><span class="n">onSuccess</span><span class="p">:</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">$"[Event] {eventType} принят: {resp.eventId}"</span><span class="p">);</span>
<span class="w">                    </span><span class="n">onSuccess</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">();</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">onError</span><span class="p">:</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Debug</span><span class="p">.</span><span class="n">LogWarning</span><span class="p">(</span><span class="s">$"[Event] {eventType} ошибка: {err}"</span><span class="p">);</span>
<span class="w">                    </span><span class="n">onError</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">                </span><span class="p">}));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ─── Готовые payload-классы для жанровых событий ─────────────</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UnitDeployPayload</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">matchId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">unitCode</span><span class="p">;</span><span class="w">   </span><span class="c1">// infantry / cavalry / archer / siege</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">atSecond</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UnitRetreatPayload</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">matchId</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">unitCode</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">lost</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">atSecond</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Serializable]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BuildingUpgradePayload</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">buildingCode</span><span class="p">;</span><span class="w">  </span><span class="c1">// barracks / farm / forge / walls</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">fromLevel</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">toLevel</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="n">goldCost</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr>
<hr>
<h2 id="7">Часть 7. Расширение проекта</h2>
<h3 id="_4">Добавить новое событие</h3>
<ol>
<li>
<p>В <code>EventSender.cs</code> добавить новый payload-класс:
</p><div class="highlight"><pre><span></span><code><span class="na">[Serializable]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MyEventPayload</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">matchId</span><span class="p">;</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div><p></p>
</li>
<li>
<p>Отправить из любого MonoBehaviour:
</p><div class="highlight"><pre><span></span><code><span class="n">EventSender</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">"my_event"</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyEventPayload</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">matchId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"test"</span><span class="w"> </span><span class="p">});</span>
</code></pre></div><p></p>
</li>
</ol>
<h3 id="playerprefs">Сохранить токен между сессиями (PlayerPrefs)</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// При сохранении:</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">SetString</span><span class="p">(</span><span class="s">"token"</span><span class="p">,</span><span class="w">    </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">SetInt</span><span class="w">   </span><span class="p">(</span><span class="s">"userId"</span><span class="p">,</span><span class="w">   </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">UserId</span><span class="p">);</span>
<span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">SetString</span><span class="p">(</span><span class="s">"nickname"</span><span class="p">,</span><span class="w"> </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">Nickname</span><span class="p">);</span>

<span class="c1">// При загрузке:</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">HasKey</span><span class="p">(</span><span class="s">"token"</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">fakeResp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoginResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="s">"token"</span><span class="p">),</span>
<span class="w">        </span><span class="n">userId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">GetInt</span><span class="p">(</span><span class="s">"userId"</span><span class="p">),</span>
<span class="w">        </span><span class="n">nickname</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerPrefs</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="s">"nickname"</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">AuthSession</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">fakeResp</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="dev-prod">Смена сервера (dev / prod)</h3>
<p>Измените <code>ApiConfig.BaseUrl</code>:
</p><div class="highlight"><pre><span></span><code><span class="c1">// Локально:    "http://127.0.0.1:5000"</span>
<span class="c1">// По сети:     "http://192.168.1.100:5000"</span>
<span class="c1">// Production:  "https://your-server.com"</span>
</code></pre></div><p></p>
<hr>
<h1 id="_5">Ссылка на пример проекта</h1>
<p><a href="https://github.com/OlgaKraven/strategy-support-is.git">!Ссылка на пример проекта</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  К началу
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.image.zoom", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../assets/js/mermaid-init.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>